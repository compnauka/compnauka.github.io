<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–º—ñ–π–∫–∞ - –ö–ª–∞—Å–∏—á–Ω–∞ –≥—Ä–∞</title>
    <meta name="description" content="–ö–ª–∞—Å–∏—á–Ω–∞ –≥—Ä–∞ –ó–º—ñ–π–∫–∞ –∑ –∫–µ—Ä—É–≤–∞–Ω–Ω—è–º —Å—Ç—Ä—ñ–ª–∫–∞–º–∏ —Ç–∞ —Å–≤–∞–π–ø–∞–º–∏">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            /* –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è "—Å—Ç—Ä–∏–±–∫–∞–º" –µ–∫—Ä–∞–Ω—É –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö –ø—Ä–∏ –¥–æ—Ç–∏–∫—É */
            touch-action: none;
        }

        .container {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
        }

        h1 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .score-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            gap: 20px;
        }

        .score-item {
            font-size: 1.2em;
            color: #333;
            font-weight: bold;
        }

        .score-label {
            color: #666;
            font-size: 0.9em;
            display: block;
        }

        .score-value {
            color: #667eea;
            font-size: 1.5em;
        }

        canvas {
            border: 4px solid #667eea;
            border-radius: 10px;
            background: #f0f0f0;
            display: block;
            margin: 0 auto 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            max-width: 100%;
            height: auto;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        button:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .start-btn {
            background: #48bb78;
            color: white;
        }

        .start-btn:hover:not(:disabled) {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .pause-btn {
            background: #ed8936;
            color: white;
        }

        .pause-btn:hover:not(:disabled) {
            background: #dd6b20;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .info {
            margin-top: 20px;
            color: #666;
            font-size: 0.9em;
        }

        .game-over {
            display: none;
            color: #e53e3e;
            font-size: 1.8em;
            font-weight: bold;
            margin: 20px 0;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 2em;
            }
            
            .container {
                padding: 20px;
            }
            
            button {
                padding: 10px 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêç –ó–º—ñ–π–∫–∞</h1>
        <div class="score-container">
            <div class="score-item">
                <span class="score-label">–†–∞—Ö—É–Ω–æ–∫</span>
                <div class="score-value" id="score" aria-live="polite">0</div>
            </div>
            <div class="score-item">
                <span class="score-label">–†–µ–∫–æ—Ä–¥</span>
                <div class="score-value" id="highScore" aria-live="polite">0</div>
            </div>
        </div>
        <canvas id="gameCanvas" width="400" height="400" role="img" aria-label="–Ü–≥—Ä–æ–≤–µ –ø–æ–ª–µ –∑–º—ñ–π–∫–∏"></canvas>
        <div class="game-over" id="gameOver" role="alert">–ì—Ä–∞ –∑–∞–∫—ñ–Ω—á–µ–Ω–∞!</div>
        <div class="controls">
            <button class="start-btn" id="startBtn" onclick="game.start()">–ù–æ–≤–∞ –≥—Ä–∞</button>
            <button class="pause-btn" id="pauseBtn" onclick="game.togglePause()" disabled>–ü–∞—É–∑–∞</button>
        </div>
        <div class="info">–ö–µ—Ä—É–≤–∞–Ω–Ω—è: —Å—Ç—Ä—ñ–ª–∫–∏ ‚Üê ‚Üë ‚Üí ‚Üì –∞–±–æ —Å–≤–∞–π–ø–∏</div>
    </div>

    <script>
        'use strict';

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –≥—Ä–∏
        const CONFIG = {
            GRID_SIZE: 20,
            CANVAS_SIZE: 400,
            INITIAL_SPEED_MS: 200, // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤ –º—Å
            MIN_SPEED_MS: 70,       // –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª
            SPEED_INCREASE_MS: 5,   // –ó–º–µ–Ω—à–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –ø—Ä–∏ –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—ñ
            SCORE_FOR_SPEED_INCREASE: 5, // –ö-—Ç—å –æ—á–æ–∫ –¥–ª—è –ø—Ä–∏—Å–∫–æ—Ä–µ–Ω–Ω—è
            INITIAL_POSITION: { x: 10, y: 10 },
            COLORS: {
                BACKGROUND: '#f0f0f0',
                SNAKE_HEAD: '#48bb78',
                SNAKE_BODY: '#68d391',
                SNAKE_BORDER: '#2f855a',
                FOOD: '#e53e3e'
            },
            DIRECTIONS: {
                LEFT: { x: -1, y: 0 },
                RIGHT: { x: 1, y: 0 },
                UP: { x: 0, y: -1 },
                DOWN: { x: 0, y: 1 }
            }
        };

        // –ö–ª–∞—Å –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≥—Ä–æ—é
        class SnakeGame {
            constructor() {
                // UI –µ–ª–µ–º–µ–Ω—Ç–∏
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.scoreElement = document.getElementById('score');
                this.highScoreElement = document.getElementById('highScore');
                this.gameOverElement = document.getElementById('gameOver');
                this.startBtn = document.getElementById('startBtn');
                this.pauseBtn = document.getElementById('pauseBtn');
                
                this.tileCount = CONFIG.CANVAS_SIZE / CONFIG.GRID_SIZE;
                this.loadHighScore();
                this.setupEventListeners();
                this.reset();
                this.drawWelcomeScreen();
            }

            reset() {
                this.snake = [{ ...CONFIG.INITIAL_POSITION }];
                this.direction = { ...CONFIG.DIRECTIONS.RIGHT };
                this.nextDirection = { ...CONFIG.DIRECTIONS.RIGHT };
                this.food = null;
                this.score = 0;
                this.gameSpeed = CONFIG.INITIAL_SPEED_MS;
                
                // –°—Ç–∞–Ω –≥—Ä–∏
                this.isRunning = false;
                this.isPaused = false;
                this.directionChangedInTick = false; // NEW: –ó–∞–ø–æ–±—ñ–≥–∞—î –∫—ñ–ª—å–∫–æ–º –∑–º—ñ–Ω–∞–º –Ω–∞–ø—Ä—è–º–∫—É –∑–∞ –æ–¥–∏–Ω —Ç—ñ–∫

                // NEW: –î–ª—è requestAnimationFrame
                this.gameLoopId = null;
                this.lastTickTime = 0;

                // NEW: –î–ª—è —Å–≤–∞–π–ø—ñ–≤
                this.touchStartX = 0;
                this.touchStartY = 0;
            }

            setupEventListeners() {
                document.addEventListener('keydown', (e) => this.handleKeyPress(e));
                
                // NEW: –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è —Å–≤–∞–π–ø—ñ–≤
                this.canvas.addEventListener('touchstart', (e) => this.handleTouchStart(e), { passive: true });
                this.canvas.addEventListener('touchmove', (e) => this.handleTouchMove(e), { passive: false });
                this.canvas.addEventListener('touchend', (e) => this.handleTouchEnd(e), { passive: true });

                window.addEventListener('keydown', (e) => {
                    if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
                        e.preventDefault();
                    }
                });
            }
            
            // NEW: –õ–æ–≥—ñ–∫–∞ –∑–º—ñ–Ω–∏ –Ω–∞–ø—Ä—è–º–∫—É –≤–∏–Ω–µ—Å–µ–Ω–∞ –≤ –æ–∫—Ä–µ–º–∏–π –º–µ—Ç–æ–¥
            changeDirection(newDirection) {
                if (this.directionChangedInTick) return;

                const currentDir = this.direction;
                // –ó–∞–±–æ—Ä–æ–Ω–∞ —Ä–æ–∑–≤–æ—Ä–æ—Ç—É –Ω–∞ 180 –≥—Ä–∞–¥—É—Å—ñ–≤
                if (newDirection.x === -currentDir.x && newDirection.y === -currentDir.y) {
                    return;
                }
                
                this.nextDirection = newDirection;
                this.directionChangedInTick = true;
            }

            handleKeyPress(e) {
                if (!this.isRunning || this.isPaused) return;

                switch (e.key) {
                    case 'ArrowLeft':
                        this.changeDirection({ ...CONFIG.DIRECTIONS.LEFT });
                        break;
                    case 'ArrowRight':
                        this.changeDirection({ ...CONFIG.DIRECTIONS.RIGHT });
                        break;
                    case 'ArrowUp':
                        this.changeDirection({ ...CONFIG.DIRECTIONS.UP });
                        break;
                    case 'ArrowDown':
                        this.changeDirection({ ...CONFIG.DIRECTIONS.DOWN });
                        break;
                }
            }
            
            // NEW: –û–±—Ä–æ–±–Ω–∏–∫–∏ —Å–≤–∞–π–ø—ñ–≤
            handleTouchStart(e) {
                this.touchStartX = e.touches[0].clientX;
                this.touchStartY = e.touches[0].clientY;
            }
            
            handleTouchMove(e) {
                e.preventDefault(); // –ó–∞–ø–æ–±—ñ–≥–∞—î–º–æ —Å–∫—Ä–æ–ª—É —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –ø—ñ–¥ —á–∞—Å —Å–≤–∞–π–ø—É –ø–æ canvas
            }

            handleTouchEnd(e) {
                if (!this.isRunning || this.isPaused) return;
                
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;

                const deltaX = touchEndX - this.touchStartX;
                const deltaY = touchEndY - this.touchStartY;
                
                // –í–∏–∑–Ω–∞—á–∞—î–º–æ, —Å–≤–∞–π–ø –±—É–≤ –±—ñ–ª—å—à–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∏–º —á–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏–º
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∏–π —Å–≤–∞–π–ø
                    if (deltaX > 50) this.changeDirection({ ...CONFIG.DIRECTIONS.RIGHT });
                    else if (deltaX < -50) this.changeDirection({ ...CONFIG.DIRECTIONS.LEFT });
                } else {
                    // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏–π —Å–≤–∞–π–ø
                    if (deltaY > 50) this.changeDirection({ ...CONFIG.DIRECTIONS.DOWN });
                    else if (deltaY < -50) this.changeDirection({ ...CONFIG.DIRECTIONS.UP });
                }
            }

            start() {
                if (this.gameLoopId) {
                    cancelAnimationFrame(this.gameLoopId);
                }
                
                this.reset();
                this.generateFood();
                this.updateScoreUI();
                this.gameOverElement.style.display = 'none';
                this.isRunning = true;
                this.isPaused = false;
                this.pauseBtn.disabled = false;
                this.startBtn.textContent = '–ù–æ–≤–∞ –≥—Ä–∞';
                this.pauseBtn.textContent = '–ü–∞—É–∑–∞';

                // –ó–∞–ø—É—Å–∫ —ñ–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª—É
                this.gameLoopId = requestAnimationFrame(this.mainLoop.bind(this));
            }

            togglePause() {
                if (!this.isRunning) return;
                
                this.isPaused = !this.isPaused;
                this.pauseBtn.textContent = this.isPaused ? '–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏' : '–ü–∞—É–∑–∞';

                if (!this.isPaused) {
                    // –Ø–∫—â–æ –≥—Ä–∞ –ø—Ä–æ–¥–æ–≤–∂—É—î—Ç—å—Å—è, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—î–º–æ —Ü–∏–∫–ª
                    this.lastTickTime = performance.now(); // –°–∫–∏–¥–∞—î–º–æ —á–∞—Å, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ —Ä–∏–≤–∫–∞
                    this.gameLoopId = requestAnimationFrame(this.mainLoop.bind(this));
                } else {
                    // –Ø–∫—â–æ –≥—Ä–∞ –Ω–∞ –ø–∞—É–∑—ñ, –∑—É–ø–∏–Ω—è—î–º–æ —Ü–∏–∫–ª
                    cancelAnimationFrame(this.gameLoopId);
                }
            }

            // NEW: –û—Å–Ω–æ–≤–Ω–∏–π —ñ–≥—Ä–æ–≤–∏–π —Ü–∏–∫–ª –Ω–∞ requestAnimationFrame
            mainLoop(currentTime) {
                if (this.isPaused || !this.isRunning) return;

                this.gameLoopId = requestAnimationFrame(this.mainLoop.bind(this));

                const timeSinceLastTick = currentTime - this.lastTickTime;
                
                if (timeSinceLastTick > this.gameSpeed) {
                    this.lastTickTime = currentTime;
                    this.update();
                }
            }

            update() {
                this.direction = { ...this.nextDirection };
                this.directionChangedInTick = false;

                const head = {
                    x: this.snake[0].x + this.direction.x,
                    y: this.snake[0].y + this.direction.y
                };

                if (this.checkWallCollision(head) || this.checkSelfCollision(head)) {
                    this.end();
                    return;
                }

                this.snake.unshift(head);

                if (this.checkFoodCollision(head)) {
                    this.score++;
                    this.updateScoreUI();
                    this.generateFood();
                    
                    if (this.score % CONFIG.SCORE_FOR_SPEED_INCREASE === 0 && this.score > 0) {
                        this.increaseSpeed();
                    }
                } else {
                    this.snake.pop();
                }

                this.draw();
            }

            checkWallCollision(pos) {
                return pos.x < 0 || pos.x >= this.tileCount || pos.y < 0 || pos.y >= this.tileCount;
            }

            checkSelfCollision(pos) {
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∑ –¥—Ä—É–≥–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞, –æ—Å–∫—ñ–ª—å–∫–∏ –≥–æ–ª–æ–≤–∞ –∑–∞–≤–∂–¥–∏ –±—É–¥–µ –Ω–∞ —Å–≤–æ—ó–π –ø–æ–∑–∏—Ü—ñ—ó
                return this.snake.slice(1).some(segment => segment.x === pos.x && segment.y === pos.y);
            }

            checkFoodCollision(pos) {
                return this.food && pos.x === this.food.x && pos.y === this.food.y;
            }

            generateFood() {
                let newFood;
                do {
                    newFood = {
                        x: Math.floor(Math.random() * this.tileCount),
                        y: Math.floor(Math.random() * this.tileCount)
                    };
                } while (this.snake.some(seg => seg.x === newFood.x && seg.y === newFood.y));
                this.food = newFood;
            }

            increaseSpeed() {
                this.gameSpeed = Math.max(CONFIG.MIN_SPEED_MS, this.gameSpeed - CONFIG.SPEED_INCREASE_MS);
            }

            draw() {
                this.ctx.fillStyle = CONFIG.COLORS.BACKGROUND;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                if (this.food) {
                    this.ctx.fillStyle = CONFIG.COLORS.FOOD;
                    this.ctx.beginPath();
                    this.ctx.arc(
                        this.food.x * CONFIG.GRID_SIZE + CONFIG.GRID_SIZE / 2,
                        this.food.y * CONFIG.GRID_SIZE + CONFIG.GRID_SIZE / 2,
                        CONFIG.GRID_SIZE / 2 - 2, 0, Math.PI * 2
                    );
                    this.ctx.fill();
                }

                this.snake.forEach((segment, index) => {
                    this.ctx.fillStyle = index === 0 ? CONFIG.COLORS.SNAKE_HEAD : CONFIG.COLORS.SNAKE_BODY;
                    this.ctx.fillRect(
                        segment.x * CONFIG.GRID_SIZE + 1, segment.y * CONFIG.GRID_SIZE + 1,
                        CONFIG.GRID_SIZE - 2, CONFIG.GRID_SIZE - 2
                    );
                    this.ctx.strokeStyle = CONFIG.COLORS.SNAKE_BORDER;
                    this.ctx.strokeRect(
                        segment.x * CONFIG.GRID_SIZE + 1, segment.y * CONFIG.GRID_SIZE + 1,
                        CONFIG.GRID_SIZE - 2, CONFIG.GRID_SIZE - 2
                    );
                });
            }

            drawWelcomeScreen() {
                this.ctx.fillStyle = CONFIG.COLORS.BACKGROUND;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                this.ctx.fillStyle = '#999';
                this.ctx.font = '20px Segoe UI';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(
                    '–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ù–æ–≤–∞ –≥—Ä–∞"',
                    this.canvas.width / 2,
                    this.canvas.height / 2
                );
            }

            updateScoreUI() {
                this.scoreElement.textContent = this.score;
                if (this.score > this.getHighScore()) {
                    this.saveHighScore(this.score);
                    this.highScoreElement.textContent = this.score;
                }
            }

            loadHighScore() {
                this.highScoreElement.textContent = this.getHighScore();
            }

            getHighScore() {
                try {
                    return parseInt(localStorage.getItem('snakeHighScore') || '0', 10);
                } catch (e) {
                    return 0;
                }
            }

            saveHighScore(score) {
                try {
                    localStorage.setItem('snakeHighScore', score.toString());
                } catch (e) {
                    console.warn('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–±–µ—Ä–µ–≥—Ç–∏ —Ä–µ–∫–æ—Ä–¥');
                }
            }

            end() {
                this.isRunning = false;
                cancelAnimationFrame(this.gameLoopId);
                this.gameOverElement.style.display = 'block';
                this.pauseBtn.disabled = true;
            }
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∏
        const game = new SnakeGame();
    </script>
</body>
</html>
