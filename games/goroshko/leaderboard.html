<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–¢—É—Ä–Ω—ñ—Ä–∏ ‚Äî –ö–æ—Ç–∏–≥–æ—Ä–æ—à–∫–æ</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    theme: {
      extend: {
        fontFamily: {
          sans: ['Rubik','Montserrat','-apple-system','BlinkMacSystemFont','Segoe UI','Helvetica','Arial','sans-serif'],
          display: ['Montserrat','Rubik','sans-serif']
        }
      }
    }
  };
</script>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700;900&family=Montserrat:wght@600;700;800;900&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
<link rel="stylesheet" href="css/styles.css" />
</head>
<body class="brawl-bg text-white min-h-screen font-sans">
  <div class="game-shell flex flex-col min-h-screen">
    <header class="brawl-header">
      <div class="brawl-header__inner">
        <a href="index.html" class="brawl-header__brand">
          <span class="brawl-header__logo" aria-hidden="true">‚öîÔ∏è</span>
          <span>
            <span class="brawl-header__eyebrow">–ê–∫–∞–¥–µ–º—ñ—è –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤</span>
            <span class="brawl-header__title">–ö–æ—Ç–∏–≥–æ—Ä–æ—à–∫–æ</span>
          </span>
        </a>
        <nav class="brawl-nav" aria-label="–û—Å–Ω–æ–≤–Ω–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è">
          <a class="brawl-nav__link" href="story.html">üìñ –õ–µ–≥–µ–Ω–¥–∞</a>
          <a class="brawl-nav__link" href="algorithms.html">üß† –ê–ª–≥–æ—Ä–∏—Ç–º–∏</a>
          <a class="brawl-nav__link brawl-nav__link--accent" href="leaderboard.html" aria-current="page">üèÜ –¢—É—Ä–Ω—ñ—Ä–∏</a>
          <a class="brawl-nav__link hidden" href="account.html" id="accountLink">‚≠ê –ê–∫–∞—É–Ω—Ç</a>
        </nav>
        <div class="brawl-header__actions">
          <div class="profile-dock">
            <div id="userProfile" class="profile-dock__user hidden">
              <div class="profile-dock__avatar" id="userAvatar" aria-hidden="true">üëæ</div>
              <div>
                <p class="profile-dock__name" id="userName">–ì—Ä–∞–≤–µ—Ü—å</p>
                <a class="profile-dock__account" href="account.html">–ú—ñ–π –∞–∫–∞—É–Ω—Ç</a>
              </div>
              <button id="logoutBtn" class="profile-dock__logout hidden">–í–∏–π—Ç–∏</button>
            </div>
            <button id="loginBtn" class="btn-hero btn-hero--compact" type="button">
              <span class="btn-hero__glow" aria-hidden="true"></span>
              <i class="fas fa-sign-in-alt"></i>
              <span>–£–≤—ñ–π—Ç–∏</span>
            </button>
          </div>
        </div>
      </div>
    </header>

    <main class="game-main flex-1">
      <div class="game-main__container">
        <section class="interface-panel interface-panel--map">
          <header class="interface-panel__header">
            <span class="interface-panel__icon">üèÜ</span>
            <div>
              <h1 class="interface-panel__title">–¢—É—Ä–Ω—ñ—Ä–Ω–∞ –∞—Ä–µ–Ω–∞</h1>
              <p class="interface-panel__subtitle">–í—ñ–¥—Å—Ç–µ–∂—É–π –ø—Ä–æ–≥—Ä–µ—Å –≥—Ä–∞–≤—Ü—ñ–≤ —Ç–∞ —Å–≤–æ—ó —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</p>
            </div>
          </header>
          <p class="panel-hint">–ö–æ–∂–µ–Ω —Ä—ñ–≤–µ–Ω—å –º–∞—î –≤–ª–∞—Å–Ω—É —Ç—É—Ä–Ω—ñ—Ä–Ω—É —Ç–∞–±–ª–∏—Ü—é. –û–±–∏—Ä–∞–π —Ä—ñ–≤–µ–Ω—å –∞–±–æ –ø–µ—Ä–µ–≥–ª—è–¥–∞–π –∑–∞–≥–∞–ª—å–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥.</p>
          <a href="index.html" class="btn-hero btn-hero--compact" style="width:max-content">
            <span class="btn-hero__glow" aria-hidden="true"></span>
            <i class="fas fa-arrow-left"></i>
            <span>–î–æ –≥—Ä–∏</span>
          </a>
        </section>

        <section class="interface-panel">
          <div class="flex flex-wrap gap-3" role="group" aria-label="–ü–µ—Ä–µ–º–∏–∫–∞—á—ñ —Ç—É—Ä–Ω—ñ—Ä—ñ–≤">
            <button class="btn-hero btn-hero--compact btn-hero--danger" data-view="global">üåç –ó–∞–≥–∞–ª—å–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥</button>
            <button class="btn-hero btn-hero--compact" data-view="level">üéØ –ó–∞ —Ä—ñ–≤–Ω–µ–º</button>
          </div>
          <div id="levelSelector" class="hidden">
            <label class="panel-hint" for="levelSelect">–í–∏–±–µ—Ä—ñ—Ç—å —Ä—ñ–≤–µ–Ω—å</label>
            <select id="levelSelect" class="w-full bg-transparent border border-white/20 rounded-lg px-3 py-2 text-white">
              <option value="0">–†—ñ–≤–µ–Ω—å 1 ‚Äî –û–ø—É–¥–∞–ª–æ</option>
              <option value="1">–†—ñ–≤–µ–Ω—å 2 ‚Äî –ì–æ–±–ª—ñ–Ω</option>
              <option value="2">–†—ñ–≤–µ–Ω—å 3 ‚Äî –û—Ä–∫</option>
              <option value="3">–†—ñ–≤–µ–Ω—å 4 ‚Äî –¢—Ä–æ–ª—å</option>
              <option value="4">–†—ñ–≤–µ–Ω—å 5 ‚Äî –°–∫–µ–ª–µ—Ç</option>
              <option value="5">–†—ñ–≤–µ–Ω—å 6 ‚Äî –î—Ä–∞–∫–æ–Ω</option>
            </select>
          </div>
        </section>

        <section class="interface-panel" aria-live="polite">
          <div id="loadingState" class="text-center py-12">
            <div class="loading-screen__spinner" aria-hidden="true"></div>
            <p class="panel-hint mt-3">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–µ–π—Ç–∏–Ω–≥—É...</p>
          </div>

          <div id="leaderboardContent" class="hidden space-y-6">
            <div id="topThree" class="grid gap-4 md:grid-cols-3"></div>
            <div class="overflow-x-auto">
              <table class="w-full text-left text-sm">
                <thead>
                  <tr class="border-b border-white/10">
                    <th class="py-3 pr-3 font-semibold">–ú—ñ—Å—Ü–µ</th>
                    <th class="py-3 pr-3 font-semibold">–ì—Ä–∞–≤–µ—Ü—å</th>
                    <th class="py-3 pr-3 font-semibold text-center" id="scoreHeader">–ü—Ä–æ–π–¥–µ–Ω–æ</th>
                    <th class="py-3 pr-3 font-semibold text-center">ü•á</th>
                    <th class="py-3 pr-3 font-semibold text-center">ü•à</th>
                    <th class="py-3 pr-3 font-semibold text-center">ü•â</th>
                  </tr>
                </thead>
                <tbody id="leaderboardBody"></tbody>
              </table>
            </div>
            <div id="userRankCard" class="hidden achievement-card">
              <h3 class="achievement-card__title">–¢–≤–æ—è –ø–æ–∑–∏—Ü—ñ—è</h3>
              <p class="text-2xl font-display text-center" id="userRankText">‚Äî</p>
            </div>
          </div>

          <div id="emptyState" class="hidden text-center py-12">
            <div class="text-6xl mb-3">üèúÔ∏è</div>
            <p class="panel-hint text-base">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤. –ë—É–¥—å –ø–µ—Ä—à–∏–º!</p>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script type="module">
    import { authManager } from './js/auth.js';
    import { storage } from './js/storage.js';
    import { initHeader } from './js/header.js';

    authManager.init();
    initHeader();

    let currentView = 'global';
    let currentLevel = null;

    const loadingState = document.getElementById('loadingState');
    const leaderboardContent = document.getElementById('leaderboardContent');
    const emptyState = document.getElementById('emptyState');
    const topThree = document.getElementById('topThree');
    const leaderboardBody = document.getElementById('leaderboardBody');
    const levelSelector = document.getElementById('levelSelector');
    const levelSelect = document.getElementById('levelSelect');
    const userRankCard = document.getElementById('userRankCard');
    const userRankText = document.getElementById('userRankText');
    const scoreHeader = document.getElementById('scoreHeader');

    document.querySelectorAll('[data-view]').forEach((btn) => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-view]').forEach((el) => {
          el.classList.remove('btn-hero--danger');
        });
        btn.classList.add('btn-hero--danger');

        currentView = btn.dataset.view;
        if (currentView === 'level') {
          levelSelector.classList.remove('hidden');
          currentLevel = parseInt(levelSelect.value, 10);
        } else {
          levelSelector.classList.add('hidden');
          currentLevel = null;
        }
        loadLeaderboard();
      });
    });

    levelSelect.addEventListener('change', () => {
      currentLevel = parseInt(levelSelect.value, 10);
      loadLeaderboard();
    });

    loadLeaderboard();

    async function loadLeaderboard() {
      showLoading();
      try {
        const data = await storage.getLeaderboard(currentLevel, 100);
        if (data.length === 0) {
          showEmpty();
          return;
        }

        renderLeaderboard(data);

        if (authManager.isAuthenticated() && currentLevel !== null) {
          const rank = await storage.getUserRank(currentLevel);
          if (rank) {
            userRankText.textContent = `#${rank}`;
            userRankCard.classList.remove('hidden');
          } else {
            userRankCard.classList.add('hidden');
          }
        } else {
          userRankCard.classList.add('hidden');
        }
      } catch (error) {
        console.error('Error loading leaderboard:', error);
        showEmpty();
      }
    }

    function renderLeaderboard(data) {
      loadingState.classList.add('hidden');
      emptyState.classList.add('hidden');
      leaderboardContent.classList.remove('hidden');

      scoreHeader.textContent = currentView === 'level' ? '–ë–ª–æ–∫—ñ–≤' : '–ü—Ä–æ–π–¥–µ–Ω–æ';

      topThree.innerHTML = '';
      const top3 = data.slice(0, 3);
      const podiumColors = [
        'linear-gradient(135deg, rgba(255,215,89,0.6), rgba(255,157,65,0.65))',
        'linear-gradient(135deg, rgba(188,202,255,0.6), rgba(128,142,220,0.65))',
        'linear-gradient(135deg, rgba(255,168,104,0.6), rgba(255,118,142,0.65))'
      ];

      top3.forEach((player, index) => {
        const card = document.createElement('div');
        card.className = 'achievement-card';
        card.style.background = podiumColors[index] || 'rgba(15,28,62,0.82)';
        if (index < podiumColors.length) {
          card.style.color = '#1a0d2b';
        }
        card.innerHTML = `
          <p class="text-3xl text-center font-display">${['ü•á','ü•à','ü•â'][index] || ''}</p>
          <p class="text-center font-bold text-lg">${player.displayName || '–ì—Ä–∞–≤–µ—Ü—å'}</p>
          <p class="text-center text-sm">${currentView === 'level' ? `–ë–ª–æ–∫—ñ–≤: ${player.blocks}` : `–ü—Ä–æ–π–¥–µ–Ω–æ: ${player.totalCompleted || 0}`}</p>
        `;
        topThree.appendChild(card);
      });

      leaderboardBody.innerHTML = '';
      data.forEach((player) => {
        const tr = document.createElement('tr');
        tr.className = 'border-b border-white/5';

        const medalDisplay = currentView === 'level'
          ? {
              gold: player.medal === 'gold' ? 'ü•á' : '‚Äî',
              silver: player.medal === 'silver' ? 'ü•à' : '‚Äî',
              bronze: player.medal === 'bronze' ? 'ü•â' : '‚Äî'
            }
          : {
              gold: player.goldMedals || 0,
              silver: player.silverMedals || 0,
              bronze: player.bronzeMedals || 0
            };

        tr.innerHTML = `
          <td class="py-2 pr-3">#${player.rank}</td>
          <td class="py-2 pr-3">${player.displayName || '–ì—Ä–∞–≤–µ—Ü—å'}</td>
          <td class="py-2 pr-3 text-center">${currentView === 'level' ? player.blocks : (player.totalCompleted || 0)}</td>
          <td class="py-2 pr-3 text-center">${medalDisplay.gold}</td>
          <td class="py-2 pr-3 text-center">${medalDisplay.silver}</td>
          <td class="py-2 pr-3 text-center">${medalDisplay.bronze}</td>
        `;
        leaderboardBody.appendChild(tr);
      });
    }

    function showLoading() {
      loadingState.classList.remove('hidden');
      leaderboardContent.classList.add('hidden');
      emptyState.classList.add('hidden');
      userRankCard.classList.add('hidden');
    }

    function showEmpty() {
      loadingState.classList.add('hidden');
      leaderboardContent.classList.add('hidden');
      emptyState.classList.remove('hidden');
      userRankCard.classList.add('hidden');
    }
  </script>
</body>
</html>
