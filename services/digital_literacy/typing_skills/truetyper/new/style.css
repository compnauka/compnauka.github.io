:root {
  --bg:        #F5F0E8;
  --black:     #1C1C1C;
  --white:     #FFFFFF;
  --amber:     #F5A623;
  --amber-dk:  #C47D0A;
  --teal:      #2ABFBF;
  --teal-dk:   #1A8F8F;
  --coral:     #E8604C;
  --coral-dk:  #B83C2A;
  --sage:      #5AAF7A;
  --sage-dk:   #3A8558;
  --slate:     #6B7FA3;
  --slate-dk:  #4A5C80;
  --lavender:  #9B7FD4;
  --stat-score:  #FFF0CC;
  --stat-streak: #CCF0E8;
  --stat-errors: #FFE0D8;
  --stat-record: #E8ECFF;
  --stat-wpm:    #D8F0FF;
  --stat-acc:    #E0F5E8;
  --border: 3px solid var(--black);
  --sh:     4px 4px 0 var(--black);
  --sh-sm:  3px 3px 0 var(--black);
  --sh-lg:  6px 6px 0 var(--black);
  --r:      12px;
  --r-lg:   18px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Fredoka', system-ui, sans-serif;
  background: var(--bg);
  background-image:
    linear-gradient(rgba(28,28,28,.055) 1px, transparent 1px),
    linear-gradient(90deg, rgba(28,28,28,.055) 1px, transparent 1px);
  background-size: 30px 30px;
  height: 100dvh;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  padding: 12px 12px 10px;
  overflow: hidden;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  overscroll-behavior: none;
}

/* ── MODALS ───────────────────────────────────────────────── */
.overlay {
  position: fixed; inset: 0; z-index: 999;
  display: flex; align-items: center; justify-content: center;
  background: rgba(28,28,28,.75);
  backdrop-filter: blur(10px);
  padding: 20px;
}
.overlay.hidden { display: none !important; }

.modal-box {
  background: var(--white);
  border: 4px solid var(--black);
  border-radius: 22px;
  box-shadow: 8px 8px 0 var(--black);
  padding: 36px 32px;
  text-align: center;
  width: 100%; max-width: 420px;
  animation: popIn .35s cubic-bezier(.34,1.56,.64,1) both;
}
@keyframes popIn {
  from { opacity:0; transform: scale(.6) translateY(50px); }
  to   { opacity:1; transform: scale(1)  translateY(0); }
}
.modal-box.milestone-box { background: var(--amber); }
.modal-box.test-result-box { background: #E8F4FF; }

.modal-icon  { font-size: 3.6rem; margin-bottom: 12px; color: var(--black); }
.modal-title { font-size: 2rem; font-weight: 700; color: var(--black); margin-bottom: 8px; }
.modal-sub   { font-size: 1.1rem; font-weight: 500; color: #444; margin-bottom: 24px; line-height: 1.5; white-space: pre-line; }
.modal-hint  { margin-top: 14px; font-size: .7rem; text-transform: uppercase; letter-spacing: 2px; color: #888; font-weight: 600; }

/* Countdown */
.countdown-modal-box {
  background: var(--black);
  border: 4px solid var(--black);
  border-radius: 22px;
  box-shadow: 8px 8px 0 rgba(0,0,0,.5);
  padding: 48px 56px;
  text-align: center;
  width: 100%; max-width: 360px;
  min-height: 200px;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
}
#countdown-num {
  font-size: 8rem;
  font-weight: 700;
  color: var(--amber);
  line-height: 1;
  display: block;
  text-align: center;
  animation: countPop .55s cubic-bezier(.34,1.56,.64,1) both;
}
#countdown-num.is-go {
  font-size: 3.8rem;
  color: var(--sage);
  letter-spacing: -.01em;
}
@keyframes countPop {
  from { opacity: 0; transform: scale(2.5); }
  to   { opacity: 1; transform: scale(1); }
}
.countdown-label {
  font-size: 1.1rem;
  font-weight: 700;
  color: #888;
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-top: 8px;
}

/* Test Result stats grid */
.test-stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin: 20px 0;
}
.test-stat-box {
  background: var(--white);
  border: 3px solid var(--black);
  border-radius: 12px;
  box-shadow: 3px 3px 0 var(--black);
  padding: 12px 10px;
  display: flex; flex-direction: column; align-items: center; gap: 3px;
}
.test-stat-box.big {
  grid-column: 1 / -1;
  background: var(--teal);
}
.test-stat-box.big .tsv { font-size: 3.6rem; color: var(--white); }
.test-stat-box.big .tsl { color: rgba(255,255,255,.8); }
.test-stat-box.new-record { background: var(--amber); }
.tsv { font-size: 2rem; font-weight: 700; color: var(--black); }
.tsl { font-size: .7rem; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; color: #666; }
.test-btn-row { display: flex; gap: 10px; }

/* ── BUTTONS ──────────────────────────────────────────────── */
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 8px;
  font-family: 'Fredoka', sans-serif;
  font-size: 1.15rem; font-weight: 700;
  padding: 13px 24px;
  border: var(--border); border-radius: var(--r);
  box-shadow: var(--sh); cursor: pointer;
  transition: transform .08s, box-shadow .08s;
  white-space: nowrap; outline: none;
}
.btn:hover  { transform: translate(-2px,-2px); box-shadow: 6px 6px 0 var(--black); }
.btn:active { transform: translate(4px,4px);   box-shadow: 0 0 0 var(--black); }
.btn-full   { width: 100%; }
.btn-lg     { font-size: 1.25rem; padding: 15px 28px; }
.btn-amber  { background: var(--amber);  color: var(--black); }
.btn-teal   { background: var(--teal);   color: var(--white); }
.btn-coral  { background: var(--coral);  color: var(--white); }
.btn-sage   { background: var(--sage);   color: var(--white); }
.btn-ghost  { background: #E0E0E0;       color: var(--black); }

/* ── HEADER ───────────────────────────────────────────────── */
#header {
  width: 100%; max-width: 1020px;
  display: flex; align-items: center; justify-content: space-between;
  flex-shrink: 0;
}

.logo {
  display: flex; align-items: center; gap: 8px;
  background: transparent; color: var(--black);
  border: none;
  padding: 8px 4px;
  font-size: 1.2rem; font-weight: 700; letter-spacing: .01em;
}
.logo i { font-size: 1.1rem; color: var(--amber-dk); }

.hcontrols { display: flex; gap: 8px; align-items: center; }

.icon-btn {
  height: 44px; min-width: 44px; padding: 0 12px;
  display: flex; align-items: center; justify-content: center; gap: 6px;
  background: var(--white); border: var(--border); border-radius: 10px;
  box-shadow: var(--sh-sm); cursor: pointer;
  font-family: 'Fredoka', sans-serif;
  font-size: .85rem; font-weight: 700; letter-spacing: 1px; color: var(--black);
  transition: transform .08s, box-shadow .08s; outline: none;
}
.icon-btn:hover  { transform: translate(-2px,-2px); box-shadow: 5px 5px 0 var(--black); }
.icon-btn:active { transform: translate(3px,3px);   box-shadow: 0 0 0 var(--black); }
.icon-btn.muted  { background: var(--coral); color: var(--white); }
.icon-btn.active-test { background: var(--coral); color: var(--white); }

/* ── STATS ────────────────────────────────────────────────── */
#stats-row {
  width: 100%; max-width: 1020px;
  display: flex; gap: 8px; justify-content: center; flex-wrap: nowrap;
  flex-shrink: 0;
}

.stat {
  flex: 1;
  background: var(--white);
  border: var(--border); border-radius: 14px;
  box-shadow: var(--sh-sm);
  padding: 10px 8px;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 4px; min-width: 0;
}
.stat-icon { font-size: .9rem; }
.stat-lbl  { font-size: .68rem; text-transform: uppercase; letter-spacing: .8px; font-weight: 700; color: #666; line-height: 1; }
.stat-val  { font-size: 1.5rem; font-weight: 700; color: var(--black); line-height: 1; }

.stat.s-score   { background: var(--stat-score); }
.stat.s-streak  { background: var(--stat-streak); }
.stat.s-errors  { background: var(--stat-errors); }
.stat.s-record  { background: var(--stat-record); }
.stat.s-wpm     { background: var(--stat-wpm); }
.stat.s-acc     { background: var(--stat-acc); }

/* ── PROGRESS + TIMER ─────────────────────────────────────── */
#prog-wrap {
  width: 100%; max-width: 1020px;
  background: var(--white);
  border: 3px solid var(--black);
  border-radius: 999px; height: 16px; overflow: hidden;
  box-shadow: var(--sh-sm); flex-shrink: 0;
}
#prog-bar {
  height: 100%; width: 0%;
  background: linear-gradient(90deg, var(--teal), var(--sage));
  border-radius: 999px;
  transition: width .45s cubic-bezier(.4,0,.2,1);
}
#prog-bar.test-bar {
  background: linear-gradient(90deg, var(--coral), var(--amber));
  transition: width .9s linear;
}

/* Test Timer Banner */
#test-banner {
  width: 100%; max-width: 1020px;
  display: flex; align-items: center; justify-content: center; gap: 8px;
  flex-shrink: 0;
  background: var(--coral);
  border: 3px solid var(--black);
  border-radius: 12px;
  box-shadow: var(--sh-sm);
  padding: 6px 16px;
  font-size: 1.1rem; font-weight: 700; color: var(--white);
}
#test-banner.hidden { display: none !important; }
#test-banner.low-time {
  background: var(--black);
  animation: bannerPulse .5s ease-in-out infinite alternate;
}
@keyframes bannerPulse {
  from { transform: scale(1); }
  to   { transform: scale(1.01); }
}
#timer-sec { font-size: 1.4rem; }

/* Difficulty badge */
#diff-badge {
  font-size: .65rem; font-weight: 700;
  padding: 2px 8px; border-radius: 999px;
  border: 2px solid var(--black);
  background: var(--white); color: var(--black);
  letter-spacing: 1px; text-transform: uppercase;
  transition: background .3s, color .3s;
  flex-shrink: 0;
}
#diff-badge.lvl-1 { background: var(--sage); color: var(--white); }
#diff-badge.lvl-2 { background: var(--amber); color: var(--black); }
#diff-badge.lvl-3 { background: var(--coral); color: var(--white); }

/* ── WORD DISPLAY ─────────────────────────────────────────── */
#main-area {
  flex: 1; width: 100%; max-width: 1020px;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  gap: 8px; min-height: 0;
}

#word-display {
  width: 100%;
  background: var(--white);
  border: 4px solid var(--black);
  border-radius: 20px;
  box-shadow: 6px 6px 0 var(--black);
  padding: 20px 28px;
  display: flex; align-items: center; justify-content: center;
  min-height: 110px;
  font-size: clamp(2rem, 7vw, 4.2rem);
  font-weight: 700;
  letter-spacing: .08em;
  text-align: center;
  transition: background .12s;
}

#msg-area {
  height: 32px;
  display: flex; align-items: center; justify-content: center; gap: 6px;
  font-size: 1.15rem; font-weight: 700;
  color: var(--sage-dk);
  opacity: 0;
  transition: opacity .18s, transform .18s;
  transform: scale(1);
}

/* ── KEYBOARD ─────────────────────────────────────────────── */
#kb-wrap { width: 100%; max-width: 1020px; flex-shrink: 0; }

#kb {
  background: #C8C8C8;
  border: 4px solid var(--black);
  border-radius: 18px;
  box-shadow: 6px 6px 0 var(--black);
  padding: 10px 10px 10px;
  display: flex; flex-direction: column; gap: 5px;
}

.kb-row { display: flex; gap: 5px; justify-content: center; }

.key {
  background: var(--white);
  border: 2.5px solid var(--black);
  border-radius: 8px;
  box-shadow: 4px 4px 0 var(--black);
  height: 46px;
  display: flex; align-items: center; justify-content: center;
  flex: 1; min-width: 0;
  font-family: 'Fredoka', sans-serif;
  font-size: 1rem; font-weight: 600; color: var(--black);
  cursor: pointer;
  transition: transform .07s, box-shadow .07s, background .1s;
  touch-action: manipulation; user-select: none;
}
.key:active, .key.pressed {
  transform: translate(4px,4px);
  box-shadow: 0 0 0 var(--black);
}
.key.special {
  background: #ADADAD; color: #3A3A3A;
  font-size: .65rem; cursor: default;
  font-weight: 600;
}
.key.special i { font-size: .9rem; }
.key.hint {
  background: var(--amber) !important;
  color: var(--black) !important;
  border-color: var(--black) !important;
  animation: hintPulse 1.0s ease-in-out infinite;
  z-index: 2;
}
.key.hint.pressed, .key.hint:active {
  animation: none;
  transform: translate(4px,4px);
  box-shadow: 0 0 0 var(--black);
}
@keyframes hintPulse {
  0%,100% { box-shadow: 4px 4px 0 var(--black); }
  50%     { box-shadow: 6px 6px 0 var(--black); transform: translate(-1px,-1px); }
}
.key.wrong {
  background: var(--coral) !important;
  color: var(--white) !important;
  animation: none !important;
}
.key.correct {
  background: var(--teal) !important;
  color: var(--white) !important;
  animation: none !important;
}
.key.w-bs    { flex: 1.6; }
.key.w-tab   { flex: 1.6; }
.key.w-caps  { flex: 1.9; }
.key.w-enter { flex: 2.1; background: #D8E8FF; }
.key.w-shift { flex: 2.4; }
.key.w-space { flex: 0 0 44%; max-width: 360px; }
.key.hidden-key { display: none !important; }

/* ── WORD ANIMATIONS ──────────────────────────────────────── */
.shake { animation: shake .38s cubic-bezier(.36,.07,.19,.97) both; }
@keyframes shake {
  10%,90%     { transform: translateX(-3px); }
  20%,80%     { transform: translateX(5px);  }
  30%,50%,70% { transform: translateX(-7px); }
  40%,60%     { transform: translateX(7px);  }
}
.word-wrong { background: #FFE8E4 !important; }
.float { animation: tfloat 2.8s ease-in-out infinite; }
@keyframes tfloat {
  0%,100% { transform: translateY(0); }
  50%     { transform: translateY(-14px); }
}

/* ── RESPONSIVE ───────────────────────────────────────────── */
@media (max-width: 600px) {
  body { gap: 7px; padding: 8px 6px 6px; }
  .key { height: 36px; font-size: .82rem; border-radius: 6px; box-shadow: 3px 3px 0 var(--black); }
  .key:active, .key.pressed { transform: translate(3px,3px); }
  #kb { padding: 7px 6px; gap: 4px; }
  .kb-row { gap: 3px; }
  .stat-val { font-size: 1.2rem; }
  .stat     { padding: 7px 5px; }
  #word-display { min-height: 80px; padding: 14px 16px; }
  .logo { padding: 6px 12px; font-size: 1rem; }
  .test-stats-grid { gap: 8px; }
}
