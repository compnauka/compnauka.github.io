<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–í–æ–ª–æ–¥–∞—Ä –∫–æ–º–±—ñ–Ω–∞—Ü—ñ–π | –¢—Ä–µ–Ω–∞–∂–µ—Ä –ì–∞—Ä—è—á–∏—Ö –ö–ª–∞–≤—ñ—à (Windows)</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class' };
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N8T05K3NGT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-N8T05K3NGT');
    </script>

    <!-- Privacy-friendly analytics by Plausible -->
    <script async src="https://plausible.io/js/pa-kBgdFkemKx0WM6VJQvasn.js"></script>
    <script>
      window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
      plausible.init()
    </script>

    
  <style>
    body { font-family: 'Inter', sans-serif; }

    .key-cap { box-shadow: 0 3px 0 #cbd5e1; transition: all 0.05s; }
    .dark .key-cap { box-shadow: 0 3px 0 #475569; border-bottom-color: #334155; }
    .key-cap:active, .key-cap.pressed { transform: translateY(3px); box-shadow: 0 0 0 transparent; }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-4px); }
      75% { transform: translateX(4px); }
    }
    .animate-shake { animation: shake 0.3s ease-in-out; }

    @keyframes pop {
      0% { transform: scale(0.95); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .animate-pop { animation: pop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    .dark ::-webkit-scrollbar-track { background: #0f172a; }
    .dark ::-webkit-scrollbar-thumb { background: #334155; }
    .dark ::-webkit-scrollbar-thumb:hover { background: #475569; }

    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-900 dark:bg-slate-900 dark:text-slate-100 h-screen flex flex-col overflow-hidden selection:bg-blue-500 selection:text-white transition-colors duration-300">

  <nav class="bg-white/80 dark:bg-slate-800/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-700 p-4 z-20 shadow-sm dark:shadow-md flex-shrink-0 transition-colors duration-300">
    <div class="container mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
      <div class="flex items-center gap-3 select-none">
        <i class="fa-solid fa-keyboard text-3xl text-blue-600 dark:text-blue-500"></i>
        <h1 class="text-xl font-bold tracking-tight text-slate-800 dark:text-white">
          KeyMaster <span class="text-blue-500 dark:text-blue-400 font-light">Windows Edition</span>
        </h1>
      </div>

      <div class="flex items-center gap-4">
        <div class="flex bg-slate-200/50 dark:bg-slate-700/50 p-1 rounded-lg">
          <button onclick="app.switchTab('trainer')" id="btn-trainer"
            class="px-5 py-2 rounded-md text-sm font-semibold transition-all bg-blue-600 text-white shadow-sm">
            <i class="fa-solid fa-gamepad mr-2"></i>–¢—Ä–µ–Ω–∞–∂–µ—Ä
          </button>
          <button onclick="app.switchTab('reference')" id="btn-reference"
            class="px-5 py-2 rounded-md text-sm font-semibold transition-all text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-200 dark:hover:bg-slate-700">
            <i class="fa-solid fa-book mr-2"></i>–î–æ–≤—ñ–¥–Ω–∏–∫
          </button>
        </div>

        <button id="theme-toggle-btn" onclick="app.toggleTheme()" aria-label="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É" title="–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É"
          class="w-10 h-10 rounded-full bg-slate-200/50 dark:bg-slate-700/50 text-slate-600 dark:text-slate-400 hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors flex items-center justify-center">
          <i class="fa-solid fa-moon hidden dark:block"></i>
          <i class="fa-solid fa-sun block dark:hidden text-orange-500"></i>
        </button>
      </div>
    </div>
  </nav>

  <main class="flex-grow container mx-auto p-4 md:p-8 flex flex-col items-center justify-center overflow-hidden relative max-h-full">

    <!-- TRAINER MODE -->
    <div id="trainer-view" class="w-full max-w-2xl flex flex-col gap-6 animate-pop transition-all duration-300">

      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 text-sm font-medium px-4 select-none bg-white/50 dark:bg-slate-800/50 p-3 rounded-xl border border-slate-200 dark:border-slate-700/50 shadow-sm">
        <div class="flex flex-wrap gap-4 items-center">
          <div class="text-slate-500 dark:text-slate-400">–†–∞—Ö—É–Ω–æ–∫: <span id="score-display" class="text-slate-900 dark:text-white ml-1 font-bold">0</span></div>
          <div class="text-slate-500 dark:text-slate-400">–°–µ—Ä—ñ—è: <span id="streak-display" class="text-orange-500 dark:text-orange-400 ml-1 font-bold">0</span> üî•</div>
          <div class="text-slate-500 dark:text-slate-400">–¢–æ—á–Ω—ñ—Å—Ç—å: <span id="accuracy-display" class="text-blue-600 dark:text-blue-400 ml-1 font-bold">100%</span></div>
        </div>

        <div class="flex items-center gap-2">
          <span class="text-slate-500 dark:text-slate-400 text-xs hidden md:inline">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</span>
          <select id="train-category"
            class="bg-white dark:bg-slate-700 text-slate-700 dark:text-white text-sm px-3 py-2 rounded border border-slate-300 dark:border-slate-600 focus:outline-none focus:border-blue-500 transition-colors cursor-pointer">
            <option value="all">–í—Å—ñ</option>
            <option value="–ë–∞–∑–æ–≤—ñ">üåü –ë–∞–∑–æ–≤—ñ</option>
            <option value="–ë—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É">üìã –ë—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É</option>
            <option value="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è">üß≠ –ù–∞–≤—ñ–≥–∞—Ü—ñ—è</option>
            <option value="–í–∏–¥—ñ–ª–µ–Ω–Ω—è">‚ú® –í–∏–¥—ñ–ª–µ–Ω–Ω—è</option>
            <option value="–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</option>
            <option value="–†–æ–±–æ—Ç–∞ –∑ —Ñ–∞–π–ª–∞–º–∏">üìÅ –§–∞–π–ª–∏</option>
            <option value="–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è">üé® –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è</option>
          </select>
        </div>
      </div>

      <div class="bg-white dark:bg-slate-800 rounded-2xl p-8 md:p-10 shadow-xl dark:shadow-2xl border border-slate-200 dark:border-slate-700 text-center relative overflow-hidden group transition-colors duration-300">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500"></div>

        <div id="category-badge"
          class="inline-block mb-3 text-xs font-bold uppercase tracking-wider px-3 py-1 rounded-full bg-slate-100 dark:bg-slate-700/50 text-slate-600 dark:text-slate-400 transition-colors">
          –ì–æ—Ç–æ–≤—ñ –¥–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è?
        </div>

        <h2 id="task-desc"
          class="text-2xl md:text-3xl font-bold mb-10 text-slate-800 dark:text-white min-h-[4rem] flex items-center justify-center leading-tight transition-colors">
          –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–°—Ç–∞—Ä—Ç"
        </h2>

        <div id="visualizer" class="h-16 flex items-center justify-center gap-2 mb-8 select-none" aria-live="polite">
          <span class="text-slate-400 dark:text-slate-600 text-sm italic">–ö–ª–∞–≤—ñ—à—ñ –∑'—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç...</span>
        </div>

        <div id="feedback" class="h-6 mb-6 font-semibold text-lg empty:hidden" aria-live="polite"></div>

        <div class="flex justify-center gap-3 flex-wrap">
          <button id="start-btn" onclick="app.startOrResume()"
            class="bg-green-600 hover:bg-green-500 active:bg-green-700 text-white px-8 py-3 rounded-xl font-bold transition shadow-lg shadow-green-900/20 flex items-center">
            <i class="fa-solid fa-play mr-2"></i><span id="start-btn-text">–°—Ç–∞—Ä—Ç</span>
          </button>

          <button id="pause-btn" onclick="app.togglePause()" class="hidden bg-amber-500 hover:bg-amber-400 active:bg-amber-600 text-white px-6 py-3 rounded-xl font-bold transition shadow-lg shadow-amber-900/20 flex items-center">
            <i class="fa-solid fa-pause mr-2"></i><span id="pause-btn-text">–ü–∞—É–∑–∞</span>
          </button>

          <button id="hint-btn" onclick="app.showHint()"
            class="hidden bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 px-6 py-3 rounded-xl font-medium transition border border-slate-300 dark:border-slate-600">
            <i class="fa-regular fa-lightbulb mr-2"></i>–ü—ñ–¥–∫–∞–∑–∫–∞
          </button>
        </div>

        <div id="keyboard-note" class="mt-6 text-xs text-slate-500 dark:text-slate-400 hidden">
          ‚ÑπÔ∏è –î–ª—è —Ä–æ–±–æ—Ç–∏ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ñ—ñ–∑–∏—á–Ω–∞ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∞ (–Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞—Ö –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –º–æ–∂—É—Ç—å –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏).
        </div>
      </div>

      <div class="text-center text-slate-400 dark:text-slate-500 text-xs mt-2 select-none">
        <p>üí° Windows-–∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–∞—Ö ‚Ä¢ –ü–∞—É–∑–∞: <b>Esc</b></p>
      </div>
    </div>

    <!-- REFERENCE MODE -->
    <div id="reference-view"
      class="w-full max-w-5xl hidden animate-pop max-h-full flex flex-col bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 shadow-xl dark:shadow-2xl overflow-hidden transition-colors duration-300">
      <div class="p-5 border-b border-slate-200 dark:border-slate-700 bg-slate-50/80 dark:bg-slate-800/80 flex flex-col md:flex-row items-center justify-between flex-shrink-0 gap-4">
        <div>
          <h2 class="text-xl font-bold text-slate-800 dark:text-white flex items-center gap-2">
            <i class="fa-solid fa-keyboard text-blue-600 dark:text-blue-500"></i> –î–æ–≤—ñ–¥–Ω–∏–∫
          </h2>
          <p class="text-slate-500 dark:text-slate-400 text-xs mt-1">–ü–æ—à–∏—Ä–µ–Ω—ñ Windows-–∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó (–º–æ–∂—É—Ç—å –≤—ñ–¥—Ä—ñ–∑–Ω—è—Ç–∏—Å—è –≤ –æ–∫—Ä–µ–º–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–∞—Ö)</p>
        </div>

        <select id="category-filter" onchange="app.filterTable(this.value)"
          class="bg-white dark:bg-slate-700 text-slate-700 dark:text-white text-sm px-3 py-2 rounded border border-slate-300 dark:border-slate-600 focus:outline-none focus:border-blue-500 transition-colors cursor-pointer">
          <option value="all">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
          <option value="–ë–∞–∑–æ–≤—ñ">üåü –ë–∞–∑–æ–≤—ñ</option>
          <option value="–ë—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É">üìã –ë—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É</option>
          <option value="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è">üß≠ –ù–∞–≤—ñ–≥–∞—Ü—ñ—è</option>
          <option value="–í–∏–¥—ñ–ª–µ–Ω–Ω—è">‚ú® –í–∏–¥—ñ–ª–µ–Ω–Ω—è</option>
          <option value="–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</option>
          <option value="–†–æ–±–æ—Ç–∞ –∑ —Ñ–∞–π–ª–∞–º–∏">üìÅ –§–∞–π–ª–∏</option>
          <option value="–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è">üé® –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è</option>
        </select>
      </div>

      <div class="overflow-y-auto flex-1 bg-slate-50 dark:bg-slate-900/30 min-h-0">
        <table class="w-full text-left border-collapse">
          <thead class="sticky top-0 bg-white dark:bg-slate-900 shadow-sm z-10">
            <tr class="text-slate-500 dark:text-slate-400 uppercase text-xs tracking-wider">
              <th class="p-4 font-semibold border-b border-slate-200 dark:border-slate-700 w-1/3">–ö–æ–º–±—ñ–Ω–∞—Ü—ñ—è</th>
              <th class="p-4 font-semibold border-b border-slate-200 dark:border-slate-700">–î—ñ—è</th>
              <th class="p-4 font-semibold border-b border-slate-200 dark:border-slate-700 text-right">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th>
            </tr>
          </thead>
          <tbody id="reference-table" class="text-sm divide-y divide-slate-200 dark:divide-slate-700/50"></tbody>
        </table>
      </div>
    </div>

  </main>

  <div id="toast" role="status" aria-live="polite"
    class="fixed top-24 right-5 bg-white dark:bg-slate-800 border border-slate-200 dark:border-transparent border-l-4 border-l-green-500 text-slate-800 dark:text-white px-5 py-3 rounded shadow-2xl translate-x-[150%] transition-transform duration-300 z-50 flex items-center gap-3">
    <div class="bg-green-100 dark:bg-green-500/20 p-2 rounded-full">
      <i class="fa-solid fa-check text-green-600 dark:text-green-500 text-sm"></i>
    </div>
    <div>
      <h4 class="font-bold text-sm">–í—ñ—Ä–Ω–æ!</h4>
      <p class="text-xs text-slate-500 dark:text-slate-400" id="toast-msg">...</p>
    </div>
  </div>

  <script>
    // === –ö–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª –∫–∞—Ç–µ–≥–æ—Ä—ñ–π ===
    // –ë–∞–∑–æ–≤—ñ: Ctrl+A, Ctrl+S, Ctrl+F (–ø–æ—à—É–∫ —è–∫ –±–∞–∑–æ–≤–∞ –Ω–∞–≤–∏—á–∫–∞), + –±–∞–∑–æ–≤—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ —Ñ–∞–π–ª–∞–º–∏ (N/O/P)
    // –ë—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É: C/X/V + Shift+V
    // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è: Undo/Redo + word delete + Tab (–≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞—Ö)
    // –ù–∞–≤—ñ–≥–∞—Ü—ñ—è: Home/End + Ctrl+Home/End + Ctrl+—Å—Ç—Ä—ñ–ª–∫–∏ + Alt+Backspace (—á–∞—Å—Ç–æ "–ù–∞–∑–∞–¥")
    // –í–∏–¥—ñ–ª–µ–Ω–Ω—è: Shift/Shift+Ctrl + —Å—Ç—Ä—ñ–ª–∫–∏/Home/End
    // –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è: B/I/U + L/E/R

    const SHORTCUTS = [
      // === –ë–ê–ó–û–í–Ü ===
      { keys: { ctrl: true, code: 'KeyA' }, label: 'Ctrl + A', desc: '–í–∏–¥—ñ–ª–∏—Ç–∏ –≤—Å–µ', cat: '–ë–∞–∑–æ–≤—ñ', level: 1, color: 'text-emerald-600 dark:text-emerald-400', icon: '‚ú®' },
      { keys: { ctrl: true, code: 'KeyS' }, label: 'Ctrl + S', desc: '–ó–±–µ—Ä–µ–≥—Ç–∏ —Ñ–∞–π–ª', cat: '–ë–∞–∑–æ–≤—ñ', level: 1, color: 'text-emerald-600 dark:text-emerald-400', icon: 'üíæ' },
      { keys: { ctrl: true, code: 'KeyF' }, label: 'Ctrl + F', desc: '–ü–æ—à—É–∫ —É –¥–æ–∫—É–º–µ–Ω—Ç—ñ', cat: '–ë–∞–∑–æ–≤—ñ', level: 1, color: 'text-emerald-600 dark:text-emerald-400', icon: 'üîç' },

      // === –†–û–ë–û–¢–ê –ó –§–ê–ô–õ–ê–ú–ò ===
      { keys: { ctrl: true, code: 'KeyN' }, label: 'Ctrl + N', desc: '–ù–æ–≤–∏–π –¥–æ–∫—É–º–µ–Ω—Ç', cat: '–†–æ–±–æ—Ç–∞ –∑ —Ñ–∞–π–ª–∞–º–∏', level: 1, color: 'text-orange-600 dark:text-orange-400', icon: 'üìÑ' },
      { keys: { ctrl: true, code: 'KeyO' }, label: 'Ctrl + O', desc: '–í—ñ–¥–∫—Ä–∏—Ç–∏ —Ñ–∞–π–ª', cat: '–†–æ–±–æ—Ç–∞ –∑ —Ñ–∞–π–ª–∞–º–∏', level: 1, color: 'text-orange-600 dark:text-orange-400', icon: 'üìÇ' },
      { keys: { ctrl: true, code: 'KeyP' }, label: 'Ctrl + P', desc: '–î—Ä—É–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞', cat: '–†–æ–±–æ—Ç–∞ –∑ —Ñ–∞–π–ª–∞–º–∏', level: 1, color: 'text-orange-600 dark:text-orange-400', icon: 'üñ®Ô∏è' },

      // === –ë–£–§–ï–† –û–ë–ú–Ü–ù–£ ===
      { keys: { ctrl: true, code: 'KeyC' }, label: 'Ctrl + C', desc: '–ö–æ–ø—ñ—é–≤–∞—Ç–∏', cat: '–ë—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É', level: 1, color: 'text-blue-600 dark:text-blue-400', icon: 'üìã' },
      { keys: { ctrl: true, code: 'KeyX' }, label: 'Ctrl + X', desc: '–í–∏—Ä—ñ–∑–∞—Ç–∏', cat: '–ë—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É', level: 1, color: 'text-blue-600 dark:text-blue-400', icon: '‚úÇÔ∏è' },
      { keys: { ctrl: true, code: 'KeyV' }, label: 'Ctrl + V', desc: '–í—Å—Ç–∞–≤–∏—Ç–∏', cat: '–ë—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É', level: 1, color: 'text-blue-600 dark:text-blue-400', icon: 'üìã' },
      { keys: { ctrl: true, shift: true, code: 'KeyV' }, label: 'Ctrl + Shift + V', desc: '–í—Å—Ç–∞–≤–∏—Ç–∏ –±–µ–∑ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è', cat: '–ë—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É', level: 2, color: 'text-blue-600 dark:text-blue-400', icon: 'üìÑ' },

      // === –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø ===
      { keys: { ctrl: true, code: 'KeyZ' }, label: 'Ctrl + Z', desc: '–°–∫–∞—Å—É–≤–∞—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—é –¥—ñ—é', cat: '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è', level: 1, color: 'text-red-600 dark:text-red-400', icon: '‚Ü©Ô∏è' },
      { keys: { ctrl: true, code: 'KeyY' }, label: 'Ctrl + Y', desc: '–ü–æ–≤—Ç–æ—Ä–∏—Ç–∏ –¥—ñ—é', cat: '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è', level: 2, color: 'text-red-600 dark:text-red-400', icon: '‚Ü™Ô∏è' },
      { keys: { ctrl: true, code: 'Backspace' }, label: 'Ctrl + Backspace', desc: '–í–∏–¥–∞–ª–∏—Ç–∏ —Å–ª–æ–≤–æ –ª—ñ–≤–æ—Ä—É—á', cat: '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è', level: 2, color: 'text-red-600 dark:text-red-400', icon: 'üóëÔ∏è' },
      { keys: { ctrl: true, code: 'Delete' }, label: 'Ctrl + Del', desc: '–í–∏–¥–∞–ª–∏—Ç–∏ —Å–ª–æ–≤–æ –ø—Ä–∞–≤–æ—Ä—É—á', cat: '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è', level: 2, color: 'text-red-600 dark:text-red-400', icon: 'üóëÔ∏è' },
      { keys: { code: 'Tab' }, label: 'Tab', desc: '–í—Å—Ç–∞–≤–∏—Ç–∏ –≤—ñ–¥—Å—Ç—É–ø (–≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞—Ö)', cat: '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è', level: 2, color: 'text-red-600 dark:text-red-400', icon: '‚û°Ô∏è' },

      // === –ù–ê–í–Ü–ì–ê–¶–Ü–Ø ===
      { keys: { code: 'Home' }, label: 'Home', desc: '–ù–∞ –ø–æ—á–∞—Ç–æ–∫ —Ä—è–¥–∫–∞', cat: '–ù–∞–≤—ñ–≥–∞—Ü—ñ—è', level: 2, color: 'text-yellow-600 dark:text-yellow-400', icon: '‚¨ÖÔ∏è' },
      { keys: { code: 'End' }, label: 'End', desc: '–í –∫—ñ–Ω–µ—Ü—å —Ä—è–¥–∫–∞', cat: '–ù–∞–≤—ñ–≥–∞—Ü—ñ—è', level: 2, color: 'text-yellow-600 dark:text-yellow-400', icon: '‚û°Ô∏è' },
      { keys: { ctrl: true, code: 'Home' }, label: 'Ctrl + Home', desc: '–ù–∞ –ø–æ—á–∞—Ç–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞', cat: '–ù–∞–≤—ñ–≥–∞—Ü—ñ—è', level: 2, color: 'text-yellow-600 dark:text-yellow-400', icon: '‚¨ÜÔ∏è' },
      { keys: { ctrl: true, code: 'End' }, label: 'Ctrl + End', desc: '–í –∫—ñ–Ω–µ—Ü—å –¥–æ–∫—É–º–µ–Ω—Ç–∞', cat: '–ù–∞–≤—ñ–≥–∞—Ü—ñ—è', level: 2, color: 'text-yellow-600 dark:text-yellow-400', icon: '‚¨áÔ∏è' },
      { keys: { ctrl: true, code: 'ArrowLeft' }, label: 'Ctrl + ‚Üê', desc: '–ü–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ —Å–ª–æ–≤–æ –Ω–∞–∑–∞–¥', cat: '–ù–∞–≤—ñ–≥–∞—Ü—ñ—è', level: 2, color: 'text-yellow-600 dark:text-yellow-400', icon: '‚¨ÖÔ∏è' },
      { keys: { ctrl: true, code: 'ArrowRight' }, label: 'Ctrl + ‚Üí', desc: '–ü–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ —Å–ª–æ–≤–æ –≤–ø–µ—Ä–µ–¥', cat: '–ù–∞–≤—ñ–≥–∞—Ü—ñ—è', level: 2, color: 'text-yellow-600 dark:text-yellow-400', icon: '‚û°Ô∏è' },
      { keys: { alt: true, code: 'Backspace' }, label: 'Alt + Backspace', desc: '–ù–∞–∑–∞–¥ (—É –±–∞–≥–∞—Ç—å–æ—Ö –ø—Ä–æ–≥—Ä–∞–º–∞—Ö/–±—Ä–∞—É–∑–µ—Ä–∞—Ö)', cat: '–ù–∞–≤—ñ–≥–∞—Ü—ñ—è', level: 2, color: 'text-yellow-600 dark:text-yellow-400', icon: '‚Ü©Ô∏è' },

      // === –í–ò–î–Ü–õ–ï–ù–ù–Ø ===
      { keys: { shift: true, code: 'ArrowLeft' }, label: 'Shift + ‚Üê', desc: '–í–∏–¥—ñ–ª–∏—Ç–∏ —Å–∏–º–≤–æ–ª –ª—ñ–≤–æ—Ä—É—á', cat: '–í–∏–¥—ñ–ª–µ–Ω–Ω—è', level: 2, color: 'text-purple-600 dark:text-purple-400', icon: '‚óÄÔ∏è' },
      { keys: { shift: true, code: 'ArrowRight' }, label: 'Shift + ‚Üí', desc: '–í–∏–¥—ñ–ª–∏—Ç–∏ —Å–∏–º–≤–æ–ª –ø—Ä–∞–≤–æ—Ä—É—á', cat: '–í–∏–¥—ñ–ª–µ–Ω–Ω—è', level: 2, color: 'text-purple-600 dark:text-purple-400', icon: '‚ñ∂Ô∏è' },
      { keys: { shift: true, code: 'ArrowUp' }, label: 'Shift + ‚Üë', desc: '–í–∏–¥—ñ–ª–∏—Ç–∏ —Ä—è–¥–æ–∫ –≤–≥–æ—Ä—É', cat: '–í–∏–¥—ñ–ª–µ–Ω–Ω—è', level: 2, color: 'text-purple-600 dark:text-purple-400', icon: 'üîº' },
      { keys: { shift: true, code: 'ArrowDown' }, label: 'Shift + ‚Üì', desc: '–í–∏–¥—ñ–ª–∏—Ç–∏ —Ä—è–¥–æ–∫ –≤–Ω–∏–∑', cat: '–í–∏–¥—ñ–ª–µ–Ω–Ω—è', level: 2, color: 'text-purple-600 dark:text-purple-400', icon: 'üîΩ' },
      { keys: { shift: true, code: 'Home' }, label: 'Shift + Home', desc: '–í–∏–¥—ñ–ª–∏—Ç–∏ –¥–æ –ø–æ—á–∞—Ç–∫—É —Ä—è–¥–∫–∞', cat: '–í–∏–¥—ñ–ª–µ–Ω–Ω—è', level: 3, color: 'text-purple-600 dark:text-purple-400', icon: '‚èÆÔ∏è' },
      { keys: { shift: true, code: 'End' }, label: 'Shift + End', desc: '–í–∏–¥—ñ–ª–∏—Ç–∏ –¥–æ –∫—ñ–Ω—Ü—è —Ä—è–¥–∫–∞', cat: '–í–∏–¥—ñ–ª–µ–Ω–Ω—è', level: 3, color: 'text-purple-600 dark:text-purple-400', icon: '‚è≠Ô∏è' },
      { keys: { shift: true, ctrl: true, code: 'ArrowLeft' }, label: 'Shift + Ctrl + ‚Üê', desc: '–í–∏–¥—ñ–ª–∏—Ç–∏ —Å–ª–æ–≤–æ –ª—ñ–≤–æ—Ä—É—á', cat: '–í–∏–¥—ñ–ª–µ–Ω–Ω—è', level: 3, color: 'text-purple-600 dark:text-purple-400', icon: '‚óÄÔ∏è' },
      { keys: { shift: true, ctrl: true, code: 'ArrowRight' }, label: 'Shift + Ctrl + ‚Üí', desc: '–í–∏–¥—ñ–ª–∏—Ç–∏ —Å–ª–æ–≤–æ –ø—Ä–∞–≤–æ—Ä—É—á', cat: '–í–∏–¥—ñ–ª–µ–Ω–Ω—è', level: 3, color: 'text-purple-600 dark:text-purple-400', icon: '‚ñ∂Ô∏è' },
      { keys: { shift: true, ctrl: true, code: 'Home' }, label: 'Shift + Ctrl + Home', desc: '–í–∏–¥—ñ–ª–∏—Ç–∏ –¥–æ –ø–æ—á–∞—Ç–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–∞', cat: '–í–∏–¥—ñ–ª–µ–Ω–Ω—è', level: 3, color: 'text-purple-600 dark:text-purple-400', icon: '‚è´' },
      { keys: { shift: true, ctrl: true, code: 'End' }, label: 'Shift + Ctrl + End', desc: '–í–∏–¥—ñ–ª–∏—Ç–∏ –¥–æ –∫—ñ–Ω—Ü—è –¥–æ–∫—É–º–µ–Ω—Ç–∞', cat: '–í–∏–¥—ñ–ª–µ–Ω–Ω—è', level: 3, color: 'text-purple-600 dark:text-purple-400', icon: '‚è¨' },

      // === –§–û–†–ú–ê–¢–£–í–ê–ù–ù–Ø ===
      { keys: { ctrl: true, code: 'KeyB' }, label: 'Ctrl + B', desc: '–ñ–∏—Ä–Ω–∏–π —à—Ä–∏—Ñ—Ç', cat: '–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è', level: 2, color: 'text-pink-600 dark:text-pink-400', icon: 'üÖ±Ô∏è' },
      { keys: { ctrl: true, code: 'KeyI' }, label: 'Ctrl + I', desc: '–ö—É—Ä—Å–∏–≤–Ω–∏–π —à—Ä–∏—Ñ—Ç', cat: '–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è', level: 2, color: 'text-pink-600 dark:text-pink-400', icon: 'üÖ∏' },
      { keys: { ctrl: true, code: 'KeyU' }, label: 'Ctrl + U', desc: '–ü—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–∏–π —Ç–µ–∫—Å—Ç', cat: '–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è', level: 2, color: 'text-pink-600 dark:text-pink-400', icon: 'UÃ≤' },
      { keys: { ctrl: true, code: 'KeyL' }, label: 'Ctrl + L', desc: '–í–∏—Ä—ñ–≤–Ω—è—Ç–∏ –ª—ñ–≤–æ—Ä—É—á', cat: '–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è', level: 3, color: 'text-pink-600 dark:text-pink-400', icon: '‚¨ÖÔ∏è' },
      { keys: { ctrl: true, code: 'KeyE' }, label: 'Ctrl + E', desc: '–í–∏—Ä—ñ–≤–Ω—è—Ç–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É', cat: '–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è', level: 3, color: 'text-pink-600 dark:text-pink-400', icon: '‚ÜîÔ∏è' },
      { keys: { ctrl: true, code: 'KeyR' }, label: 'Ctrl + R', desc: '–í–∏—Ä—ñ–≤–Ω—è—Ç–∏ –ø—Ä–∞–≤–æ—Ä—É—á', cat: '–§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è', level: 3, color: 'text-pink-600 dark:text-pink-400', icon: '‚û°Ô∏è' },
    ];

    const BLOCKED_KEYS = [
      'Tab', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight',
      'Space', 'Home', 'End', 'PageUp', 'PageDown', 'Backspace', 'Delete'
    ];

    class ShortcutsTrainer {
      constructor() {
        this.state = {
          currentIndex: null,
          lastIndex: -1,
          score: 0,
          streak: 0,
          totalAttempts: 0,
          correctAttempts: 0,
          isBlocked: false,
          isGameActive: false,
          isPaused: false,
          theme: this.getPreferredTheme(),
          trainCategory: 'all'
        };

        this.dom = {
          html: document.documentElement,
          trainerView: document.getElementById('trainer-view'),
          referenceView: document.getElementById('reference-view'),
          btnTrainer: document.getElementById('btn-trainer'),
          btnReference: document.getElementById('btn-reference'),
          themeBtn: document.getElementById('theme-toggle-btn'),

          taskDesc: document.getElementById('task-desc'),
          catBadge: document.getElementById('category-badge'),
          visualizer: document.getElementById('visualizer'),
          feedback: document.getElementById('feedback'),

          score: document.getElementById('score-display'),
          streak: document.getElementById('streak-display'),
          accuracy: document.getElementById('accuracy-display'),

          startBtn: document.getElementById('start-btn'),
          startBtnText: document.getElementById('start-btn-text'),
          pauseBtn: document.getElementById('pause-btn'),
          pauseBtnText: document.getElementById('pause-btn-text'),
          hintBtn: document.getElementById('hint-btn'),

          toast: document.getElementById('toast'),
          toastMsg: document.getElementById('toast-msg'),

          refTable: document.getElementById('reference-table'),
          trainCategory: document.getElementById('train-category'),

          keyboardNote: document.getElementById('keyboard-note')
        };

        this.nextTimer = null;
        this.toastTimeout = null;

        this.init();
      }

      getPreferredTheme() {
        const saved = localStorage.getItem('theme');
        if (saved) return saved;
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      }

      init() {
        this.applyTheme();
        this.renderReferenceTable();
        this.setupTrainerCategory();
        this.setupKeyboardHint();

        const mq = window.matchMedia('(prefers-color-scheme: dark)');
        if (mq && mq.addEventListener) {
          mq.addEventListener('change', (e) => {
            if (!localStorage.getItem('theme')) {
              this.state.theme = e.matches ? 'dark' : 'light';
              this.applyTheme();
            }
          });
        }

        window.addEventListener('keydown', this.handleGlobalKeyDown.bind(this));

        window.addEventListener('blur', () => this.pauseGame(true));
        document.addEventListener('visibilitychange', () => {
          if (document.hidden) this.pauseGame(true);
        });
      }

      setupKeyboardHint() {
        const isTouch =
          ('ontouchstart' in window) ||
          (navigator.maxTouchPoints && navigator.maxTouchPoints > 0);

        if (isTouch) this.dom.keyboardNote.classList.remove('hidden');
      }

      setupTrainerCategory() {
        this.dom.trainCategory.value = this.state.trainCategory;
        this.dom.trainCategory.addEventListener('change', () => {
          this.state.trainCategory = this.dom.trainCategory.value;
          if (this.state.isGameActive && !this.state.isPaused && !this.state.isBlocked) {
            this.nextTask();
          }
        });
      }

      toggleTheme() {
        this.state.theme = this.state.theme === 'dark' ? 'light' : 'dark';
        localStorage.setItem('theme', this.state.theme);
        this.applyTheme();
      }

      applyTheme() {
        if (this.state.theme === 'dark') this.dom.html.classList.add('dark');
        else this.dom.html.classList.remove('dark');

        if (this.dom.themeBtn) {
          const themeName = this.state.theme === 'dark' ? '—Ç–µ–º–Ω–∞' : '—Å–≤—ñ—Ç–ª–∞';
          this.dom.themeBtn.setAttribute('title', `–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É (–ø–æ—Ç–æ—á–Ω–∞: ${themeName})`);
        }
      }

      switchTab(tab) {
        const isTrainer = tab === 'trainer';

        this.dom.trainerView.classList.toggle('hidden', !isTrainer);
        this.dom.referenceView.classList.toggle('hidden', isTrainer);

        if (isTrainer) {
          this.dom.btnTrainer.className = "px-5 py-2 rounded-md text-sm font-semibold transition-all bg-blue-600 text-white shadow-sm";
          this.dom.btnReference.className = "px-5 py-2 rounded-md text-sm font-semibold transition-all text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-200 dark:hover:bg-slate-700";
        } else {
          this.pauseGame(true);
          this.dom.btnTrainer.className = "px-5 py-2 rounded-md text-sm font-semibold transition-all text-slate-500 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white hover:bg-slate-200 dark:hover:bg-slate-700";
          this.dom.btnReference.className = "px-5 py-2 rounded-md text-sm font-semibold transition-all bg-blue-600 text-white shadow-sm";
        }
      }

      startOrResume() {
        if (this.state.isGameActive && this.state.isPaused) {
          this.resumeGame();
          return;
        }
        this.startNewGame();
      }

      startNewGame() {
        this.clearNextTimer();

        this.state.score = 0;
        this.state.streak = 0;
        this.state.totalAttempts = 0;
        this.state.correctAttempts = 0;
        this.state.isGameActive = true;
        this.state.isPaused = false;
        this.state.isBlocked = false;

        this.updateStats();
        this.setGameButtonsState();

        this.dom.catBadge.textContent = "–ü–æ—á–∏–Ω–∞—î–º–æ!";
        this.dom.feedback.textContent = "";
        this.nextTask();
      }

      togglePause() {
        if (!this.state.isGameActive) return;
        if (this.state.isPaused) this.resumeGame();
        else this.pauseGame(false);
      }

      pauseGame(soft) {
        if (!this.state.isGameActive || this.state.isPaused) return;

        this.state.isPaused = true;
        this.clearNextTimer();

        this.dom.catBadge.textContent = soft ? "–ü–∞—É–∑–∞ (–∞–≤—Ç–æ)" : "–ü–∞—É–∑–∞";
        this.dom.feedback.textContent = "–ì—Ä–∞ –Ω–∞ –ø–∞—É–∑—ñ. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å ¬´–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏¬ª –∞–±–æ Esc.";
        this.dom.feedback.className = "h-6 mb-6 font-semibold text-sm md:text-lg text-amber-500";

        this.setGameButtonsState();
      }

      resumeGame() {
        if (!this.state.isGameActive || !this.state.isPaused) return;

        this.state.isPaused = false;
        this.state.isBlocked = false;

        this.dom.feedback.textContent = "";
        this.dom.feedback.className = "h-6 mb-6 font-semibold text-lg empty:hidden";

        this.setGameButtonsState();

        if (this.state.currentIndex === null) this.nextTask();
      }

      setGameButtonsState() {
        if (!this.state.isGameActive) {
          this.dom.startBtn.classList.remove('hidden');
          this.dom.pauseBtn.classList.add('hidden');
          this.dom.hintBtn.classList.add('hidden');
          this.dom.startBtnText.textContent = "–°—Ç–∞—Ä—Ç";
          return;
        }

        if (this.state.isPaused) {
          this.dom.startBtn.classList.remove('hidden');
          this.dom.pauseBtn.classList.add('hidden');
          this.dom.hintBtn.classList.add('hidden');
          this.dom.startBtnText.textContent = "–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏";
        } else {
          this.dom.startBtn.classList.add('hidden');
          this.dom.pauseBtn.classList.remove('hidden');
          this.dom.hintBtn.classList.remove('hidden');
          this.dom.pauseBtnText.textContent = "–ü–∞—É–∑–∞";
        }
      }

      getPoolIndices() {
        const cat = this.state.trainCategory;
        const pool = [];
        for (let i = 0; i < SHORTCUTS.length; i++) {
          if (cat === 'all' || SHORTCUTS[i].cat === cat) pool.push(i);
        }
        return pool.length ? pool : [...Array(SHORTCUTS.length)].map((_, i) => i);
      }

      nextTask() {
        this.clearNextTimer();

        const pool = this.getPoolIndices();

        let nextIndex = pool[Math.floor(Math.random() * pool.length)];
        if (pool.length > 1) {
          let guard = 0;
          while (nextIndex === this.state.lastIndex && guard < 20) {
            nextIndex = pool[Math.floor(Math.random() * pool.length)];
            guard++;
          }
        }

        this.state.currentIndex = nextIndex;
        this.state.lastIndex = nextIndex;
        this.state.isBlocked = false;

        const task = SHORTCUTS[nextIndex];

        this.dom.catBadge.textContent = task.cat;
        this.dom.taskDesc.textContent = task.desc;
        this.dom.taskDesc.className = `text-2xl md:text-3xl font-bold mb-10 min-h-[4rem] flex items-center justify-center leading-tight transition-colors ${task.color}`;

        this.dom.visualizer.innerHTML = '<div class="animate-pulse text-4xl text-slate-300 dark:text-slate-600">‚å®Ô∏è</div>';
        this.dom.feedback.textContent = '';
      }

      handleGlobalKeyDown(e) {
        if (this.state.isGameActive && e.code === 'Escape') {
          e.preventDefault();
          this.togglePause();
          return;
        }

        if (!this.state.isGameActive || this.state.isPaused) return;

        const t = e.target;
        const isTypingTarget = t && (
          t.tagName === 'INPUT' ||
          t.tagName === 'TEXTAREA' ||
          t.tagName === 'SELECT' ||
          t.isContentEditable
        );
        if (isTypingTarget) return;

        if (e.ctrlKey || e.altKey || BLOCKED_KEYS.includes(e.code) || e.code.startsWith('F')) {
          e.preventDefault();
        }

        if (this.state.isBlocked) return;
        if (e.repeat) return;

        const ignore = ['ControlLeft', 'ControlRight', 'ShiftLeft', 'ShiftRight', 'AltLeft', 'AltRight'];
        if (ignore.includes(e.code)) return;

        this.checkInput(e);
      }

      checkInput(e) {
        const target = SHORTCUTS[this.state.currentIndex];
        const targetKeys = target.keys;

        const ctrlMatch = !!targetKeys.ctrl === e.ctrlKey;
        const shiftMatch = !!targetKeys.shift === e.shiftKey;
        const altMatch = !!targetKeys.alt === e.altKey;

        const codeMatch = targetKeys.code === e.code;

        this.state.totalAttempts++;

        if (ctrlMatch && shiftMatch && altMatch && codeMatch) this.handleSuccess();
        else this.handleFail();
      }

      handleSuccess() {
        this.state.score += 10 + (this.state.streak * 2);
        this.state.streak++;
        this.state.correctAttempts++;
        this.state.isBlocked = true;

        this.updateStats();
        const task = SHORTCUTS[this.state.currentIndex];

        this.showToast(`–ß—É–¥–æ–≤–æ! ${task.label}`);
        this.renderKeys(task);

        this.dom.feedback.textContent = "–ü—Ä–∞–≤–∏–ª—å–Ω–æ!";
        this.dom.feedback.className = "h-6 mb-6 font-bold text-lg text-green-500 animate-pop";

        this.clearNextTimer();
        this.nextTimer = setTimeout(() => {
          if (this.state.isGameActive && !this.state.isPaused) this.nextTask();
        }, 1000);
      }

      handleFail() {
        this.state.streak = 0;
        this.updateStats();

        const card = this.dom.taskDesc.parentElement;
        card.classList.remove('animate-shake');
        void card.offsetWidth;
        card.classList.add('animate-shake');

        this.dom.feedback.textContent = "–°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑";
        this.dom.feedback.className = "h-6 mb-6 font-semibold text-lg text-red-500";
      }

      showHint() {
        if (!this.state.isGameActive || this.state.isPaused || this.state.isBlocked) return;

        this.state.score = Math.max(0, this.state.score - 5);
        this.state.streak = 0;
        this.updateStats();

        const task = SHORTCUTS[this.state.currentIndex];
        this.renderKeys(task);
      }

      renderKeys(task) {
        const parts = [];
        if (task.keys.ctrl) parts.push('Ctrl');
        if (task.keys.shift) parts.push('Shift');
        if (task.keys.alt) parts.push('Alt');

        let mainKey = task.keys.code.replace('Key', '').replace('Digit', '').replace('Arrow', '');

        const keyNames = {
          'Left': '‚Üê', 'Right': '‚Üí', 'Up': '‚Üë', 'Down': '‚Üì',
          'Escape': 'Esc', 'Delete': 'Del', 'Insert': 'Ins',
          'Backspace': 'Backspace',
          'PageUp': 'PgUp', 'PageDown': 'PgDn'
        };

        if (keyNames[mainKey]) mainKey = keyNames[mainKey];
        parts.push(mainKey);

        const html = parts.map(k =>
          `<kbd class="key-cap inline-flex items-center justify-center min-w-[2.5rem] h-10 px-3 bg-white dark:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-600 text-slate-700 dark:text-slate-200 font-bold text-sm shadow-sm mx-1">${k}</kbd>`
        ).join('<span class="text-slate-400 mx-1">+</span>');

        this.dom.visualizer.innerHTML = `<div class="animate-pop">${html}</div>`;
      }

      clearNextTimer() {
        if (this.nextTimer) {
          clearTimeout(this.nextTimer);
          this.nextTimer = null;
        }
      }

      showToast(msg) {
        this.dom.toastMsg.textContent = msg;
        this.dom.toast.classList.remove('translate-x-[150%]');

        if (this.toastTimeout) clearTimeout(this.toastTimeout);
        this.toastTimeout = setTimeout(() => {
          this.dom.toast.classList.add('translate-x-[150%]');
        }, 2000);
      }

      updateStats() {
        this.dom.score.textContent = this.state.score;
        this.dom.streak.textContent = this.state.streak;

        const acc = this.state.totalAttempts === 0
          ? 100
          : Math.round((this.state.correctAttempts / this.state.totalAttempts) * 100);
        this.dom.accuracy.textContent = `${acc}%`;
      }

      renderReferenceTable() {
        this.dom.refTable.innerHTML = '';
        SHORTCUTS.forEach(s => {
          const row = document.createElement('tr');
          row.className = 'hover:bg-slate-100 dark:hover:bg-slate-800/50 transition-colors group';
          row.innerHTML = `
            <td class="p-4 border-b border-slate-200 dark:border-slate-700 font-mono text-blue-600 dark:text-blue-400 font-medium">${s.label}</td>
            <td class="p-4 border-b border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300">${s.desc}</td>
            <td class="p-4 border-b border-slate-200 dark:border-slate-700 text-right">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-200">
                ${s.cat}
              </span>
            </td>
          `;
          this.dom.refTable.appendChild(row);
        });
      }

      filterTable(category) {
        const rows = this.dom.refTable.getElementsByTagName('tr');
        for (let row of rows) {
          const catCell = row.cells[2].textContent.trim();
          if (category === 'all' || catCell === category) row.style.display = '';
          else row.style.display = 'none';
        }
      }
    }

    const app = new ShortcutsTrainer();
  </script>
</body>
</html>
