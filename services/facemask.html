<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–ø–æ–≤–Ω–µ–Ω–∞ —Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—å | –†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –æ–±–ª–∏—á –∑—ñ —Å–º–∞–π–ª–∏–∫–∞–º–∏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            color: #2c3e50;
        }
        p, li {
        font-size: 1.1em;
        }
        
        #video-container {
            position: relative;
            margin: 20px auto;
            width: 640px;
            height: 480px;
        }
        
        #video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f0f0f0;
        }
        
        #overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        #controls {
            margin: 20px 0;
        }
        
        button {
            background-color: #3498db;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        #status {
            margin-top: 10px;
            font-style: italic;
        }
        
        .explanation {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            text-align: left;
        }
        
        .detection-info {
            margin-top: 10px;
            font-weight: bold;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 2s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #emoji-select {
            margin: 10px 0;
            padding: 8px;
            font-size: 16px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="loading">
        <div class="spinner"></div>
        <div id="loadingText">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è face-api.js...</div>
    </div>

    <h1>–í—ñ—Ä—Ç—É–∞–ª—å–Ω—ñ –º–∞—Å–∫–∏ üé≠</h1>
    
    <div id="video-container">
        <video id="video" autoplay muted></video>
        <canvas id="overlay"></canvas>
    </div>
    
    <div id="controls">
        <button id="startButton">–£–≤—ñ–º–∫–Ω—É—Ç–∏ –∫–∞–º–µ—Ä—É</button>
        <button id="stopButton" disabled>–í–∏–º–∫–Ω—É—Ç–∏ –∫–∞–º–µ—Ä—É</button>
        <div style="margin-top: 10px;">
            <label for="emoji-select">–í–∏–±–µ—Ä—ñ—Ç—å —Å–º–∞–π–ª–∏–∫:</label>
            <select id="emoji-select">
                <option value="üòä">üòä –£—Å–º—ñ—à–∫–∞</option>
                <option value="üòé">üòé –ö—Ä—É—Ç–∏–π</option>
                <option value="üê∂">üê∂ –ü–µ—Å–∏–∫</option>
                <option value="ü§ñ">ü§ñ –†–æ–±–æ—Ç</option>
                <option value="üëΩ">üëΩ –ü—Ä–∏–±—É–ª–µ—Ü—å</option>
                <option value="üê±">üê± –ö—ñ—Ç</option>
            </select>
        </div>
    </div>
    
    <div id="status">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö —Ñ–∞–π–ª—ñ–≤...</div>
    <div id="faces-detected" class="detection-info">–ó–Ω–∞–π–¥–µ–Ω–æ –æ–±–ª–∏—á: 0</div>
    
    <div class="explanation">
        <h2>–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?</h2>
        <p>–¶—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É face-api.js –¥–ª—è —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è —Ç–∞ –∑–∞–∫—Ä–∏—Ç—Ç—è –æ–±–ª–∏—á:</p>
        <ol>
            <li>–ü—Ä–æ–≥—Ä–∞–º–∞ –æ—Ç—Ä–∏–º—É—î –¥–æ—Å—Ç—É–ø –¥–æ –≤–µ–±-–∫–∞–º–µ—Ä–∏ –≤–∞—à–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é.</li>
            <li>–ö–æ–∂–µ–Ω –∫–∞–¥—Ä –∞–Ω–∞–ª—ñ–∑—É—î—Ç—å—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–µ–π—Ä–æ–Ω–Ω–æ—ó –º–µ—Ä–µ–∂—ñ TinyFaceDetector.</li>
            <li>–ö–æ–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–∞ –≤–∏—è–≤–ª—è—î –æ–±–ª–∏—á—á—è, –≤–æ–Ω–∞ –∑–∞–∫—Ä–∏–≤–∞—î –π–æ–≥–æ —Å–º–∞–π–ª–∏–∫–æ–º.</li>
            <li>–í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–±—Ä–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ —Å–º–∞–π–ª–∏–∫–∏ —É –≤–∏–ø–∞–¥–∞—é—á–æ–º—É —Å–ø–∏—Å–∫—É.</li>
            <li>–¶–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ, –¥–µ–º–æ–Ω—Å—Ç—Ä—É—é—á–∏ —Å—É—á–∞—Å–Ω—ñ –º–µ—Ç–æ–¥–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–æ–≥–æ –∑–æ—Ä—É.</li>
        </ol>
    </div>

    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ face-api.js -->
    <script src="https://unpkg.com/face-api.js@0.22.2/dist/face-api.min.js"></script>
    
    <script>
        // –ï–ª–µ–º–µ–Ω—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
        const video = document.getElementById('video');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const statusText = document.getElementById('status');
        const facesDetectedText = document.getElementById('faces-detected');
        const loadingElement = document.getElementById('loading');
        const loadingText = document.getElementById('loadingText');
        const emojiSelect = document.getElementById('emoji-select');
        
        // –ó–º—ñ–Ω–Ω—ñ –¥–ª—è —Ä–æ–±–æ—Ç–∏
        let streaming = false;
        let stream = null;
        let detectInterval;
        let currentEmoji = "üòä"; // –°–º–∞–π–ª–∏–∫ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
        
        // –ê–¥—Ä–µ—Å–∞ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª–µ–π
        const MODEL_URL = 'https://raw.githubusercontent.com/justadudewhohacks/face-api.js/master/weights';
        
        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª–µ–π —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è
        async function loadModels() {
            try {
                loadingText.textContent = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª–µ–π face-api.js...';
                
                // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª—ñ Tiny Face Detector
                await faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL);
                // –î–æ–¥–∞—Ç–∫–æ–≤–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —ñ–Ω—à—ñ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –º–æ–¥–µ–ª—ñ
                await faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL);
                
                loadingElement.style.display = 'none';
                statusText.textContent = "–ú–æ–¥–µ–ª—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å '–£–≤—ñ–º–∫–Ω—É—Ç–∏ –∫–∞–º–µ—Ä—É' –¥–ª—è –ø–æ—á–∞—Ç–∫—É.";
                startButton.disabled = false;
            } catch (err) {
                loadingElement.style.display = 'none';
                statusText.textContent = "–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥–µ–ª–µ–π: " + err.message;
                console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:", err);
            }
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –º–∞–ª—é–≤–∞–Ω–Ω—è —Å–º–∞–π–ª–∏–∫–∞ –Ω–∞ –æ–±–ª–∏—á—á—ñ
        function drawEmoji(ctx, detection, emoji) {
            const box = detection.detection.box;
            const size = Math.max(box.width, box.height);
            const fontSize = size;
            
            ctx.font = `${fontSize}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // –ú–∞–ª—é—î–º–æ —Å–º–∞–π–ª–∏–∫ –ø–æ —Ü–µ–Ω—Ç—Ä—É –æ–±–ª–∏—á—á—è
            ctx.fillText(
                emoji,
                box.x + box.width / 2,
                box.y + box.height / 2
            );
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø—É—Å–∫—É –≤–µ–±-–∫–∞–º–µ—Ä–∏
        async function startCamera() {
            if (streaming) return;
            
            try {
                // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–∞–º–µ—Ä–∏
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: "user", 
                        width: { ideal: 640 }, 
                        height: { ideal: 480 } 
                    },
                    audio: false
                });
                
                video.srcObject = stream;
                video.play();
                
                streaming = true;
                startButton.disabled = true;
                stopButton.disabled = false;
                statusText.textContent = "–ö–∞–º–µ—Ä–∞ –ø—Ä–∞—Ü—é—î. –ó–∞–∫—Ä–∏—Ç—Ç—è –æ–±–ª–∏—á —Å–º–∞–π–ª–∏–∫–∞–º–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ.";
                
                // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–∞–Ω–≤–∞—Å—É –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
                const canvas = document.getElementById('overlay');
                const displaySize = { width: video.clientWidth, height: video.clientHeight };
                faceapi.matchDimensions(canvas, displaySize);
                
                // –ó–∞–ø—É—Å–∫ –¥–µ—Ç–µ–∫—Ç—É–≤–∞–Ω–Ω—è
                detectInterval = setInterval(async () => {
                    if (!streaming) return;
                    
                    try {
                        // –í–∏—è–≤–ª–µ–Ω–Ω—è –æ–±–ª–∏—á
                        const detections = await faceapi.detectAllFaces(
                            video, 
                            new faceapi.TinyFaceDetectorOptions()
                        ).withFaceLandmarks();
                        
                        // –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
                        const resizedDetections = faceapi.resizeResults(detections, displaySize);
                        
                        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –∑–Ω–∞–π–¥–µ–Ω–∏—Ö –æ–±–ª–∏—á
                        facesDetectedText.textContent = `–ó–Ω–∞–π–¥–µ–Ω–æ –æ–±–ª–∏—á: ${resizedDetections.length}`;
                        
                        // –û—á–∏—â–µ–Ω–Ω—è –∫–∞–Ω–≤–∞—Å—É
                        const ctx = canvas.getContext('2d');
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        
                        // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π –≤–∏–±—Ä–∞–Ω–∏–π —Å–º–∞–π–ª–∏–∫
                        currentEmoji = emojiSelect.value;
                        
                        // –ú–∞–ª—é—î–º–æ —Å–º–∞–π–ª–∏–∫–∏ –Ω–∞ –æ–±–ª–∏—á—á—è—Ö
                        resizedDetections.forEach(detection => {
                            drawEmoji(ctx, detection, currentEmoji);
                        });
                        
                    } catch (error) {
                        console.error("–ü–æ–º–∏–ª–∫–∞ –≤ –æ–±—Ä–æ–±—Ü—ñ –∫–∞–¥—Ä—É:", error);
                    }
                }, 100);
                
            } catch (error) {
                statusText.textContent = "–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–∞–º–µ—Ä–∏: " + error.message;
                console.error("–ü–æ–º–∏–ª–∫–∞ –∫–∞–º–µ—Ä–∏:", error);
            }
        }
        
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑—É–ø–∏–Ω–∫–∏ –≤–µ–±-–∫–∞–º–µ—Ä–∏
        function stopCamera() {
            if (!streaming) return;
            
            // –ó—É–ø–∏–Ω–∫–∞ –≤—ñ–¥–µ–æ –æ–±—Ä–æ–±–∫–∏
            clearInterval(detectInterval);
            
            // –ó—É–ø–∏–Ω–∫–∞ –∫–∞–º–µ—Ä–∏
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            video.srcObject = null;
            streaming = false;
            
            // –û—á–∏—â–µ–Ω–Ω—è –ø–æ–ª–æ—Ç–Ω–∞
            const canvas = document.getElementById('overlay');
            canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);
            
            startButton.disabled = false;
            stopButton.disabled = true;
            
            statusText.textContent = "–ö–∞–º–µ—Ä—É –≤–∏–º–∫–Ω–µ–Ω–æ.";
            facesDetectedText.textContent = "–ó–Ω–∞–π–¥–µ–Ω–æ –æ–±–ª–∏—á: 0";
        }
        
        // –û–±—Ä–æ–±–ª—è—î–º–æ –∑–º—ñ–Ω—É –≤–∏–±—Ä–∞–Ω–æ–≥–æ —Å–º–∞–π–ª–∏–∫–∞
        emojiSelect.addEventListener('change', function() {
            currentEmoji = this.value;
        });
        
        // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π –¥–ª—è –∫–Ω–æ–ø–æ–∫
        startButton.addEventListener('click', startCamera);
        stopButton.addEventListener('click', stopCamera);
        
        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –º–æ–¥–µ–ª—ñ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
        document.addEventListener("DOMContentLoaded", loadModels);
        
        // –ù–∞ –≤–∏–ø–∞–¥–æ–∫, —è–∫—â–æ DOMContentLoaded –≤–∂–µ –≤—ñ–¥–±—É–≤—Å—è
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            loadModels();
        }
    </script>
</body>
</html>
