<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–õ–ê–ô–î–ò–ö ‚Äî –ü—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #cbd5e1;
            user-select: none;
        }

        .sharp { border-radius: 0 !important; }
        
        /* –ü–æ–ª–æ—Ç–Ω–æ —Å–ª–∞–π–¥–∞ */
        #canvas-container {
            width: 100%;
            max-width: 800px;
            aspect-ratio: 16 / 9;
            background-color: white;
            position: relative;
            overflow: hidden;
            border: 2px solid #64748b;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.1);
        }

        /* –ï–ª–µ–º–µ–Ω—Ç–∏ –Ω–∞ —Å–ª–∞–π–¥—ñ */
        .slide-element {
            position: absolute;
            cursor: move;
            min-width: 50px;
            min-height: 30px;
            border: 1px solid transparent;
            box-sizing: border-box;
        }

        .slide-element.selected {
            border: 2px dashed #2563eb;
        }

        .resize-handle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #2563eb;
            bottom: -5px;
            right: -5px;
            cursor: nwse-resize;
            display: none;
        }

        .slide-element.selected .resize-handle {
            display: block;
        }

        /* –¢–µ–∫—Å—Ç–æ–≤–∏–π –±–ª–æ–∫ */
        .text-element {
            outline: none;
            word-wrap: break-word;
            padding: 5px;
        }

        /* –°–ø–∏—Å–æ–∫ —Å–ª–∞–π–¥—ñ–≤ */
        .sidebar-item {
            width: 100%;
            aspect-ratio: 16 / 9;
            background: white;
            border: 2px solid #94a3b8;
            margin-bottom: 10px;
            position: relative;
            cursor: pointer;
            overflow: hidden;
        }

        .sidebar-item.active {
            border-color: #2563eb;
            box-shadow: 4px 4px 0px #bfdbfe;
        }

        .sidebar-preview-content {
            width: 800px;
            height: 450px;
            transform: scale(0.25);
            transform-origin: top left;
            pointer-events: none;
        }

        .toolbar-group {
            @apply flex flex-col border-r-2 border-slate-200 px-4 last:border-r-0;
        }

        .group-label {
            @apply text-[10px] font-black uppercase text-slate-400 mb-1 tracking-tighter;
        }

        .btn-tool {
            @apply p-2 hover:bg-slate-800 hover:text-white text-slate-700 transition-all border border-transparent flex items-center justify-center;
            min-width: 36px;
            height: 36px;
        }

        .btn-tool.active {
            @apply bg-blue-600 text-white;
        }

        .color-dot {
            @apply w-5 h-5 border border-slate-300 cursor-pointer hover:scale-110 transition-transform;
        }

        #presentation-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 1000;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-slate-900 text-white p-3 flex justify-between items-center z-50">
        <div class="flex items-center gap-3">
            <i class="fas fa-layer-group text-blue-500 text-2xl"></i>
            <h1 class="text-xl font-black tracking-tighter uppercase">–°–õ–ê–ô–î–ò–ö</h1>
        </div>
        <div class="flex gap-2">
            <button onclick="Presentation.start()" class="bg-emerald-500 hover:bg-emerald-600 px-6 py-2 font-black sharp uppercase text-xs transition-all" title="–ü–æ—á–∞—Ç–∏ –ø–æ–∫–∞–∑">
                <i class="fas fa-play mr-2"></i> –ü–µ—Ä–µ–≥–ª—è–¥
            </button>
            <button onclick="Export.toPDF()" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 font-black sharp uppercase text-xs transition-all" title="–ó–±–µ—Ä–µ–≥—Ç–∏ —Ñ–∞–π–ª">
                <i class="fas fa-file-pdf mr-2"></i> PDF
            </button>
            <button onclick="App.clear()" class="bg-red-600 hover:bg-red-700 px-4 py-2 font-black sharp uppercase text-xs transition-all" title="–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å–µ">
                –û—á–∏—Å—Ç–∏—Ç–∏
            </button>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-64 bg-slate-100 border-r-2 border-slate-300 flex flex-col">
            <div id="slide-list" class="p-4 overflow-y-auto flex-1"></div>
            <div class="p-4 border-t-2 border-slate-300 bg-white space-y-2">
                <button onclick="Templates.open()" class="w-full border-2 border-slate-800 py-2 font-black text-[10px] uppercase sharp hover:bg-slate-800 hover:text-white transition-all">
                    –ú–∞–∫–µ—Ç–∏
                </button>
                <button onclick="App.addSlide()" class="w-full bg-blue-600 text-white py-3 font-black sharp uppercase text-xs hover:bg-blue-700 shadow-[4px_4px_0px_#1e40af]">
                    –ù–æ–≤–∏–π —Å–ª–∞–π–¥
                </button>
            </div>
        </aside>

        <!-- Main Area -->
        <main class="flex-1 flex flex-col">
            <!-- Professional Toolbar -->
            <div class="bg-white border-b-2 border-slate-300 p-2 flex items-start overflow-x-auto">
                <div class="toolbar-group">
                    <span class="group-label">–ü—Ä–æ—î–∫—Ç</span>
                    <div class="flex gap-1">
                        <button onclick="App.deleteSlide()" class="btn-tool text-red-500" title="–í–∏–¥–∞–ª–∏—Ç–∏ —Å–ª–∞–π–¥"><i class="fas fa-trash-alt"></i></button>
                        <button onclick="App.duplicateSlide()" class="btn-tool text-emerald-600" title="–î—É–±–ª—é–≤–∞—Ç–∏ —Å–ª–∞–π–¥"><i class="fas fa-copy"></i></button>
                    </div>
                </div>

                <div class="toolbar-group">
                    <span class="group-label">–¢–µ–∫—Å—Ç</span>
                    <div class="flex gap-1 items-center">
                        <button onclick="Editor.format('bold')" class="btn-tool" title="–ñ–∏—Ä–Ω–∏–π"><i class="fas fa-bold"></i></button>
                        <button onclick="Editor.format('italic')" class="btn-tool" title="–ö—É—Ä—Å–∏–≤"><i class="fas fa-italic"></i></button>
                        <select onchange="Editor.format('fontSize', this.value)" class="text-[10px] font-bold border-2 border-slate-200 sharp p-1" title="–†–æ–∑–º—ñ—Ä —Ç–µ–∫—Å—Ç—É">
                            <option value="16px">S</option>
                            <option value="32px" selected>M</option>
                            <option value="48px">L</option>
                            <option value="72px">XL</option>
                        </select>
                        <button onclick="UI.toggleColorPicker('text')" class="btn-tool" title="–ö–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É"><i class="fas fa-font"></i></button>
                    </div>
                </div>

                <div class="toolbar-group">
                    <span class="group-label">–í—Å—Ç–∞–≤–∫–∞</span>
                    <div class="flex gap-1">
                        <button onclick="App.addTextElement()" class="btn-tool text-blue-600" title="–î–æ–¥–∞—Ç–∏ —Ç–µ–∫—Å—Ç"><i class="fas fa-font"></i> <i class="fas fa-plus text-[8px]"></i></button>
                        <button onclick="App.openImageModal()" class="btn-tool text-purple-600" title="–î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ"><i class="fas fa-image"></i></button>
                        <button onclick="UI.toggleEmoji()" class="btn-tool text-amber-500" title="–î–æ–¥–∞—Ç–∏ —Å–º–∞–π–ª–∏–∫"><i class="fas fa-smile"></i></button>
                    </div>
                </div>

                <div class="toolbar-group">
                    <span class="group-label">–°–ª–∞–π–¥</span>
                    <div class="flex gap-1">
                        <button onclick="UI.toggleColorPicker('bg')" class="btn-tool text-orange-500" title="–§–æ–Ω —Å–ª–∞–π–¥–∞"><i class="fas fa-fill-drip"></i></button>
                    </div>
                </div>
            </div>

            <!-- Canvas Workspace -->
            <div class="flex-1 overflow-auto p-12 flex justify-center items-center relative" id="workspace" onclick="App.deselect(event)">
                <div id="canvas-container" class="sharp" ondrop="App.handleDrop(event)" ondragover="event.preventDefault()">
                    <!-- Elements will be here -->
                </div>

                <!-- Color Picker Popover -->
                <div id="color-popover" class="absolute top-4 left-1/2 -translate-x-1/2 bg-white border-2 border-slate-900 p-3 sharp shadow-[8px_8px_0px_rgba(0,0,0,0.1)] hidden z-50">
                    <div class="flex justify-between items-center mb-2">
                        <span id="color-title" class="text-[10px] font-black uppercase tracking-widest">–í–∏–±–µ—Ä—ñ—Ç—å –∫–æ–ª—ñ—Ä</span>
                        <button onclick="UI.closePopovers()" class="text-slate-400 hover:text-black"><i class="fas fa-times text-xs"></i></button>
                    </div>
                    <div id="color-grid" class="grid grid-cols-5 gap-1"></div>
                </div>

                <!-- Emoji Popover -->
                <div id="emoji-popover" class="absolute top-4 left-1/2 -translate-x-1/2 bg-white border-2 border-slate-900 p-3 sharp shadow-[8px_8px_0px_rgba(0,0,0,0.1)] hidden z-50 w-64">
                    <div class="grid grid-cols-6 gap-2" id="emoji-grid"></div>
                </div>
            </div>

            <!-- Footer -->
            <div class="bg-slate-800 text-slate-400 px-4 py-1 flex justify-between text-[10px] font-bold uppercase tracking-widest">
                <span>–ú–∞—Å—à—Ç–∞–±: 100% (16:9)</span>
                <span id="save-status">–ó–±–µ—Ä–µ–∂–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ</span>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="modal-overlay" class="fixed inset-0 bg-slate-900/80 backdrop-blur-sm hidden z-[2000] flex items-center justify-center p-4" onclick="UI.closeModalsIfOutside(event)">
        <div class="bg-white p-8 max-w-md w-full border-2 border-slate-900 sharp shadow-[12px_12px_0px_#2563eb] relative">
            <button onclick="UI.closeModal()" class="absolute top-4 right-4 text-slate-300 hover:text-black"><i class="fas fa-times text-xl"></i></button>
            <h3 id="modal-title" class="text-xl font-black mb-4 uppercase text-center">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3>
            <div id="modal-content" class="mb-6"></div>
            <div id="modal-actions" class="flex gap-2">
                <button id="modal-cancel" class="flex-1 py-3 bg-slate-200 font-black uppercase text-xs sharp">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button id="modal-confirm" class="flex-1 py-3 bg-blue-600 text-white font-black uppercase text-xs sharp">–î–æ–±—Ä–µ</button>
            </div>
        </div>
    </div>

    <!-- Presentation Overlay -->
    <div id="presentation-overlay">
        <div id="pres-canvas-wrapper" class="w-full h-full flex items-center justify-center"></div>
        <button onclick="Presentation.stop()" class="fixed top-6 right-6 text-white text-4xl opacity-50 hover:opacity-100 transition-all"><i class="fas fa-times"></i></button>
    </div>

    <script>
        const STORAGE_KEY = 'slidyk_v10_obj';
        const COLORS = ['#000000', '#ffffff', '#ef4444', '#f97316', '#f59e0b', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899', '#64748b', '#cbd5e1', '#fee2e2', '#dcfce7', '#dbeafe', '#fef3c7'];
        const EMOJIS = ['üòÄ','ü•≥','üòé','üöÄ','üé®','üéÆ','‚öΩ','üê±','üç¶','üçï','üåü','üåà','üî•','üëè','ü§ñ','üí°'];

        let state = {
            slides: [
                {
                    id: Date.now(),
                    background: '#ffffff',
                    elements: [
                        { id: 1, type: 'text', x: 50, y: 50, w: 400, h: 100, content: '<h1>–ú—ñ–π –°–ª–∞–π–¥–∏–∫</h1>', color: '#000000', fontSize: '48px' }
                    ]
                }
            ],
            currentIdx: 0,
            selectedId: null
        };

        let isDragging = false;
        let isResizing = false;
        let dragOffset = { x: 0, y: 0 };
        let resizeTarget = null;
        let colorMode = 'text'; // 'text' or 'bg'

        const App = {
            init() {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) state = JSON.parse(saved);
                this.render();
                this.initEmoji();
                this.initColors();
            },

            save() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
                document.getElementById('save-status').innerText = '–ó–±–µ—Ä–µ–∂–µ–Ω–æ: ' + new Date().toLocaleTimeString();
            },

            render() {
                this.renderSlideList();
                this.renderCanvas();
            },

            renderSlideList() {
                const list = document.getElementById('slide-list');
                list.innerHTML = '';
                state.slides.forEach((s, i) => {
                    const div = document.createElement('div');
                    div.className = `sidebar-item sharp ${i === state.currentIdx ? 'active' : ''}`;
                    div.onclick = () => { state.currentIdx = i; state.selectedId = null; this.render(); };
                    
                    const preview = document.createElement('div');
                    preview.className = 'sidebar-preview-content';
                    preview.style.backgroundColor = s.background;
                    s.elements.forEach(el => {
                        const elDiv = document.createElement('div');
                        elDiv.style.cssText = `position:absolute; left:${el.x}px; top:${el.y}px; width:${el.w}px; height:${el.h}px; font-size:${el.fontSize}; color:${el.color}; overflow:hidden;`;
                        if (el.type === 'text') elDiv.innerHTML = el.content;
                        if (el.type === 'image') elDiv.innerHTML = `<img src="${el.content}" style="width:100%;height:100%;object-fit:cover">`;
                        preview.appendChild(elDiv);
                    });
                    
                    div.appendChild(preview);
                    list.appendChild(div);
                });
            },

            renderCanvas() {
                const container = document.getElementById('canvas-container');
                container.innerHTML = '';
                const slide = state.slides[state.currentIdx];
                container.style.backgroundColor = slide.background;

                slide.elements.forEach(el => {
                    const div = document.createElement('div');
                    div.className = `slide-element ${state.selectedId === el.id ? 'selected' : ''} sharp`;
                    div.style.cssText = `left:${el.x}px; top:${el.y}px; width:${el.w}px; height:${el.h}px; color:${el.color}; font-size:${el.fontSize}; z-index:${el.id};`;
                    
                    if (el.type === 'text') {
                        div.innerHTML = `<div class="text-element" contenteditable="true" oninput="App.updateText(${el.id}, this.innerHTML)">${el.content}</div>`;
                    } else {
                        div.innerHTML = `<img src="${el.content}" style="width:100%;height:100%;object-fit:cover;pointer-events:none" class="sharp">`;
                    }

                    const handle = document.createElement('div');
                    handle.className = 'resize-handle sharp';
                    handle.onmousedown = (e) => this.startResize(e, el.id);
                    div.appendChild(handle);

                    div.onmousedown = (e) => {
                        if (e.target.classList.contains('resize-handle')) return;
                        this.startDrag(e, el.id);
                    };

                    container.appendChild(div);
                });
            },

            addSlide() {
                state.slides.push({ id: Date.now(), background: '#ffffff', elements: [] });
                state.currentIdx = state.slides.length - 1;
                this.render();
                this.save();
            },

            deleteSlide() {
                if (state.slides.length <= 1) return;
                state.slides.splice(state.currentIdx, 1);
                state.currentIdx = Math.max(0, state.currentIdx - 1);
                this.render();
                this.save();
            },

            duplicateSlide() {
                const copy = JSON.parse(JSON.stringify(state.slides[state.currentIdx]));
                copy.id = Date.now();
                state.slides.splice(state.currentIdx + 1, 0, copy);
                state.currentIdx++;
                this.render();
                this.save();
            },

            addTextElement() {
                const id = Date.now();
                state.slides[state.currentIdx].elements.push({
                    id: id, type: 'text', x: 100, y: 100, w: 300, h: 80, content: '–ù–æ–≤–∏–π —Ç–µ–∫—Å—Ç...', color: '#000000', fontSize: '32px'
                });
                state.selectedId = id;
                this.render();
                this.save();
            },

            updateText(id, html) {
                const el = state.slides[state.currentIdx].elements.find(e => e.id === id);
                if (el) el.content = html;
                this.save();
                this.renderSlideList();
            },

            deselect(e) {
                if (e.target.id === 'workspace' || e.target.id === 'canvas-container') {
                    state.selectedId = null;
                    this.render();
                }
            },

            startDrag(e, id) {
                e.stopPropagation();
                state.selectedId = id;
                const el = state.slides[state.currentIdx].elements.find(e => e.id === id);
                isDragging = true;
                dragOffset = { x: e.clientX - el.x, y: e.clientY - el.y };
                this.render();
            },

            startResize(e, id) {
                e.stopPropagation();
                isResizing = true;
                resizeTarget = id;
            },

            handleMouseMove(e) {
                if (isDragging) {
                    const el = state.slides[state.currentIdx].elements.find(e => e.id === state.selectedId);
                    el.x = e.clientX - dragOffset.x;
                    el.y = e.clientY - dragOffset.y;
                    this.renderCanvas();
                }
                if (isResizing) {
                    const el = state.slides[state.currentIdx].elements.find(e => e.id === resizeTarget);
                    el.w = Math.max(50, e.clientX - (document.getElementById('canvas-container').getBoundingClientRect().left + el.x));
                    el.h = Math.max(30, e.clientY - (document.getElementById('canvas-container').getBoundingClientRect().top + el.y));
                    this.renderCanvas();
                }
            },

            handleMouseUp() {
                if (isDragging || isResizing) {
                    isDragging = false;
                    isResizing = false;
                    this.save();
                    this.renderSlideList();
                }
            },

            initEmoji() {
                const grid = document.getElementById('emoji-grid');
                EMOJIS.forEach(emo => {
                    const btn = document.createElement('button');
                    btn.className = 'text-2xl p-1 hover:bg-slate-100 sharp';
                    btn.innerText = emo;
                    btn.onclick = () => {
                        const id = Date.now();
                        state.slides[state.currentIdx].elements.push({
                            id: id, type: 'text', x: 200, y: 200, w: 60, h: 60, content: emo, color: '#000000', fontSize: '48px'
                        });
                        UI.closePopovers();
                        this.render();
                        this.save();
                    };
                    grid.appendChild(btn);
                });
            },

            initColors() {
                const grid = document.getElementById('color-grid');
                COLORS.forEach(col => {
                    const dot = document.createElement('div');
                    dot.className = 'color-dot';
                    dot.style.backgroundColor = col;
                    dot.onclick = () => {
                        if (colorMode === 'text' && state.selectedId) {
                            const el = state.slides[state.currentIdx].elements.find(e => e.id === state.selectedId);
                            if (el) el.color = col;
                        } else if (colorMode === 'bg') {
                            state.slides[state.currentIdx].background = col;
                        }
                        UI.closePopovers();
                        this.render();
                        this.save();
                    };
                    grid.appendChild(dot);
                });
            },

            openImageModal() {
                const content = `
                    <div class="space-y-4">
                        <button onclick="document.getElementById('file-in').click()" class="w-full py-4 border-2 border-dashed border-slate-300 sharp font-black text-xs uppercase hover:bg-slate-50">–û–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª –∑ –ü–ö</button>
                        <input type="file" id="file-in" class="hidden" accept="image/*" onchange="App.handleUpload(this)">
                        <div class="text-center text-[10px] font-black text-slate-400">–ê–ë–û</div>
                        <input type="text" id="img-url" placeholder="–í—Å—Ç–∞–≤—Ç–µ URL..." class="w-full p-3 border-2 border-slate-900 sharp outline-none">
                    </div>
                `;
                UI.modal("–î–û–î–ê–¢–ò –§–û–¢–û", content, () => {
                    const url = document.getElementById('img-url').value;
                    if (url) this.insertImage(url);
                });
            },

            handleUpload(input) {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (e) => this.insertImage(e.target.result);
                    reader.readAsDataURL(input.files[0]);
                    UI.closeModal();
                }
            },

            insertImage(src) {
                const id = Date.now();
                state.slides[state.currentIdx].elements.push({
                    id: id, type: 'image', x: 150, y: 150, w: 300, h: 200, content: src, color: '', fontSize: ''
                });
                state.selectedId = id;
                this.render();
                this.save();
            },

            clear() {
                if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—é –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—é?')) {
                    localStorage.removeItem(STORAGE_KEY);
                    location.reload();
                }
            }
        };

        const UI = {
            toggleEmoji() {
                const p = document.getElementById('emoji-popover');
                const isHidden = p.classList.contains('hidden');
                this.closePopovers();
                if (isHidden) p.classList.remove('hidden');
            },
            toggleColorPicker(mode) {
                colorMode = mode;
                const p = document.getElementById('color-popover');
                const isHidden = p.classList.contains('hidden');
                document.getElementById('color-title').innerText = mode === 'text' ? '–ö–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É' : '–§–æ–Ω —Å–ª–∞–π–¥–∞';
                this.closePopovers();
                if (isHidden) p.classList.remove('hidden');
            },
            closePopovers() {
                document.getElementById('emoji-popover').classList.add('hidden');
                document.getElementById('color-popover').classList.add('hidden');
            },
            modal(title, content, onConfirm) {
                document.getElementById('modal-title').innerText = title;
                document.getElementById('modal-content').innerHTML = content;
                document.getElementById('modal-overlay').classList.remove('hidden');
                document.getElementById('modal-confirm').onclick = () => { onConfirm(); this.closeModal(); };
                document.getElementById('modal-cancel').onclick = () => this.closeModal();
            },
            closeModal() { document.getElementById('modal-overlay').classList.add('hidden'); },
            closeModalsIfOutside(e) { if (e.target.id === 'modal-overlay') this.closeModal(); }
        };

        const Editor = {
            format(cmd, val = null) {
                if (state.selectedId) {
                    const el = state.slides[state.currentIdx].elements.find(e => e.id === state.selectedId);
                    if (el && el.type === 'text') {
                        if (cmd === 'fontSize') el.fontSize = val;
                        else document.execCommand(cmd, false, val);
                        App.render();
                        App.save();
                    }
                }
            }
        };

        const Templates = {
            open() {
                const content = `
                    <div class="grid grid-cols-1 gap-2">
                        <button onclick="Templates.apply(1)" class="p-3 bg-slate-50 border-2 border-slate-900 sharp font-black text-xs uppercase hover:bg-blue-600 hover:text-white">–¢–∏—Ç—É–ª—å–Ω–∏–π</button>
                        <button onclick="Templates.apply(2)" class="p-3 bg-slate-50 border-2 border-slate-900 sharp font-black text-xs uppercase hover:bg-blue-600 hover:text-white">–¢–µ–∫—Å—Ç + –§–æ—Ç–æ</button>
                    </div>
                `;
                UI.modal("–û–ë–ï–†–Ü–¢–¨ –ú–ê–ö–ï–¢", content, null);
                document.getElementById('modal-actions').classList.add('hidden');
            },
            apply(type) {
                const slide = state.slides[state.currentIdx];
                if (slide.elements.length > 0 && !confirm('–û–Ω–æ–≤–∏—Ç–∏ —Å–ª–∞–π–¥? –ü–æ—Ç–æ—á–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –±—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ.')) return;
                
                slide.elements = [];
                if (type === 1) {
                    slide.elements.push({ id: 1, type: 'text', x: 100, y: 150, w: 600, h: 150, content: '<h1 style="text-align:center">–ó–ê–ì–û–õ–û–í–û–ö</h1>', color: '#000000', fontSize: '72px' });
                } else if (type === 2) {
                    slide.elements.push({ id: 1, type: 'text', x: 50, y: 50, w: 350, h: 350, content: '<h2>–ú—ñ–π —Ç–µ–∫—Å—Ç...</h2>', color: '#000000', fontSize: '32px' });
                    slide.elements.push({ id: 2, type: 'image', x: 420, y: 50, w: 330, h: 350, content: 'https://via.placeholder.com/300', color: '', fontSize: '' });
                }
                
                UI.closeModal();
                App.render();
                App.save();
            }
        };

        const Presentation = {
            idx: 0,
            start() {
                this.idx = 0;
                document.getElementById('presentation-overlay').style.display = 'block';
                this.render();
                window.addEventListener('keydown', this.handleKeys);
            },
            stop() {
                document.getElementById('presentation-overlay').style.display = 'none';
                window.removeEventListener('keydown', this.handleKeys);
            },
            render() {
                const wrapper = document.getElementById('pres-canvas-wrapper');
                wrapper.innerHTML = '';
                const slide = state.slides[this.idx];
                const canvas = document.createElement('div');
                canvas.style.cssText = `width:800px; height:450px; background-color:${slide.background}; position:relative; overflow:hidden; border:10px solid #222;`;
                
                slide.elements.forEach(el => {
                    const div = document.createElement('div');
                    div.style.cssText = `position:absolute; left:${el.x}px; top:${el.y}px; width:${el.w}px; height:${el.h}px; font-size:${el.fontSize}; color:${el.color};`;
                    if (el.type === 'text') div.innerHTML = el.content;
                    if (el.type === 'image') div.innerHTML = `<img src="${el.content}" style="width:100%;height:100%;object-fit:cover">`;
                    canvas.appendChild(div);
                });
                wrapper.appendChild(canvas);
            },
            handleKeys(e) {
                if (e.key === 'ArrowRight' || e.key === ' ') {
                    if (Presentation.idx < state.slides.length - 1) { Presentation.idx++; Presentation.render(); }
                    else Presentation.stop();
                }
                if (e.key === 'ArrowLeft') {
                    if (Presentation.idx > 0) { Presentation.idx--; Presentation.render(); }
                }
                if (e.key === 'Escape') Presentation.stop();
            }
        };

        const Export = {
            async toPDF() {
                const container = document.createElement('div');
                state.slides.forEach(s => {
                    const page = document.createElement('div');
                    page.style.cssText = `width:800px; height:450px; background-color:${s.background}; position:relative; overflow:hidden; page-break-after:always;`;
                    s.elements.forEach(el => {
                        const div = document.createElement('div');
                        div.style.cssText = `position:absolute; left:${el.x}px; top:${el.y}px; width:${el.w}px; height:${el.h}px; font-size:${el.fontSize}; color:${el.color};`;
                        if (el.type === 'text') div.innerHTML = el.content;
                        if (el.type === 'image') div.innerHTML = `<img src="${el.content}" style="width:100%;height:100%;object-fit:cover">`;
                        page.appendChild(div);
                    });
                    container.appendChild(page);
                });
                await html2pdf().from(container).set({ margin: 0, filename: '–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü—ñ—è.pdf', jsPDF: { format: [800, 450], orientation: 'landscape' } }).save();
            }
        };

        window.onmousemove = (e) => App.handleMouseMove(e);
        window.onmouseup = () => App.handleMouseUp();
        window.onload = () => App.init();
    </script>
</body>
</html>
