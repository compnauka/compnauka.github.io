<!DOCTYPE html>
<html lang="uk">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>Ğ„Ğ´Ğ¸Ğ½Ğ¾Ñ€Ñ–Ğ¶ĞºĞ° Ñ– ĞœĞ°Ğ³Ñ–Ñ‡Ğ½Ñ– ĞšÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ¸</title>
Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
Â  <style>
Â  Â  :root{ --cell-gap-sm:2px; --cell-gap-lg:4px; }
Â  Â  body{font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;touch-action:manipulation}
Â  Â  .grid-cell{aspect-ratio:1;border:2px solid #e9d5ff;transition:all .2s;position:relative;}
Â  Â  @media (max-width:640px){.grid-cell{border-width:1px}}

Â  Â  .command-slot{
Â  Â  Â  aspect-ratio:1;
Â  Â  Â  border:3px dashed #c084fc;
Â  Â  Â  transition:all .2s;
Â  Â  Â  width:100%;
Â  Â  Â  min-width:0;
Â  Â  Â  min-height:0;
Â  Â  }
Â  Â  @media (min-width:640px){ .command-slot{ } }
Â  Â  .command-slot.filled{border-style:solid;border-color:#a855f7;background-color:#faf5ff;cursor:pointer}

Â  Â  #commandSlots{
Â  Â  Â  grid-auto-flow: row;
Â  Â  Â  grid-auto-rows: 1fr;
Â  Â  Â  grid-template-columns: repeat(auto-fill, minmax(56px, 1fr));
Â  Â  Â  gap: .5rem;
Â  Â  }
Â  Â  @media (min-width:640px){
Â  Â  Â  #commandSlots{
Â  Â  Â  Â  grid-template-columns: repeat(auto-fill, minmax(64px, 1fr));
Â  Â  Â  Â  gap: .75rem;
Â  Â  Â  }
Â  Â  }

Â  Â  .arrow-btn{aspect-ratio:1;cursor:pointer;transition:transform .15s;user-select:none}
Â  Â  .arrow-btn:active{transform:scale(1.08)}
Â  Â  @keyframes sparkle-float{0%,100%{transform:translateY(0) rotate(0)}50%{transform:translateY(-8px) rotate(5deg)}}
Â  Â  .character{animation:sparkle-float 2s infinite ease-in-out}
Â  Â  @keyframes gem-collect{0%{transform:scale(1) rotate(0);opacity:1}50%{transform:scale(1.5) rotate(180deg);opacity:0.7}100%{transform:scale(0.2) rotate(360deg);opacity:0}}
Â  Â  .collecting{animation:gem-collect .7s forwards}
Â  Â  @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
Â  Â  .shake{animation:shake .5s}
Â  Â  @keyframes cell-sparkle{0%{transform:scale(1);background-color:#faf5ff;box-shadow:0 0 0 rgba(168,85,247,0)}50%{transform:scale(1.05);background-color:#f3e8ff;box-shadow:0 0 20px rgba(168,85,247,0.6)}100%{transform:scale(1);background-color:#faf5ff;box-shadow:0 0 0 rgba(168,85,247,0)}}
Â  Â  .landing{animation:cell-sparkle .4s ease-out}
Â  Â  @keyframes win-rainbow{0%{transform:scale(1) rotate(0);filter:hue-rotate(0deg)}20%{transform:scale(1.15) rotate(-8deg);filter:hue-rotate(60deg)}40%{transform:scale(1.15) rotate(8deg);filter:hue-rotate(120deg)}60%{transform:scale(1.15) rotate(-8deg);filter:hue-rotate(180deg)}80%{transform:scale(1.15) rotate(8deg);filter:hue-rotate(240deg)}100%{transform:scale(1) rotate(0);filter:hue-rotate(360deg)}}
Â  Â  .win-pulse div{animation:win-rainbow 1.5s ease-in-out}
Â  Â  @keyframes grid-shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}50%{transform:translateX(6px)}75%{transform:translateX(-6px)}}
Â  Â  .grid-shaking{animation:grid-shake .4s linear}
Â  Â  .sparkle-container{position:absolute;inset:0;pointer-events:none;overflow:hidden}
Â  Â  .sparkle-bit{position:absolute;width:10px;height:10px;background:linear-gradient(45deg, #fbbf24, #ec4899);border-radius:50%;animation:sparkle-fx .9s forwards;opacity:0}
Â  Â  @keyframes sparkle-fx{0%{opacity:1;transform:scale(.5) translate(0,0)}100%{opacity:0;transform:scale(1.5) var(--tw-translate)}}

Â  Â  .emoji-xs{font-size:1.35rem}
Â  Â  .emoji-sm{font-size:1.75rem}
Â  Â  .emoji-md{font-size:2.25rem}
Â  Â  .emoji-lg{font-size:2.75rem}

Â  Â  .trail-dot{position:absolute;width:12px;height:12px;border-radius:50%;background:linear-gradient(135deg, #ec4899, #a855f7);opacity:.9;top:50%;left:50%;transform:translate(-50%,-50%);animation:trail-fade .7s ease-out forwards;box-shadow:0 0 8px rgba(168,85,247,0.6)}
Â  Â  @keyframes trail-fade{to{opacity:0;transform:translate(-50%,-50%) scale(0.3)}}
Â  Â  .near-obstacle{box-shadow:inset 0 0 0 3px rgba(239,68,68,.4);animation:near-pulse .6s ease-out 1}
Â  Â  @keyframes near-pulse{0%{box-shadow:inset 0 0 0 0 rgba(239,68,68,0)}50%{box-shadow:inset 0 0 0 6px rgba(239,68,68,.4)}100%{box-shadow:inset 0 0 0 3px rgba(239,68,68,.4)}}
Â  Â  .confetti{position:absolute;inset:0;pointer-events:none;overflow:hidden;z-index:100}
Â  Â  .confetti-bit{position:absolute;width:10px;height:10px;border-radius:50%;opacity:.95;animation:confetti-fall 1400ms ease-out forwards}
Â  Â  @keyframes confetti-fall{0%{transform:translateY(-30px) rotate(0) scale(1)}100%{transform:translateY(180px) rotate(1080deg) scale(0.5);opacity:0}}
Â  Â Â 
Â  Â  @keyframes float-achievement{
Â  Â  Â  0%{transform:translateY(20px) scale(0.8);opacity:0}
Â  Â  Â  50%{transform:translateY(0) scale(1.08);opacity:1}
Â  Â  Â  100%{transform:translateY(0) scale(1);opacity:1}
Â  Â  }
Â  Â  .achievement-toast{
Â  Â  Â  animation: float-achievement 0.7s ease-out;
Â  Â  }
Â  Â Â 
Â  Â  .progress-bar{
Â  Â  Â  height:10px;
Â  Â  Â  background:linear-gradient(90deg, #ec4899 0%, #a855f7 50%, #8b5cf6 100%);
Â  Â  Â  border-radius:999px;
Â  Â  Â  transition:width 0.6s ease-out;
Â  Â  Â  box-shadow:0 0 10px rgba(168,85,247,0.5);
Â  Â  }
Â  Â Â 
Â  Â  @keyframes pulse-glow{
Â  Â  Â  0%, 100%{box-shadow:0 0 20px rgba(168,85,247,0.6), 0 0 40px rgba(236,72,153,0.4)}
Â  Â  Â  50%{box-shadow:0 0 30px rgba(168,85,247,0.8), 0 0 60px rgba(236,72,153,0.6)}
Â  Â  }
Â  Â  .pulse-glow{animation:pulse-glow 2s infinite}

Â  Â  .hint-bubble{
Â  Â  Â  animation: bounce 2s infinite;
Â  Â  Â  filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
Â  Â  }
Â  Â Â 
Â  Â  @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
Â  Â Â 
Â  Â  .gem-glow{
Â  Â  Â  animation: gem-pulse 1.5s infinite;
Â  Â  }
Â  Â Â 
Â  Â  @keyframes gem-pulse{
Â  Â  Â  0%, 100%{transform:scale(1);filter:brightness(1)}
Â  Â  Â  50%{transform:scale(1.1);filter:brightness(1.3)}
Â  Â  }
Â  </style>
</head>
<body class="bg-gradient-to-br from-pink-200 via-purple-200 to-indigo-200 min-h-screen p-2 sm:p-4">
Â  <div class="max-w-7xl mx-auto">
Â  Â  <!-- Header -->
Â  Â  <header class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-3 sm:p-6 mb-3 sm:mb-6 border-4 border-purple-300">
Â  Â  Â  <div class="flex justify-between items-start mb-3">
Â  Â  Â  Â  <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent">
Â  Â  Â  Â  Â  <i class="fas fa-gem" aria-hidden="true"></i>
Â  Â  Â  Â  Â  Ğ„Ğ´Ğ¸Ğ½Ğ¾Ñ€Ñ–Ğ¶ĞºĞ° Ñ– ĞœĞ°Ğ³Ñ–Ñ‡Ğ½Ñ– ĞšÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ¸
Â  Â  Â  Â  </h1>
Â  Â  Â  Â  <button id="soundBtn" class="bg-gradient-to-r from-purple-200 to-pink-200 hover:from-purple-300 hover:to-pink-300 px-3 py-2 rounded-xl transition" title="Ğ—Ğ²ÑƒĞº">
Â  Â  Â  Â  Â  <i class="fas fa-volume-up text-xl text-purple-600" aria-hidden="true"></i>
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <!-- Progress Bar -->
Â  Â  Â  <div class="bg-gray-200 rounded-full h-4 mb-3 overflow-hidden border-2 border-purple-300">
Â  Â  Â  Â  <div id="progressBar" class="progress-bar" style="width:0%"></div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <div class="flex justify-between items-center text-lg sm:text-xl md:text-2xl" role="status" aria-live="polite">
Â  Â  Â  Â  <div class="font-bold text-purple-600">Ğ Ñ–Ğ²ĞµĞ½ÑŒ: <span id="levelNum">1</span>/<span id="totalLevels">10</span></div>
Â  Â  Â  Â  <div class="font-bold bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent">
Â  Â  Â  Â  Â  <i class="fas fa-gem" aria-hidden="true"></i> <span id="gemsCount">0</span>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <!-- Hint bubble -->
Â  Â  Â  <div id="hintBubble" class="hidden mt-3 bg-gradient-to-r from-purple-100 to-pink-100 border-3 border-purple-400 rounded-xl p-3 text-center hint-bubble">
Â  Â  Â  Â  <p class="text-lg sm:text-xl font-bold text-purple-700"><i class="fas fa-magic"></i> <span id="hintText"></span></p>
Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <!-- Main layout -->
Â  Â  <main class="grid grid-cols-1 md:grid-cols-3 gap-3 sm:gap-6">
Â  Â  Â  <!-- Game board -->
Â  Â  Â  <section class="md:col-span-2 bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-3 sm:p-6 flex flex-col border-4 border-purple-300" aria-label="Ğ†Ğ³Ñ€Ğ¾Ğ²Ğµ Ğ¿Ğ¾Ğ»Ğµ">
Â  Â  Â  Â  <div class="flex-1 flex justify-center items-center min-h-[300px] md:min-h-[420px]">
Â  Â  Â  Â  Â  <div id="gameGrid" class="relative" aria-label="Ğ¡Ñ–Ñ‚ĞºĞ° Ğ³Ñ€Ğ¸" role="grid"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </section>

Â  Â  Â  <!-- Controls -->
Â  Â  Â  <aside class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-3 sm:p-6 flex flex-col border-4 border-purple-300" aria-label="ĞŸĞ°Ğ½ĞµĞ»ÑŒ ĞºĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ">
Â  Â  Â  Â  <h2 class="text-xl sm:text-2xl font-bold text-purple-600 mb-3 sm:mb-4 flex-shrink-0"><i class="fas fa-magic" aria-hidden="true"></i> ĞœĞ°Ğ³Ñ–Ñ‡Ğ½Ñ– ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¸</h2>

Â  Â  Â  Â  <div class="grid grid-cols-2 gap-2 sm:gap-4 mb-4 sm:mb-6 flex-shrink-0">
Â  Â  Â  Â  Â  <button id="upBtn" class="arrow-btn bg-gradient-to-br from-purple-400 to-purple-600 hover:from-purple-500 hover:to-purple-700 text-white rounded-xl text-3xl sm:text-4xl md:text-5xl p-2 sm:p-3 shadow-lg" aria-label="Ğ’Ğ³Ğ¾Ñ€Ñƒ"><i class="fas fa-arrow-up" aria-hidden="true"></i></button>
Â  Â  Â  Â  Â  <button id="downBtn" class="arrow-btn bg-gradient-to-br from-pink-400 to-pink-600 hover:from-pink-500 hover:to-pink-700 text-white rounded-xl text-3xl sm:text-4xl md:text-5xl p-2 sm:p-3 shadow-lg" aria-label="Ğ’Ğ½Ğ¸Ğ·"><i class="fas fa-arrow-down" aria-hidden="true"></i></button>
Â  Â  Â  Â  Â  <button id="leftBtn" class="arrow-btn bg-gradient-to-br from-indigo-400 to-indigo-600 hover:from-indigo-500 hover:to-indigo-700 text-white rounded-xl text-3xl sm:text-4xl md:text-5xl p-2 sm:p-3 shadow-lg" aria-label="Ğ’Ğ»Ñ–Ğ²Ğ¾"><i class="fas fa-arrow-left" aria-hidden="true"></i></button>
Â  Â  Â  Â  Â  <button id="rightBtn" class="arrow-btn bg-gradient-to-br from-rose-400 to-rose-600 hover:from-rose-500 hover:to-rose-700 text-white rounded-xl text-3xl sm:text-4xl md:text-5xl p-2 sm:p-3 shadow-lg" aria-label="Ğ’Ğ¿Ñ€Ğ°Ğ²Ğ¾"><i class="fas fa-arrow-right" aria-hidden="true"></i></button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <h3 class="text-lg sm:text-xl font-bold text-gray-700 mb-2 sm:mb-3 flex-shrink-0">ĞŸÑ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ° Ñ€ÑƒÑ…Ñƒ:</h3>
Â  Â  Â  Â  <div id="commandSlots" class="grid gap-2 mb-4 sm:mb-6 flex-shrink-0" aria-label="Ğ¡Ğ»Ğ¾Ñ‚Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´"></div>

Â  Â  Â  Â  <div class="flex-grow"></div>

Â  Â  Â  Â  <div class="flex gap-2 flex-shrink-0">
Â  Â  Â  Â  Â  <button id="runBtn" class="flex-1 bg-gradient-to-r from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 text-white font-bold py-3 sm:py-4 px-3 sm:px-6 rounded-xl text-base sm:text-lg md:text-xl disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"><i class="fas fa-play" aria-hidden="true"></i> ĞŸÑƒÑĞº</button>
Â  Â  Â  Â  Â  <button id="clearBtn" class="flex-1 bg-gradient-to-r from-red-400 to-orange-500 hover:from-red-500 hover:to-orange-600 text-white font-bold py-3 sm:py-4 px-3 sm:px-6 rounded-xl text-base sm:text-lg md:text-xl shadow-lg"><i class="fas fa-eraser" aria-hidden="true"></i> ĞÑ‡Ğ¸ÑÑ‚Ğ¸Ñ‚Ğ¸</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </aside>
Â  Â  </main>

Â  Â  <!-- Win modal -->
Â  Â  <div id="winModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" role="dialog" aria-modal="true">
Â  Â  Â  <div class="bg-gradient-to-br from-purple-100 to-pink-100 rounded-3xl p-6 sm:p-8 max-w-md w-full text-center relative overflow-hidden border-4 border-purple-400 shadow-2xl">
Â  Â  Â  Â  <div id="winConfetti" class="confetti"></div>
Â  Â  Â  Â  <div class="text-6xl sm:text-7xl mb-4 win-pulse"><div>ğŸ¦„</div></div>
Â  Â  Â  Â  <h2 class="text-3xl sm:text-4xl font-bold bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent mb-2">ĞœĞ°Ğ³Ñ–Ñ!</h2>
Â  Â  Â  Â  <p class="text-xl sm:text-2xl mb-4 font-bold text-purple-600" id="encouragement"></p>
Â  Â  Â  Â  <p class="text-lg sm:text-xl mb-6 text-gray-700" id="winMessage"></p>
Â  Â  Â  Â  <button id="nextLevelBtn" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-4 px-8 rounded-xl text-xl w-full pulse-glow shadow-lg">
Â  Â  Â  Â  Â  ĞĞ°ÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ğ¹ Ñ€Ñ–Ğ²ĞµĞ½ÑŒ <i class="fas fa-sparkles" aria-hidden="true"></i>
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Error modal -->
Â  Â  <div id="errorModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" role="dialog" aria-modal="true">
Â  Â  Â  <div class="bg-gradient-to-br from-orange-100 to-yellow-100 rounded-3xl p-6 sm:p-8 max-w-md w-full text-center border-4 border-orange-400 shadow-2xl">
Â  Â  Â  Â  <div class="text-5xl sm:text-6xl mb-4" aria-hidden="true">ğŸ¦„</div>
Â  Â  Â  Â  <h2 class="text-2xl sm:text-3xl font-bold text-orange-600 mb-4">ĞĞ¹-Ğ¾Ğ¹!</h2>
Â  Â  Â  Â  <p class="text-lg sm:text-xl mb-6 text-gray-700" id="errorMessage"></p>
Â  Â  Â  Â  <div class="flex gap-2 flex-wrap justify-center">
Â  Â  Â  Â  Â  <button id="retryBtn" class="bg-gradient-to-r from-purple-400 to-pink-400 hover:from-purple-500 hover:to-pink-500 text-white font-bold py-3 px-6 rounded-xl text-lg shadow-lg">
Â  Â  Â  Â  Â  Â  Ğ¡Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ²Ğ°Ñ‚Ğ¸ Ñ‰Ğµ <i class="fas fa-redo" aria-hidden="true"></i>
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button id="closeErrBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-xl text-lg shadow-lg">Ğ—Ñ€Ğ¾Ğ·ÑƒĞ¼Ñ–Ğ»Ğ¾</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- Achievement toast -->
Â  Â  <div id="achievementToast" class="hidden fixed top-20 left-1/2 -translate-x-1/2 z-[60] bg-gradient-to-r from-purple-500 via-pink-500 to-purple-500 text-white px-6 py-4 rounded-2xl shadow-2xl achievement-toast border-4 border-white">
Â  Â  Â  <div class="flex items-center gap-3">
Â  Â  Â  Â  <div class="text-4xl" id="achievementIcon"></div>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <div class="font-bold text-lg" id="achievementTitle"></div>
Â  Â  Â  Â  Â  <div class="text-sm" id="achievementText"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  // ===== Constants =====
Â  Â  const ANIMATION_SPEED = 350;
Â  Â  const DIRECTION_VECTORS = { up:[-1,0], down:[1,0], left:[0,-1], right:[0,1] };
Â  Â  const ARROW_ICONS = {
Â  Â  Â  up:'<i class="fas fa-arrow-up text-purple-500" aria-hidden="true"></i>',
Â  Â  Â  down:'<i class="fas fa-arrow-down text-pink-500" aria-hidden="true"></i>',
Â  Â  Â  left:'<i class="fas fa-arrow-left text-indigo-500" aria-hidden="true"></i>',
Â  Â  Â  right:'<i class="fas fa-arrow-right text-rose-500" aria-hidden="true"></i>'
Â  Â  };

Â  Â  // ===== Levels =====
Â  Â  const LEVELS = [
Â  Â  Â  // Level 1-2: Tutorial - Simple straight lines
Â  Â  Â  {Â 
Â  Â  Â  Â  size:3, start:[1,0], obstacles:[],Â 
Â  Â  Â  Â  gems:[[1,1],[1,2]], maxCommands:2,
Â  Â  Â  Â  hint:"Ğ ÑƒÑ…Ğ°Ğ¹ÑÑ Ğ²Ğ¿Ñ€Ğ°Ğ²Ğ¾ Ñ– Ğ·Ğ±Ğ¸Ñ€Ğ°Ğ¹ ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ¸! âœ¨"Â 
Â  Â  Â  },
Â  Â  Â  {Â 
Â  Â  Â  Â  size:4, start:[0,0], obstacles:[],Â 
Â  Â  Â  Â  gems:[[1,0],[2,0],[3,0]], maxCommands:3,
Â  Â  Â  Â  hint:"Ğ ÑƒÑ…Ğ°Ğ¹ÑÑ Ğ²Ğ½Ğ¸Ğ· Ñ‚Ğ° Ğ·Ğ±ĞµÑ€Ğ¸ Ğ²ÑÑ– ĞºĞ°Ğ¼Ñ–Ğ½Ñ†Ñ–! ğŸ’"Â 
Â  Â  Â  },
Â  Â  Â Â 
Â  Â  Â  // Level 3-4: Easy turns
Â  Â  Â  {Â 
Â  Â  Â  Â  size:4, start:[0,0], obstacles:[],Â 
Â  Â  Â  Â  gems:[[0,1],[1,1],[1,2]], maxCommands:4
Â  Â  Â  },
Â  Â  Â  {Â 
Â  Â  Â  Â  size:4, start:[0,0], obstacles:[[1,1]],Â 
Â  Â  Â  Â  gems:[[0,2],[2,0],[2,2]], maxCommands:6
Â  Â  Â  },
Â  Â  Â Â 
Â  Â  Â  // Level 5-6: Medium complexity
Â  Â  Â  {Â 
Â  Â  Â  Â  size:5, start:[2,0], obstacles:[[2,1],[2,2]],Â 
Â  Â  Â  Â  gems:[[1,1],[3,1],[2,3]], maxCommands:7
Â  Â  Â  },
Â  Â  Â  {Â 
Â  Â  Â  Â  size:5, start:[0,0], obstacles:[[1,1],[2,2],[3,3]],Â 
Â  Â  Â  Â  gems:[[0,2],[2,0],[4,4]], maxCommands:9
Â  Â  Â  },
Â  Â  Â Â 
Â  Â  Â  // Level 7-8: Advanced mazes
Â  Â  Â  {Â 
Â  Â  Â  Â  size:5, start:[0,2], obstacles:[[1,0],[1,1],[1,3],[1,4],[3,2]],Â 
Â  Â  Â  Â  gems:[[0,0],[0,4],[4,0],[4,4]], maxCommands:12
Â  Â  Â  },
Â  Â  Â  {Â 
Â  Â  Â  Â  size:6, start:[0,0], obstacles:[[1,1],[1,2],[2,3],[3,2],[4,4]],Â 
Â  Â  Â  Â  gems:[[0,3],[3,0],[5,3],[3,5]], maxCommands:14
Â  Â  Â  },
Â  Â  Â Â 
Â  Â  Â  // Level 9-10: Expert challenges
Â  Â  Â  {Â 
Â  Â  Â  Â  size:6, start:[0,0], obstacles:[[0,2],[1,1],[2,0],[2,3],[3,2],[4,1],[4,4]],Â 
Â  Â  Â  Â  gems:[[0,4],[2,2],[4,0],[5,5]], maxCommands:16
Â  Â  Â  },
Â  Â  Â  {Â 
Â  Â  Â  Â  size:7, start:[3,0], obstacles:[[1,2],[2,1],[2,3],[3,2],[4,1],[4,3],[5,2]],Â 
Â  Â  Â  Â  gems:[[0,0],[0,6],[6,0],[6,6],[3,3]], maxCommands:18
Â  Â  Â  }
Â  Â  ];

Â  Â  // ===== Encouragements =====
Â  Â  const ENCOURAGEMENTS = [
Â  Â  Â  "Ğ¢Ğ¸ Ñ‡Ğ°Ñ€Ñ–Ğ²Ğ½Ğ°! ğŸŒŸ", "ĞœĞ°Ğ³Ñ–Ñ ÑƒÑĞ¿Ñ–Ñ…Ñƒ! âœ¨", "Ğ§ÑƒĞ´Ğ¾Ğ²Ğ° Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ°! ğŸ¦„",Â 
Â  Â  Â  "Ğ‘Ğ»Ğ¸ÑĞºÑƒÑ‡Ğµ! ğŸ’", "ĞšĞ°Ğ·ĞºĞ¾Ğ²Ğ°! ğŸŒˆ", "ĞĞµĞ¿ĞµÑ€ĞµĞ²ĞµÑ€ÑˆĞµĞ½Ğ°! ğŸ¨",
Â  Â  Â  "ĞœĞ°Ğ³Ñ–Ñ‡Ğ½Ğ¾! â­", "Ğ¤Ğ°Ğ½Ñ‚Ğ°ÑÑ‚Ğ¸ĞºĞ°! ğŸª"
Â  Â  ];

Â  Â  const FRIENDLY_ERRORS = [
Â  Â  Â  "Ğ„Ğ´Ğ¸Ğ½Ğ¾Ñ€Ñ–Ğ¶ĞºĞ° Ğ·ÑƒĞ¿Ğ¸Ğ½Ğ¸Ğ»Ğ°ÑÑ Ğ¿ĞµÑ€ĞµĞ´ ÑĞºĞµĞ»ĞµÑ! ğŸª¨ Ğ¡Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ñ–Ğ½ÑˆĞ¸Ğ¹ ÑˆĞ»ÑÑ…",
Â  Â  Â  "ĞĞ¹, Ñ”Ğ´Ğ¸Ğ½Ğ¾Ñ€Ñ–Ğ¶ĞºĞ° Ğ²Ğ¸Ğ¹ÑˆĞ»Ğ° Ğ·Ğ° Ğ¼ĞµĞ¶Ñ– Ğ¼Ğ°Ğ³Ñ–Ñ‡Ğ½Ğ¾Ñ— Ğ·ĞµĞ¼Ğ»Ñ–! ğŸŒˆ ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¸",
Â  Â  Â  "Ğ¥Ğ¼, Ñ†ĞµĞ¹ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚ Ğ½Ğµ Ğ·Ğ±Ğ¸Ñ€Ğ°Ñ” Ğ²ÑÑ– ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ¸! ğŸ’ Ğ¡Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ñ‰Ğµ Ñ€Ğ°Ğ·",
Â  Â  Â  "Ğ„Ğ´Ğ¸Ğ½Ğ¾Ñ€Ñ–Ğ¶ĞºĞ° Ğ·Ğ°Ğ±Ğ»ÑƒĞºĞ°Ğ»Ğ°! ğŸ¦„ ĞŸĞ¾Ğ´ÑƒĞ¼Ğ°Ğ¹, ĞºÑƒĞ´Ğ¸ Ñ—Ğ¹ Ğ¹Ñ‚Ğ¸"
Â  Â  ];

Â  Â  // ===== Achievements =====
Â  Â  const ACHIEVEMENTS = {
Â  Â  Â  firstGems: { icon:"ğŸ’", title:"ĞŸĞµÑ€ÑˆÑ– ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ¸!", text:"Ğ¢Ğ¸ Ğ·Ñ–Ğ±Ñ€Ğ°Ğ»Ğ° ÑĞ²Ğ¾Ñ— Ğ¿ĞµÑ€ÑˆÑ– Ğ¼Ğ°Ğ³Ñ–Ñ‡Ğ½Ñ– ĞºĞ°Ğ¼Ñ–Ğ½Ñ†Ñ–!" },
Â  Â  Â  tenGems: { icon:"âœ¨", title:"10 ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ñ–Ğ²!", text:"Ğ’Ğ°Ñƒ! Ğ’Ğ¶Ğµ 10 ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ñ–Ğ²!" },
Â  Â  Â  twentyGems: { icon:"ğŸŒŸ", title:"20 ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ñ–Ğ²!", text:"ĞœĞ°Ğ³Ñ–Ñ‡Ğ½Ğ° ĞºĞ¾Ğ»ĞµĞºÑ†Ñ–Ñ Ğ·Ñ€Ğ¾ÑÑ‚Ğ°Ñ”!" },
Â  Â  Â  thirtyGems: { icon:"ğŸ†", title:"30 ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ñ–Ğ²!", text:"ĞĞµĞ¹Ğ¼Ğ¾Ğ²Ñ–Ñ€Ğ½Ğ° ĞºĞ¾Ğ»ĞµĞºÑ†Ñ–Ñ!" },
Â  Â  Â  halfwayDone: { icon:"ğŸ¦„", title:"ĞŸĞ¾Ğ»Ğ¾Ğ²Ğ¸Ğ½Ğ° ÑˆĞ»ÑÑ…Ñƒ!", text:"Ğ„Ğ´Ğ¸Ğ½Ğ¾Ñ€Ñ–Ğ¶ĞºĞ° Ğ¿Ñ€Ğ¾Ğ¹ÑˆĞ»Ğ° Ğ¿Ğ¾Ğ»Ğ¾Ğ²Ğ¸Ğ½Ñƒ Ğ¿Ñ€Ğ¸Ğ³Ğ¾Ğ´!" },
Â  Â  Â  master: { icon:"ğŸ‘‘", title:"ĞšĞ¾Ñ€Ğ¾Ğ»ĞµĞ²Ğ° Ğ¼Ğ°Ğ³Ñ–Ñ—!", text:"Ğ¢Ğ¸ Ğ¿Ñ€Ğ¾Ğ¹ÑˆĞ»Ğ° Ğ²ÑÑ– Ñ€Ñ–Ğ²Ğ½Ñ–!" }
Â  Â  };

Â  Â  // ===== State =====
Â  Â  const gameState = {
Â  Â  Â  currentLevel: 0,
Â  Â  Â  commands: [],
Â  Â  Â  totalGems: 0,
Â  Â  Â  isExecuting: false,
Â  Â  Â  currentPos: null,
Â  Â  Â  soundEnabled: true,
Â  Â  Â  shownAchievements: new Set()
Â  Â  };

Â  Â  // FIX 1 (PERFORMANCE): Ğ¡Ñ‚Ğ²Ğ¾Ñ€ÑÑ”Ğ¼Ğ¾ AudioContext Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ· Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñ–.
Â  Â  let audioCtx = null;
Â  Â  try {
Â  Â  Â  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
Â  Â  } catch(e) {
Â  Â  Â  console.warn("AudioContext is not supported, sounds will be disabled.");
Â  Â  }

Â  Â  // ===== DOM =====
Â  Â  const el = (id) => document.getElementById(id);
Â  Â  const elements = {
Â  Â  Â  gameGrid: el('gameGrid'), commandSlots: el('commandSlots'), runBtn: el('runBtn'), clearBtn: el('clearBtn'),
Â  Â  Â  winModal: el('winModal'), errorModal: el('errorModal'), nextLevelBtn: el('nextLevelBtn'),Â 
Â  Â  Â  retryBtn: el('retryBtn'), closeErrBtn: el('closeErrBtn'),
Â  Â  Â  levelNum: el('levelNum'), totalLevels: el('totalLevels'), gemsCount: el('gemsCount'),Â 
Â  Â  Â  winMessage: el('winMessage'), errorMessage: el('errorMessage'),
Â  Â  Â  upBtn: el('upBtn'), downBtn: el('downBtn'), leftBtn: el('leftBtn'), rightBtn: el('rightBtn'),
Â  Â  Â  progressBar: el('progressBar'), encouragement: el('encouragement'), hintBubble: el('hintBubble'),
Â  Â  Â  hintText: el('hintText'), soundBtn: el('soundBtn'), achievementToast: el('achievementToast'),
Â  Â  Â  achievementIcon: el('achievementIcon'), achievementTitle: el('achievementTitle'),
Â  Â  Â  achievementText: el('achievementText'), winConfetti: el('winConfetti')
Â  Â  };

Â  Â  // ===== Utils =====
Â  Â  const utils = {
Â  Â  Â  sleep: (ms) => new Promise(r => setTimeout(r, ms)),
Â  Â  Â  arraysEqual: (a,b) => a && b && a[0]===b[0] && a[1]===b[1],
Â  Â  Â  isValidPosition: (pos, level) => pos[0]>=0 && pos[0]<level.size && pos[1]>=0 && pos[1]<level.size &&Â 
Â  Â  Â  Â  !level.obstacles.some(o=>utils.arraysEqual(o,pos)),
Â  Â  Â  emojiClass: () => {
Â  Â  Â  Â  const w = window.innerWidth;
Â  Â  Â  Â  if (w < 480) return 'emoji-xs';
Â  Â  Â  Â  if (w < 640) return 'emoji-sm';
Â  Â  Â  Â  if (w < 1024) return 'emoji-md';
Â  Â  Â  Â  return 'emoji-lg';
Â  Â  Â  },
Â  Â  Â  getCellSize: (level) => {
Â  Â  Â  Â  const wrap = elements.gameGrid.parentElement;
Â  Â  Â  Â  const rect = wrap.getBoundingClientRect();
Â  Â  Â  Â  const gap = window.innerWidth < 640 ? 2 : 4;
Â  Â  Â  Â  const columns = level.size;
Â  Â  Â  Â  const maxGridWidth = Math.min(rect.width, 900);
Â  Â  Â  Â  const size = Math.floor((maxGridWidth - (columns - 1) * gap) / columns);
Â  Â  Â  Â  return Math.max(36, Math.min(size, 110));
Â  Â  Â  },
Â  Â  Â  randomChoice: (arr) => arr[Math.floor(Math.random() * arr.length)],
Â  Â  Â  // FIX 1 (PERFORMANCE): ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ° Ñ„ÑƒĞ½ĞºÑ†Ñ–Ñ, Ñ‰Ğ¾ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ” Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ audioCtx
Â  Â  Â  playSound: (freq, duration=100) => {
Â  Â  Â  Â  if (!gameState.soundEnabled || !audioCtx) return; // ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ÑÑ”Ğ¼Ğ¾ Ñ‡Ğ¸ Ğ·Ğ²ÑƒĞº ÑƒĞ²Ñ–Ğ¼ĞºĞ½ĞµĞ½Ğ¸Ğ¹ Ñ– Ñ‡Ğ¸ context Ñ–ÑĞ½ÑƒÑ”
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const osc = audioCtx.createOscillator();
Â  Â  Â  Â  Â  const gain = audioCtx.createGain();
Â  Â  Â  Â  Â  osc.connect(gain);
Â  Â  Â  Â  Â  gain.connect(audioCtx.destination);
Â  Â  Â  Â  Â  osc.frequency.value = freq;
Â  Â  Â  Â  Â  osc.type = 'sine';
Â  Â  Â  Â  Â  gain.gain.value = 0.1;
Â  Â  Â  Â  Â  osc.start();
Â  Â  Â  Â  Â  gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration/1000);
Â  Â  Â  Â  Â  osc.stop(audioCtx.currentTime + duration/1000);
Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  console.error("Error playing sound:", e);
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  };

Â  Â  // ===== Sound Effects =====
Â  Â  const sounds = {
Â  Â  Â  move: () => utils.playSound(450, 70),
Â  Â  Â  collect: () => {
Â  Â  Â  Â  utils.playSound(800, 80);
Â  Â  Â  Â  setTimeout(() => utils.playSound(1000, 100), 80);
Â  Â  Â  },
Â  Â  Â  win: () => {
Â  Â  Â  Â  utils.playSound(523, 120);
Â  Â  Â  Â  setTimeout(() => utils.playSound(659, 120), 120);
Â  Â  Â  Â  setTimeout(() => utils.playSound(784, 150), 240);
Â  Â  Â  Â  setTimeout(() => utils.playSound(1047, 200), 390);
Â  Â  Â  },
Â  Â  Â  error: () => utils.playSound(180, 250),
Â  Â  Â  click: () => utils.playSound(650, 40)
Â  Â  };

Â  Â  // ===== Achievements =====
Â  Â  function checkAchievements() {
Â  Â  Â  const gems = gameState.totalGems;
Â  Â  Â  const level = gameState.currentLevel;
Â  Â  Â Â 
Â  Â  Â  if (gems >= 1 && gems < 10 && !gameState.shownAchievements.has('firstGems')) {
Â  Â  Â  Â  showAchievement(ACHIEVEMENTS.firstGems);
Â  Â  Â  Â  gameState.shownAchievements.add('firstGems');
Â  Â  Â  } else if (gems >= 10 && gems < 20 && !gameState.shownAchievements.has('tenGems')) {
Â  Â  Â  Â  showAchievement(ACHIEVEMENTS.tenGems);
Â  Â  Â  Â  gameState.shownAchievements.add('tenGems');
Â  Â  Â  } else if (gems >= 20 && gems < 30 && !gameState.shownAchievements.has('twentyGems')) {
Â  Â  Â  Â  showAchievement(ACHIEVEMENTS.twentyGems);
Â  Â  Â  Â  gameState.shownAchievements.add('twentyGems');
Â  Â  Â  } else if (gems >= 30 && !gameState.shownAchievements.has('thirtyGems')) {
Â  Â  Â  Â  showAchievement(ACHIEVEMENTS.thirtyGems);
Â  Â  Â  Â  gameState.shownAchievements.add('thirtyGems');
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  if (level === Math.floor(LEVELS.length/2) && !gameState.shownAchievements.has('halfwayDone')) {
Â  Â  Â  Â  showAchievement(ACHIEVEMENTS.halfwayDone);
Â  Â  Â  Â  gameState.shownAchievements.add('halfwayDone');
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  if (level === LEVELS.length - 1 && !gameState.shownAchievements.has('master')) {
Â  Â  Â  Â  showAchievement(ACHIEVEMENTS.master);
Â  Â  Â  Â  gameState.shownAchievements.add('master');
Â  Â  Â  }
Â  Â  }

Â  Â  function showAchievement(ach) {
Â  Â  Â  elements.achievementIcon.textContent = ach.icon;
Â  Â  Â  elements.achievementTitle.textContent = ach.title;
Â  Â  Â  elements.achievementText.textContent = ach.text;
Â  Â  Â  elements.achievementToast.classList.remove('hidden');
Â  Â  Â Â 
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  elements.achievementToast.style.transition = 'opacity 0.5s, transform 0.5s';
Â  Â  Â  Â  elements.achievementToast.style.opacity = '0';
Â  Â  Â  Â  elements.achievementToast.style.transform = 'translate(-50%, -20px)';
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  elements.achievementToast.classList.add('hidden');
Â  Â  Â  Â  Â  elements.achievementToast.style.opacity = '1';
Â  Â  Â  Â  Â  elements.achievementToast.style.transform = 'translate(-50%, 0)';
Â  Â  Â  Â  }, 500);
Â  Â  Â  }, 3500);
Â  Â  }

Â  Â  // ===== Confetti =====
Â  Â  function createConfetti() {
Â  Â  Â  const container = elements.winConfetti;
Â  Â  Â  container.innerHTML = '';
Â  Â  Â  const colors = ['#ec4899', '#a855f7', '#8b5cf6', '#f472b6', '#c084fc', '#fbbf24'];
Â  Â  Â Â 
Â  Â  Â  for (let i = 0; i < 40; i++) {
Â  Â  Â  Â  const bit = document.createElement('div');
Â  Â  Â  Â  bit.className = 'confetti-bit';
Â  Â  Â  Â  bit.style.left = Math.random() * 100 + '%';
Â  Â  Â  Â  bit.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
Â  Â  Â  Â  bit.style.animationDelay = (Math.random() * 0.4) + 's';
Â  Â  Â  Â  container.appendChild(bit);
Â  Â  Â  }
Â  Â  }

Â  Â  // ===== Sparkles =====
Â  Â  function createSparkles(cell) {
Â  Â  Â  const container = document.createElement('div');
Â  Â  Â  container.className = 'sparkle-container';
Â  Â  Â  cell.appendChild(container);
Â  Â  Â Â 
Â  Â  Â  for (let i = 0; i < 8; i++) {
Â  Â  Â  Â  const sparkle = document.createElement('div');
Â  Â  Â  Â  sparkle.className = 'sparkle-bit';
Â  Â  Â  Â  const angle = (i / 8) * Math.PI * 2;
Â  Â  Â  Â  const distance = 30;
Â  Â  Â  Â  const tx = Math.cos(angle) * distance;
Â  Â  Â  Â  const ty = Math.sin(angle) * distance;
Â  Â  Â  Â  sparkle.style.setProperty('--tw-translate', `translate(${tx}px, ${ty}px)`);
Â  Â  Â  Â  sparkle.style.left = '50%';
Â  Â  Â  Â  sparkle.style.top = '50%';
Â  Â  Â  Â  sparkle.style.animationDelay = (i * 0.05) + 's';
Â  Â  Â  Â  container.appendChild(sparkle);
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  setTimeout(() => container.remove(), 1000);
Â  Â  }

Â  Â  // ===== Level Management =====
Â  Â  function updateProgress() {
Â  Â  Â  const progress = ((gameState.currentLevel + 1) / LEVELS.length) * 100;
Â  Â  Â  elements.progressBar.style.width = progress + '%';
Â  Â  }

Â  Â  function showHint(level) {
Â  Â  Â  if (level.hint && gameState.currentLevel < 3) {
Â  Â  Â  Â  elements.hintText.textContent = level.hint;
Â  Â  Â  Â  elements.hintBubble.classList.remove('hidden');
Â  Â  Â  } else {
Â  Â  Â  Â  elements.hintBubble.classList.add('hidden');
Â  Â  Â  }
Â  Â  }

Â  Â  // ===== Init Level =====
Â  Â  function initLevel() {
Â  Â  Â  const level = LEVELS[gameState.currentLevel];
Â  Â  Â  if (!level || !Number.isInteger(level.size) || level.size <= 0) {
Â  Â  Â  Â  console.error('Invalid level:', level);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  elements.totalLevels.textContent = LEVELS.length;
Â  Â  Â  elements.levelNum.textContent = gameState.currentLevel + 1;
Â  Â  Â  gameState.commands = Array(level.maxCommands).fill(null);
Â  Â  Â  gameState.currentPos = [...level.start];
Â  Â  Â  renderGrid(level);
Â  Â  Â  renderCommandSlots();
Â  Â  Â  updateProgress();
Â  Â  Â  showHint(level);
Â  Â  Â  elements.runBtn.disabled = false;
Â  Â  Â  gameState.isExecuting = false;
Â  Â  }

Â  Â  // ===== Render Grid =====
Â  Â  function renderGrid(level) {
Â  Â  Â  const g = elements.gameGrid;
Â  Â  Â  g.classList.remove('grid-shaking');
Â  Â  Â  g.innerHTML = '';
Â  Â  Â  const cellSize = utils.getCellSize(level);
Â  Â  Â  const gap = window.innerWidth < 640 ? '2px' : '4px';
Â  Â  Â  g.style.display = 'grid';
Â  Â  Â  g.style.gridTemplateColumns = `repeat(${level.size}, ${cellSize}px)`;
Â  Â  Â  g.style.gap = gap;

Â  Â  Â  const emojiCls = utils.emojiClass();
Â  Â  Â  for (let r = 0; r < level.size; r++) {
Â  Â  Â  Â  for (let c = 0; c < level.size; c++) {
Â  Â  Â  Â  Â  const cell = document.createElement('div');
Â  Â  Â  Â  Â  cell.className = 'grid-cell flex items-center justify-center bg-purple-50 rounded-lg';
Â  Â  Â  Â  Â  cell.dataset.row = r;
Â  Â  Â  Â  Â  cell.dataset.col = c;
Â  Â  Â  Â  Â  cell.setAttribute('role', 'gridcell');

Â  Â  Â  Â  Â  const pos = [r, c];
Â  Â  Â  Â  Â  if (utils.arraysEqual(pos, level.start)) {
Â  Â  Â  Â  Â  Â  cell.innerHTML = `<div class="character ${emojiCls}" aria-label="Ğ„Ğ´Ğ¸Ğ½Ğ¾Ñ€Ñ–Ğ¶ĞºĞ°">ğŸ¦„</div>`;
Â  Â  Â  Â  Â  Â  cell.classList.add('bg-pink-200');
Â  Â  Â  Â  Â  } else if (level.obstacles.some(o => utils.arraysEqual(o, pos))) {
Â  Â  Â  Â  Â  Â  // FIX 2 (EMOJI): Ğ—Ğ°Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾ ğŸª¨ Ğ½Ğ° Ñ–ĞºĞ¾Ğ½ĞºÑƒ FontAwesome Ğ´Ğ»Ñ ÑÑƒĞ¼Ñ–ÑĞ½Ğ¾ÑÑ‚Ñ–
Â  Â  Â  Â  Â  Â  cell.innerHTML = `<i class="fas fa-mountain text-gray-600 ${emojiCls}" aria-hidden="true"></i>`;
Â  Â  Â  Â  Â  Â  cell.classList.add('bg-gray-300');
Â  Â  Â  Â  Â  } else if (level.gems.some(g => utils.arraysEqual(g, pos))) {
Â  Â  Â  Â  Â  Â  cell.innerHTML = `<div class="${emojiCls} gem-glow" data-gem="crystal" aria-label="ĞšÑ€Ğ¸ÑÑ‚Ğ°Ğ»">ğŸ’</div>`;
Â  Â  Â  Â  Â  Â  cell.classList.add('bg-gradient-to-br', 'from-purple-100', 'to-pink-100');
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  g.appendChild(cell);
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }

Â  Â  // ===== Render Command Slots =====
Â  Â  function renderCommandSlots() {
Â  Â  Â  const level = LEVELS[gameState.currentLevel];
Â  Â  Â  const wrap = elements.commandSlots;
Â  Â  Â  wrap.innerHTML = '';

Â  Â  Â  const maxCols = window.innerWidth < 640 ? 4 : 6;
Â  Â  Â  const cols = Math.min(level.maxCommands, maxCols);
Â  Â  Â  wrap.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

Â  Â  Â  for (let i = 0; i < level.maxCommands; i++) {
Â  Â  Â  Â  const slot = document.createElement('div');
Â  Â  Â  Â  slot.className = 'command-slot flex items-center justify-center rounded-lg text-2xl sm:text-3xl md:text-4xl';
Â  Â  Â  Â  slot.dataset.index = i;

Â  Â  Â  Â  if (gameState.commands[i]) {
Â  Â  Â  Â  Â  slot.classList.add('filled');
Â  Â  Â  Â  Â  slot.innerHTML = ARROW_ICONS[gameState.commands[i]];
Â  Â  Â  Â  Â  slot.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  if (!gameState.isExecuting) {
Â  Â  Â  Â  Â  Â  Â  sounds.click();
Â  Â  Â  Â  Â  Â  Â  gameState.commands[i] = null;
Â  Â  Â  Â  Â  Â  Â  renderCommandSlots();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  wrap.appendChild(slot);
Â  Â  Â  }
Â  Â  }

Â  Â  // ===== Add Command =====
Â  Â  function addCommand(direction) {
Â  Â  Â  if (gameState.isExecuting) return;
Â  Â  Â  sounds.click();
Â  Â  Â Â 
Â  Â  Â  const firstEmpty = gameState.commands.indexOf(null);
Â  Â  Â  if (firstEmpty !== -1) {
Â  Â  Â  Â  gameState.commands[firstEmpty] = direction;
Â  Â  Â  Â  renderCommandSlots();
Â  Â  Â  }
Â  Â  }

Â  Â  // ===== Clear Commands =====
Â  Â  function clearCommands() {
Â  Â  Â  if (gameState.isExecuting) return;
Â  Â  Â  sounds.click();
Â  Â  Â  const level = LEVELS[gameState.currentLevel];
Â  Â  Â  gameState.commands = Array(level.maxCommands).fill(null);
Â  Â  Â  renderCommandSlots();
Â  Â  }

Â  Â  // ===== Get Cell Element =====
Â  Â  function getCellElement(pos) {
Â  Â  Â  return elements.gameGrid.querySelector(`[data-row="${pos[0]}"][data-col="${pos[1]}"]`);
Â  Â  }

Â  Â  // ===== Update Character Position =====
Â  Â  function updateCharacterPosition(newPos, noJump = false) {
Â  Â  Â  const level = LEVELS[gameState.currentLevel];
Â  Â  Â  const oldCell = getCellElement(gameState.currentPos);
Â  Â  Â  const newCell = getCellElement(newPos);

Â  Â  Â  if (oldCell) {
Â  Â  Â  Â  const char = oldCell.querySelector('.character');
Â  Â  Â  Â  if (char) char.remove();
Â  Â  Â  Â  if (utils.arraysEqual(gameState.currentPos, level.start)) {
Â  Â  Â  Â  Â  oldCell.classList.add('bg-pink-200');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  oldCell.classList.remove('bg-pink-200', 'landing');
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Trail effect
Â  Â  Â  Â  const trail = document.createElement('div');
Â  Â  Â  Â  trail.className = 'trail-dot';
Â  Â  Â  Â  oldCell.appendChild(trail);
Â  Â  Â  Â  setTimeout(() => trail.remove(), 700);
Â  Â  Â  }

Â  Â  Â  if (newCell) {
Â  Â  Â  Â  const emojiCls = utils.emojiClass();
Â  Â  Â  Â  const char = document.createElement('div');
Â  Â  Â  Â  char.className = `character ${emojiCls}`;
Â  Â  Â  Â  char.setAttribute('aria-label', 'Ğ„Ğ´Ğ¸Ğ½Ğ¾Ñ€Ñ–Ğ¶ĞºĞ°');
Â  Â  Â  Â  char.textContent = 'ğŸ¦„';
Â  Â  Â  Â  newCell.appendChild(char);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (!noJump) {
Â  Â  Â  Â  Â  newCell.classList.add('landing');
Â  Â  Â  Â  Â  setTimeout(() => newCell.classList.remove('landing'), 400);
Â  Â  Â  Â  Â  createSparkles(newCell);
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  gameState.currentPos = newPos;
Â  Â  }

Â  Â  // ===== Execute Commands =====
Â  Â  async function executeCommands() {
Â  Â  Â  if (gameState.isExecuting) return;
Â  Â  Â Â 
Â  Â  Â  const hasCommands = gameState.commands.some(c => c !== null);
Â  Â  Â  if (!hasCommands) {
Â  Â  Â  Â  showError("Ğ”Ğ¾Ğ´Ğ°Ğ¹ Ğ¼Ğ°Ğ³Ñ–Ñ‡Ğ½Ñ– ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¸! ĞĞ°Ñ‚Ğ¸ÑĞ½Ğ¸ Ğ½Ğ° ÑÑ‚Ñ€Ñ–Ğ»ĞºĞ¸ âœ¨", false);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  gameState.isExecuting = true;
Â  Â  Â  elements.runBtn.disabled = true;

Â  Â  Â  const level = LEVELS[gameState.currentLevel];
Â  Â  Â  let pos = [...level.start];
Â  Â  Â  let collectedGems = 0;
Â  Â  Â  const remainingGems = [...level.gems];

Â  Â  Â  // Ğ¡ĞºĞ¸Ğ´Ğ°Ñ”Ğ¼Ğ¾ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ñ–Ñ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ° Ğ½Ğ° Ğ¿Ğ¾Ñ‡Ğ°Ñ‚Ğ¾Ğº Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ½ÑĞ¼
Â  Â  Â  updateCharacterPosition(level.start, true);
Â  Â  Â  await utils.sleep(100); // ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ° Ğ¿Ğ°ÑƒĞ·Ğ° Ğ¿ĞµÑ€ĞµĞ´ Ğ¿Ğ¾Ñ‡Ğ°Ñ‚ĞºĞ¾Ğ¼

Â  Â  Â  for (let i = 0; i < gameState.commands.length; i++) {
Â  Â  Â  Â  const cmd = gameState.commands[i];
Â  Â  Â  Â  if (!cmd) break;

Â  Â  Â  Â  const [dr, dc] = DIRECTION_VECTORS[cmd];
Â  Â  Â  Â  const newPos = [pos[0] + dr, pos[1] + dc];

Â  Â  Â  Â  await utils.sleep(ANIMATION_SPEED);

Â  Â  Â  Â  // Check collision
Â  Â  Â  Â  if (!utils.isValidPosition(newPos, level)) {
Â  Â  Â  Â  Â  sounds.error();
Â  Â  Â  Â  Â  elements.gameGrid.classList.add('grid-shaking');
Â  Â  Â  Â  Â  setTimeout(() => elements.gameGrid.classList.remove('grid-shaking'), 400);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  const errorMsg = newPos[0] < 0 || newPos[0] >= level.size ||Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newPos[1] < 0 || newPos[1] >= level.size
Â  Â  Â  Â  Â  Â  ? "Ğ„Ğ´Ğ¸Ğ½Ğ¾Ñ€Ñ–Ğ¶ĞºĞ° Ğ²Ğ¸Ğ¹ÑˆĞ»Ğ° Ğ·Ğ° Ğ¼ĞµĞ¶Ñ– Ğ¼Ğ°Ğ³Ñ–Ñ‡Ğ½Ğ¾Ñ— Ğ·ĞµĞ¼Ğ»Ñ–! ğŸŒˆ ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¸"
Â  Â  Â  Â  Â  Â  : "Ğ„Ğ´Ğ¸Ğ½Ğ¾Ñ€Ñ–Ğ¶ĞºĞ° Ğ·ÑƒĞ¿Ğ¸Ğ½Ğ¸Ğ»Ğ°ÑÑ Ğ¿ĞµÑ€ĞµĞ´ ÑĞºĞµĞ»ĞµÑ! â›°ï¸ Ğ¡Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ñ–Ğ½ÑˆĞ¸Ğ¹ ÑˆĞ»ÑÑ…"; // ĞĞ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ ĞµĞ¼Ğ¾Ğ´Ğ·Ñ–
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  showError(errorMsg, true);
Â  Â  Â  Â  Â  gameState.isExecuting = false;
Â  Â  Â  Â  Â  elements.runBtn.disabled = false;
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  // Move character
Â  Â  Â  Â  sounds.move();
Â  Â  Â  Â  updateCharacterPosition(newPos);
Â  Â  Â  Â  pos = newPos;

Â  Â  Â  Â  // Check gem collection
Â  Â  Â  Â  const gemIdx = remainingGems.findIndex(g => utils.arraysEqual(g, pos));
Â  Â  Â  Â  if (gemIdx !== -1) {
Â  Â  Â  Â  Â  sounds.collect();
Â  Â  Â  Â  Â  collectedGems++;
Â  Â  Â  Â  Â  const cell = getCellElement(pos);
Â  Â  Â  Â  Â  const gem = cell?.querySelector('[data-gem="crystal"]');
Â  Â  Â  Â  Â  if (gem) {
Â  Â  Â  Â  Â  Â  gem.classList.add('collecting');
Â  Â  Â  Â  Â  Â  setTimeout(() => gem.remove(), 700);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  remainingGems.splice(gemIdx, 1);
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  // Check win - must collect ALL gems
Â  Â  Â  if (remainingGems.length === 0) {
Â  Â  Â  Â  sounds.win();
Â  Â  Â  Â  gameState.totalGems += collectedGems;
Â  Â  Â  Â  elements.gemsCount.textContent = gameState.totalGems;
Â  Â  Â  Â  checkAchievements();
Â  Â  Â  Â  await utils.sleep(400);
Â  Â  Â  Â  showWin(collectedGems);
Â  Â  Â  } else {
Â  Â  Â  Â  sounds.error();
Â  Â  Â  Â  const leftGems = remainingGems.length;
Â  Â  Â  Â  const gemWord = leftGems === 1 ? 'ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»' : (leftGems < 5 ? 'ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ¸' : 'ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ñ–Ğ²');
Â  Â  Â  Â  showError(`Ğ—Ğ°Ğ»Ğ¸ÑˆĞ¸Ğ»Ğ¾ÑÑŒ Ñ‰Ğµ ${leftGems} ${gemWord}! ğŸ’ Ğ¡Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹ Ğ·Ğ½Ğ¾Ğ²Ñƒ`, true);
Â  Â  Â  }

Â  Â  Â  gameState.isExecuting = false;
Â  Â  Â  elements.runBtn.disabled = false;
Â  Â  }

Â  Â  // ===== Show Win =====
Â  Â  function showWin(gemsCollected) {
Â  Â  Â  createConfetti();
Â  Â  Â  elements.encouragement.textContent = utils.randomChoice(ENCOURAGEMENTS);
Â  Â  Â Â 
Â  Â  Â  const gemWord = gemsCollected === 1 ? 'ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»' : (gemsCollected < 5 ? 'ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ğ¸' : 'ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ñ–Ğ²');
Â  Â  Â  elements.winMessage.textContent = `Ğ¢Ğ¸ Ğ·Ñ–Ğ±Ñ€Ğ°Ğ»Ğ° ${gemsCollected} ${gemWord}! ğŸ’ ĞœĞ°Ğ³Ñ–Ñ‡Ğ½Ğ° ĞºĞ¾Ğ»ĞµĞºÑ†Ñ–Ñ Ğ·Ñ€Ğ¾ÑÑ‚Ğ°Ñ”!`;
Â  Â  Â Â 
Â  Â  Â  if (gameState.currentLevel === LEVELS.length - 1) {
Â  Â  Â  Â  elements.nextLevelBtn.innerHTML = 'Ğ’Ñ–Ñ‚Ğ°Ñ”Ğ¼Ğ¾! ğŸŠ';
Â  Â  Â  Â  elements.winMessage.textContent = `Ğ¢Ğ¸ Ğ¿Ñ€Ğ¾Ğ¹ÑˆĞ»Ğ° Ğ²ÑÑ– ${LEVELS.length} Ñ€Ñ–Ğ²Ğ½Ñ–Ğ²! Ğ—Ñ–Ğ±Ñ€Ğ°Ğ½Ğ¾ ĞºÑ€Ğ¸ÑÑ‚Ğ°Ğ»Ñ–Ğ²: ${gameState.totalGems} ğŸ’`;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  elements.winModal.classList.remove('hidden');
Â  Â  }

Â  Â  // ===== Show Error =====
Â  Â  function showError(msg, canRetry) {
Â  Â  Â  elements.errorMessage.textContent = msg;
Â  Â  Â  elements.retryBtn.style.display = canRetry ? 'inline-block' : 'none';
Â  Â  Â  elements.errorModal.classList.remove('hidden');
Â  Â  }

Â  Â  // ===== Event Listeners =====
Â  Â  elements.upBtn.addEventListener('click', () => addCommand('up'));
Â  Â  elements.downBtn.addEventListener('click', () => addCommand('down'));
Â  Â  elements.leftBtn.addEventListener('click', () => addCommand('left'));
Â  Â  elements.rightBtn.addEventListener('click', () => addCommand('right'));
Â  Â  elements.clearBtn.addEventListener('click', clearCommands);
Â  Â  elements.runBtn.addEventListener('click', executeCommands);

Â  Â  elements.nextLevelBtn.addEventListener('click', () => {
Â  Â  Â  elements.winModal.classList.add('hidden');
Â  Â  Â  if (gameState.currentLevel < LEVELS.length - 1) {
Â  Â  Â  Â  gameState.currentLevel++;
Â  Â  Â  Â  initLevel();
Â  Â  Â  } else {
Â  Â  Â  Â  // Game completed - restart
Â  Â  Â  Â  gameState.currentLevel = 0;
Â  Â  Â  Â  gameState.totalGems = 0;
Â  Â  Â  Â  gameState.shownAchievements.clear();
Â  Â  Â  Â  elements.gemsCount.textContent = '0';
Â  Â  Â  Â  elements.nextLevelBtn.innerHTML = 'ĞĞ°ÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ğ¹ Ñ€Ñ–Ğ²ĞµĞ½ÑŒ <i class="fas fa-sparkles" aria-hidden="true"></i>';
Â  Â  Â  Â  initLevel();
Â  Â  Â  }
Â  Â  });

Â  Â  elements.retryBtn.addEventListener('click', () => {
Â  Â  Â  elements.errorModal.classList.add('hidden');
Â  Â  Â  // Ğ¡ĞºĞ¸Ğ´Ğ°Ñ”Ğ¼Ğ¾ Ñ€Ñ–Ğ²ĞµĞ½ÑŒ, Ğ½Ğµ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ñ…Ğ¾Ğ²Ğ°Ñ”Ğ¼Ğ¾ Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºÑƒ
Â  Â  Â  initLevel(); 
Â  Â  });

Â  Â  elements.closeErrBtn.addEventListener('click', () => {
Â  Â  Â  elements.errorModal.classList.add('hidden');
Â  Â  Â  // Ğ¯ĞºÑ‰Ğ¾ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ Ğ·Ğ°ĞºÑ€Ğ¸Ğ² Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºÑƒ, Ñ‚Ğ°ĞºĞ¾Ğ¶ Ğ²Ğ°Ñ€Ñ‚Ğ¾ ÑĞºĞ¸Ğ½ÑƒÑ‚Ğ¸ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ° Ğ½Ğ° ÑÑ‚Ğ°Ñ€Ñ‚
Â  Â  Â  const level = LEVELS[gameState.currentLevel];
Â  Â  Â  updateCharacterPosition(level.start, true);
Â  Â  Â  gameState.currentPos = [...level.start];
Â  Â  });

Â  Â  elements.soundBtn.addEventListener('click', () => {
Â  Â  Â  gameState.soundEnabled = !gameState.soundEnabled;
Â  Â  Â  const icon = elements.soundBtn.querySelector('i');
Â  Â  Â  if (gameState.soundEnabled) {
Â  Â  Â  Â  icon.className = 'fas fa-volume-up text-xl text-purple-600';
Â  Â  Â  Â  sounds.click();
Â  Â  Â  } else {
Â  Â  Â  Â  icon.className = 'fas fa-volume-mute text-xl text-purple-600';
Â  Â  Â  }
Â  Â  });

Â  Â  // Keyboard support
Â  Â  document.addEventListener('keydown', (e) => {
Â  Â  Â  if (gameState.isExecuting) return;
Â  Â  Â Â 
Â  Â  Â  // ĞĞµ Ñ€ĞµĞ°Ğ³ÑƒĞ²Ğ°Ñ‚Ğ¸ Ğ½Ğ° ĞºĞ»Ğ°Ğ²Ñ–ÑˆÑ–, ÑĞºÑ‰Ğ¾ Ğ²Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¾ Ğ¼Ğ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğµ Ğ²Ñ–ĞºĞ½Ğ¾
Â  Â  Â  if (!elements.winModal.classList.contains('hidden') || !elements.errorModal.classList.contains('hidden')) {
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  switch(e.key) {
Â  Â  Â  Â  case 'ArrowUp': 
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  addCommand('up'); 
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'ArrowDown': 
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  addCommand('down'); 
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'ArrowLeft': 
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  addCommand('left'); 
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'ArrowRight': 
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  addCommand('right'); 
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'Enter': 
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  executeCommands(); 
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 'Escape': 
Â  Â  Â  Â  case 'Backspace':
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  clearCommands(); 
Â  Â  Â  Â  Â  break;
Â  Â  Â  }
Â  Â  });

Â  Â  // Responsive reflow
Â  Â  let resizeTimeout;
Â  Â  window.addEventListener('resize', () => {
Â  Â  Â  clearTimeout(resizeTimeout);
Â  Â  Â  resizeTimeout = setTimeout(() => {
Â  Â  Â  Â  const level = LEVELS[gameState.currentLevel];
Â  Â  Â  Â  renderGrid(level);
Â  Â  Â  Â  // ĞŸĞµÑ€ĞµĞ¼Ğ°Ğ»ÑĞ²Ğ°Ñ‚Ğ¸ Ğ¿ĞµÑ€ÑĞ¾Ğ½Ğ°Ğ¶Ğ° Ğ² Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ñ–Ğ¹ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ñ–Ñ— (Ğ°Ğ±Ğ¾ Ğ½Ğ° ÑÑ‚Ğ°Ñ€Ñ‚Ñ–, ÑĞºÑ‰Ğ¾ Ñ€Ñ–Ğ²ĞµĞ½ÑŒ ÑĞºĞ¸Ğ½ÑƒÑ‚Ğ¾)
Â  Â  Â  Â  updateCharacterPosition(gameState.currentPos || level.start, true);
Â  Â  Â  }, 250);
Â  Â  });

Â  Â  // ===== Initialize Game =====
Â  Â  initLevel();
Â  </script>
</body>
</html>
