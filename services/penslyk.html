<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ü–µ–Ω–∑–ª–∏–∫ | –ì—Ä–∞—Ñ—ñ—á–Ω–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è –¥—ñ—Ç–µ–π</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N8T05K3NGT"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      const gtag = (...args) => dataLayer.push(args);
      gtag("js", new Date());
      gtag("config", "G-N8T05K3NGT");
    </script>
    <style>
      body {
        font-family: "Roboto", "Arial", sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f0f8ff;
        text-align: center;
      }
      h1 {
        color: #ff6b6b;
        margin-bottom: 10px;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
      }
      #canvas-container {
        position: relative;
        margin: 20px auto;
        border: 5px solid #ffc0cb;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      #drawing-canvas {
        background-color: white;
        cursor: crosshair;
        display: block;
      }
      .controls {
        margin: 15px 0;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
      }
      .tool-button {
        padding: 10px 15px;
        font-size: 16px;
        background-color: #9cc4ff;
        border: none;
        border-radius: 8px;
        color: white;
        cursor: pointer;
        transition: all 0.3s;
      }
      .tool-button:hover {
        background-color: #7aa5f8;
        transform: translateY(-2px);
      }
      .tool-button.active {
        background-color: #5980d9;
      }
      .color-palette {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        margin: 15px 0;
      }
      .color {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        transition: transform 0.2s;
        border: 3px solid transparent;
      }
      .color:hover {
        transform: scale(1.1);
      }
      .color.active {
        border: 3px solid #333;
      }
      .size-slider {
        width: 200px;
        margin: 10px;
      }
      .shapes-container {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin: 15px 0;
      }
      .shape-btn {
        font-size: 24px;
        background-color: #9cc4ff;
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
      }
      .shape-btn:hover {
        background-color: #7aa5f8;
      }
      .shape-btn.active {
        background-color: #5980d9;
      }
      #stamps-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin: 15px 0;
      }
      .stamp {
        font-size: 24px;
        padding: 5px;
        background-color: #f8f8f8;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .stamp:hover {
        transform: scale(1.2);
        background-color: #e0e0e0;
      }
      .stamp.active {
        background-color: #e0e0e0;
        transform: scale(1.1);
      }
      /* Media queries –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –º–æ–±—ñ–ª—å–Ω–æ–≥–æ –¥–æ—Å–≤—ñ–¥—É */
      @media (max-width: 480px) {
        .tool-button {
          padding: 14px 20px;
          font-size: 18px;
        }
        .shape-btn {
          width: 60px;
          height: 60px;
          font-size: 28px;
        }
        .stamp {
          font-size: 28px;
          padding: 8px;
        }
        .size-slider {
          width: 250px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>–ü–µ–Ω–∑–ª–∏–∫ üé®</h1>
      <p>–ú–∞–ª—é–π, —Ç–≤–æ—Ä–∏, —Ä–æ–∑–≤–∞–∂–∞–π—Å—è!</p>
      <div class="controls">
        <button id="pencil" class="tool-button active" aria-label="–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ–ª—ñ–≤—Ü—è">
          <strong>‚úèÔ∏è –û–ª—ñ–≤–µ—Ü—å</strong>
        </button>
        <button id="eraser" class="tool-button" aria-label="–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –≥—É–º–∫–∏">
          <strong>üßΩ –ì—É–º–∫–∞</strong>
        </button>
        <button id="shapes" class="tool-button" aria-label="–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ñ—ñ–≥—É—Ä">
          <strong>üìê –§—ñ–≥—É—Ä–∏</strong>
        </button>
        <button id="stamps" class="tool-button" aria-label="–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —à—Ç–∞–º–ø—ñ–≤">
          <strong>üé≠ –®—Ç–∞–º–ø–∏</strong>
        </button>
        <button id="clear" class="tool-button" aria-label="–û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ–ª–æ—Ç–Ω–æ">
          <strong>üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏</strong>
        </button>
        <button id="save" class="tool-button" aria-label="–ó–±–µ—Ä–µ–≥—Ç–∏ –º–∞–ª—é–Ω–æ–∫">
          <strong>üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</strong>
        </button>
      </div>
      <div class="color-palette">
        <div class="color active" style="background-color: #000000" aria-label="–ß–æ—Ä–Ω–∏–π"></div>
        <div class="color" style="background-color: #ff0000" aria-label="–ß–µ—Ä–≤–æ–Ω–∏–π"></div>
        <div class="color" style="background-color: #ff9900" aria-label="–û—Ä–∞–Ω–∂–µ–≤–∏–π"></div>
        <div class="color" style="background-color: #ffff00" aria-label="–ñ–æ–≤—Ç–∏–π"></div>
        <div class="color" style="background-color: #00ff00" aria-label="–ó–µ–ª–µ–Ω–∏–π"></div>
        <div class="color" style="background-color: #00ffff" aria-label="–ë–ª–∞–∫–∏—Ç–Ω–∏–π"></div>
        <div class="color" style="background-color: #0000ff" aria-label="–°–∏–Ω—ñ–π"></div>
        <div class="color" style="background-color: #9900ff" aria-label="–§—ñ–æ–ª–µ—Ç–æ–≤–∏–π"></div>
        <div class="color" style="background-color: #ff00ff" aria-label="–†–æ–∂–µ–≤–∏–π"></div>
        <div class="color" style="background-color: #ff6b6b" aria-label="–°–≤—ñ—Ç–ª–æ-—á–µ—Ä–≤–æ–Ω–∏–π"></div>
        <div class="color" style="background-color: #7aa5f8" aria-label="–°–≤—ñ—Ç–ª–æ-—Å–∏–Ω—ñ–π"></div>
        <div class="color" style="background-color: #ffffff" aria-label="–ë—ñ–ª–∏–π"></div>
      </div>
      <div>
        <label for="size-slider">–†–æ–∑–º—ñ—Ä: </label>
        <input
          type="range"
          id="size-slider"
          class="size-slider"
          min="1"
          max="50"
          value="5"
          aria-label="–†–æ–∑–º—ñ—Ä –ø–µ–Ω–∑–ª–∏–∫–∞"
        />
      </div>
      <div class="shapes-container" style="display: none" aria-label="–í–∏–±—ñ—Ä —Ñ—ñ–≥—É—Ä–∏">
        <button class="shape-btn active" data-shape="line" aria-label="–õ—ñ–Ω—ñ—è">‚ï±</button>
        <button class="shape-btn" data-shape="rect" aria-label="–ü—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫">‚ñ°</button>
        <button class="shape-btn" data-shape="circle" aria-label="–ö–æ–ª–æ">‚óã</button>
        <button class="shape-btn" data-shape="triangle" aria-label="–¢—Ä–∏–∫—É—Ç–Ω–∏–∫">‚ñ≥</button>
        <button class="shape-btn" data-shape="star" aria-label="–ó—ñ—Ä–∫–∞">‚òÖ</button>
      </div>
      <div id="stamps-container" style="display: none" aria-label="–í–∏–±—ñ—Ä —à—Ç–∞–º–ø–∞">
        <div class="stamp" data-emoji="ü¶Ñ" aria-label="–Ñ–¥–∏–Ω–æ—Ä—ñ–≥">ü¶Ñ</div>
        <div class="stamp" data-emoji="üê±" aria-label="–ö—ñ—à–∫–∞">üê±</div>
        <div class="stamp" data-emoji="üê∂" aria-label="–°–æ–±–∞–∫–∞">üê∂</div>
        <div class="stamp" data-emoji="ü¶ñ" aria-label="–î–∏–Ω–æ–∑–∞–≤—Ä">ü¶ñ</div>
        <div class="stamp" data-emoji="üåà" aria-label="–í–µ—Å–µ–ª–∫–∞">üåà</div>
        <div class="stamp" data-emoji="üåü" aria-label="–ó—ñ—Ä–∫–∞">üåü</div>
        <div class="stamp" data-emoji="üçï" aria-label="–ü—ñ—Ü–∞">üçï</div>
        <div class="stamp" data-emoji="üöÄ" aria-label="–†–∞–∫–µ—Ç–∞">üöÄ</div>
        <div class="stamp" data-emoji="üéÆ" aria-label="–Ü–≥—Ä–æ–≤–∏–π –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä">üéÆ</div>
        <div class="stamp" data-emoji="üèÄ" aria-label="–ë–∞—Å–∫–µ—Ç–±–æ–ª—å–Ω–∏–π –º'—è—á">üèÄ</div>
        <div class="stamp" data-emoji="üå∏" aria-label="–ö–≤—ñ—Ç–∫–∞">üå∏</div>
        <div class="stamp" data-emoji="üåû" aria-label="–°–æ–Ω—Ü–µ">üåû</div>
      </div>
      <div id="canvas-container">
        <canvas id="drawing-canvas" width="600" height="400"></canvas>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ Canvas
        const canvas = document.getElementById("drawing-canvas");
        if (!canvas || !canvas.getContext) {
          alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î HTML5 Canvas!");
          return;
        }
        const ctx = canvas.getContext("2d");

        // –ó–º—ñ–Ω–Ω—ñ –¥–ª—è —Å—Ç–∞–Ω—É
        const state = {
          isDrawing: false,
          lastX: 0,
          lastY: 0,
          currentTool: "pencil",
          currentColor: "#000000",
          currentSize: 5,
          currentShape: "line",
          startX: 0,
          startY: 0,
          currentStamp: null,
          canvasSnapshot: null
        };

        // DOM –µ–ª–µ–º–µ–Ω—Ç–∏
        const elements = {
          pencilBtn: document.getElementById("pencil"),
          eraserBtn: document.getElementById("eraser"),
          shapesBtn: document.getElementById("shapes"),
          stampsBtn: document.getElementById("stamps"),
          clearBtn: document.getElementById("clear"),
          saveBtn: document.getElementById("save"),
          colors: document.querySelectorAll(".color"),
          sizeSlider: document.getElementById("size-slider"),
          shapesContainer: document.querySelector(".shapes-container"),
          shapeButtons: document.querySelectorAll(".shape-btn"),
          stampsContainer: document.getElementById("stamps-container"),
          stamps: document.querySelectorAll(".stamp")
        };

        // Debounce —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó autoSave
        function debounce(func, delay) {
          let timeoutId;
          return function(...args) {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => {
              func.apply(this, args);
            }, delay);
          };
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–∞–ª—é–Ω–∫–∞ —É localStorage
        function autoSave() {
          try {
            localStorage.setItem("autosave", canvas.toDataURL());
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–∞–ª—é–Ω–∫–∞: ", e);
          }
        }
        const debouncedAutoSave = debounce(autoSave, 1000);

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤—Ç–æ-–∑–±–µ—Ä–µ–∂–µ–Ω–æ–≥–æ –º–∞–ª—é–Ω–∫–∞
        function loadAutoSave() {
          try {
            const dataURL = localStorage.getItem("autosave");
            if (dataURL) {
              const img = new Image();
              img.onload = function () {
                ctx.drawImage(img, 0, 0);
              };
              img.src = dataURL;
            }
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ–≥–æ –º–∞–ª—é–Ω–∫–∞: ", e);
          }
        }

        // –§—É–Ω–∫—Ü—ñ—è –∑–º—ñ–Ω–∏ —Ä–æ–∑–º—ñ—Ä—É –ø–æ–ª–æ—Ç–Ω–∞ —Ç–∞ –æ—á–∏—â–µ–Ω–Ω—è –∑–Ω—ñ–º–∫—É –¥–ª—è –∑–≤—ñ–ª—å–Ω–µ–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
        function resizeCanvas() {
          const container = document.getElementById("canvas-container");
          canvas.width = container.clientWidth;
          canvas.height = Math.min(container.clientWidth * 0.66, 400);
          state.canvasSnapshot = null;
          try {
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø–æ–ª–æ—Ç–Ω–∞: ", e);
          }
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ–ª–æ—Ç–Ω–∞
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);
        loadAutoSave();

        // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –º–∏—à—ñ/–¥–æ—Ç–∏–∫—É
        function getMousePos(canvas, e) {
          const rect = canvas.getBoundingClientRect();
          const scaleX = canvas.width / rect.width;
          const scaleY = canvas.height / rect.height;
          if (e.touches) {
            return [
              (e.touches[0].clientX - rect.left) * scaleX,
              (e.touches[0].clientY - rect.top) * scaleY
            ];
          }
          return [
            (e.clientX - rect.left) * scaleX,
            (e.clientY - rect.top) * scaleY
          ];
        }

        function startDrawing(e) {
          state.isDrawing = true;
          [state.lastX, state.lastY] = getMousePos(canvas, e);
          state.startX = state.lastX;
          state.startY = state.lastY;
          if (state.currentTool === "stamps" && state.currentStamp) {
            placeStamp(state.lastX, state.lastY);
            state.isDrawing = false;
          }
          if (state.currentTool === "shapes") {
            takeCanvasSnapshot();
          }
        }

        function takeCanvasSnapshot() {
          try {
            state.canvasSnapshot = ctx.getImageData(0, 0, canvas.width, canvas.height);
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–Ω—ñ–º–∫—É –ø–æ–ª–æ—Ç–Ω–∞: ", e);
          }
        }

        function restoreCanvasSnapshot() {
          if (state.canvasSnapshot) {
            try {
              ctx.putImageData(state.canvasSnapshot, 0, 0);
            } catch (e) {
              console.error("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–Ω—ñ–º–∫—É –ø–æ–ª–æ—Ç–Ω–∞: ", e);
            }
          }
        }

        function draw(e) {
          if (!state.isDrawing) return;
          const [currentX, currentY] = getMousePos(canvas, e);
          if (state.currentTool === "pencil") {
            drawFreehand(currentX, currentY);
          } else if (state.currentTool === "eraser") {
            erase(currentX, currentY);
          } else if (state.currentTool === "shapes") {
            restoreCanvasSnapshot();
            drawShape(currentX, currentY);
          }
        }

        function drawFreehand(currentX, currentY) {
          try {
            ctx.strokeStyle = state.currentColor;
            ctx.lineWidth = state.currentSize;
            ctx.lineCap = "round";
            ctx.lineJoin = "round";
            ctx.beginPath();
            ctx.moveTo(state.lastX, state.lastY);
            ctx.lineTo(currentX, currentY);
            ctx.stroke();
            [state.lastX, state.lastY] = [currentX, currentY];
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è: ", e);
          }
        }

        function erase(currentX, currentY) {
          try {
            ctx.strokeStyle = "white";
            ctx.lineWidth = state.currentSize;
            ctx.lineCap = "round";
            ctx.lineJoin = "round";
            ctx.beginPath();
            ctx.moveTo(state.lastX, state.lastY);
            ctx.lineTo(currentX, currentY);
            ctx.stroke();
            [state.lastX, state.lastY] = [currentX, currentY];
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ –≥—É–º–∫–∏: ", e);
          }
        }

        function drawShape(currentX, currentY) {
          try {
            ctx.strokeStyle = state.currentColor;
            ctx.fillStyle = state.currentColor;
            ctx.lineWidth = state.currentSize;
            switch (state.currentShape) {
              case "line":
                drawLine(state.startX, state.startY, currentX, currentY);
                break;
              case "rect":
                drawRectangle(state.startX, state.startY, currentX, currentY);
                break;
              case "circle":
                drawCircle(state.startX, state.startY, currentX, currentY);
                break;
              case "triangle":
                drawTriangle(state.startX, state.startY, currentX, currentY);
                break;
              case "star":
                drawStar(state.startX, state.startY, currentX, currentY);
                break;
            }
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è —Ñ—ñ–≥—É—Ä–∏: ", e);
          }
        }

        function drawLine(startX, startY, endX, endY) {
          try {
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.stroke();
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è –ª—ñ–Ω—ñ—ó: ", e);
          }
        }

        function drawRectangle(startX, startY, endX, endY) {
          try {
            const x = Math.min(startX, endX);
            const y = Math.min(startY, endY);
            const width = Math.abs(endX - startX);
            const height = Math.abs(endY - startY);
            ctx.beginPath();
            ctx.rect(x, y, width, height);
            ctx.fill();
            ctx.stroke();
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫–∞: ", e);
          }
        }

        function drawCircle(startX, startY, endX, endY) {
          try {
            const radius = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
            ctx.beginPath();
            ctx.arc(startX, startY, radius, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è –∫–æ–ª–∞: ", e);
          }
        }

        function drawTriangle(startX, startY, endX, endY) {
          try {
            ctx.beginPath();
            ctx.moveTo(startX, startY);
            ctx.lineTo(endX, endY);
            ctx.lineTo(startX - (endX - startX), endY);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è —Ç—Ä–∏–∫—É—Ç–Ω–∏–∫–∞: ", e);
          }
        }

        function drawStar(startX, startY, endX, endY) {
          try {
            const spikes = 5;
            const outerRadius = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
            const innerRadius = outerRadius / 2;
            const cx = startX;
            const cy = startY;
            let rot = (Math.PI / 2) * 3;
            const step = Math.PI / spikes;
            ctx.beginPath();
            ctx.moveTo(cx, cy - outerRadius);
            for (let i = 0; i < spikes; i++) {
              ctx.lineTo(cx + Math.cos(rot) * outerRadius, cy + Math.sin(rot) * outerRadius);
              rot += step;
              ctx.lineTo(cx + Math.cos(rot) * innerRadius, cy + Math.sin(rot) * innerRadius);
              rot += step;
            }
            ctx.lineTo(cx, cy - outerRadius);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –º–∞–ª—é–≤–∞–Ω–Ω—è –∑—ñ—Ä–∫–∏: ", e);
          }
        }

        function placeStamp(x, y) {
          try {
            if (!state.currentStamp) return;
            ctx.font = `${state.currentSize * 5}px Arial`;
            ctx.fillStyle = state.currentColor;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(state.currentStamp, x, y);
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è —à—Ç–∞–º–ø–∞: ", e);
          }
        }

        function stopDrawing() {
          if (state.isDrawing) {
            state.isDrawing = false;
            if (state.currentTool === "shapes") {
              state.canvasSnapshot = null;
            }
            debouncedAutoSave();
          }
        }

        function clearCanvas() {
          try {
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            state.canvasSnapshot = null;
            localStorage.removeItem("autosave");
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è –ø–æ–ª–æ—Ç–Ω–∞: ", e);
          }
        }

        function saveCanvas() {
          try {
            const link = document.createElement("a");
            link.download = "my-drawing.png";
            link.href = canvas.toDataURL("image/png");
            link.click();
          } catch (e) {
            console.error("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –º–∞–ª—é–Ω–∫–∞: ", e);
          }
        }

        // –§—É–Ω–∫—Ü—ñ—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É (–¥–æ–¥–∞—î–º–æ takeCanvasSnapshot() –ø—Ä–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—ñ –Ω–∞ shapes)
        function setActiveTool(tool) {
          state.currentTool = tool;
          elements.pencilBtn.classList.remove("active");
          elements.eraserBtn.classList.remove("active");
          elements.shapesBtn.classList.remove("active");
          elements.stampsBtn.classList.remove("active");
          elements.shapesContainer.style.display = "none";
          elements.stampsContainer.style.display = "none";
          switch (tool) {
            case "pencil":
              elements.pencilBtn.classList.add("active");
              break;
            case "eraser":
              elements.eraserBtn.classList.add("active");
              break;
            case "shapes":
              elements.shapesBtn.classList.add("active");
              elements.shapesContainer.style.display = "flex";
              // –û–Ω–æ–≤–ª—é—î–º–æ –∑–Ω—ñ–º–æ–∫ –ø–æ–ª–æ—Ç–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—ñ –Ω–∞ shapes
              takeCanvasSnapshot();
              break;
            case "stamps":
              elements.stampsBtn.classList.add("active");
              elements.stampsContainer.style.display = "flex";
              break;
          }
        }

        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π –¥–ª—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤
        elements.pencilBtn.addEventListener("click", () => setActiveTool("pencil"));
        elements.eraserBtn.addEventListener("click", () => setActiveTool("eraser"));
        elements.shapesBtn.addEventListener("click", () => setActiveTool("shapes"));
        elements.stampsBtn.addEventListener("click", () => setActiveTool("stamps"));
        elements.clearBtn.addEventListener("click", clearCanvas);
        elements.saveBtn.addEventListener("click", saveCanvas);
        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π –¥–ª—è –≤–∏–±–æ—Ä—É –∫–æ–ª—å–æ—Ä—ñ–≤
        elements.colors.forEach((color) => {
          color.addEventListener("click", function () {
            elements.colors.forEach((c) => c.classList.remove("active"));
            this.classList.add("active");
            state.currentColor = this.style.backgroundColor;
          });
        });
        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ—ó –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–∞ —Ä–æ–∑–º—ñ—Ä—É
        elements.sizeSlider.addEventListener("input", function () {
          state.currentSize = Number(this.value);
        });
        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ñ—ñ–≥—É—Ä
        elements.shapeButtons.forEach((button) => {
          button.addEventListener("click", function () {
            elements.shapeButtons.forEach((btn) => btn.classList.remove("active"));
            this.classList.add("active");
            state.currentShape = this.dataset.shape;
          });
        });
        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π –¥–ª—è —à—Ç–∞–º–ø—ñ–≤
        elements.stamps.forEach((stamp) => {
          stamp.addEventListener("click", function () {
            elements.stamps.forEach((s) => s.classList.remove("active"));
            this.classList.add("active");
            state.currentStamp = this.dataset.emoji;
          });
        });
        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ–π –¥–ª—è –ø–æ–ª–æ—Ç–Ω–∞
        canvas.addEventListener("mousedown", startDrawing);
        canvas.addEventListener("mousemove", draw);
        canvas.addEventListener("mouseup", stopDrawing);
        canvas.addEventListener("mouseout", stopDrawing);
        canvas.addEventListener(
          "touchstart",
          function (e) {
            e.preventDefault();
            startDrawing(e);
          },
          { passive: false }
        );
        canvas.addEventListener(
          "touchmove",
          function (e) {
            e.preventDefault();
            draw(e);
          },
          { passive: false }
        );
        canvas.addEventListener("touchend", stopDrawing);
        clearCanvas();
      });
    </script>
  </body>
</html>
