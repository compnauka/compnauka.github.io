<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¢—Ä–µ–Ω–∞–∂–µ—Ä –∑ –ö–æ–Ω—Ñ–µ—Ç—ñ: PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Nunito', 'Segoe UI', sans-serif;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
        }

        /* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è –∫–ª–∞–≤—ñ—à */
        .key-3d {
            background: linear-gradient(to bottom, #ffffff 0%, #f3f4f6 100%);
            border-radius: 4px;
            box-shadow: 0 2px 0 #94a3b8, 0 3px 3px rgba(0,0,0,0.15);
            transition: transform 0.05s ease, box-shadow 0.05s ease, background-color 0.1s;
            position: relative;
            top: 0;
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 1; /* –î–æ–∑–≤–æ–ª—è—î –∑–º–µ–Ω—à—É–≤–∞—Ç–∏—Å—å */
            cursor: pointer;
            min-width: 0; /* –í–∞–∂–ª–∏–≤–æ –¥–ª—è flex –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ */
        }

        @media (min-width: 768px) {
            .key-3d {
                border-radius: 6px;
                box-shadow: 0 4px 0 #94a3b8, 0 5px 5px rgba(0,0,0,0.15);
            }
        }

        .key-3d:active, .key-pressed {
            transform: translateY(2px);
            box-shadow: 0 0 0 #94a3b8, inset 0 1px 2px rgba(0,0,0,0.1);
            background: #e2e8f0;
        }

        @media (min-width: 768px) {
            .key-3d:active, .key-pressed {
                transform: translateY(4px);
                box-shadow: 0 0 0 #94a3b8, inset 0 2px 4px rgba(0,0,0,0.1);
            }
        }

        .key-hint {
            background: linear-gradient(to bottom, #fde047 0%, #facc15 100%) !important;
            border-color: #eab308 !important;
            box-shadow: 0 2px 0 #a16207, 0 0 5px rgba(250, 204, 21, 0.6) !important;
            color: #422006 !important;
            z-index: 10;
        }
        @media (min-width: 768px) {
            .key-hint {
                box-shadow: 0 4px 0 #a16207, 0 0 10px rgba(250, 204, 21, 0.6) !important;
            }
        }
        .key-hint:active, .key-hint.key-pressed {
            box-shadow: 0 0 0 #a16207, inset 0 2px 4px rgba(0,0,0,0.1) !important;
        }

        .key-special {
            background: linear-gradient(to bottom, #cbd5e1 0%, #94a3b8 100%);
            box-shadow: 0 2px 0 #64748b;
            color: #334155;
            border: 1px solid #94a3b8;
        }
        @media (min-width: 768px) {
            .key-special {
                box-shadow: 0 4px 0 #64748b;
            }
        }
        .key-special:active, .key-special.key-pressed {
            box-shadow: 0 0 0 #64748b;
            background: #94a3b8;
        }

        .shake {
            animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .milestone-enter {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.8) translateY(20px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }

        .trophy-float {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .hidden-key {
            display: none !important;
        }
    </style>
</head>
<body class="bg-indigo-600 h-screen flex flex-col items-center justify-between py-2 md:py-4 overflow-hidden" role="application">

    <!-- Header & Stats -->
    <div class="w-full max-w-5xl px-2 md:px-4 flex flex-col gap-2 md:gap-4 relative z-10 shrink-0">
        <!-- Top Row -->
        <div class="flex justify-between items-center text-white drop-shadow-md">
            <div class="text-lg md:text-2xl font-extrabold tracking-wider flex items-center gap-2">
                <i class="fa-solid fa-gamepad text-yellow-300"></i>
                <span class="hidden sm:inline">KEYBOARD</span>
            </div>
            
            <div class="flex gap-2 md:gap-3 items-center">
                <!-- Language Toggle -->
                <button id="lang-toggle" class="bg-white/20 backdrop-blur-md border border-white/30 px-2 py-1 md:px-3 md:py-1.5 rounded-lg md:rounded-xl font-bold text-xs md:text-sm hover:bg-white/30 transition shadow-sm focus:outline-none focus:ring-2 focus:ring-white">
                    UA | EN
                </button>

                <button id="sound-toggle" class="bg-white/20 backdrop-blur-md border border-white/30 w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center hover:bg-white/30 transition shadow-sm focus:outline-none focus:ring-2 focus:ring-white" aria-label="Toggle Sound">
                    <i class="fa-solid fa-volume-high text-white text-xs md:text-base"></i>
                </button>
            </div>
        </div>

        <!-- Stats Row (Flex wrap for mobile) -->
        <div class="flex flex-wrap justify-center gap-1 md:gap-4 w-full">
            <!-- Score -->
            <div class="bg-white/20 backdrop-blur-md border border-white/30 px-2 py-1 md:px-3 md:py-2 rounded-lg md:rounded-xl flex flex-col items-center min-w-[60px] md:min-w-[80px]">
                <span class="text-[8px] md:text-[10px] uppercase font-bold text-yellow-200">Score</span>
                <span id="score-counter" class="font-black text-sm md:text-xl text-white">0</span>
            </div>
            <!-- Errors -->
            <div class="bg-white/20 backdrop-blur-md border border-white/30 px-2 py-1 md:px-3 md:py-2 rounded-lg md:rounded-xl flex flex-col items-center min-w-[60px] md:min-w-[80px]">
                <span class="text-[8px] md:text-[10px] uppercase font-bold text-red-200">Errors</span>
                <span id="error-counter" class="font-black text-sm md:text-xl text-red-100">0</span>
            </div>
            <!-- Best -->
            <div class="bg-white/20 backdrop-blur-md border border-white/30 px-2 py-1 md:px-3 md:py-2 rounded-lg md:rounded-xl flex flex-col items-center relative overflow-hidden min-w-[60px] md:min-w-[80px]">
                <div class="absolute inset-0 bg-yellow-400/10"></div>
                <span class="text-[8px] md:text-[10px] uppercase font-bold text-orange-200">Record</span>
                <span id="best-score" class="font-black text-sm md:text-xl text-orange-100">0</span>
            </div>
            <!-- WPM -->
            <div class="bg-white/20 backdrop-blur-md border border-white/30 px-2 py-1 md:px-3 md:py-2 rounded-lg md:rounded-xl flex flex-col items-center min-w-[60px] md:min-w-[80px]">
                <span class="text-[8px] md:text-[10px] uppercase font-bold text-blue-200">WPM</span>
                <span id="wpm-counter" class="font-black text-sm md:text-xl text-blue-100">0</span>
            </div>
            <!-- Accuracy -->
            <div class="bg-white/20 backdrop-blur-md border border-white/30 px-2 py-1 md:px-3 md:py-2 rounded-lg md:rounded-xl flex flex-col items-center min-w-[60px] md:min-w-[80px]">
                <span class="text-[8px] md:text-[10px] uppercase font-bold text-green-200">Accuracy</span>
                <span id="accuracy-counter" class="font-black text-sm md:text-xl text-green-100">100%</span>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="w-full bg-slate-900/30 rounded-full h-2 md:h-3 overflow-hidden border border-white/10 shadow-inner">
            <div id="progress-bar" class="bg-gradient-to-r from-yellow-400 to-orange-500 h-full transition-all duration-500 ease-out shadow-[0_0_10px_rgba(251,191,36,0.5)]" style="width: 0%"></div>
        </div>
    </div>

    <!-- Main Game Area -->
    <div class="flex-grow flex flex-col items-center justify-center w-full max-w-3xl px-2 md:px-4 relative z-0 min-h-0">
        
        <!-- Modal -->
        <div id="milestone-modal" class="hidden absolute inset-0 z-50 flex flex-col items-center justify-center bg-slate-900/80 backdrop-blur-md transition-opacity duration-300 px-4" aria-modal="true" role="dialog">
            <div class="relative bg-white p-6 md:p-8 rounded-3xl shadow-[0_0_50px_rgba(79,70,229,0.5)] text-center milestone-enter w-full max-w-sm mx-auto border-4 border-indigo-50 overflow-hidden">
                <!-- Decorative Background -->
                <div class="absolute top-0 left-0 w-full h-full pointer-events-none">
                    <div class="absolute -top-10 -right-10 w-24 h-24 md:w-32 md:h-32 bg-yellow-200 rounded-full mix-blend-multiply filter blur-2xl opacity-50"></div>
                    <div class="absolute -bottom-10 -left-10 w-24 h-24 md:w-32 md:h-32 bg-indigo-200 rounded-full mix-blend-multiply filter blur-2xl opacity-50"></div>
                </div>

                <div class="relative z-10">
                    <div class="text-5xl md:text-7xl mb-4 trophy-float filter drop-shadow-lg">üèÜ</div>
                    <h2 class="text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 mb-2 drop-shadow-sm" id="modal-title">Super!</h2>
                    <p class="text-slate-500 text-lg md:text-xl font-bold mb-6 md:mb-8" id="milestone-text">5 words done!</p>
                    
                    <button id="modal-next-btn" class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-bold py-3 px-6 md:py-4 md:px-8 rounded-2xl shadow-lg transform transition hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-2 group cursor-pointer outline-none focus:ring-4 focus:ring-indigo-300">
                        <span id="modal-btn-text">Next</span>
                        <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                    </button>
                    
                    <div class="mt-4 text-[8px] md:text-[10px] text-slate-400 font-bold uppercase tracking-widest" id="modal-hint">
                        Press any key
                    </div>
                </div>
            </div>
        </div>

        <div class="relative w-full flex flex-col items-center justify-center flex-grow">
            <div class="w-full text-center text-white/80 font-bold uppercase tracking-widest text-[10px] md:text-sm animate-pulse mb-2 md:mb-4" id="typing-prompt">
                Type letters:
            </div>
            
            <div id="word-display" class="bg-white rounded-2xl md:rounded-3xl shadow-2xl border-b-4 md:border-b-8 border-slate-200 px-4 py-4 md:px-8 md:py-10 text-center text-4xl md:text-7xl font-black text-slate-300 tracking-wider w-full min-h-[80px] md:min-h-[140px] flex items-center justify-center transform transition-all" aria-live="polite" role="status">
                <!-- JS render -->
            </div>
             <div id="message-area" class="h-6 md:h-8 mt-2 md:mt-4 text-lg md:text-2xl font-bold text-yellow-300 drop-shadow-md opacity-0 transition-opacity duration-300 text-center" aria-live="assertive">
                Great!
            </div>
        </div>
    </div>

    <!-- Keyboard -->
    <div class="w-full max-w-5xl px-1 md:px-2 pb-2 md:pb-4 select-none shrink-0">
        <div class="bg-slate-800 p-1 md:p-5 rounded-lg md:rounded-xl shadow-[0_10px_30px_rgba(0,0,0,0.5)] border-b-4 md:border-b-8 border-slate-900 mx-auto w-full" id="keyboard-container">
            <!-- Row Numbers -->
            <div class="flex gap-0.5 md:gap-1.5 mb-1 md:mb-3 w-full">
                <!-- Standard Keys: flex-1 for responsiveness -->
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">`</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">1</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">2</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">3</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">4</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">5</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">6</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">7</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">8</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">9</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">0</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">-</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">=</div>
                <!-- Backspace is usually bigger, giving it flex-grow-2 -->
                <div class="key-3d key-special flex-[1.5] h-8 md:h-12 text-[10px] md:text-sm" data-action="backspace">
                    <i class="fa-solid fa-delete-left"></i>
                </div>
            </div>

            <!-- Row 1 -->
            <div class="flex gap-0.5 md:gap-1.5 mb-1 md:mb-3 w-full keyboard-row">
                <!-- Tab -->
                <div class="key-3d key-special flex-[1.5] h-8 md:h-12 font-bold text-[8px] md:text-xs">Tab</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–π">–ô</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—Ü">–¶</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—É">–£</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–∫">–ö</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–µ">–ï</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–Ω">–ù</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–≥">–ì</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—à">–®</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—â">–©</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–∑">–ó</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—Ö">–•</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—ó">–á</div>
                <div class="key-3d key-special flex-[1.2] h-8 md:h-12 font-bold text-sm md:text-sm">\</div>
            </div>

            <!-- Row 2 -->
            <div class="flex gap-0.5 md:gap-1.5 mb-1 md:mb-3 w-full keyboard-row">
                <!-- Caps -->
                <div class="key-3d key-special flex-[1.8] h-8 md:h-12 font-bold text-[8px] md:text-xs">Caps</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—Ñ">–§</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—ñ">–Ü</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–≤">–í</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–∞">–ê</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–ø">–ü</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—Ä">–†</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–æ">–û</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–ª">–õ</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–¥">–î</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–∂">–ñ</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—î">–Ñ</div>
                <!-- Enter -->
                <div class="key-3d key-special flex-[2] h-8 md:h-12 font-bold text-[8px] md:text-xs bg-gradient-to-b from-blue-100 to-blue-200">Enter</div>
            </div>

            <!-- Row 3 -->
            <div class="flex gap-0.5 md:gap-1.5 mb-1 md:mb-3 w-full keyboard-row">
                <!-- Shift -->
                <div class="key-3d key-special flex-[2.3] h-8 md:h-12 font-bold text-[8px] md:text-xs">Shift</div>
                <!-- 11 slots -->
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="“ë">“ê</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—è">–Ø</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—á">–ß</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—Å">–°</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–º">–ú</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–∏">–ò</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—Ç">–¢</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—å">–¨</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="–±">–ë</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char="—é">–Æ</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg" data-char=".">.</div>
                <!-- Shift -->
                <div class="key-3d key-special flex-[2.3] h-8 md:h-12 font-bold text-[8px] md:text-xs">Shift</div>
            </div>

            <!-- Space -->
            <div class="flex justify-center gap-0.5 md:gap-1.5 w-full">
                <div class="key-3d w-1/2 h-8 md:h-12 font-bold text-slate-400 text-sm" data-code="Space"></div>
            </div>
        </div>
    </div>

    <script>
        const AudioController = {
            ctx: null,
            muted: false,
            init() { if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
            resume() { if (!this.muted && this.ctx && this.ctx.state === 'suspended') this.ctx.resume().catch(console.warn); },
            toggleMute(btn, icon) {
                this.muted = !this.muted;
                icon.classList.replace(this.muted ? 'fa-volume-high' : 'fa-volume-xmark', this.muted ? 'fa-volume-xmark' : 'fa-volume-high');
                btn.classList.toggle('bg-red-500/50', this.muted);
                btn.blur();
            },
            playTone(freq, type, duration, volStart = 0.05, volEnd = 0.001) {
                if (this.muted) return;
                if (!this.ctx) this.init();
                this.resume();
                
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                if (type === 'triangle') osc.frequency.exponentialRampToValueAtTime(freq / 4, this.ctx.currentTime + duration);
                gain.gain.setValueAtTime(volStart, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(volEnd, this.ctx.currentTime + duration);
                osc.start();
                osc.stop(this.ctx.currentTime + duration + 0.1);
            },
            playClick() { this.playTone(400, 'triangle', 0.05); },
            playSuccess() {
                if (this.muted) return;
                [523.25, 659.25, 783.99].forEach((freq, i) => setTimeout(() => this.playTone(freq, 'sine', 0.5, 0.1), i * 50));
            }
        };

        const Storage = {
            saveBest(score, lang) {
                const key = `bestScore_${lang}`;
                const best = this.getBest(lang);
                if (score > best) {
                    localStorage.setItem(key, score);
                    return true;
                }
                return false;
            },
            getBest(lang) {
                return parseInt(localStorage.getItem(`bestScore_${lang}`) || '0', 10);
            }
        };

        const Data = {
            uk: {
                words: [...new Set([
                    "–ª—é–¥–∏", "–≤–æ–Ω–∞", "–≤–æ–Ω–∏", "–∫–æ–ª–∏", "–π–æ–≥–æ", "–±—É—Ç–∏", "—Ä–æ–∫—É", "—á–∞—Å", "–±—É–ª–æ", "–º–µ–Ω–µ", "–¥—É–∂–µ", "–º–µ–Ω—ñ", "—Ç–æ–º—É", "—Ç–µ–±–µ", "—è–∫–∏–π", "–º–∞—î", "—Å–µ–±–µ", "–º–æ–∂–µ", "—Ü—å–æ–≥–æ", "–≤–∂–µ", "—Å–æ–±—ñ", "—Ä–æ–±–∏—Ç–∏", "–±—É–¥–µ", "—Ç—Ä–µ–±–∞", "—Å–≤—ñ—Ç", "–∂–∏—Ç—Ç—è", "–ª–∏—à–µ", "–º–æ–∂–Ω–∞", "—Ç—É—Ç", "–¥–µ–Ω—å", "—Å–≤–æ—é", "—Ç–µ–ø–µ—Ä", "—â–æ–±–∏", "–π–æ–º—É", "—Å–≤–æ—ó", "—ñ–Ω—à—ñ", "–Ω–∞–≤—ñ—Ç—å", "—Ö–æ—á—É", "–∫–æ–≥–æ", "–±—É–ª–∏", "—Å–∞–º–µ", "–∫—É–¥–∏", "—è–∫–∞", "–¥–æ–∫–∏", "—Ç–æ–¥—ñ", "—Ç–µ–∂", "–æ—á—ñ", "—Ä—É–∫–∏", "–Ω—ñ–±–∏", "–Ω—ñ–∂", "–ø–æ–∫–∏", "–ø—Ä–æ—Å—Ç–æ", "–±–∞–≥–∞—Ç–æ", "–∑–∞—Ä–∞–∑", "–º–∞–º–∞", "—Ç–∞—Ç–æ", "–±—Ä–∞—Ç", "–º–æ–≤–∞", "–≤–æ–¥–∞", "–Ω–µ–±–æ", "–ø–æ–ª–µ", "–ª—ñ—Å", "—Ä—ñ–∫–∞", "–º–æ—Ä–µ", "–≥–æ—Ä–∞", "—Å–µ–ª–∞", "–º—ñ—Å—Ç–æ", "—Ö–∞—Ç–∞", "–≤—ñ–∫–Ω–æ", "–¥–≤–µ—Ä—ñ", "—Å—Ç—ñ–ª", "–∫–Ω–∏–≥–∞", "—à–∫–æ–ª–∞", "–∫–ª–∞—Å", "—É—Ä–æ–∫", "—Ä—É—á–∫–∞", "–¥—Ä—É–≥", "—Å–∏–ª–∞", "–≤–æ–ª—è", "—Å–ª–∞–≤–∞", "–ø—ñ—Å–Ω—è", "–¥—É—à–∞", "—Å–µ—Ä—Ü–µ", "–ª—é–±–æ–≤", "–º—Ä—ñ—è", "–Ω–∞–¥—ñ—è", "–≤—ñ—Ä–∞", "–ø—Ä–∞–≤–¥–∞", "–∫—Ä–∞—Å–∞", "—Ä–∞–¥—ñ—Å—Ç—å", "–¥–æ–±—Ä–æ", "—É—Å–ø—ñ—Ö", "–ø—Ä–∞—Ü—è", "–∑–Ω–∞—Ç–∏", "–∂–∏—Ç–∏", "–º–∞—Ç–∏"
                ])],
                milestones: ["–ß—É–¥–æ–≤–∏–π —Å—Ç–∞—Ä—Ç!", "–¢–∏ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –º–∞–π—Å—Ç–µ—Ä!", "–ù–µ–π–º–æ–≤—ñ—Ä–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å!", "–ü—Ä–æ–¥–æ–≤–∂—É–π —É —Ç–æ–º—É –∂ –¥—É—Å—ñ!", "–ö–ª–∞–≤—ñ–∞—Ç—É—Ä–Ω–∏–π –≥–µ–Ω—ñ–π!", "–ù–µ–ø–µ—Ä–µ–≤–µ—Ä—à–µ–Ω–æ!"],
                labels: { prompt: "–ù–∞–±–∏—Ä–∞–π –ª—ñ—Ç–µ—Ä–∏:", success: "–ß—É–¥–æ–≤–æ!", words: "–°–ª—ñ–≤", errors: "–ü–æ–º–∏–ª–æ–∫", record: "–†–µ–∫–æ—Ä–¥", accuracy: "–¢–æ—á–Ω—ñ—Å—Ç—å", next: "–î–∞–ª—ñ", pressAny: "–ù–∞—Ç–∏—Å–Ω–∏ –±—É–¥—å-—è–∫—É –∫–ª–∞–≤—ñ—à—É", modalTitle: "–°—É–ø–µ—Ä!", modalText: "—Å–ª—ñ–≤!" },
                layout: [
                    ['–π','—Ü','—É','–∫','–µ','–Ω','–≥','—à','—â','–∑','—Ö','—ó'],
                    ['—Ñ','—ñ','–≤','–∞','–ø','—Ä','–æ','–ª','–¥','–∂','—î'],
                    ['“ë','—è','—á','—Å','–º','–∏','—Ç','—å','–±','—é','.']
                ]
            },
            en: {
                words: [...new Set([
                    "about", "other", "which", "their", "there", "first", "would", "these", "click", "price", "state", "world", "music", "video", "books", "links", "years", "could", "group", "games", "service", "start", "today", "south", "pages", "found", "house", "photo", "power", "while", "three", "total", "place", "think", "north", "where", "after", "water", "since", "guide", "board", "white", "small", "shall", "times", "sites", "level", "thank", "phone", "hours", "black", "plant", "trade", "radio", "study", "party", "early", "given", "light", "every", "field", "large", "point", "never", "under", "group", "among", "great", "right", "write", "thing", "cause", "check", "stand", "ready", "story", "media", "class", "value", "image", "model", "phone", "space", "night", "table", "event", "order", "range", "cloud", "focus", "voice", "offer", "learn", "money", "paper", "track", "terms", "skill", "brain", "dream"
                ])],
                milestones: ["Great Start!", "You're a master!", "Incredible Speed!", "Keep it up!", "Keyboard Genius!", "Outstanding!"],
                labels: { prompt: "Type letters:", success: "Great!", words: "Words", errors: "Errors", record: "Record", accuracy: "Accuracy", next: "Next", pressAny: "Press any key", modalTitle: "Super!", modalText: "words done!" },
                layout: [
                    ['q','w','e','r','t','y','u','i','o','p','[',']'],
                    ['a','s','d','f','g','h','j','k','l',';','\''],
                    ['z','x','c','v','b','n','m',',','.','/']
                ]
            }
        };

        const UI = {
            els: {
                wordDisplay: document.getElementById('word-display'),
                score: document.getElementById('score-counter'),
                errors: document.getElementById('error-counter'),
                best: document.getElementById('best-score'),
                wpm: document.getElementById('wpm-counter'),
                accuracy: document.getElementById('accuracy-counter'),
                progressBar: document.getElementById('progress-bar'),
                message: document.getElementById('message-area'),
                modal: document.getElementById('milestone-modal'),
                modalText: document.getElementById('milestone-text'),
                modalTitle: document.getElementById('modal-title'),
                modalBtnText: document.getElementById('modal-btn-text'),
                modalHint: document.getElementById('modal-hint'),
                nextBtn: document.getElementById('modal-next-btn'),
                soundBtn: document.getElementById('sound-toggle'),
                langBtn: document.getElementById('lang-toggle'),
                prompt: document.getElementById('typing-prompt'),
                statLabels: document.querySelectorAll('.grid span.uppercase'),
                keyboard: document.getElementById('keyboard-container')
            },
            keyMap: new Map(),

            updateLabels(lang) {
                const l = Data[lang].labels;
                this.els.prompt.textContent = l.prompt;
                this.els.message.textContent = l.success;
                this.els.modalTitle.textContent = l.modalTitle;
                this.els.modalBtnText.textContent = l.next;
                this.els.modalHint.textContent = l.pressAny;
                
                const stats = document.querySelectorAll('.grid span.uppercase');
                // stats was a nodelist from grid, but we changed layout to flex
                // Re-query labels correctly
                const statLabels = document.querySelectorAll('[class*="uppercase"]');
                // The order in HTML: Words, Errors, Record, WPM, Accuracy
                if(statLabels[0]) statLabels[0].textContent = l.words;
                if(statLabels[1]) statLabels[1].textContent = l.errors;
                if(statLabels[2]) statLabels[2].textContent = l.record;
                if(statLabels[3]) statLabels[3].textContent = "WPM"; // Always WPM
                if(statLabels[4]) statLabels[4].textContent = l.accuracy;
            },

            updateKeyboardLayout(lang) {
                const layout = Data[lang].layout;
                const rows = document.querySelectorAll('.keyboard-row');
                
                // Row 1
                const row1Keys = rows[0].querySelectorAll('.key-letter');
                layout[0].forEach((char, i) => {
                    if(row1Keys[i]) {
                        row1Keys[i].textContent = char.toUpperCase();
                        row1Keys[i].dataset.char = char;
                    }
                });

                // Row 2
                const row2Keys = rows[1].querySelectorAll('.key-letter');
                layout[1].forEach((char, i) => {
                    if(row2Keys[i]) {
                        row2Keys[i].textContent = char.toUpperCase();
                        row2Keys[i].dataset.char = char;
                    }
                });

                // Row 3
                const row3Keys = rows[2].querySelectorAll('.key-letter');
                
                if (lang === 'en') {
                    row3Keys[0].classList.add('hidden-key');
                    layout[2].forEach((char, i) => {
                        if(row3Keys[i+1]) {
                            row3Keys[i+1].textContent = char.toUpperCase();
                            row3Keys[i+1].dataset.char = char;
                        }
                    });
                } else {
                    row3Keys[0].classList.remove('hidden-key');
                    layout[2].forEach((char, i) => {
                        if(row3Keys[i]) {
                            row3Keys[i].textContent = char.toUpperCase();
                            row3Keys[i].dataset.char = char;
                        }
                    });
                }
            },
            
            renderWord(word, index) {
                this.els.wordDisplay.innerHTML = '';
                for (let i = 0; i < word.length; i++) {
                    const span = document.createElement('span');
                    span.textContent = word[i];
                    if (i < index) span.className = 'text-green-500 transition-colors duration-200';
                    else if (i === index) span.className = 'text-indigo-600 border-b-2 md:border-b-4 border-indigo-500 pb-0.5 md:pb-1';
                    else span.className = 'text-slate-300';
                    this.els.wordDisplay.appendChild(span);
                }
            },
            updateStats(state) {
                this.els.score.textContent = state.score;
                this.els.errors.textContent = state.errors;
                this.els.best.textContent = state.bestScore;
                
                const wordsInCycle = state.score % 5;
                const wordProgress = state.currentWord.length > 0 ? state.charIndex / state.currentWord.length : 0;
                const progress = (wordsInCycle + wordProgress) * 20;
                this.els.progressBar.style.width = `${Math.min(progress, 100)}%`;

                const totalAttempts = state.totalHits + state.errors;
                const accuracy = totalAttempts <= 0 ? 100 : (state.totalHits / totalAttempts) * 100;
                this.els.accuracy.textContent = `${accuracy.toFixed(1)}%`;
                
                const baseClass = "font-black text-sm md:text-xl";
                if (accuracy > 95) this.els.accuracy.className = `${baseClass} text-green-100`;
                else if (accuracy > 80) this.els.accuracy.className = `${baseClass} text-yellow-100`;
                else this.els.accuracy.className = `${baseClass} text-red-100`;
            },
            updateWPM(startTime, score) {
                if (!startTime || score === 0) {
                    this.els.wpm.textContent = '0';
                    return;
                }
                const minutes = (Date.now() - startTime) / 60000;
                if (minutes < 0.001) {
                    this.els.wpm.textContent = '0';
                    return;
                }
                const wpm = Math.round(score / minutes);
                this.els.wpm.textContent = wpm;
            },
            highlightKey(char) {
                document.querySelectorAll('.key-hint').forEach(el => el.classList.remove('key-hint'));
                if (!char) return;
                
                let selector;
                if (char === ' ') selector = '[data-code="Space"]';
                else selector = `[data-char="${char.toLowerCase()}"]`;
                
                const el = this.els.keyboard.querySelector(selector);
                if (el) el.classList.add('key-hint');
            },
            animateKey(char) {
                let selector;
                if (char === ' ') selector = '[data-code="Space"]';
                else selector = `[data-char="${char.toLowerCase()}"]`;
                
                const el = this.els.keyboard.querySelector(selector);
                if (el) {
                    el.classList.add('key-pressed');
                    setTimeout(() => el.classList.remove('key-pressed'), 150);
                }
            },
            shakeWord() {
                this.els.wordDisplay.classList.add('shake');
                setTimeout(() => this.els.wordDisplay.classList.remove('shake'), 400);
            },
            showSuccessMessage(lang) {
                this.els.message.style.opacity = '1';
                this.els.message.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    this.els.message.style.opacity = '0';
                    this.els.message.style.transform = 'scale(1)';
                }, 800);
            },
            showModal(text) {
                this.els.modalText.textContent = text;
                this.els.modal.classList.remove('hidden');
                setTimeout(() => this.els.nextBtn.focus(), 100);
            },
            hideModal() {
                this.els.modal.classList.add('hidden');
            }
        };

        const Game = {
            currentLang: 'uk',
            ignoredKeys: new Set(['Shift', 'Control', 'Alt', 'Meta', 'Tab', 'CapsLock', 'Escape', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Enter']),
            state: {
                wordIndex: 0,
                charIndex: 0,
                score: 0,
                errors: 0,
                totalHits: 0,
                bestScore: 0,
                startTime: null,
                currentWord: "",
                paused: false,
                closingModal: false
            },

            init() {
                this.setupLanguage();
                this.initEventListeners();
                this.startNewGame();
            },

            initEventListeners() {
                UI.els.soundBtn.addEventListener('click', () => AudioController.toggleMute(UI.els.soundBtn, UI.els.soundIcon.parentElement.querySelector('i')));
                UI.els.langBtn.addEventListener('click', () => this.toggleLanguage());
                UI.els.nextBtn.addEventListener('click', () => this.closeModal());
                document.addEventListener('keydown', (e) => this.onKeyDown(e));
                
                UI.els.keyboard.addEventListener('mousedown', (e) => {
                    const keyEl = e.target.closest('.key-3d');
                    if (!keyEl) return;
                    
                    e.preventDefault();
                    const key = keyEl.dataset.char;
                    const action = keyEl.dataset.action;
                    
                    if (action === 'backspace') {
                        this.handleBackspace();
                    } else if (key || keyEl.dataset.code === 'Space') {
                        this.handleInput(key || ' ');
                    }
                });
            },

            setupLanguage() {
                UI.updateLabels(this.currentLang);
                UI.updateKeyboardLayout(this.currentLang);
            },

            toggleLanguage() {
                if (this.state.score > 0) {
                    const confirmSwitch = window.confirm("Switch language? Current progress will be lost.");
                    if (!confirmSwitch) return;
                }
                this.currentLang = this.currentLang === 'uk' ? 'en' : 'uk';
                this.setupLanguage();
                this.startNewGame();
                UI.els.langBtn.blur();
            },

            startNewGame() {
                this.state.score = 0;
                this.state.errors = 0;
                this.state.totalHits = 0;
                this.state.wordIndex = 0;
                this.state.charIndex = 0;
                this.state.startTime = null;
                this.state.bestScore = Storage.getBest(this.currentLang);
                
                const words = [...Data[this.currentLang].words];
                for (let i = words.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [words[i], words[j]] = [words[j], words[i]];
                }
                this.currentWordsList = words;
                
                this.loadNextWord();
                UI.updateStats(this.state);
                UI.updateWPM(null, 0);
            },

            loadNextWord() {
                if (this.state.wordIndex >= this.currentWordsList.length) {
                    this.state.wordIndex = 0;
                }
                this.state.currentWord = this.currentWordsList[this.state.wordIndex];
                this.state.charIndex = 0;
                UI.renderWord(this.state.currentWord, 0);
                UI.highlightKey(this.state.currentWord[0]);
                UI.updateStats(this.state);
            },

            handleInput(inputChar) {
                if (this.state.paused) return;
                
                if (!this.state.startTime) this.state.startTime = Date.now();
                UI.updateWPM(this.state.startTime, this.state.score);

                AudioController.playClick();
                UI.animateKey(inputChar);

                const targetChar = this.state.currentWord[this.state.charIndex];

                if (inputChar.toLowerCase() === targetChar.toLowerCase()) {
                    this.state.charIndex++;
                    this.state.totalHits++;
                    UI.renderWord(this.state.currentWord, this.state.charIndex);
                    
                    if (this.state.charIndex === this.state.currentWord.length) {
                        this.onWordComplete();
                    } else {
                        UI.highlightKey(this.state.currentWord[this.state.charIndex]);
                    }
                } else {
                    this.state.errors++;
                    UI.shakeWord();
                }
                UI.updateStats(this.state);
            },

            handleBackspace() {
                if (this.state.paused || this.state.charIndex === 0) return;
                AudioController.playClick();
                this.state.charIndex--;
                if (this.state.totalHits > 0) this.state.totalHits--;
                UI.renderWord(this.state.currentWord, this.state.charIndex);
                UI.highlightKey(this.state.currentWord[this.state.charIndex]);
                UI.updateStats(this.state);
            },

            onWordComplete() {
                this.state.score++;
                if (Storage.saveBest(this.state.score, this.currentLang)) {
                    this.state.bestScore = this.state.score;
                }
                
                AudioController.playSuccess();
                UI.showSuccessMessage(this.currentLang);
                UI.updateWPM(this.state.startTime, this.state.score);
                
                this.state.wordIndex++;

                if (this.state.score > 0 && this.state.score % 5 === 0) {
                    this.triggerMilestone();
                } else {
                    setTimeout(() => this.loadNextWord(), 200);
                }
            },

            triggerMilestone() {
                this.state.paused = true;
                confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
                const milestones = Data[this.currentLang].milestones;
                const phrase = milestones[Math.floor(Math.random() * milestones.length)];
                const suffix = Data[this.currentLang].labels.modalText;
                UI.showModal(`${phrase} (${this.state.score} ${suffix})`);
                UI.els.progressBar.style.width = '100%';
            },

            closeModal() {
                if (this.state.closingModal) return;
                this.state.closingModal = true;
                UI.hideModal();
                this.state.paused = false;
                UI.els.progressBar.style.width = '0%';
                this.loadNextWord();
                setTimeout(() => { this.state.closingModal = false; }, 300);
            },

            onKeyDown(e) {
                if (this.state.paused) { this.closeModal(); return; }
                if (this.ignoredKeys.has(e.key)) return;
                if (e.key === 'Backspace') { this.handleBackspace(); return; }
                if (e.key.length === 1) this.handleInput(e.key);
            }
        };

        Game.init();
    </script>
</body>
</html>
