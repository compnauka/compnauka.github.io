<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–§–µ—Ä–º–µ—Ä –ë–æ—Ç –ü–ª—é—Å | –ü—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è —Ä–æ–±–æ—Ç–∞</title>
    <style>
      :root {
        --primary-color: #6a5acd;
        --primary-dark: #483d8b;
        --background-color: #f0f8ff;
        --card-color: #ffffff;
        --example-bg: #e6f7ff;
        --example-border: #1e90ff;
        --interactive-bg: #f0fff0;
        --text-color: #333333;
        --success-color: #4caf50;
        --error-color: #f44336;
        --warning-color: #ff9800;
        --level-color: #9c27b0;
        --code-bg: #f5f5f5;
        --border-radius: 10px;
        --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        --strong-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
      
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.7;
        font-family: "Roboto", "Arial", sans-serif;
        font-size: 16px;
      }
      
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 30px 20px;
      }
      
      header {
        background-color: var(--primary-color);
        color: white;
        text-align: center;
        padding: 30px 20px;
        border-radius: var(--border-radius);
        margin-bottom: 30px;
        box-shadow: var(--strong-shadow);
      }
      
      h1 {
        font-size: 42px;
        margin-bottom: 15px;
        font-weight: 700;
        letter-spacing: 0.5px;
      }
      
      h2 {
        color: var(--primary-color);
        margin: 25px 0 20px;
        border-bottom: 2px solid var(--primary-color);
        padding-bottom: 8px;
        font-size: 28px;
        font-weight: 600;
      }
      
      h3 {
        font-size: 22px;
        margin-bottom: 12px;
        color: var(--primary-dark);
      }
      
      p {
        margin-bottom: 18px;
        font-size: 18px;
        line-height: 1.7;
      }
      
      .interactive {
        background-color: var(--interactive-bg);
        border-radius: var(--border-radius);
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--shadow);
      }
      
      .game-container {
        display: flex;
        flex-direction: row;
        gap: 20px;
        margin: 20px 0;
        align-items: flex-start;
      }
      
      .game-column {
        flex: 1;
        min-width: 0;
      }
      
      .field-column {
        flex-basis: 40%;
      }
      
      .controls-column {
        flex-basis: 60%;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      
      /* –°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä—ñ–≤–Ω—ñ–≤ */
      .level-progress {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
      
      .level-btn {
        padding: 8px 16px;
        background-color: #ddd;
        color: var(--text-color);
        border-radius: 5px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
      }
      
      .level-btn.active {
        background-color: var(--level-color);
        color: white;
        font-weight: bold;
      }
      
      .level-btn:hover {
        background-color: #ccc;
        transform: translateY(-2px);
      }
      
      .level-btn.active:hover {
        background-color: var(--level-color);
      }
      
      /* –ü–æ–ª–µ –≥—Ä–∏ */
      .robot-field {
        display: grid;
        gap: 3px;
        margin: 15px auto;
        width: max-content;
        background-color: #eee;
        padding: 8px;
        border-radius: 8px;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
      }
      
      .cell {
        width: 50px;
        height: 50px;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: background-color 0.2s;
        position: relative;
      }
      
      .wall {
        background-color: #8b4513;
        border: 1px solid #6b3300;
      }
      
      .cell:hover {
        background-color: #f8f8f8;
      }
      
      .robot-icon {
        font-size: 32px;
        color: var(--primary-color);
        filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.2));
        z-index: 10;
        transition: transform 0.3s ease;
      }
      
      .collectible {
        font-size: 32px;
        filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.2));
        z-index: 5;
      }
      
      /* –†–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–æ–≥—Ä–∞–º–∏ */
      .code-editor {
        background-color: var(--code-bg);
        border-radius: var(--border-radius);
        padding: 15px;
        box-shadow: var(--shadow);
      }
      
      .program-textarea {
        width: 100%;
        min-height: 300px;
        padding: 15px;
        font-family: monospace;
        font-size: 16px;
        line-height: 1.5;
        border: 2px solid var(--primary-color);
        border-radius: 8px;
        resize: vertical;
      }
      
      .program-textarea:focus {
        outline: none;
        border-color: var(--primary-dark);
        box-shadow: 0 0 0 3px rgba(106, 90, 205, 0.3);
      }
      
      .console {
        background-color: #2d2d2d;
        color: #f8f8f8;
        font-family: monospace;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        height: 500px;
        overflow-y: auto;
      }
      
      .console-line {
        margin: 5px 0;
        line-height: 1.4;
      }
      
      .console-error {
        color: #ff6b6b;
      }
      
      .console-success {
        color: #69db7c;
      }
      
      .toast {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background-color: var(--success-color);
        color: white;
        padding: 15px 30px;
        border-radius: 8px;
        display: none;
        z-index: 1000;
        font-size: 18px;
        font-weight: 500;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }
      
      button {
        background-color: var(--primary-color);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        margin: 10px 8px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      
      button:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      }
      
      button:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }
      
      footer {
        background-color: var(--primary-color);
        color: white;
        text-align: center;
        padding: 2rem 0;
        border-radius: 20px 20px 0 0;
        margin-top: 3rem;
        box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
      }
      
      footer p {
        font-size: 1.1rem;
      }
      
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }
      
        header {
          padding: 20px 15px;
        }
      
        h1 {
          font-size: 32px;
        }
      
        h2 {
          font-size: 24px;
        }
      
        p {
          font-size: 16px;
        }
      
        .interactive {
          padding: 20px;
        }
      
        .game-container {
          flex-direction: column;
        }
      
        .field-column,
        .controls-column {
          flex-basis: 100%;
          width: 100%;
        }
      
        .cell {
          width: 45px;
          height: 45px;
        }
      
        .robot-icon,
        .collectible {
          font-size: 30px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>–§–µ—Ä–º–µ—Ä –ë–æ—Ç –ü–ª—é—Å ü§ñüçè‚ûï</h1>
        <p>–ó–∞–ø—Ä–æ–≥—Ä–∞–º—É–π —Ä–æ–±–æ—Ç–∞, —â–æ–± –≤—ñ–Ω –∑—ñ–±—Ä–∞–≤ –≤—Å—ñ —Ñ—Ä—É–∫—Ç–∏ —Ç–∞ –æ–≤–æ—á—ñ!</p>
      </header>
      
      <!-- –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä—ñ–≤–Ω—ñ–≤ -->
      <div class="level-progress" id="levelProgress">
        <!-- –ö–Ω–æ–ø–∫–∏ —Ä—ñ–≤–Ω—ñ–≤ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
      </div>
      
      <div class="interactive">
        <div class="level-description" id="levelDescription">
          –£—Å–∫–ª–∞–¥–Ω–µ–Ω–∏–π —Ä—ñ–≤–µ–Ω—å: –Ω–∞–ø–∏—à–∏ –ø—Ä–æ–≥—Ä–∞–º—É –¥–ª—è —Ä–æ–±–æ—Ç–∞ —Ç–µ–∫—Å—Ç–æ–º. –ó–±–µ—Ä–∏ –≤—Å—ñ —è–±–ª—É–∫–∞, –æ–±—Ö–æ–¥—è—á–∏ —Å—Ç—ñ–Ω–∏.
        </div>
      
        <div class="game-container">
          <!-- –ü–æ–ª–µ –≥—Ä–∏ -->
          <div class="game-column field-column">
            <h3>–ü–æ–ª–µ –≥—Ä–∏:</h3>
            <div class="robot-field" id="robotField">
              <!-- –ö–ª—ñ—Ç–∏–Ω–∫–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
            <div class="console" id="console">
              <div class="console-line">–ì–æ—Ç–æ–≤–∏–π –¥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥...</div>
            </div>
          </div>
      
          <!-- –†–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–æ–≥—Ä–∞–º–∏ -->
          <div class="game-column controls-column">
            <div class="code-editor">
              <h3>–¢–≤–æ—è –ø—Ä–æ–≥—Ä–∞–º–∞:</h3>
              <textarea
                id="programCode"
                class="program-textarea"
                placeholder="–≤–≥–æ—Ä—É
–≤–ø—Ä–∞–≤–æ
–≤–≥–æ—Ä—É 2
–≤–ª—ñ–≤–æ 3
–≤–Ω–∏–∑"
              ></textarea>
              <div class="controls">
                <button onclick="runProgram()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–∏</button>
                <button onclick="stopProgram()">‚èπÔ∏è –ó—É–ø–∏–Ω–∏—Ç–∏</button>
                <button onclick="resetLevel()">üîÑ –ü–æ—á–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
              </div>
            </div>
      
            <div class="syntax-guide">
              <h3>–ü—ñ–¥–∫–∞–∑–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞—Ö:</h3>
              <p>–ü—Ä–æ–≥—Ä–∞–º–∞ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ –æ–∫—Ä–µ–º–∏—Ö –∫–æ–º–∞–Ω–¥, –∫–æ–∂–Ω–∞ –≤ –Ω–æ–≤–æ–º—É —Ä—è–¥–∫—É:</p>
              <pre>–≤–≥–æ—Ä—É    // –æ–¥–∏–Ω –∫—Ä–æ–∫ –≤–≥–æ—Ä—É
–≤–Ω–∏–∑     // –æ–¥–∏–Ω –∫—Ä–æ–∫ –≤–Ω–∏–∑
–≤–ª—ñ–≤–æ    // –æ–¥–∏–Ω –∫—Ä–æ–∫ –≤–ª—ñ–≤–æ
–≤–ø—Ä–∞–≤–æ   // –æ–¥–∏–Ω –∫—Ä–æ–∫ –≤–ø—Ä–∞–≤–æ</pre>
              <p>–ú–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–æ–≤—Ç–æ—Ä–∏ –¥–ª—è —Å–∫–æ—Ä–æ—á–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É:</p>
              <pre>–≤–≥–æ—Ä—É 3   // —Ç—Ä–∏ –∫—Ä–æ–∫–∏ –≤–≥–æ—Ä—É
–≤–ø—Ä–∞–≤–æ 2  // –¥–≤–∞ –∫—Ä–æ–∫–∏ –≤–ø—Ä–∞–≤–æ</pre>
              <p>–£–≤–∞–≥–∞: —Ä–æ–±–æ—Ç –Ω–µ –º–æ–∂–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏ —á–µ—Ä–µ–∑ —Å—Ç—ñ–Ω–∏!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
      
    <div class="toast" id="toast">–ú–æ–ª–æ–¥–µ—Ü—å! –¢–∏ –∑—ñ–±—Ä–∞–≤ —É—Å—ñ —Ñ—Ä—É–∫—Ç–∏!</div>
    <div class="step-count" id="stepCount">–ö—Ä–æ–∫—ñ–≤: 0</div>
      
    <footer>
      <p>
        –†–æ–∑—Ä–æ–±–ª–µ–Ω–æ –¥–ª—è —é–Ω–∏—Ö –ø—Ä–æ–≥—Ä–∞–º—ñ—Å—Ç—ñ–≤ <br />
        2025 ¬© –ê–ª–≥–æ—Ä–∏—Ç–º–∏ —Ç–∞ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è –¥–ª—è –¥—ñ—Ç–µ–π
      </p>
    </footer>
      
    <script>
      // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
      const ANIMATION_SPEED = 500; // –º—Å
      const TOAST_DURATION = 3000; // –º—Å
      
      // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –≥—Ä–∏
      let robotPosition = { x: 0, y: 0 };
      let collectibles = [];
      let walls = [];
      let isRunning = false;
      let stepCount = 0;
      let maxSteps = 30;
      let gridSize = 6;
      let executionInterval = null;
      let currentCommandIndex = 0;
      let parsedCommands = [];
      
      // DOM-–µ–ª–µ–º–µ–Ω—Ç–∏
      const robotField = document.getElementById("robotField");
      const stepCountElement = document.getElementById("stepCount");
      const programTextarea = document.getElementById("programCode");
      const levelDescriptionElement = document.getElementById("levelDescription");
      const levelProgressElement = document.getElementById("levelProgress");
      
      // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä—ñ–≤–Ω—ñ–≤ (5 —Ä—ñ–≤–Ω—ñ–≤ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ)
      const levels = [
        {
          gridSize: 4,
          robotStart: { x: 0, y: 0 },
          collectiblesCount: 2,
          collectibleType: "üçé",
          walls: [],
          description: "–†—ñ–≤–µ–Ω—å 1: –ü–æ–ª–µ 4x4. –ó–±–µ—Ä–∏ –≤—Å—ñ —è–±–ª—É–∫–∞.",
          maxSteps: 20
        },
        {
          gridSize: 5,
          robotStart: { x: 0, y: 0 },
          collectiblesCount: 3,
          collectibleType: "üçé",
          walls: [{ x: 2, y: 1 }],
          description: "–†—ñ–≤–µ–Ω—å 2: –ü–æ–ª–µ 5x5. –ó–±–µ—Ä–∏ –≤—Å—ñ —è–±–ª—É–∫–∞, –æ–±—Ö–æ–¥—è—á–∏ —Å—Ç—ñ–Ω—É.",
          maxSteps: 25
        },
        {
          gridSize: 6,
          robotStart: { x: 0, y: 0 },
          collectiblesCount: 4,
          collectibleType: "üçé",
          walls: [
            { x: 2, y: 0 },
            { x: 2, y: 1 },
            { x: 2, y: 2 }
          ],
          description: "–†—ñ–≤–µ–Ω—å 3: –ü–æ–ª–µ 6x6. –ë—ñ–ª—å—à–µ –ø–µ—Ä–µ—à–∫–æ–¥, –±—ñ–ª—å—à–µ —è–±–ª—É–∫.",
          maxSteps: 30
        },
        {
          gridSize: 7,
          robotStart: { x: 0, y: 0 },
          collectiblesCount: 5,
          collectibleType: "üçé",
          walls: [
            { x: 3, y: 1 },
            { x: 3, y: 2 },
            { x: 3, y: 3 }
          ],
          description: "–†—ñ–≤–µ–Ω—å 4: –ü–æ–ª–µ 7x7. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ç–µ–∫—Å—Ç–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏, —â–æ–± –æ–±—ñ–π—Ç–∏ —Å—Ç—ñ–Ω–∏.",
          maxSteps: 35
        },
        {
          gridSize: 7,
          robotStart: { x: 3, y: 3 },
          collectiblesCount: 6,
          collectibleType: "üçé",
          walls: [
            { x: 1, y: 1 },
            { x: 1, y: 5 },
            { x: 5, y: 1 },
            { x: 5, y: 5 }
          ],
          description: "–†—ñ–≤–µ–Ω—å 5: –ù–∞–π—Å–∫–ª–∞–¥–Ω—ñ—à–∏–π —Ä—ñ–≤–µ–Ω—å. –ü–æ–ª–µ 7x7 –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ –ø–µ—Ä–µ—à–∫–æ–¥–∞–º–∏.",
          maxSteps: 40
        }
      ];
      let currentLevelIndex = 0;
      
      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∏
      function initGame() {
        loadLevel();
        updateStepCounter();
        displayLevels();
      }
      
      // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É —Ä—ñ–≤–Ω—ñ–≤
      function displayLevels() {
        levelProgressElement.innerHTML = "";
        levels.forEach((level, index) => {
          const levelBtn = document.createElement("div");
          levelBtn.className = "level-btn" + (index === currentLevelIndex ? " active" : "");
          levelBtn.textContent = `–†—ñ–≤–µ–Ω—å ${index + 1}`;
          levelBtn.onclick = () => jumpToLevel(index);
          levelProgressElement.appendChild(levelBtn);
        });
      }
      
      // –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –≤–∏–±—Ä–∞–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è
      function jumpToLevel(index) {
        currentLevelIndex = index;
        resetLevel();
      }
      
      // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è
      function loadLevel() {
        const levelConfig = levels[currentLevelIndex];
        gridSize = levelConfig.gridSize;
        robotPosition = { ...levelConfig.robotStart };
        maxSteps = levelConfig.maxSteps;
        walls = [...levelConfig.walls];
        stepCount = 0;
        currentCommandIndex = 0;
        parsedCommands = [];
      
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–ø–∏—Å—É —Ä—ñ–≤–Ω—è
        levelDescriptionElement.textContent = levelConfig.description;
        createField();
        updateStepCounter();
        logToConsole("–ì—Ä—É —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ. –ù–∞–ø–∏—à–∏ –ø—Ä–æ–≥—Ä–∞–º—É —ñ –Ω–∞—Ç–∏—Å–Ω–∏ '–ó–∞–ø—É—Å—Ç–∏—Ç–∏'.");
        displayLevels();
      }
      
      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–ª—è –≥—Ä–∏
      function createField() {
        robotField.innerHTML = "";
        robotField.style.gridTemplateColumns = `repeat(${gridSize}, 50px)`;
        robotField.style.gridTemplateRows = `repeat(${gridSize}, 50px)`;
        for (let y = 0; y < gridSize; y++) {
          for (let x = 0; x < gridSize; x++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.x = x;
            cell.dataset.y = y;
            robotField.appendChild(cell);
          }
        }
        updateWalls();
        updateRobotPosition();
        placeCollectibles();
      }
      
      // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç—ñ–Ω
      function updateWalls() {
        document.querySelectorAll(".cell").forEach((cell) => {
          cell.classList.remove("wall");
        });
        walls.forEach((wall) => {
          const cell = document.querySelector(`.cell[data-x="${wall.x}"][data-y="${wall.y}"]`);
          if (cell) cell.classList.add("wall");
        });
      }
      
      // –†–æ–∑–º—ñ—â–µ–Ω–Ω—è —Ñ—Ä—É–∫—Ç—ñ–≤/–æ–≤–æ—á—ñ–≤
      function placeCollectibles() {
        collectibles = [];
        const levelConfig = levels[currentLevelIndex];
        while (collectibles.length < levelConfig.collectiblesCount) {
          const x = Math.floor(Math.random() * gridSize);
          const y = Math.floor(Math.random() * gridSize);
          if (
            (x !== robotPosition.x || y !== robotPosition.y) &&
            !collectibles.some((item) => item.x === x && item.y === y) &&
            !walls.some((wall) => wall.x === x && wall.y === y)
          ) {
            collectibles.push({ x, y, type: levelConfig.collectibleType });
          }
        }
        updateCollectibles();
      }
      
      // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—ó —Ä–æ–±–æ—Ç–∞
      function updateRobotPosition() {
        document.querySelectorAll(".robot-icon").forEach((icon) => icon.remove());
        const cell = document.querySelector(`.cell[data-x="${robotPosition.x}"][data-y="${robotPosition.y}"]`);
        if (cell) {
          const robotIcon = document.createElement("div");
          robotIcon.className = "robot-icon";
          robotIcon.innerHTML = "ü§ñ";
          cell.appendChild(robotIcon);
        }
        checkCollectibles();
      }
      
      // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ñ—Ä—É–∫—Ç—ñ–≤/–æ–≤–æ—á—ñ–≤
      function updateCollectibles() {
        document.querySelectorAll(".collectible").forEach((item) => item.remove());
        collectibles.forEach((item) => {
          const cell = document.querySelector(`.cell[data-x="${item.x}"][data-y="${item.y}"]`);
          if (cell) {
            const collectibleIcon = document.createElement("div");
            collectibleIcon.className = "collectible";
            collectibleIcon.innerHTML = item.type;
            cell.appendChild(collectibleIcon);
          }
        });
      }
      
      // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–±–æ—Ä—É —Ñ—Ä—É–∫—Ç—ñ–≤/–æ–≤–æ—á—ñ–≤
      function checkCollectibles() {
        const itemIndex = collectibles.findIndex(
          (item) => item.x === robotPosition.x && item.y === robotPosition.y
        );
        if (itemIndex !== -1) {
          collectibles.splice(itemIndex, 1);
          updateCollectibles();
          logToConsole(
            `–ó—ñ–±—Ä–∞–Ω–æ ${levels[currentLevelIndex].collectibleType}! –ó–∞–ª–∏—à–∏–ª–æ—Å—å: ${collectibles.length}`,
            "success"
          );
          if (collectibles.length === 0) {
            setTimeout(() => {
              isRunning = false;
              clearInterval(executionInterval);
              showToast(`–ú–æ–ª–æ–¥–µ—Ü—å! –¢–∏ –∑–∞–≤–µ—Ä—à–∏–≤ —Ä—ñ–≤–µ–Ω—å!`);
              logToConsole("–†—ñ–≤–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –í—Å—ñ —Ñ—Ä—É–∫—Ç–∏ –∑—ñ–±—Ä–∞–Ω–æ.", "success");
              // –ü–µ—Ä–µ—Ö–æ–¥—å –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è –ø—ñ—Å–ª—è –∑–∞—Ç—Ä–∏–º–∫–∏
              setTimeout(() => {
                nextLevel();
              }, 2000);
            }, 500);
          }
        }
      }
      
      // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª—ñ—á–∏–ª—å–Ω–∏–∫–∞ –∫—Ä–æ–∫—ñ–≤
      function updateStepCounter() {
        stepCountElement.textContent = `–ö—Ä–æ–∫—ñ–≤: ${stepCount} / ${maxSteps}`;
        stepCountElement.style.backgroundColor =
          stepCount > maxSteps ? "var(--warning-color)" : "var(--primary-color)";
      }
      
      // –†—É—Ö —Ä–æ–±–æ—Ç–∞ –∑–∞ –∫–æ–º–∞–Ω–¥–æ—é
      function moveRobot(direction) {
        let newPosition = { ...robotPosition };
        switch (direction) {
          case "–≤–≥–æ—Ä—É":
            newPosition.y = Math.max(0, newPosition.y - 1);
            break;
          case "–≤–Ω–∏–∑":
            newPosition.y = Math.min(gridSize - 1, newPosition.y + 1);
            break;
          case "–≤–ª—ñ–≤–æ":
            newPosition.x = Math.max(0, newPosition.x - 1);
            break;
          case "–≤–ø—Ä–∞–≤–æ":
            newPosition.x = Math.min(gridSize - 1, newPosition.x + 1);
            break;
          default:
            logToConsole(`–ù–µ–≤—ñ–¥–æ–º–∞ –∫–æ–º–∞–Ω–¥–∞: ${direction}`, "error");
            return false;
        }
        
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ —Å—Ç—ñ–Ω—É
        const hitWall = walls.some(
          (wall) => wall.x === newPosition.x && wall.y === newPosition.y
        );
        if (hitWall) {
          logToConsole("–°—Ç—ñ–Ω–∞! –†–æ–±–æ—Ç –Ω–µ –º–æ–∂–µ —Ç—É–¥–∏ —Ä—É—Ö–∞—Ç–∏—Å—å.", "error");
          return false;
        }
        
        // –†—É—Ö —É—Å–ø—ñ—à–Ω–∏–π
        robotPosition = newPosition;
        stepCount++;
        updateStepCounter();
        updateRobotPosition();
        
        if (stepCount > maxSteps) {
          logToConsole(`–£–≤–∞–≥–∞: —Ç–∏ –ø–µ—Ä–µ–≤–∏—â–∏–≤ –æ–ø—Ç–∏–º–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫—Ä–æ–∫—ñ–≤ (${maxSteps})`, "error");
        }
        
        return true;
      }
      
      // –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–¥—É –ø—Ä–æ–≥—Ä–∞–º–∏
      function parseProgram() {
        const code = programTextarea.value.trim();
        if (!code) {
          showError("–ü—Ä–æ–≥—Ä–∞–º–∞ –ø–æ—Ä–æ–∂–Ω—è! –î–æ–¥–∞–π —Ö–æ—á–∞ –± –æ–¥–Ω—É –∫–æ–º–∞–Ω–¥—É.");
          return null;
        }
        
        const lines = code.split("\n");
        const commands = [];
        
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i].trim();
          if (!line || line.startsWith("//")) continue;
          
          const parts = line.split(" ");
          const command = parts[0].toLowerCase();
          const count = parts.length > 1 ? parseInt(parts[1]) : 1;
          
          if (isNaN(count) || count < 1) {
            showError(`–ü–æ–º–∏–ª–∫–∞ –≤ —Ä—è–¥–∫—É ${i + 1}: –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω—å`);
            return null;
          }
          
          if (!["–≤–≥–æ—Ä—É", "–≤–Ω–∏–∑", "–≤–ª—ñ–≤–æ", "–≤–ø—Ä–∞–≤–æ"].includes(command)) {
            showError(`–ü–æ–º–∏–ª–∫–∞ –≤ —Ä—è–¥–∫—É ${i + 1}: –Ω–µ–≤—ñ–¥–æ–º–∞ –∫–æ–º–∞–Ω–¥–∞ "${command}"`);
            return null;
          }
          
          for (let j = 0; j < count; j++) {
            commands.push({ command: command, line: i + 1 });
          }
        }
        
        return commands;
      }
      
      // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–∏
      function runProgram() {
        if (isRunning) return;
        parsedCommands = parseProgram();
        if (!parsedCommands) return;
        currentCommandIndex = 0;
        stepCount = 0;
        updateStepCounter();
        isRunning = true;
        logToConsole("–ü—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–ø—É—â–µ–Ω–∞...");
        executionInterval = setInterval(executeNextCommand, ANIMATION_SPEED);
      }
      
      // –í–∏–∫–æ–Ω–∞–Ω–Ω—è –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –∫–æ–º–∞–Ω–¥–∏
      function executeNextCommand() {
        if (!isRunning || currentCommandIndex >= parsedCommands.length) {
          stopProgram();
          if (collectibles.length > 0) {
            logToConsole("–ü—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –∞–ª–µ –Ω–µ –≤—Å—ñ —Ñ—Ä—É–∫—Ç–∏ –∑—ñ–±—Ä–∞–Ω—ñ!", "error");
          } else {
            logToConsole("–ü—Ä–æ–≥—Ä–∞–º–∞ —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!", "success");
          }
          return;
        }
        
        const currentCommand = parsedCommands[currentCommandIndex];
        logToConsole(`–í–∏–∫–æ–Ω—É—î–º–æ: ${currentCommand.command} (—Ä—è–¥–æ–∫ ${currentCommand.line})`);
        const success = moveRobot(currentCommand.command);
        currentCommandIndex++;
        
        if (!success) {
          stopProgram();
          logToConsole("–í–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏ –∑—É–ø–∏–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ –ø–æ–º–∏–ª–∫—É", "error");
        }
      }
      
      // –ó—É–ø–∏–Ω–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–∏
      function stopProgram() {
        if (!isRunning) return;
        clearInterval(executionInterval);
        isRunning = false;
        logToConsole("–ü—Ä–æ–≥—Ä–∞–º–∞ –∑—É–ø–∏–Ω–µ–Ω–∞");
      }
      
      // –°–∫–∏–¥–∞–Ω–Ω—è —Ä—ñ–≤–Ω—è (–æ—á–∏—â–µ–Ω–Ω—è –ø–æ–ª—è –∫–æ–º–∞–Ω–¥)
      function resetLevel() {
        stopProgram();
        stepCount = 0;
        currentCommandIndex = 0;
        parsedCommands = [];
        // –û—á–∏—â–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è –∫–æ–º–∞–Ω–¥
        programTextarea.value = "";
        loadLevel();
        logToConsole("–†—ñ–≤–µ–Ω—å —Å–∫–∏–Ω—É—Ç–æ");
      }
      
      // –ü–µ—Ä–µ—Ö—ñ–¥ –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è
      function nextLevel() {
        if (currentLevelIndex < levels.length - 1) {
          currentLevelIndex++;
          resetLevel();
        } else {
          logToConsole("–í—ñ—Ç–∞—î–º–æ! –í—Å—ñ —Ä—ñ–≤–Ω—ñ –ø—Ä–æ–π–¥–µ–Ω–æ!", "success");
        }
      }
      
      // –ü–æ–∫–∞–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (toast)
      function showToast(message) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.style.display = "block";
        setTimeout(() => {
          toast.style.display = "none";
        }, TOAST_DURATION);
      }
      
      // –ü–æ–∫–∞–∑ –ø–æ–º–∏–ª–∫–∏
      function showError(message) {
        logToConsole(message, "error");
        showToast(message, true);
      }
      
      // –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –∫–æ–Ω—Å–æ–ª—å
      function logToConsole(message, type = "info") {
        const consoleEl = document.getElementById("console");
        const line = document.createElement("div");
        line.className = "console-line";
        
        if (type === "error") {
          line.classList.add("console-error");
          message = "‚ùå " + message;
        } else if (type === "success") {
          line.classList.add("console-success");
          message = "‚úÖ " + message;
        }
        
        line.textContent = message;
        consoleEl.appendChild(line);
        consoleEl.scrollTop = consoleEl.scrollHeight;
        
        // –û–±–º–µ–∂–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ä—è–¥–∫—ñ–≤
        while (consoleEl.children.length > 20) {
          consoleEl.children[0].remove();
        }
      }
      
      window.onload = initGame;
    </script>
  </body>
</html>
