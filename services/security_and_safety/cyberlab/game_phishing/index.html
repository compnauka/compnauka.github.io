<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Game Account Phishing Simulator (AiTM Edition)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Rajdhani:wght@500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; height: 100dvh; width: 100vw; overflow: hidden; background-color: #0f0b15; color: #dcddde; }
        .font-mono { font-family: 'Fira Code', monospace; }
        .font-game { font-family: 'Rajdhani', sans-serif; }
        
        .terminal-scroll::-webkit-scrollbar { width: 6px; }
        .terminal-scroll::-webkit-scrollbar-track { background: #0f172a; }
        .terminal-scroll::-webkit-scrollbar-thumb { background: #ef4444; border-radius: 3px; }
        
        .discord-scroll::-webkit-scrollbar { width: 4px; height: 4px; background-color: #2f3136; }
        .discord-scroll::-webkit-scrollbar-thumb { background-color: #202225; border-radius: 4px; }

        .animate-slide-up { animation: slide-up 0.3s ease-out forwards; }
        @keyframes slide-up { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }

        .bg-desktop-wallpaper { 
            background: linear-gradient(135deg, #1a1625 0%, #0f0b15 100%);
            background-image: radial-gradient(circle at 50% 50%, rgba(239, 68, 68, 0.05) 0%, transparent 50%);
        }
        
        .window-shadow { box-shadow: 0 10px 40px rgba(0,0,0,0.6); }
        .text-warning { color: #f59e0b; }
    </style>
</head>
<body class="flex flex-col">

    <!-- ETHICS DISCLAIMER -->
    <div class="bg-amber-900/40 border-b border-amber-500/30 text-[10px] text-amber-200 py-1 px-4 text-center shrink-0 z-50">
        <i class="fas fa-exclamation-triangle mr-2"></i> ВВОДЬТЕ ВИГАДАНІ ДАНІ. НІЧОГО НЕ ЗБЕРІГАЄТЬСЯ. ДЛЯ НАВЧАЛЬНИХ ЦІЛЕЙ.
    </div>

    <!-- INFO MODAL -->
    <div id="infoModal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-[#36393f] border border-[#202225] rounded-lg max-w-lg w-full shadow-2xl overflow-hidden transform scale-95 transition-transform duration-300" id="modalContent">
            <div class="bg-[#202225] p-4 flex items-center gap-3 border-b border-[#000]">
                <i class="fas fa-shield-alt text-red-500 text-xl"></i>
                <h3 class="text-xl font-bold text-white uppercase tracking-wider">Аналіз загрози</h3>
                <button onclick="ui.closeModal()" class="absolute top-2 right-2 p-2 text-gray-400 hover:text-white transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <h4 id="modalTitle" class="text-lg font-bold text-red-400">...</h4>
                <div id="modalText" class="text-gray-300 text-sm leading-relaxed">...</div>
                <div class="bg-red-500/10 p-3 rounded-l-4 border-l-4 border-red-500 text-sm text-gray-200 mt-4 hidden" id="modalWarn">
                    <i class="fas fa-exclamation-triangle mr-2 text-red-500"></i>
                    <span id="modalWarnText">...</span>
                </div>
            </div>
            <div class="p-4 bg-[#2f3136] flex justify-end">
                <button onclick="ui.closeModal()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded transition shadow-lg text-sm">
                    ЗРОЗУМІЛО
                </button>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="bg-[#202225] border-b border-[#000] shrink-0 h-12 flex items-center justify-between px-4 z-50">
        <div class="flex items-center gap-3">
            <div class="bg-red-600 p-1.5 rounded">
                <i class="fas fa-user-secret text-white text-sm"></i>
            </div>
            <h1 class="font-bold tracking-wide text-sm text-white font-game uppercase">MitM Simulation <span class="text-red-500">v4.5</span></h1>
        </div>
        
        <div class="flex items-center gap-2">
            <button id="advToggle" onclick="core.toggleAdvanced()" class="text-[9px] bg-white/5 border border-white/10 px-2 py-1 rounded text-gray-400 hover:text-white transition">
                <i class="fas fa-microscope mr-1"></i> ADVANCED
            </button>
            <div class="flex items-center gap-2 px-2 py-1 bg-[#2f3136] rounded cursor-pointer" onclick="core.toggleProtection()">
                <span id="envStatus" class="font-bold text-red-500 font-mono text-[9px]">2FA: STANDARD</span>
            </div>
            <button onclick="core.fullReset()" class="text-[9px] text-gray-400 hover:text-white border border-gray-700 px-2 py-1 rounded transition">
                <i class="fas fa-redo"></i>
            </button>
        </div>
    </header>

    <!-- MOBILE TABS -->
    <div class="md:hidden flex border-b border-[#000] bg-[#2f3136] shrink-0 z-40">
        <button id="tabPhone" onclick="ui.switchTab('phone')" class="flex-1 py-3 text-xs font-bold border-b-2 border-red-500 text-red-500">Жертва</button>
        <button id="tabTerminal" onclick="ui.switchTab('terminal')" class="flex-1 py-3 text-xs font-bold border-b-2 border-transparent text-gray-400">Консоль</button>
    </div>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col md:grid md:grid-cols-2 overflow-hidden relative min-h-0">
        
        <!-- LEFT: VICTIM PC -->
        <div id="panelPhone" class="flex-1 relative bg-desktop-wallpaper flex items-center justify-center p-2 sm:p-4 overflow-hidden">
            <div class="w-full h-full max-h-[850px] bg-[#000] rounded-lg border-4 border-[#202225] shadow-2xl relative overflow-hidden window-shadow flex flex-col">
                <!-- OS Title Bar -->
                <div class="h-8 bg-[#202225] flex items-center justify-between px-3 shrink-0 border-b border-[#000]">
                    <div class="flex items-center gap-2 text-[10px] text-gray-400">
                        <i class="fab fa-discord text-[#5865f2]"></i>
                        <span class="font-medium text-white">Discord Desktop</span>
                    </div>
                </div>

                <!-- DESKTOP CONTENT AREA -->
                <div class="flex-1 relative bg-[#36393f] overflow-hidden flex min-h-0">
                    <!-- DISCORD APP -->
                    <div id="discordApp" class="absolute inset-0 flex w-full h-full transition-transform duration-500 overflow-hidden">
                        <!-- Server List -->
                        <div class="w-14 bg-[#202225] flex flex-col items-center py-3 gap-2 overflow-y-auto shrink-0 discord-scroll">
                            <div class="w-10 h-10 rounded-[16px] bg-[#5865f2] flex items-center justify-center text-white shrink-0">
                                <i class="fab fa-discord text-lg"></i>
                            </div>
                            <div class="w-10 h-10 rounded-[16px] bg-indigo-500 flex items-center justify-center text-xs font-bold text-white relative shrink-0 ring-2 ring-[#36393f]">
                                V
                                <div class="absolute -bottom-1 -right-1 bg-red-500 text-[8px] w-3 h-3 rounded-full border border-[#202225]"></div>
                            </div>
                        </div>

                        <!-- Sidebar -->
                        <div class="w-32 sm:w-44 bg-[#2f3136] flex flex-col shrink-0 border-r border-[#202225] min-w-0">
                            <div class="h-12 border-b border-[#202225] flex items-center px-3 font-bold text-white text-[11px] truncate">Void Community</div>
                            <div class="flex-1 overflow-y-auto p-1 discord-scroll">
                                <div class="px-2 py-1.5 rounded bg-[#393c43] text-white flex items-center gap-2 text-[11px] truncate">
                                    <i class="fas fa-hashtag opacity-60"></i> chat
                                </div>
                            </div>
                            <div class="h-12 bg-[#292b2f] flex items-center px-2 gap-2 shrink-0">
                                <div class="w-7 h-7 rounded-full bg-[#5865f2] relative"><div class="absolute bottom-0 right-0 w-2 h-2 bg-green-500 rounded-full border border-[#292b2f]"></div></div>
                                <div class="text-[10px] font-bold text-white truncate">Victim#1337</div>
                            </div>
                        </div>

                        <!-- Chat Area -->
                        <div class="flex-1 flex flex-col bg-[#36393f] relative min-w-0">
                            <div class="h-12 border-b border-[#26272d] flex items-center px-4 shrink-0 text-white font-bold text-xs"># chat</div>
                            <div class="flex-1 overflow-y-auto p-2 sm:p-4 space-y-4 discord-scroll flex flex-col-reverse" id="discordMessages">
                                <div id="phishMessage" class="flex gap-3 group hover:bg-[#32353b] -mx-2 px-2 py-2 hidden animate-fade-in border-l-2 border-transparent">
                                    <div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center font-bold text-white shrink-0 text-xs">P</div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-baseline gap-2">
                                            <span class="font-bold text-white text-[12px]">ProGamer123</span>
                                            <span class="text-[9px] text-gray-400">22:05</span>
                                        </div>
                                        <p class="text-gray-300 text-[12px] leading-relaxed">Йоу! Заціни, тут роздають скіни на Void Legends. Офіційна промка:</p>
                                        <div class="mt-2 bg-[#2f3136] rounded border-l-4 border-[#5865f2] p-2 max-w-sm w-full">
                                            <a href="#" onclick="core.openBrowser()" class="text-[#00b0f4] hover:underline text-[11px] break-all block font-medium">https://void-games-reward.com/login</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3 bg-[#36393f] shrink-0"><div class="bg-[#40444b] rounded p-2 text-gray-500 text-[11px]">Напишіть у #chat</div></div>
                        </div>
                    </div>

                    <!-- BROWSER WINDOW -->
                    <div id="browserApp" class="absolute inset-2 md:inset-4 bg-[#202124] rounded shadow-2xl flex flex-col hidden animate-slide-up border border-[#3c4043] z-20 overflow-hidden">
                        <div class="bg-[#292a2d] p-1.5 flex items-center gap-2 border-b border-[#3c4043] shrink-0">
                            <div class="flex-1 bg-[#202124] rounded-full px-3 py-1 text-[10px] text-gray-300 border border-[#5f6368] flex items-center justify-center min-w-0">
                                <i class="fas fa-lock text-green-500 mr-2 text-[8px]"></i>
                                <span class="truncate">void-games-reward.com/login</span>
                            </div>
                            <i class="fas fa-times text-gray-500 p-1 cursor-pointer" onclick="ui.closeBrowser()"></i>
                        </div>

                        <div class="flex-1 bg-[#0f0f12] overflow-y-auto relative flex flex-col items-center justify-center p-4">
                            <div class="w-full max-w-xs">
                                <div class="text-center mb-6">
                                    <i class="fas fa-ghost text-4xl text-purple-600 mb-2"></i>
                                    <h1 class="text-xl font-game font-bold text-white tracking-widest uppercase">VOID <span class="text-purple-500">ID</span></h1>
                                </div>
                                <div class="bg-[#1a1a20] p-5 rounded-lg border border-[#2d2f36] relative overflow-hidden">
                                    <div id="siteLoader" class="absolute inset-0 bg-[#1a1a20]/95 z-20 flex flex-col items-center justify-center hidden">
                                        <div class="w-6 h-6 border-2 border-purple-500 border-t-transparent rounded-full animate-spin mb-2"></div>
                                        <div id="loaderText" class="text-[9px] text-purple-400 font-mono">PROXYING...</div>
                                    </div>
                                    <div id="loginStep1" class="space-y-3">
                                        <div><label class="text-[9px] text-gray-400 font-bold uppercase block mb-1">Username</label><input type="text" id="victimUser" class="w-full bg-[#0f0f12] border border-[#2d2f36] rounded p-2 text-xs text-white" placeholder="Username"></div>
                                        <div><label class="text-[9px] text-gray-400 font-bold uppercase block mb-1">Password</label><input type="password" id="victimPass" class="w-full bg-[#0f0f12] border border-[#2d2f36] rounded p-2 text-xs text-white" placeholder="••••••••"></div>
                                        <button onclick="core.submitCreds()" class="w-full bg-purple-600 hover:bg-purple-500 text-white font-bold py-2 rounded text-[11px] uppercase tracking-wider">Sign In</button>
                                    </div>
                                    <div id="loginStep2" class="hidden text-center">
                                        <h3 class="text-white font-bold mb-1 text-sm">Security Code</h3>
                                        <p id="2faPrompt" class="text-[10px] text-gray-400 mb-4">Введіть 6-значний код підтвердження.</p>
                                        <div id="fidoChallenge" class="hidden py-3 border border-indigo-500/30 rounded bg-indigo-500/5 mb-4">
                                            <i class="fas fa-fingerprint text-2xl text-indigo-400 animate-pulse mb-1"></i>
                                            <p class="text-[9px] text-indigo-200 uppercase">Очікування FIDO2...</p>
                                        </div>
                                        <input type="text" id="guardCode" maxlength="6" class="w-32 bg-[#0f0f12] border-b border-purple-500 text-center text-xl font-mono text-white tracking-widest focus:outline-none mb-4" placeholder="••••••">
                                        <button id="guardSubmit" onclick="core.submitGuard()" class="w-full bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 rounded text-[11px] uppercase tracking-wider">Verify</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- DEBRIEF SCREEN -->
                    <div id="viewDebrief" class="absolute inset-0 bg-[#0f0f12] z-40 hidden flex flex-col overflow-y-auto animate-fade-in discord-scroll p-4 sm:p-8">
                        <div class="max-w-xl mx-auto w-full text-center">
                            <div id="debriefIcon"></div>
                            <h2 id="debriefTitle" class="text-xl sm:text-2xl font-bold text-white uppercase mb-4 font-game"></h2>
                            <div id="debriefContent" class="space-y-4 text-left"></div>
                            <button onclick="core.fullReset()" class="mt-8 bg-white/5 hover:bg-white/10 text-white text-[10px] px-8 py-3 rounded uppercase font-bold border border-white/10">Спробувати ще раз</button>
                        </div>
                    </div>

                    <!-- NOTIFICATION -->
                    <div id="sysNotification" class="absolute bottom-4 right-4 bg-[#1f1f1f] text-white p-3 rounded shadow-2xl border border-[#3c3c3c] z-[60] w-72 md:w-80 transform translate-y-40 transition-transform duration-500 cursor-pointer flex gap-3" onclick="ui.switchTab('phone')">
                        <div class="w-10 h-10 bg-indigo-600 flex items-center justify-center shrink-0"><i class="fas fa-envelope"></i></div>
                        <div class="flex-1 min-w-0" id="notifDetails">
                            <!-- Injected by JS -->
                        </div>
                    </div>

                    <!-- ALERT MODAL -->
                    <div id="phoneModal" class="absolute inset-0 bg-black/70 z-[70] hidden flex items-center justify-center p-4 backdrop-blur-sm">
                        <div class="bg-[#2f3136] rounded p-5 shadow-2xl border border-gray-700 text-center w-full max-w-[280px]">
                            <h3 id="pModalTitle" class="text-white font-bold mb-2 text-sm">Error</h3>
                            <p id="pModalText" class="text-gray-400 text-[11px] mb-6"></p>
                            <button onclick="ui.closePhoneModal()" class="w-full bg-red-600 text-white py-2 rounded text-[10px] font-bold">ЗРОЗУМІЛО</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT: HACKER TERMINAL -->
        <div id="panelTerminal" class="flex-1 bg-[#0d1117] flex flex-col border-l border-black relative hidden md:flex font-mono text-xs min-h-0">
            <div class="bg-[#161b22] p-2 border-b border-gray-800 flex justify-between items-center shrink-0">
                <span class="text-gray-500 text-[10px] pl-2">root@mitm-relay:~#</span>
                <div class="flex gap-1.5 pr-2"><div class="w-2 h-2 rounded-full bg-red-500"></div></div>
            </div>
            
            <div id="terminalOutput" class="flex-1 p-4 overflow-y-auto text-red-500 terminal-scroll font-mono text-[10px] bg-black/95">
                <div class="text-gray-500 mb-2"># Initializing AiTM framework...</div>
                <div class="text-red-400">[READY] Proxy active on :8080</div>
                <div class="text-gray-500">Waiting for victim...</div>
            </div>
            
            <div class="p-4 bg-[#161b22] border-t border-black shrink-0">
                <div id="taskBox" class="mb-3 bg-red-950/20 border border-red-500/20 p-3 rounded flex flex-col gap-2">
                    <div class="flex justify-between items-start">
                        <div class="flex gap-3 items-center">
                            <i class="fas fa-bolt text-red-500 animate-pulse mt-1"></i>
                            <div>
                                <h3 class="text-red-500 font-bold text-[10px] uppercase tracking-wider">Місія атаки</h3>
                                <p id="missionText" class="text-gray-400 text-[11px] mt-0.5">...</p>
                            </div>
                        </div>
                        <button onclick="ui.showExplanation()" class="flex items-center gap-2 bg-red-900/30 hover:bg-red-800/50 text-red-400 px-2 py-1.5 rounded text-[10px] font-bold transition shrink-0 border border-red-500/30">
                            <i class="fas fa-question-circle"></i>
                            Що це означає?
                        </button>
                    </div>
                </div>

                <div id="cmdHintBlock" class="mb-3">
                    <code id="cmdHint" class="block bg-black border border-gray-800 p-2 rounded text-amber-500 text-[10px] cursor-pointer hover:border-red-500 transition select-none" onclick="core.fillCommand()">
                        <span class="opacity-40">$ </span>...
                    </code>
                </div>
                
                <form id="cmdForm" class="flex items-center gap-2 bg-black p-2 rounded border border-gray-800 focus-within:border-red-500 transition" onsubmit="core.handleCommand(event)">
                    <span class="text-red-600 font-bold text-[11px] shrink-0">#</span>
                    <input id="cmdInput" type="text" autocomplete="off" class="flex-1 bg-transparent border-none text-white focus:ring-0 focus:outline-none text-[11px]" placeholder="command..." autofocus>
                </form>
            </div>
        </div>
    </main>

    <script>
        const CONFIG = {
            STEPS: [
                {
                    id: 'init',
                    cmd: './launch_phish.py --source discord',
                    mission: "1. Надішли фішингове посилання жертві.",
                    termLog: `[>] Generating Discord Lure...\n[SUCCESS] DM sent to VictimGamer#1337.`,
                    termExpl: `[INFO] Атака через DM від друга є найбільш ефективною формою соціальної інженерії.`,
                    expl: { title: "Social Engineering", text: "Ви довіряєте другу. Це головний важіль атаки.", tip: "Ніколи не переходьте за лінками, що обіцяють 'халяву'." }
                },
                {
                    id: 'wait_click',
                    cmd: 'listen --proxy --capture',
                    mission: "2. Запусти перехоплення трафіку (AiTM).",
                    termLog: `[LISTENING] HTTP Proxy active.\n[INFO] Awaiting Victim...`,
                    termExpl: `[INFO] Хакер бачить кожне відвідування свого сайту-пастки.`,
                    manualTrigger: true,
                    expl: { title: "AiTM (Adversary-in-the-Middle)", text: "Це не просто підроблена сторінка. Хакер використовує 'reverse proxy' — скрипт, який передає ваші дані справжньому серверу В РЕАЛЬНОМУ ЧАСІ.", tip: "Email/SMS коди не захищають від фішингу в реальному часі." }
                },
                {
                    id: 'capture_creds',
                    cmd: 'intercept_credentials',
                    mission: "3. Перехопи логін та пароль.",
                    termLog: `[HTTP] POST /auth/login captured.`,
                    termExpl: `[INFO] Пароль в руках хакера. Він передає його на справжній сервер.`,
                    manualTrigger: true,
                    expl: { title: "Credential Harvest", text: "Ваші дані передаються хакеру в момент натискання кнопки 'Увійти'.", tip: "Менеджери паролів не підставлять дані на фейковий домен." }
                },
                {
                    id: 'bypass_2fa',
                    cmd: './relay_2fa.py',
                    mission: "4. Ретранслюй 2FA запит від реального сервера.",
                    termLog: `[PROXY] Establishing real-time relay...`,
                    termExpl: `[INFO] Коли справжній сервер просить 2FA, хакер миттєво показує це прохання вам на фейковому сайті.`,
                    expl: { title: "2FA Relay", text: "Хакер не знає ваш код, тому він змушує ВАС ввести його для нього.", tip: "Звертайте увагу на ЛОКАЦІЮ входу в листі з кодом." }
                },
                {
                    id: 'finalize',
                    cmd: 'steal_session --takeover',
                    mission: "5. Захопи сесію та змініть дані.",
                    manualTrigger: true,
                    termLog: `[SUCCESS] Session Hijacked.\n[ACTION] Changing recovery data...`,
                    termExpl: `[INFO] Акаунт вкрадено. Сесію перехоплено.`,
                    expl: { title: "Full Compromise", text: "Маючи код, хакер змінює пошту за секунди.", tip: "Використовуйте апаратні ключі (FIDO2)." }
                }
            ]
        };

        const state = { stepIndex: 0, generatedCode: null, protectionMode: 'standard', advancedMode: false };

        const ui = {
            els: {
                term: document.getElementById('terminalOutput'),
                missionText: document.getElementById('missionText'),
                cmdInput: document.getElementById('cmdInput'),
                cmdHint: document.getElementById('cmdHint'),
                views: { discord: document.getElementById('discordApp'), browser: document.getElementById('browserApp'), debrief: document.getElementById('viewDebrief') },
                overlays: { modal: document.getElementById('infoModal'), notif: document.getElementById('sysNotification'), loader: document.getElementById('siteLoader'), phoneModal: document.getElementById('phoneModal') }
            },
            log(text, type = 'neutral') {
                const div = document.createElement('div');
                div.innerText = text;
                div.className = 'mb-0.5 break-all font-mono ' + 
                    (type === 'success' ? 'text-green-400' : 
                     type === 'error' ? 'text-red-500 font-bold' : 
                     type === 'info' ? 'text-red-400 font-bold' : 
                     type === 'warning' ? 'text-warning font-bold' : 
                     type === 'expl' ? 'text-cyan-400 italic border-l-2 border-cyan-500 pl-2 my-2 py-1 text-[9px]' : 'text-gray-500');
                this.els.term.appendChild(div);
                this.els.term.scrollTop = this.els.term.scrollHeight;
            },
            updateStep() {
                if(state.stepIndex >= CONFIG.STEPS.length) return;
                const step = CONFIG.STEPS[state.stepIndex];
                this.els.missionText.innerText = step.mission;
                if (step.manualTrigger) {
                    this.els.cmdInput.disabled = true;
                    this.els.cmdInput.placeholder = "(Чекаємо дії...)";
                    document.getElementById('cmdHintBlock').classList.add('hidden');
                } else {
                    this.els.cmdInput.disabled = false;
                    this.els.cmdInput.placeholder = "command...";
                    this.els.cmdInput.focus();
                    document.getElementById('cmdHintBlock').classList.remove('hidden');
                    this.els.cmdHint.innerHTML = `<span class="opacity-40">$ </span>${step.cmd}`;
                }
            },
            showView(name) {
                Object.values(this.els.views).forEach(v => v.classList.add('hidden'));
                this.els.views[name].classList.remove('hidden');
            },
            closeBrowser() { this.showView('discord'); },
            switchTab(tab) {
                const isPhone = tab === 'phone';
                document.getElementById('panelPhone').classList.toggle('hidden', !isPhone);
                document.getElementById('panelPhone').classList.toggle('flex', isPhone);
                document.getElementById('panelTerminal').classList.toggle('hidden', isPhone);
                document.getElementById('panelTerminal').classList.toggle('flex', !isPhone);
            },
            showModal(title, text, tip) {
                document.getElementById('modalTitle').innerText = title;
                document.getElementById('modalText').innerText = text;
                const w = document.getElementById('modalWarn');
                if(tip) { w.classList.remove('hidden'); document.getElementById('modalWarnText').innerText = tip; }
                else w.classList.add('hidden');
                this.els.overlays.modal.classList.remove('hidden');
                setTimeout(() => this.els.overlays.modal.classList.remove('opacity-0'), 10);
            },
            closeModal() {
                this.els.overlays.modal.classList.add('opacity-0');
                setTimeout(() => this.els.overlays.modal.classList.add('hidden'), 300);
            },
            showExplanation() {
                const step = CONFIG.STEPS[state.stepIndex];
                if (step && step.expl) this.showModal(step.expl.title, step.expl.text, step.expl.tip);
            },
            showNotif(code) {
                document.getElementById('realGuardCode').innerText = code;
                document.getElementById('notifDetails').innerHTML = `
                    <div class="text-[10px] font-bold text-gray-400 mb-0.5">Mail • Зараз</div>
                    <div class="text-xs font-bold truncate text-white">Код: <span class="text-yellow-400">${code}</span></div>
                    <div class="text-[9px] text-gray-400 mt-1">
                        <div class="flex justify-between"><span>IP:</span><span class="text-red-400">95.142.7.183</span></div>
                        <div class="flex justify-between"><span>Браузер:</span><span>Chrome 121 (Linux)</span></div>
                        <div class="flex justify-between"><span>Локація:</span><span class="text-red-400">Moscow, RU</span></div>
                    </div>
                `;
                this.els.overlays.notif.classList.remove('translate-y-40');
                setTimeout(() => this.els.overlays.notif.classList.add('translate-y-40'), 12000);
            },
            showPhoneModal(title, text) {
                document.getElementById('pModalTitle').innerText = title;
                document.getElementById('pModalText').innerText = text;
                this.els.overlays.phoneModal.classList.remove('hidden');
            },
            closePhoneModal() { this.els.overlays.phoneModal.classList.add('hidden'); },
            reshowCode() { if(state.generatedCode) this.showNotif(state.generatedCode); }
        };

        const core = {
            init() { ui.updateStep(); ui.switchTab('phone'); },
            toggleAdvanced() {
                state.advancedMode = !state.advancedMode;
                document.getElementById('advToggle').classList.toggle('bg-red-900/40', state.advancedMode);
                ui.log(`[SYS] Advanced Mode: ${state.advancedMode ? 'ENABLED' : 'DISABLED'}`, 'warning');
            },
            toggleProtection() {
                state.protectionMode = state.protectionMode === 'standard' ? 'enhanced' : 'standard';
                const el = document.getElementById('envStatus');
                el.innerText = state.protectionMode === 'enhanced' ? '2FA: FIDO2/PASSKEY' : '2FA: STANDARD';
                el.className = 'font-bold font-mono text-[9px] ' + (state.protectionMode === 'enhanced' ? 'text-green-500' : 'text-red-500');
            },
            handleCommand(e) {
                e.preventDefault();
                const input = ui.els.cmdInput.value.trim();
                if(!input) return;
                ui.log(`# ${input}`);
                const step = CONFIG.STEPS[state.stepIndex];
                if (input === step.cmd || input.startsWith(step.cmd.split(' ')[0])) {
                    this.executeStep(step);
                    ui.els.cmdInput.value = '';
                } else ui.log(`sh: ${input}: not found`, 'error');
            },
            fillCommand() { if(!ui.els.cmdInput.disabled) { ui.els.cmdInput.value = CONFIG.STEPS[state.stepIndex].cmd; ui.els.cmdInput.focus(); } },
            executeStep(step) {
                if(step.termLog) step.termLog.split('\n').forEach((line, i) => setTimeout(() => ui.log(line, line.includes('SUCCESS') ? 'success' : 'info'), i * 200));
                
                if (step.id === 'bypass_2fa') {
                    setTimeout(() => {
                        ui.log(`[PROXY] Establishing real-time relay...`, 'warning');
                        ui.log(`[MITM] Phishing Site <---> Attacker <---> Real Server`, 'info');
                        ui.log(`[INFO] Victim's inputs will be forwarded INSTANTLY.`, 'expl');
                        
                        state.generatedCode = Math.floor(100000 + Math.random() * 900000);
                        state.stepIndex++; ui.updateStep();
                        ui.els.overlays.loader.classList.add('hidden');
                        document.getElementById('loginStep1').classList.add('hidden');
                        document.getElementById('loginStep2').classList.remove('hidden');
                        
                        if(state.protectionMode === 'enhanced') {
                            document.getElementById('fidoChallenge').classList.remove('hidden');
                            document.getElementById('guardCode').classList.add('hidden');
                            document.getElementById('guardSubmit').innerText = 'USE SECURITY KEY';
                        }
                        
                        setTimeout(() => { ui.switchTab('phone'); if(state.protectionMode === 'standard') ui.showNotif(state.generatedCode); }, 1500);
                    }, 1000);
                } else if (step.id === 'init') {
                    setTimeout(() => { document.getElementById('phishMessage').classList.remove('hidden'); state.stepIndex++; ui.updateStep(); }, 1000);
                } else { state.stepIndex++; ui.updateStep(); }
            },
            openBrowser() {
                if (CONFIG.STEPS[state.stepIndex].id !== 'wait_click') return;
                ui.log(`[ACCESS] GET /login FROM 95.142.7.183`, 'warning');
                ui.showView('browser');
                state.stepIndex++; ui.updateStep();
            },
            submitCreds() {
                const user = document.getElementById('victimUser').value;
                const pass = document.getElementById('victimPass').value;
                if(!user || !pass) return ui.showPhoneModal("Error", "Empty fields.");
                ui.els.overlays.loader.classList.remove('hidden');
                
                setTimeout(() => {
                    ui.log(`[INTERCEPT] Captured HTTP POST:`, 'info');
                    ui.log(`  POST https://void-games-reward.com/login`, 'neutral');
                    ui.log(`  user=${user}&pass=${pass}`, 'neutral');
                    ui.log(`[PROXY] Forwarding to REAL server...`, 'warning');
                    ui.log(`  POST https://voidgames.com/api/auth`, 'neutral');
                    ui.log(`[REAL_SERVER] Response: 2FA_REQUIRED`, 'error');
                    
                    if(state.advancedMode) {
                        ui.log(`[DEBUG] Phishing Kit: v-relay-core`, 'info');
                        ui.log(`[DEBUG] Victim IP: 95.142.7.183`, 'neutral');
                    }
                    
                    state.stepIndex++; ui.updateStep(); ui.switchTab('terminal');
                }, 1000);
            },
            submitGuard() {
                if(state.protectionMode === 'enhanced') {
                    ui.els.overlays.loader.classList.remove('hidden');
                    document.getElementById('loaderText').innerText = 'PROXIED FIDO2 CHALLENGE...';
                    setTimeout(() => {
                        ui.log(`[FAILURE] Origin binding failed. Domain mismatch.`, 'error');
                        ui.log(`[ABORT] Cannot proxy hardware challenge.`, 'error');
                        this.showFinalDebrief(true);
                    }, 2000);
                    return;
                }
                const code = document.getElementById('guardCode').value;
                if(code != state.generatedCode) return ui.showPhoneModal("Error", "Invalid code.");
                ui.els.overlays.loader.classList.remove('hidden');
                ui.log(`[CAPTURED] 2FA: ${code}`, 'success');
                setTimeout(() => { 
                    ui.log(`[SUCCESS] Hijacked!`, 'success');
                    if(state.advancedMode) ui.log(`[DEBUG] Session token: eyJhbGciOiJIUzI1Ni...`, 'neutral');
                    this.showFinalDebrief(false); 
                }, 1000);
            },
            showFinalDebrief(protected) {
                ui.showView('debrief');
                const icon = document.getElementById('debriefIcon');
                const title = document.getElementById('debriefTitle');
                const content = document.getElementById('debriefContent');
                
                if(protected) {
                    icon.innerHTML = '<i class="fas fa-shield-check text-5xl text-green-500 mb-4"></i>';
                    title.innerText = 'АТАКУ ВІДБИТО';
                    title.className = "text-xl sm:text-2xl font-bold text-green-500 uppercase mb-4 font-game";
                    content.innerHTML = `<div class="bg-green-500/10 p-4 rounded border-l-4 border-green-500 text-xs text-gray-300">Ви використали <b>FIDO2</b>. Цей метод прив'язаний до домену. Підроблений сайт не пройшов перевірку ключа.</div>`;
                } else {
                    icon.innerHTML = '<i class="fas fa-skull-crossbones text-4xl text-red-500 mb-4"></i>';
                    title.innerText = 'АКАУНТ ЗЛАМАНО';
                    title.className = "text-xl sm:text-2xl font-bold text-red-500 uppercase mb-4 font-game";
                    content.innerHTML = `
                        <div class="bg-red-500/10 p-4 rounded border-l-4 border-red-500 text-[11px] text-gray-300">
                            Це була атака <b>AiTM</b>. Ви самі передали код хакеру в реальному часі.
                        </div>
                        <div class="mt-6 space-y-2">
                            <div class="text-xs font-bold text-gray-400 uppercase mb-3 text-left">Таймлайн атаки:</div>
                            <div class="flex gap-3 items-start text-left"><div class="bg-red-500 w-2 h-2 rounded-full mt-1 shrink-0"></div><div class="text-[11px] text-gray-300"><span class="font-bold">22:05</span> — Отримано лінк</div></div>
                            <div class="flex gap-3 items-start text-left"><div class="bg-red-500 w-2 h-2 rounded-full mt-1 shrink-0"></div><div class="text-[11px] text-gray-300"><span class="font-bold">22:07</span> — Пароль перехоплено</div></div>
                            <div class="flex gap-3 items-start text-left"><div class="bg-red-500 w-2 h-2 rounded-full mt-1 shrink-0"></div><div class="text-[11px] text-gray-300"><span class="font-bold">22:08</span> — 2FA код викрадено</div></div>
                        </div>
                        <div class="bg-gray-800/50 p-4 rounded mt-6 text-left">
                            <h4 class="text-xs font-bold text-gray-400 uppercase mb-2">Факти:</h4>
                            <ul class="text-[11px] text-gray-400 space-y-2 list-disc list-inside">
                                <li>90% атак використовують соціальну інженерію.</li>
                                <li>За 2024 рік зламано <b>2.3M</b> акаунтів через фішинг.</li>
                                <li>FIDO2 знижує ризик зламу на <b>99.9%</b>.</li>
                            </ul>
                        </div>
                    `;
                }
            },
            fullReset() { location.reload(); }
        };
        core.init();
    </script>
</body>
</html>
