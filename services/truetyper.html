<!DOCTYPE html>
<html lang="uk">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>–°–ø—Ä–∞–≤–∂–Ω—ñ–π –î—Ä—É–∫ | –ö–ª–∞–≤—ñ–∞—Ç—É—Ä–Ω–∏–π –¢—Ä–µ–Ω–∞–∂–µ—Ä —Ç–∞ —É—Ä–æ–∫–∏ –¥—Ä—É–∫—É</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800;900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Nunito', 'Segoe UI', sans-serif;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
        }

        .key-3d {
            background: linear-gradient(to bottom, #ffffff 0%, #f3f4f6 100%);
            border-radius: 4px;
            box-shadow: 0 2px 0 #94a3b8, 0 3px 3px rgba(0, 0, 0, 0.15);
            transition: transform 0.05s ease, box-shadow 0.05s ease, background-color 0.1s;
            position: relative;
            top: 0;
            border: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 1;
            cursor: pointer;
            min-width: 0;
            touch-action: manipulation;
        }

        @media (min-width: 768px) {
            .key-3d {
                border-radius: 6px;
                box-shadow: 0 4px 0 #94a3b8, 0 5px 5px rgba(0, 0, 0, 0.15);
            }
        }

        .key-3d:active,
        .key-pressed {
            transform: translateY(2px);
            box-shadow: 0 0 0 #94a3b8, inset 0 1px 2px rgba(0, 0, 0, 0.1);
            background: #e2e8f0;
        }

        @media (min-width: 768px) {

            .key-3d:active,
            .key-pressed {
                transform: translateY(4px);
                box-shadow: 0 0 0 #94a3b8, inset 0 2px 4px rgba(0, 0, 0, 0.1);
            }
        }

        .key-hint {
            background: linear-gradient(to bottom, #fde047 0%, #facc15 100%) !important;
            border-color: #eab308 !important;
            box-shadow: 0 2px 0 #a16207, 0 0 5px rgba(250, 204, 21, 0.6) !important;
            color: #422006 !important;
            z-index: 10;
        }

        @media (min-width: 768px) {
            .key-hint {
                box-shadow: 0 4px 0 #a16207, 0 0 10px rgba(250, 204, 21, 0.6) !important;
            }
        }

        .key-hint:active,
        .key-hint.key-pressed {
            box-shadow: 0 0 0 #a16207, inset 0 2px 4px rgba(0, 0, 0, 0.1) !important;
        }

        .key-special {
            background: linear-gradient(to bottom, #cbd5e1 0%, #94a3b8 100%);
            box-shadow: 0 2px 0 #64748b;
            color: #334155;
            border: 1px solid #94a3b8;
            cursor: default;
        }

        @media (min-width: 768px) {
            .key-special {
                box-shadow: 0 4px 0 #64748b;
            }
        }

        .key-special:active,
        .key-special.key-pressed {
            box-shadow: 0 0 0 #64748b;
            background: #94a3b8;
        }

        .shake {
            animation: shake 0.4s cubic-bezier(.36, .07, .19, .97) both;
        }

        @keyframes shake {

            10%,
            90% {
                transform: translate3d(-1px, 0, 0);
            }

            20%,
            80% {
                transform: translate3d(2px, 0, 0);
            }

            30%,
            50%,
            70% {
                transform: translate3d(-4px, 0, 0);
            }

            40%,
            60% {
                transform: translate3d(4px, 0, 0);
            }
        }

        .milestone-enter {
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes popIn {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(20px);
            }

            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .trophy-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .hidden-key {
            display: none !important;
        }
    </style>
</head>

<body class="bg-indigo-600 h-screen flex flex-col items-center justify-between py-2 md:py-4 overflow-hidden"
    role="application">

    <!-- Start Modal -->
    <div id="start-modal"
        class="fixed inset-0 z-[1000] flex flex-col items-center justify-center bg-slate-900/90 backdrop-blur-lg px-4"
        aria-modal="true" role="dialog">
        <div
            class="bg-white p-8 rounded-3xl shadow-2xl text-center max-w-md w-full border-4 border-indigo-100 relative">
            <div class="text-5xl mb-4">‚å®Ô∏è</div>
            <h1 class="text-3xl font-black text-indigo-600 mb-4">–¢—Ä–µ–Ω–∞–∂–µ—Ä –¥—Ä—É–∫—É</h1>
            <p class="text-slate-600 mb-6 font-medium">–ù–∞—Ç–∏—Å–∫–∞–π –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∫–ª–∞–≤—ñ—à—ñ –Ω–∞ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—ñ, —â–æ–± –¥—Ä—É–∫—É–≤–∞—Ç–∏ —Å–ª–æ–≤–∞.
                –í–¥–æ—Å–∫–æ–Ω–∞–ª—é–π —Å–≤–æ—é —à–≤–∏–¥–∫—ñ—Å—Ç—å —Ç–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å!</p>
            <button id="start-game-btn"
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl shadow-lg transform transition active:scale-95 cursor-pointer">
                –ü–æ—á–∞—Ç–∏
            </button>
        </div>
    </div>

    <!-- Milestone Modal -->
    <div id="milestone-modal"
        class="hidden fixed inset-0 z-[999] flex flex-col items-center justify-center bg-slate-900/80 backdrop-blur-md transition-opacity duration-300 px-4"
        aria-modal="true" role="dialog">
        <div
            class="relative bg-white p-6 md:p-8 rounded-3xl shadow-[0_0_50px_rgba(79,70,229,0.5)] text-center milestone-enter w-full max-w-sm mx-auto border-4 border-indigo-50 overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-full pointer-events-none">
                <div
                    class="absolute -top-10 -right-10 w-24 h-24 md:w-32 md:h-32 bg-yellow-200 rounded-full mix-blend-multiply filter blur-2xl opacity-50">
                </div>
                <div
                    class="absolute -bottom-10 -left-10 w-24 h-24 md:w-32 md:h-32 bg-indigo-200 rounded-full mix-blend-multiply filter blur-2xl opacity-50">
                </div>
            </div>

            <div class="relative z-10">
                <div class="text-5xl md:text-7xl mb-4 trophy-float filter drop-shadow-lg">üèÜ</div>
                <h2 class="text-3xl md:text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 mb-2 drop-shadow-sm"
                    id="modal-title">Super!</h2>
                <p class="text-slate-500 text-lg md:text-xl font-bold mb-6 md:mb-8" id="milestone-text">5 words done!
                </p>

                <button id="modal-next-btn"
                    class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-bold py-3 px-6 md:py-4 md:px-8 rounded-2xl shadow-lg transform transition hover:scale-[1.02] active:scale-95 flex items-center justify-center gap-2 group cursor-pointer outline-none focus:ring-4 focus:ring-indigo-300">
                    <span id="modal-btn-text">Next</span>
                    <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                </button>

                <div class="mt-4 text-[8px] md:text-[10px] text-slate-400 font-bold uppercase tracking-widest"
                    id="modal-hint">
                    Press any key
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirm-modal"
        class="hidden fixed inset-0 z-[1001] flex flex-col items-center justify-center bg-slate-900/80 backdrop-blur-md transition-opacity duration-300 px-4"
        aria-modal="true" role="dialog">
        <div
            class="relative bg-white p-6 md:p-8 rounded-3xl shadow-2xl text-center milestone-enter w-full max-w-md mx-auto border-4 border-indigo-100 overflow-hidden">
            <div class="relative z-10">
                <div class="text-5xl mb-4">üåç</div>
                <h2 class="text-2xl md:text-3xl font-black text-indigo-600 mb-4">–ó–º—ñ–Ω–∞ –º–æ–≤–∏</h2>
                <p class="text-slate-600 mb-8 font-medium">–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –º–æ–≤—É? –ü–æ—Ç–æ—á–Ω–∏–π –ø—Ä–æ–≥—Ä–µ—Å –±—É–¥–µ
                    –≤—Ç—Ä–∞—á–µ–Ω–æ.</p>

                <div class="flex flex-col sm:flex-row gap-3">
                    <button id="confirm-cancel-btn"
                        class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold py-3 px-6 rounded-2xl transition active:scale-95 cursor-pointer">
                        –°–∫–∞—Å—É–≤–∞—Ç–∏
                    </button>
                    <button id="confirm-yes-btn"
                        class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-2xl shadow-lg transition active:scale-95 cursor-pointer">
                        –¢–∞–∫, –∑–º—ñ–Ω–∏—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header & Stats -->
    <div class="w-full max-w-5xl px-2 md:px-4 flex flex-col gap-2 md:gap-4 relative z-10 shrink-0">
        <div class="flex justify-between items-center text-white drop-shadow-md">
            <div class="text-lg md:text-2xl font-extrabold tracking-wider flex items-center gap-2">
                <i class="fa-solid fa-keyboard text-yellow-300"></i>
                <span class="hidden sm:inline">–°–ø—Ä–∞–≤–∂–Ω—ñ–π –î—Ä—É–∫</span>
            </div>

            <div class="flex gap-2 md:gap-3 items-center">
                <button id="lang-toggle"
                    class="bg-white/20 backdrop-blur-md border border-white/30 px-2 py-1 md:px-3 md:py-1.5 rounded-lg md:rounded-xl font-bold text-xs md:text-sm hover:bg-white/30 transition shadow-sm focus:outline-none focus:ring-2 focus:ring-white">
                    UA | EN
                </button>

                <button id="sound-toggle"
                    class="bg-white/20 backdrop-blur-md border border-white/30 w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center hover:bg-white/30 transition shadow-sm focus:outline-none focus:ring-2 focus:ring-white"
                    aria-label="Toggle Sound">
                    <i class="fa-solid fa-volume-high text-white text-xs md:text-base"></i>
                </button>
            </div>
        </div>

        <!-- Stats -->
        <div class="flex flex-wrap justify-center gap-1 md:gap-4 w-full" id="stats-row">
            <div
                class="bg-white/20 backdrop-blur-md border border-white/30 px-2 py-1 md:px-3 md:py-2 rounded-lg md:rounded-xl flex flex-col items-center min-w-[60px] md:min-w-[80px]">
                <span class="text-[8px] md:text-[10px] uppercase font-bold text-yellow-200"
                    data-stat-label="words">Score</span>
                <span id="score-counter" class="font-black text-sm md:text-xl text-white">0</span>
            </div>

            <div
                class="bg-white/20 backdrop-blur-md border border-white/30 px-2 py-1 md:px-3 md:py-2 rounded-lg md:rounded-xl flex flex-col items-center min-w-[60px] md:min-w-[80px]">
                <span class="text-[8px] md:text-[10px] uppercase font-bold text-red-200"
                    data-stat-label="errors">Errors</span>
                <span id="error-counter" class="font-black text-sm md:text-xl text-red-100">0</span>
            </div>

            <div
                class="bg-white/20 backdrop-blur-md border border-white/30 px-2 py-1 md:px-3 md:py-2 rounded-lg md:rounded-xl flex flex-col items-center relative overflow-hidden min-w-[60px] md:min-w-[80px]">
                <div class="absolute inset-0 bg-yellow-400/10"></div>
                <span class="text-[8px] md:text-[10px] uppercase font-bold text-orange-200"
                    data-stat-label="record">Record</span>
                <span id="best-score" class="font-black text-sm md:text-xl text-orange-100">0</span>
            </div>

            <div
                class="bg-white/20 backdrop-blur-md border border-white/30 px-2 py-1 md:px-3 md:py-2 rounded-lg md:rounded-xl flex flex-col items-center min-w-[60px] md:min-w-[80px]">
                <span class="text-[8px] md:text-[10px] uppercase font-bold text-blue-200"
                    data-stat-label="wpm">WPM</span>
                <span id="wpm-counter" class="font-black text-sm md:text-xl text-blue-100">0</span>
            </div>

            <div
                class="bg-white/20 backdrop-blur-md border border-white/30 px-2 py-1 md:px-3 md:py-2 rounded-lg md:rounded-xl flex flex-col items-center min-w-[60px] md:min-w-[80px]">
                <span class="text-[8px] md:text-[10px] uppercase font-bold text-green-200"
                    data-stat-label="accuracy">Accuracy</span>
                <span id="accuracy-counter" class="font-black text-sm md:text-xl text-green-100">100%</span>
            </div>
        </div>

        <div class="w-full bg-slate-900/30 rounded-full h-2 md:h-3 overflow-hidden border border-white/10 shadow-inner">
            <div id="progress-bar"
                class="bg-gradient-to-r from-yellow-400 to-orange-500 h-full transition-all duration-500 ease-out shadow-[0_0_10px_rgba(251,191,36,0.5)]"
                style="width: 0%"></div>
        </div>
    </div>

    <!-- Main -->
    <div class="flex-grow flex flex-col items-center justify-center w-full max-w-3xl px-2 md:px-4 relative z-0 min-h-0">
        <div class="relative w-full flex flex-col items-center justify-center flex-grow">
            <div id="word-display"
                class="bg-white rounded-2xl md:rounded-3xl shadow-2xl border-b-4 md:border-b-8 border-slate-200 px-4 py-4 md:px-8 md:py-10 text-center text-4xl md:text-7xl font-black text-slate-300 tracking-wider w-full min-h-[80px] md:min-h-[140px] flex items-center justify-center transform transition-all"
                aria-live="polite" role="status"></div>

            <div id="message-area"
                class="h-6 md:h-8 mt-2 md:mt-4 text-lg md:text-2xl font-bold text-yellow-300 drop-shadow-md opacity-0 transition-opacity duration-300 text-center"
                aria-live="assertive">
                Great!
            </div>
        </div>
    </div>

    <!-- Keyboard -->
    <div class="w-full max-w-5xl px-1 md:px-2 pb-2 md:pb-4 select-none shrink-0">
        <div class="bg-gray-300 p-1 md:p-5 rounded-lg md:rounded-xl shadow-[0_10px_30px_rgba(0,0,0,0.5)] border-b-4 md:border-b-8 border-gray-400 mx-auto w-full"
            id="keyboard-container">
            <div class="flex gap-0.5 md:gap-1.5 mb-1 md:mb-3 w-full">
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">`</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">1</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">2</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">3</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">4</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">5</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">6</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">7</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">8</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">9</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">0</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">-</div>
                <div class="key-3d key-special flex-1 h-8 md:h-12 font-bold text-[10px] md:text-sm">=</div>
                <div class="key-3d key-special flex-[1.5] h-8 md:h-12 text-[10px] md:text-sm cursor-pointer"
                    data-action="backspace">
                    <i class="fa-solid fa-delete-left"></i>
                </div>
            </div>

            <div class="flex gap-0.5 md:gap-1.5 mb-1 md:mb-3 w-full keyboard-row">
                <div class="key-3d key-special flex-[1.5] h-8 md:h-12 font-bold text-[8px] md:text-xs">Tab</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–π">–ô</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—Ü">–¶</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—É">–£</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–∫">–ö</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–µ">–ï</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–Ω">–ù</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–≥">–ì</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—à">–®</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—â">–©</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–∑">–ó</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—Ö">–•</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—ó">–á</div>
                <div class="key-3d key-special flex-[1.2] h-8 md:h-12 font-bold text-sm md:text-sm">\</div>
            </div>

            <div class="flex gap-0.5 md:gap-1.5 mb-1 md:mb-3 w-full keyboard-row">
                <div class="key-3d key-special flex-[1.8] h-8 md:h-12 font-bold text-[8px] md:text-xs">Caps</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—Ñ">–§</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—ñ">–Ü</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–≤">–í</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–∞">–ê</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–ø">–ü</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—Ä">–†</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–æ">–û</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–ª">–õ</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–¥">–î</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–∂">–ñ</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—î">–Ñ</div>
                <div
                    class="key-3d key-special flex-[2] h-8 md:h-12 font-bold text-[8px] md:text-xs bg-gradient-to-b from-blue-100 to-blue-200">
                    Enter</div>
            </div>

            <div class="flex gap-0.5 md:gap-1.5 mb-1 md:mb-3 w-full keyboard-row">
                <div class="key-3d key-special flex-[2.3] h-8 md:h-12 font-bold text-[8px] md:text-xs">Shift</div>

                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="“ë">“ê</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—è">–Ø</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—á">–ß</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—Å">–°</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–º">–ú</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–∏">–ò</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—Ç">–¢</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—å">–¨</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="–±">–ë</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char="—é">–Æ</div>
                <div class="key-3d key-letter flex-1 h-8 md:h-12 font-bold text-slate-700 text-sm md:text-lg"
                    data-char=".">.</div>

                <div class="key-3d key-special flex-[2.3] h-8 md:h-12 font-bold text-[8px] md:text-xs">Shift</div>
            </div>

            <div class="flex justify-center gap-0.5 md:gap-1.5 w-full">
                <div class="key-3d w-1/2 h-8 md:h-12 font-bold text-slate-400 text-sm cursor-pointer" data-code="Space">
                </div>
            </div>
        </div>
    </div>

    <script>
        const AudioController = {
            ctx: null,
            muted: false,
            init() { if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
            resume() { if (!this.muted && this.ctx && this.ctx.state === 'suspended') this.ctx.resume().catch(console.warn); },
            toggleMute(btn, icon) {
                this.muted = !this.muted;
                icon.classList.replace(this.muted ? 'fa-volume-high' : 'fa-volume-xmark', this.muted ? 'fa-volume-xmark' : 'fa-volume-high');
                btn.classList.toggle('bg-red-500/50', this.muted);
                btn.blur();
            },
            playTone(freq, type, duration, volStart = 0.05, volEnd = 0.001) {
                if (this.muted) return;
                if (!this.ctx) this.init();
                this.resume();

                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                if (type === 'triangle') osc.frequency.exponentialRampToValueAtTime(freq / 4, this.ctx.currentTime + duration);
                gain.gain.setValueAtTime(volStart, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(volEnd, this.ctx.currentTime + duration);
                osc.start();
                osc.stop(this.ctx.currentTime + duration + 0.1);
            },
            playClick() { this.playTone(400, 'triangle', 0.05); },
            playSuccess() {
                if (this.muted) return;
                [523.25, 659.25, 783.99].forEach((freq, i) => setTimeout(() => this.playTone(freq, 'sine', 0.35, 0.10), i * 60));
            }
        };

        const Storage = {
            saveBest(score, lang) {
                const key = `bestScore_${lang}`;
                const best = this.getBest(lang);
                if (score > best) {
                    localStorage.setItem(key, String(score));
                    return true;
                }
                return false;
            },
            getBest(lang) {
                return parseInt(localStorage.getItem(`bestScore_${lang}`) || '0', 10);
            }
        };

        const Data = {
            uk: {
                words: [...new Set([
                    "–ª—é–¥–∏", "–≤–æ–Ω–∞", "–≤–æ–Ω–∏", "–∫–æ–ª–∏", "–π–æ–≥–æ", "–±—É—Ç–∏", "—Ä–æ–∫—É", "—á–∞—Å", "–±—É–ª–æ", "–º–µ–Ω–µ", "–¥—É–∂–µ", "–º–µ–Ω—ñ", "—Ç–æ–º—É", "—Ç–µ–±–µ",
                    "—è–∫–∏–π", "–º–∞—î", "—Å–µ–±–µ", "–º–æ–∂–µ", "—Ü—å–æ–≥–æ", "–≤–∂–µ", "—Å–æ–±—ñ", "—Ä–æ–±–∏—Ç–∏", "–±—É–¥–µ", "—Ç—Ä–µ–±–∞", "—Å–≤—ñ—Ç", "–∂–∏—Ç—Ç—è", "–ª–∏—à–µ",
                    "–º–æ–∂–Ω–∞", "—Ç—É—Ç", "–¥–µ–Ω—å", "—Å–≤–æ—é", "—Ç–µ–ø–µ—Ä", "—â–æ–±–∏", "–π–æ–º—É", "—Å–≤–æ—ó", "—ñ–Ω—à—ñ", "–Ω–∞–≤—ñ—Ç—å", "—Ö–æ—á—É", "–∫–æ–≥–æ", "–±—É–ª–∏",
                    "—Å–∞–º–µ", "–∫—É–¥–∏", "—è–∫–∞", "–¥–æ–∫–∏", "—Ç–æ–¥—ñ", "—Ç–µ–∂", "–æ—á—ñ", "—Ä—É–∫–∏", "–Ω—ñ–±–∏", "–Ω—ñ–∂", "–ø–æ–∫–∏", "–ø—Ä–æ—Å—Ç–æ", "–±–∞–≥–∞—Ç–æ",
                    "–∑–∞—Ä–∞–∑", "–º–∞–º–∞", "—Ç–∞—Ç–æ", "–±—Ä–∞—Ç", "–º–æ–≤–∞", "–≤–æ–¥–∞", "–Ω–µ–±–æ", "–ø–æ–ª–µ", "–ª—ñ—Å", "—Ä—ñ–∫–∞", "–º–æ—Ä–µ", "–≥–æ—Ä–∞", "—Å–µ–ª–∞",
                    "–º—ñ—Å—Ç–æ", "—Ö–∞—Ç–∞", "–≤—ñ–∫–Ω–æ", "–¥–≤–µ—Ä—ñ", "—Å—Ç—ñ–ª", "–∫–Ω–∏–≥–∞", "—à–∫–æ–ª–∞", "–∫–ª–∞—Å", "—É—Ä–æ–∫", "—Ä—É—á–∫–∞", "–¥—Ä—É–≥", "—Å–∏–ª–∞",
                    "–≤–æ–ª—è", "—Å–ª–∞–≤–∞", "–ø—ñ—Å–Ω—è", "–¥—É—à–∞", "—Å–µ—Ä—Ü–µ", "–ª—é–±–æ–≤", "–º—Ä—ñ—è", "–Ω–∞–¥—ñ—è", "–≤—ñ—Ä–∞", "–ø—Ä–∞–≤–¥–∞", "–∫—Ä–∞—Å–∞", "—Ä–∞–¥—ñ—Å—Ç—å",
                    "–¥–æ–±—Ä–æ", "—É—Å–ø—ñ—Ö", "–ø—Ä–∞—Ü—è", "–∑–Ω–∞—Ç–∏", "–∂–∏—Ç–∏",
                    "–Ω—ñ—Ö—Ç–æ", "–Ω—ñ—Ö—Ç–æ", "–∫–æ–∂–µ–Ω", "–Ω—ñ—Ö—Ç–æ", "–∑–∞–≤–∂–¥–∏", "–Ω—ñ–∫–æ–ª–∏", "—á–∞—Å—Ç–æ", "—Ä—ñ–¥–∫–æ", "–ø–µ—Ä—à–µ", "–¥—Ä—É–≥–µ", "—Ç—Ä–µ—Ç—î",
                    "—Å–æ–Ω—Ü–µ", "–∑–µ–º–ª—è", "–±–∞—Ç—å–∫–æ", "—Å–µ—Å—Ç—Ä–∞", "–¥—ñ–º", "–∫—ñ–º–Ω–∞—Ç–∞", "–ª—ñ–∂–∫–æ", "—Ö–ª—ñ–±", "–º–æ–ª–æ–∫–æ", "—Ä—É—á–Ω–∏–π",
                    "–≥–æ–ª–æ–≤–∞", "–Ω—ñ—Å", "—Ä–æ—Ç", "–≤—É—Ö–æ", "–≤–æ–ª–æ—Å—Å—è", "–æ–¥—è–≥", "–∫—É—Ä—Ç–∫–∞", "–¥–æ—Ä–æ–≥–∞", "–∞–≤—Ç–æ–º–æ–±—ñ–ª—å", "–≥—Ä–∞—Ç–∏",
                    "–ø—ñ—Å–æ–∫", "–∫–∞–º—ñ–Ω—å", "–¥–µ—Ä–µ–≤–æ", "–∫–≤—ñ—Ç–∫–∞", "—Ç—Ä–∞–≤–∞", "–ø—Ç–∞—Ö", "—Ä–∏–±–∞", "—Å–æ–±–∞–∫–∞", "–∫—ñ—à–∫–∞", "–∫–æ—Ä–æ–≤–∞",
                    "–∫—ñ–Ω—å", "–∫—É—Ä–∫–∞", "—è–π—Ü–µ", "–º'—è—Å–æ", "—è–±–ª—É–∫–æ", "—á–∏—Å–ª–æ", "–æ–¥–∏–Ω", "–¥–≤–∞", "—Ç—Ä–∏", "—á–æ—Ç–∏—Ä–∏",
                    "—à–∫–æ–ª—è—Ä", "—É—á–∏—Ç–µ–ª—å", "–∑–æ—à–∏—Ç", "–æ–ª—ñ–≤–µ—Ü—å", "–≥—É–º–∫–∞", "–∫–æ–º–ø'—é—Ç–µ—Ä", "–º–∏—à–∫–∞", "–∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∞", "–µ–∫—Ä–∞–Ω",
                    "–ø—Ä–æ–≥—Ä–∞–º–∞", "–≥—Ä–∞—Ñ—ñ–∫–∞", "–∑–≤—É–∫", "–∫–Ω–æ–ø–∫–∞", "–º–µ–Ω—é", "—Ñ–∞–π–ª", "–ø–∞–ø–∫–∞"
                ])],
                milestones: ["–ß—É–¥–æ–≤–∏–π —Å—Ç–∞—Ä—Ç!", "–¢–∏ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π –º–∞–π—Å—Ç–µ—Ä!", "–ù–µ–π–º–æ–≤—ñ—Ä–Ω–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å!", "–ü—Ä–æ–¥–æ–≤–∂—É–π —É —Ç–æ–º—É –∂ –¥—É—Å—ñ!", "–ö–ª–∞–≤—ñ–∞—Ç—É—Ä–Ω–∏–π –≥–µ–Ω—ñ–π!", "–ù–µ–ø–µ—Ä–µ–≤–µ—Ä—à–µ–Ω–æ!"],
                labels: { success: "–ß—É–¥–æ–≤–æ!", words: "–°–ª—ñ–≤", errors: "–ü–æ–º–∏–ª–æ–∫", record: "–†–µ–∫–æ—Ä–¥", accuracy: "–¢–æ—á–Ω—ñ—Å—Ç—å", next: "–î–∞–ª—ñ", pressAny: "–ù–∞—Ç–∏—Å–Ω–∏ –±—É–¥—å-—è–∫—É –∫–ª–∞–≤—ñ—à—É", modalTitle: "–°—É–ø–µ—Ä!", modalText: "—Å–ª—ñ–≤!" },
                layout: [
                    ['–π', '—Ü', '—É', '–∫', '–µ', '–Ω', '–≥', '—à', '—â', '–∑', '—Ö', '—ó'],
                    ['—Ñ', '—ñ', '–≤', '–∞', '–ø', '—Ä', '–æ', '–ª', '–¥', '–∂', '—î'],
                    ['“ë', '—è', '—á', '—Å', '–º', '–∏', '—Ç', '—å', '–±', '—é', '.']
                ]
            },
            en: {
                words: [...new Set([
                    "about", "other", "which", "their", "there", "first", "would", "these", "click", "price", "state", "world",
                    "music", "books", "links", "years", "could", "group", "games", "service", "start", "today", "pages", "found",
                    "house", "photo", "power", "while", "three", "total", "place", "think", "where", "after", "water", "guide",
                    "board", "white", "small", "times", "sites", "level", "thank", "phone", "hours", "black", "plant", "trade",
                    "radio", "study", "party", "early", "given", "light", "every", "field", "large", "point", "never", "among",
                    "great", "right", "write", "thing", "cause", "check", "stand", "ready", "story", "media", "class", "value",
                    "image", "model", "space", "night", "table", "event", "order", "range", "cloud", "focus", "voice", "offer",
                    "learn", "money", "paper", "track", "terms", "skill", "brain", "dream",
                    "people", "number", "system", "program", "computer", "screen", "keyboard", "mouse", "button", "window",
                    "folder", "school", "teacher", "student", "lesson", "homework", "picture", "family", "mother", "father",
                    "brother", "sister", "animal", "forest", "river", "mountain", "ocean", "flower", "garden", "kitchen",
                    "bedroom", "living", "office", "project", "robot", "sensor", "engine", "player", "action", "levelup",
                    "friend", "happy", "strong", "energy", "future", "travel", "planet", "star", "magic", "dragon",
                    "castle", "sword", "shield", "health", "score", "record", "nation", "leader"
                ])],
                milestones: ["Great Start!", "You're a master!", "Incredible Speed!", "Keep it up!", "Keyboard Genius!", "Outstanding!"],
                labels: { success: "Great!", words: "Words", errors: "Errors", record: "Record", accuracy: "Accuracy", next: "Next", pressAny: "Press any key", modalTitle: "Super!", modalText: "words done!" },
                layout: [
                    ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p', '[', ']'],
                    ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l', ';', '\''],
                    ['z', 'x', 'c', 'v', 'b', 'n', 'm', ',', '.', '/']
                ]
            }
        };

        const UI = {
            els: {
                wordDisplay: document.getElementById('word-display'),
                score: document.getElementById('score-counter'),
                errors: document.getElementById('error-counter'),
                best: document.getElementById('best-score'),
                wpm: document.getElementById('wpm-counter'),
                accuracy: document.getElementById('accuracy-counter'),
                progressBar: document.getElementById('progress-bar'),
                message: document.getElementById('message-area'),
                modal: document.getElementById('milestone-modal'),
                modalText: document.getElementById('milestone-text'),
                modalTitle: document.getElementById('modal-title'),
                modalBtnText: document.getElementById('modal-btn-text'),
                modalHint: document.getElementById('modal-hint'),
                nextBtn: document.getElementById('modal-next-btn'),
                soundBtn: document.getElementById('sound-toggle'),
                langBtn: document.getElementById('lang-toggle'),
                keyboard: document.getElementById('keyboard-container'),
                startModal: document.getElementById('start-modal'),
                startGameBtn: document.getElementById('start-game-btn'),
                confirmModal: document.getElementById('confirm-modal'),
                confirmYesBtn: document.getElementById('confirm-yes-btn'),
                confirmCancelBtn: document.getElementById('confirm-cancel-btn'),
                statWords: document.querySelector('[data-stat-label="words"]'),
                statErrors: document.querySelector('[data-stat-label="errors"]'),
                statRecord: document.querySelector('[data-stat-label="record"]'),
                statAccuracy: document.querySelector('[data-stat-label="accuracy"]')
            },

            escAttrValue(s) {
                // safest for querySelector attribute values (handles quotes, brackets, etc.)
                if (window.CSS && typeof CSS.escape === 'function') return CSS.escape(s);
                return String(s).replace(/["\\\]]/g, '\\$&');
            },

            updateLabels(lang) {
                const l = Data[lang].labels;
                this.els.message.textContent = l.success;
                this.els.modalTitle.textContent = l.modalTitle;
                this.els.modalBtnText.textContent = l.next;
                this.els.modalHint.textContent = l.pressAny;

                if (this.els.statWords) this.els.statWords.textContent = l.words;
                if (this.els.statErrors) this.els.statErrors.textContent = l.errors;
                if (this.els.statRecord) this.els.statRecord.textContent = l.record;
                if (this.els.statAccuracy) this.els.statAccuracy.textContent = l.accuracy;
            },

            updateKeyboardLayout(lang) {
                const layout = Data[lang].layout;
                const rows = document.querySelectorAll('.keyboard-row');

                const row1Keys = rows[0].querySelectorAll('.key-letter');
                layout[0].forEach((char, i) => {
                    if (row1Keys[i]) {
                        row1Keys[i].textContent = char.toUpperCase();
                        row1Keys[i].dataset.char = char;
                    }
                });

                const row2Keys = rows[1].querySelectorAll('.key-letter');
                layout[1].forEach((char, i) => {
                    if (row2Keys[i]) {
                        row2Keys[i].textContent = char.toUpperCase();
                        row2Keys[i].dataset.char = char;
                    }
                });

                const row3Keys = rows[2].querySelectorAll('.key-letter');

                if (lang === 'en') {
                    // hide "“ë" key slot
                    row3Keys[0].classList.add('hidden-key');

                    layout[2].forEach((char, i) => {
                        const el = row3Keys[i + 1];
                        if (el) {
                            el.textContent = char.toUpperCase();
                            el.dataset.char = char;
                        }
                    });
                } else {
                    row3Keys[0].classList.remove('hidden-key');

                    layout[2].forEach((char, i) => {
                        const el = row3Keys[i];
                        if (el) {
                            el.textContent = char.toUpperCase();
                            el.dataset.char = char;
                        }
                    });
                }

                // remove leftover dataset.char from any hidden/unused keys (safety)
                document.querySelectorAll('.key-letter.hidden-key').forEach(el => {
                    delete el.dataset.char;
                });
            },

            renderWord(word, index) {
                this.els.wordDisplay.innerHTML = '';
                for (let i = 0; i < word.length; i++) {
                    const span = document.createElement('span');
                    span.textContent = word[i];
                    if (i < index) span.className = 'text-green-500 transition-colors duration-200';
                    else if (i === index) span.className = 'text-indigo-600 border-b-2 md:border-b-4 border-indigo-500 pb-0.5 md:pb-1';
                    else span.className = 'text-slate-300';
                    this.els.wordDisplay.appendChild(span);
                }
            },

            updateStats(state) {
                this.els.score.textContent = state.score;
                this.els.errors.textContent = state.errors;
                this.els.best.textContent = state.bestScore;

                const wordsInCycle = state.score % 5;
                const wordProgress = state.currentWord.length > 0 ? state.charIndex / state.currentWord.length : 0;
                const progress = (wordsInCycle + wordProgress) * 20;
                this.els.progressBar.style.width = `${Math.min(progress, 100)}%`;

                const totalAttempts = state.totalHits + state.errors;
                const accuracy = totalAttempts <= 0 ? 100 : (state.totalHits / totalAttempts) * 100;
                this.els.accuracy.textContent = `${accuracy.toFixed(1)}%`;

                const baseClass = "font-black text-sm md:text-xl";
                if (accuracy > 95) this.els.accuracy.className = `${baseClass} text-green-100`;
                else if (accuracy > 80) this.els.accuracy.className = `${baseClass} text-yellow-100`;
                else this.els.accuracy.className = `${baseClass} text-red-100`;
            },

            updateWPM(startTime, score) {
                if (!startTime || score === 0) {
                    this.els.wpm.textContent = '0';
                    return;
                }
                const minutes = (Date.now() - startTime) / 60000;
                if (minutes < 0.001) {
                    this.els.wpm.textContent = '0';
                    return;
                }
                const wpm = Math.round(score / minutes);
                this.els.wpm.textContent = String(wpm);
            },

            clearHints() {
                document.querySelectorAll('.key-hint').forEach(el => el.classList.remove('key-hint'));
            },

            highlightKey(char) {
                this.clearHints();
                if (!char) return;

                let selector;
                if (char === ' ') selector = '[data-code="Space"]';
                else selector = `[data-char="${this.escAttrValue(char.toLowerCase())}"]`;

                const el = this.els.keyboard.querySelector(selector);
                if (el) el.classList.add('key-hint');
            },

            animateKey(char) {
                let selector;
                if (char === ' ') selector = '[data-code="Space"]';
                else selector = `[data-char="${this.escAttrValue(char.toLowerCase())}"]`;

                const el = this.els.keyboard.querySelector(selector);
                if (el) {
                    el.classList.add('key-pressed');
                    setTimeout(() => el.classList.remove('key-pressed'), 150);
                }
            },

            shakeWord() {
                this.els.wordDisplay.classList.add('shake');
                setTimeout(() => this.els.wordDisplay.classList.remove('shake'), 400);
            },

            showSuccessMessage() {
                this.els.message.style.opacity = '1';
                this.els.message.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    this.els.message.style.opacity = '0';
                    this.els.message.style.transform = 'scale(1)';
                }, 800);
            },

            showModal(text) {
                this.els.modalText.textContent = text;
                this.els.modal.classList.remove('hidden');
                setTimeout(() => this.els.nextBtn.focus(), 80);
            },

            hideModal() {
                this.els.modal.classList.add('hidden');
            },

            isModalOpen() {
                return !this.els.modal.classList.contains('hidden');
            },

            isStartOpen() {
                return !this.els.startModal.classList.contains('hidden');
            },

            isConfirmOpen() {
                return !this.els.confirmModal.classList.contains('hidden');
            },

            showConfirm() {
                this.els.confirmModal.classList.remove('hidden');
            },

            hideConfirm() {
                this.els.confirmModal.classList.add('hidden');
            }
        };

        const Game = {
            currentLang: 'uk',
            ignoredKeys: new Set(['Shift', 'Control', 'Alt', 'Meta', 'Tab', 'CapsLock', 'Escape', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Enter']),
            currentWordsList: [],
            state: {
                wordIndex: 0,
                charIndex: 0,
                score: 0,
                errors: 0,
                totalHits: 0,
                bestScore: 0,
                startTime: null,
                currentWord: "",
                paused: true,
                closingModal: false,
                started: false
            },

            init() {
                this.setupLanguage();
                this.initEventListeners();
                this.state.paused = true;
                this.state.started = false;
                UI.renderWord("...", 0);
                UI.updateStats(this.state);
                UI.updateWPM(null, 0);
            },

            initEventListeners() {
                UI.els.startGameBtn.addEventListener('click', () => {
                    UI.els.startModal.classList.add('hidden');
                    this.state.started = true;
                    this.state.paused = false;
                    // unlock audio on user gesture
                    AudioController.resume();
                    this.startNewGame();
                });

                UI.els.soundBtn.addEventListener('click', () => {
                    const icon = UI.els.soundBtn.querySelector('i');
                    AudioController.toggleMute(UI.els.soundBtn, icon);
                });

                UI.els.langBtn.addEventListener('click', () => this.toggleLanguage());

                UI.els.nextBtn.addEventListener('click', () => this.closeModal());

                UI.els.confirmYesBtn.addEventListener('click', () => {
                    UI.hideConfirm();
                    this.state.paused = false;
                    this.proceedWithLanguageToggle();
                });

                UI.els.confirmCancelBtn.addEventListener('click', () => {
                    UI.hideConfirm();
                    this.state.paused = false;
                });

                document.addEventListener('keydown', (e) => this.onKeyDown(e), { passive: false });

                // Pointer events (works for mouse + touch)
                UI.els.keyboard.addEventListener('pointerdown', (e) => {
                    const keyEl = e.target.closest('.key-3d');
                    if (!keyEl) return;

                    // only interactive for letter keys / space / backspace
                    const action = keyEl.dataset.action;
                    const ch = keyEl.dataset.char;
                    const isSpace = keyEl.dataset.code === 'Space';

                    if (!(action === 'backspace' || ch || isSpace)) return;

                    e.preventDefault();
                    e.stopPropagation();

                    if (!this.state.started || this.state.paused) {
                        // allow closing milestone modal by tapping anywhere only if it is open
                        if (UI.isModalOpen()) this.closeModal();
                        return;
                    }

                    if (action === 'backspace') this.handleBackspace();
                    else this.handleInput(ch || ' ');
                });
            },

            setupLanguage() {
                UI.updateLabels(this.currentLang);
                UI.updateKeyboardLayout(this.currentLang);
            },

            toggleLanguage() {
                if (this.state.started && (this.state.score > 0 || this.state.errors > 0 || this.state.totalHits > 0)) {
                    this.state.paused = true;
                    UI.showConfirm();
                    return;
                }
                this.proceedWithLanguageToggle();
            },

            proceedWithLanguageToggle() {
                this.currentLang = this.currentLang === 'uk' ? 'en' : 'uk';
                this.setupLanguage();
                UI.clearHints();

                if (this.state.started) {
                    this.startNewGame();
                } else {
                    // just refresh best score label when still on start modal
                    this.state.bestScore = Storage.getBest(this.currentLang);
                    UI.updateStats(this.state);
                }

                UI.els.langBtn.blur();
            },

            startNewGame() {
                this.state.score = 0;
                this.state.errors = 0;
                this.state.totalHits = 0;
                this.state.wordIndex = 0;
                this.state.charIndex = 0;
                this.state.startTime = null;
                this.state.bestScore = Storage.getBest(this.currentLang);
                this.state.currentWord = "";

                const words = [...Data[this.currentLang].words];
                for (let i = words.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [words[i], words[j]] = [words[j], words[i]];
                }
                this.currentWordsList = words;

                this.loadNextWord();
                UI.updateStats(this.state);
                UI.updateWPM(null, 0);
            },

            loadNextWord() {
                if (this.state.wordIndex >= this.currentWordsList.length) this.state.wordIndex = 0;
                this.state.currentWord = this.currentWordsList[this.state.wordIndex] || "";
                this.state.charIndex = 0;

                UI.renderWord(this.state.currentWord, 0);
                UI.highlightKey(this.state.currentWord[0] || null);
                UI.updateStats(this.state);
            },

            handleInput(inputChar) {
                if (!this.state.started || this.state.paused) return;

                if (!this.state.startTime) this.state.startTime = Date.now();
                UI.updateWPM(this.state.startTime, this.state.score);

                AudioController.playClick();
                UI.animateKey(inputChar);

                const targetChar = this.state.currentWord[this.state.charIndex];
                if (!targetChar) return;

                if (String(inputChar).toLowerCase() === String(targetChar).toLowerCase()) {
                    this.state.charIndex++;
                    this.state.totalHits++;
                    UI.renderWord(this.state.currentWord, this.state.charIndex);

                    if (this.state.charIndex === this.state.currentWord.length) {
                        this.onWordComplete();
                    } else {
                        UI.highlightKey(this.state.currentWord[this.state.charIndex]);
                    }
                } else {
                    this.state.errors++;
                    UI.shakeWord();
                }

                UI.updateStats(this.state);
            },

            handleBackspace() {
                if (!this.state.started || this.state.paused || this.state.charIndex === 0) return;
                AudioController.playClick();

                this.state.charIndex--;
                if (this.state.totalHits > 0) this.state.totalHits--;

                UI.renderWord(this.state.currentWord, this.state.charIndex);
                UI.highlightKey(this.state.currentWord[this.state.charIndex] || null);
                UI.updateStats(this.state);
            },

            onWordComplete() {
                this.state.score++;
                if (Storage.saveBest(this.state.score, this.currentLang)) {
                    this.state.bestScore = this.state.score;
                }

                AudioController.playSuccess();
                UI.showSuccessMessage();
                UI.updateWPM(this.state.startTime, this.state.score);

                this.state.wordIndex++;

                if (this.state.score > 0 && this.state.score % 5 === 0) {
                    this.triggerMilestone();
                } else {
                    setTimeout(() => this.loadNextWord(), 200);
                }
            },

            triggerMilestone() {
                this.state.paused = true;

                try {
                    confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
                } catch (_) { /* ignore */ }

                const milestones = Data[this.currentLang].milestones;
                const phrase = milestones[Math.floor(Math.random() * milestones.length)];
                const suffix = Data[this.currentLang].labels.modalText;

                UI.showModal(`${phrase} (${this.state.score} ${suffix})`);
                UI.els.progressBar.style.width = '100%';
            },

            closeModal() {
                if (this.state.closingModal) return;
                if (!UI.isModalOpen()) return; // –≤–∞–∂–ª–∏–≤–æ: –Ω–µ –∑–∞–∫—Ä–∏–≤–∞—Ç–∏ "–ø–æ—Ä–æ–∂–Ω—î" –ø–∞—É–∑—É–≤–∞–Ω–Ω—è

                this.state.closingModal = true;
                UI.hideModal();
                this.state.paused = false;

                UI.els.progressBar.style.width = '0%';
                this.loadNextWord();

                setTimeout(() => { this.state.closingModal = false; }, 250);
            },

            onKeyDown(e) {
                // Do not react while start modal is open (before game starts)
                if (!this.state.started || UI.isStartOpen()) return;

                // If milestone modal or confirm modal is open, handle them
                if (this.state.paused) {
                    if (UI.isModalOpen()) {
                        e.preventDefault();
                        this.closeModal();
                    } else if (UI.isConfirmOpen()) {
                        if (e.key === 'Escape') {
                            e.preventDefault();
                            UI.hideConfirm();
                            this.state.paused = false;
                        } else if (e.key === 'Enter') {
                            e.preventDefault();
                            UI.hideConfirm();
                            this.state.paused = false;
                            this.proceedWithLanguageToggle();
                        }
                    }
                    return;
                }

                // prevent browser navigation on Backspace
                if (e.key === 'Backspace') {
                    e.preventDefault();
                    this.handleBackspace();
                    return;
                }

                if (this.ignoredKeys.has(e.key)) return;

                // only printable characters
                if (e.key && e.key.length === 1) {
                    this.handleInput(e.key);
                }
            }
        };

        Game.init();
    </script>
</body>

</html>
