<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–§–µ—Ä–º–µ—Ä –ë–æ—Ç | –ü—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è —Ä–æ–±–æ—Ç–∞</title>
    <style>
      :root {
        --primary-color: #6a5acd;
        --primary-dark: #483d8b;
        --background-color: #f0f8ff;
        --card-color: #ffffff;
        --example-bg: #e6f7ff;
        --example-border: #1e90ff;
        --interactive-bg: #f0fff0;
        --text-color: #333333;
        --success-color: #4caf50;
        --warning-color: #ff9800;
        --level-color: #9c27b0;
        --border-radius: 10px;
        --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        --strong-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.7;
        font-family: "Roboto", "Arial", sans-serif;
        font-size: 16px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 30px 20px;
      }

      header {
        background-color: var(--primary-color);
        color: white;
        text-align: center;
        padding: 30px 20px;
        border-radius: var(--border-radius);
        margin-bottom: 30px;
        box-shadow: var(--strong-shadow);
      }

      h1 {
        font-size: 42px;
        margin-bottom: 15px;
        font-weight: 700;
        letter-spacing: 0.5px;
      }

      h2 {
        color: var(--primary-color);
        margin: 25px 0 20px;
        border-bottom: 2px solid var(--primary-color);
        padding-bottom: 8px;
        font-size: 28px;
        font-weight: 600;
      }

      h3 {
        font-size: 22px;
        margin-bottom: 12px;
        color: var(--primary-dark);
      }

      p {
        margin-bottom: 18px;
        font-size: 18px;
        line-height: 1.7;
      }

      .interactive {
        background-color: var(--interactive-bg);
        border-radius: var(--border-radius);
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--shadow);
      }

      .game-container {
        display: flex;
        flex-direction: row;
        gap: 20px;
        margin: 20px 0;
        align-items: flex-start;
      }

      .game-column {
        flex: 1;
        min-width: 0;
      }

      .field-column {
        flex-basis: 40%;
      }

      .controls-column {
        flex-basis: 60%;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .commands-section,
      .program-section {
        background-color: rgba(255, 255, 255, 0.5);
        border-radius: var(--border-radius);
        padding: 15px;
        box-shadow: var(--shadow);
      }

      .program {
        min-height: 150px;
        max-height: 300px;
        overflow-y: auto;
        margin-bottom: 15px;
        border: 2px dashed var(--primary-color);
        border-radius: 8px;
        padding: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        background-color: rgba(255, 255, 255, 0.7);
      }

      .commands {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
        margin: 10px 0;
      }

      .robot-field {
        display: grid;
        gap: 3px;
        margin: 15px auto;
        width: max-content;
        background-color: #eee;
        padding: 8px;
        border-radius: 8px;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
      }

      .cell {
        width: 50px;
        height: 50px;
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: background-color 0.2s;
        position: relative;
      }

      .wall {
        background-color: #8b4513;
        border: 1px solid #6b3300;
      }

      .cell:hover {
        background-color: #f8f8f8;
      }

      .robot-icon {
        font-size: 32px;
        color: var(--primary-color);
        filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.2));
        z-index: 10;
        transition: transform 0.3s ease;
      }

      .collectible {
        font-size: 32px;
        filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.2));
        z-index: 5;
      }

      .command {
        padding: 8px 12px;
        background-color: var(--primary-color);
        color: white;
        border-radius: 5px;
        cursor: pointer;
        text-align: center;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        font-size: 14px;
      }

      .command:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      }

      .command:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .program-step {
        padding: 6px 12px;
        background-color: #e6e6fa;
        border-radius: 5px;
        display: flex;
        align-items: center;
        font-size: 14px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin: 4px;
      }

      .program-step.active {
        background-color: #ffcccb;
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .delete-step {
        margin-left: 10px;
        cursor: pointer;
        color: red;
        font-weight: bold;
        transition: transform 0.2s;
      }

      .delete-step:hover {
        transform: scale(1.2);
      }

      .level-progress {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .level-btn {
        padding: 8px 16px;
        background-color: #ddd;
        color: var(--text-color);
        border-radius: 5px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
      }

      .level-btn.active {
        background-color: var(--level-color);
        color: white;
        font-weight: bold;
      }

      .level-btn:hover {
        background-color: #ccc;
        transform: translateY(-2px);
      }

      .level-btn.active:hover {
        background-color: var(--level-color);
      }

      .level-btn.completed {
        background-color: var(--success-color);
        color: white;
      }

      .toast {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background-color: var(--success-color);
        color: white;
        padding: 15px 30px;
        border-radius: 8px;
        display: none;
        z-index: 1000;
        font-size: 18px;
        font-weight: 500;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }

      .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 15px;
      }

      button {
        background-color: var(--primary-color);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        margin: 10px 8px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      button:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      }

      button:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      footer {
        background-color: var(--primary-color);
        color: white;
        text-align: center;
        padding: 2rem 0;
        border-radius: 20px 20px 0 0;
        margin-top: 3rem;
        box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
      }

      footer p {
        font-size: 1.1rem;
      }

      .level-description {
        background-color: var(--example-bg);
        border-left: 5px solid var(--example-border);
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
      }

      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        header {
          padding: 20px 15px;
        }

        h1 {
          font-size: 32px;
        }

        h2 {
          font-size: 24px;
        }

        p {
          font-size: 16px;
        }

        .interactive {
          padding: 20px;
        }

        .game-container {
          flex-direction: column;
        }

        .field-column,
        .controls-column {
          flex-basis: 100%;
          width: 100%;
        }

        .cell {
          width: 45px;
          height: 45px;
        }

        .robot-icon,
        .collectible {
          font-size: 30px;
        }

        .commands {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }

        .command {
          padding: 8px 10px;
          font-size: 14px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>–§–µ—Ä–º–µ—Ä –ë–æ—Ç ü§ñüçé</h1>
        <p>–ó–∞–ø—Ä–æ–≥—Ä–∞–º—É–π —Ä–æ–±–æ—Ç–∞, —â–æ–± –≤—ñ–Ω –∑—ñ–±—Ä–∞–≤ –≤—Å—ñ —Ñ—Ä—É–∫—Ç–∏ —Ç–∞ –æ–≤–æ—á—ñ!</p>
      </header>

      <div class="level-progress" id="levelProgress">
        <!-- –ö–Ω–æ–ø–∫–∏ —Ä—ñ–≤–Ω—ñ–≤ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ —á–µ—Ä–µ–∑ JavaScript -->
      </div>

      <div class="interactive">
        <div class="level-description" id="levelDescription">
          –î–æ–ø–æ–º–æ–∂–∏ —Ä–æ–±–æ—Ç—É –∑—ñ–±—Ä–∞—Ç–∏ –≤—Å—ñ —è–±–ª—É–∫–∞ –Ω–∞ –ø–æ–ª—ñ 5x5!
        </div>

        <div class="game-container">
          <!-- –ü–æ–ª–µ –≥—Ä–∏ -->
          <div class="game-column field-column">
            <h3>–ü–æ–ª–µ –≥—Ä–∏:</h3>
            <div class="robot-field" id="robotField">
              <!-- –ö–ª—ñ—Ç–∏–Ω–∫–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
          </div>

          <!-- –ö–æ–º–∞–Ω–¥–∏ —Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ -->
          <div class="game-column controls-column">
            <div class="commands-section">
              <h3>–ö–æ–º–∞–Ω–¥–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∞:</h3>
              <div class="commands" id="commandsContainer">
                <div class="command" onclick="addCommand('–≤–≥–æ—Ä—É')">
                  ‚¨ÜÔ∏è –í–≥–æ—Ä—É
                </div>
                <div class="command" onclick="addCommand('–≤–Ω–∏–∑')">‚¨áÔ∏è –í–Ω–∏–∑</div>
                <div class="command" onclick="addCommand('–≤–ª—ñ–≤–æ')">
                  ‚¨ÖÔ∏è –í–ª—ñ–≤–æ
                </div>
                <div class="command" onclick="addCommand('–≤–ø—Ä–∞–≤–æ')">
                  ‚û°Ô∏è –í–ø—Ä–∞–≤–æ
                </div>
              </div>
            </div>

            <div class="program-section">
              <h3>–¢–≤–æ—è –ø—Ä–æ–≥—Ä–∞–º–∞:</h3>
              <div class="program" id="program">
                <!-- –¢—É—Ç –∑'—è–≤–ª—è—é—Ç—å—Å—è –∫—Ä–æ–∫–∏ -->
              </div>

              <div class="controls">
                <button onclick="runProgram()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–∏</button>
                <button onclick="clearProgram()">üßπ –û—á–∏—Å—Ç–∏—Ç–∏</button>
                <button onclick="resetLevel()">üîÑ –ü–æ—á–∞—Ç–∏ –∑–Ω–æ–≤—É</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="guide-section">
        <h2>–Ø–∫ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞—Ç–∏ —Ä–æ–±–æ—Ç–∞?</h2>
        <ol>
          <li>
            –û–±–µ—Ä–∏ –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∞ (–≤–≥–æ—Ä—É, –≤–Ω–∏–∑, –≤–ª—ñ–≤–æ, –≤–ø—Ä–∞–≤–æ), —â–æ–± —Å–∫–ª–∞—Å—Ç–∏
            –ø—Ä–æ–≥—Ä–∞–º—É
          </li>
          <li>–ù–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É "–ó–∞–ø—É—Å—Ç–∏—Ç–∏", —â–æ–± —Ä–æ–±–æ—Ç –≤–∏–∫–æ–Ω–∞–≤ —Ç–≤–æ—ó –∫–æ–º–∞–Ω–¥–∏</li>
          <li>
            –¢–≤–æ—è –º–µ—Ç–∞ ‚Äî –∑—ñ–±—Ä–∞—Ç–∏ –≤—Å—ñ —Ñ—Ä—É–∫—Ç–∏ —Ç–∞ –æ–≤–æ—á—ñ, —Ä–æ–∑–º—ñ—â–µ–Ω—ñ –Ω–∞ —ñ–≥—Ä–æ–≤–æ–º—É –ø–æ–ª—ñ
          </li>
          <li>
            –ó –∫–æ–∂–Ω–∏–º —Ä—ñ–≤–Ω–µ–º –∑–∞–≤–¥–∞–Ω–Ω—è —Å—Ç–∞—î —Å–∫–ª–∞–¥–Ω—ñ—à–∏–º: –±—ñ–ª—å—à–µ –ø–æ–ª–µ, –±—ñ–ª—å—à–µ
            —Ñ—Ä—É–∫—Ç—ñ–≤, —Å—Ç—ñ–Ω–∏ —Ç–∞ –ø–µ—Ä–µ—à–∫–æ–¥–∏
          </li>
          <li>
            –ù–∞–º–∞–≥–∞–π—Å—è –≤–∏–∫–æ–Ω–∞—Ç–∏ –∫–æ–∂–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è –∑–∞ –Ω–∞–π–º–µ–Ω—à—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫—Ä–æ–∫—ñ–≤!
          </li>
        </ol>
      </div>
    </div>

    <div class="toast" id="toast">–ú–æ–ª–æ–¥–µ—Ü—å! –¢–∏ –∑—ñ–±—Ä–∞–≤ —É—Å—ñ —Ñ—Ä—É–∫—Ç–∏!</div>

    <footer>
      <p>
        –°—Ç–≤–æ—Ä–µ–Ω–æ –ø–∞–Ω–æ–º –ê—Ä—Ç–µ–º–æ–º –¥–ª—è —é–Ω–∏—Ö –ø—Ä–æ–≥—Ä–∞–º—ñ—Å—Ç—ñ–≤ <br />2025 ¬© –ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∞
        –Ω–∞—É–∫–∞ –¥–ª—è –¥—ñ—Ç–µ–π
      </p>
    </footer>

    <script>
      // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
      const ANIMATION_SPEED = 500; // –º—Å
      const TOAST_DURATION = 3000; // –º—Å

      // –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ –≥—Ä–∏
      let robotPosition = { x: 0, y: 0 };
      let collectibles = [];
      let walls = [];
      let isRunning = false;
      let currentLevel = 1;
      let completedLevels = [];
      let gridSize = 5;
      let gameConfig = {};

      // –ö–µ—à–æ–≤–∞–Ω—ñ DOM-–µ–ª–µ–º–µ–Ω—Ç–∏
      const programContainer = document.getElementById("program");
      const robotField = document.getElementById("robotField");

      // –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Ä—ñ–≤–Ω—ñ–≤
      const levels = [
        {
          gridSize: 5,
          robotStart: { x: 0, y: 0 },
          collectiblesCount: 3,
          collectibleType: "üçé",
          walls: [],
          description: "–î–æ–ø–æ–º–æ–∂–∏ —Ä–æ–±–æ—Ç—É –∑—ñ–±—Ä–∞—Ç–∏ –≤—Å—ñ —è–±–ª—É–∫–∞ –Ω–∞ –ø–æ–ª—ñ 5x5!",
        },
        {
          gridSize: 5,
          robotStart: { x: 2, y: 2 },
          collectiblesCount: 4,
          collectibleType: "üçé",
          walls: [
            { x: 1, y: 1 },
            { x: 1, y: 3 },
            { x: 3, y: 1 },
            { x: 3, y: 3 },
          ],
          description:
            "–¢–µ–ø–µ—Ä –Ω–∞ –ø–æ–ª—ñ —î —Å—Ç—ñ–Ω–∏! –†–æ–±–æ—Ç –Ω–µ –º–æ–∂–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏ –∫—Ä—ñ–∑—å –Ω–∏—Ö.",
        },
        {
          gridSize: 6,
          robotStart: { x: 0, y: 0 },
          collectiblesCount: 5,
          collectibleType: "üçä",
          walls: [
            { x: 2, y: 0 },
            { x: 2, y: 1 },
            { x: 2, y: 2 },
            { x: 2, y: 4 },
            { x: 2, y: 5 },
          ],
          description:
            "–ü–æ–ª–µ —Å—Ç–∞–ª–æ –±—ñ–ª—å—à–∏–º (6x6)! –ó–±–µ—Ä–∏ –≤—Å—ñ –∞–ø–µ–ª—å—Å–∏–Ω–∏ —Ç–∞ –æ–±—ñ–π–¥–∏ —Å—Ç—ñ–Ω–∏.",
        },
        {
          gridSize: 6,
          robotStart: { x: 0, y: 0 },
          collectiblesCount: 6,
          collectibleType: "üçå",
          walls: [
            { x: 1, y: 1 },
            { x: 3, y: 3 },
            { x: 3, y: 4 },
            { x: 4, y: 1 },
            { x: 4, y: 2 },
          ],
          description:
            "–ó–±–µ—Ä–∏ –≤—Å—ñ –±–∞–Ω–∞–Ω–∏! –ê–ª–µ –±—É–¥—å –æ–±–µ—Ä–µ–∂–Ω–∏–π - –Ω–∞ —à–ª—è—Ö—É –±–∞–≥–∞—Ç–æ –ø–µ—Ä–µ—à–∫–æ–¥.",
        },
        {
          gridSize: 7,
          robotStart: { x: 3, y: 3 },
          collectiblesCount: 8,
          collectibleType: "üçì",
          walls: [
            { x: 1, y: 1 },
            { x: 1, y: 5 },
            { x: 2, y: 3 },
            { x: 3, y: 1 },
            { x: 3, y: 5 },
            { x: 4, y: 3 },
            { x: 5, y: 1 },
            { x: 5, y: 5 },
          ],
          description:
            "–ù–∞–π—Å–∫–ª–∞–¥–Ω—ñ—à–∏–π —Ä—ñ–≤–µ–Ω—å! –ü–æ–ª–µ 7x7 –∑ –∫—É–ø–æ—é –ø–µ—Ä–µ—à–∫–æ–¥. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –±–∞–≥–∞—Ç–æ –∫–æ–º–∞–Ω–¥, —â–æ–± –∑—ñ–±—Ä–∞—Ç–∏ –≤—Å—ñ –ø–æ–ª—É–Ω–∏—Ü—ñ.",
        },
      ];

      // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—É
      function loadProgress() {
        const saved = localStorage.getItem("robotGame_completedLevels");
        if (saved) {
          completedLevels = JSON.parse(saved);
        }
      }

      // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É
      function saveProgress() {
        localStorage.setItem(
          "robotGame_completedLevels",
          JSON.stringify(completedLevels)
        );
      }

      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∏
      function initGame() {
        loadProgress();
        createLevelButtons();
        loadLevel(currentLevel);
      }

      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–Ω–æ–ø–æ–∫ –≤–∏–±–æ—Ä—É —Ä—ñ–≤–Ω—è
      function createLevelButtons() {
        const levelProgress = document.getElementById("levelProgress");
        levelProgress.innerHTML = "";
        for (let i = 0; i < levels.length; i++) {
          const levelBtn = document.createElement("div");
          levelBtn.className = "level-btn";
          if (i + 1 === currentLevel) levelBtn.classList.add("active");
          if (completedLevels.includes(i + 1))
            levelBtn.classList.add("completed");
          levelBtn.textContent = `–†—ñ–≤–µ–Ω—å ${i + 1}`;
          levelBtn.onclick = function () {
            if (isRunning) return;
            loadLevel(i + 1);
          };
          levelProgress.appendChild(levelBtn);
        }
      }

      // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è
      function loadLevel(level) {
        if (level < 1 || level > levels.length) return;
        document.querySelectorAll(".level-btn").forEach((btn, index) => {
          btn.classList.remove("active");
          if (index + 1 === level) btn.classList.add("active");
        });
        currentLevel = level;
        gameConfig = levels[level - 1];
        document.getElementById("levelDescription").textContent =
          gameConfig.description;
        gridSize = gameConfig.gridSize;
        robotPosition = { ...gameConfig.robotStart };
        clearProgram(); // –û—á–∏—â–∞—î–º–æ –ª–∏—à–µ –∫—Ä–æ–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–∏
        createField();
      }

      // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ–ª—è –≥—Ä–∏
      function createField() {
        robotField.innerHTML = "";
        robotField.style.gridTemplateColumns = `repeat(${gridSize}, 50px)`;
        robotField.style.gridTemplateRows = `repeat(${gridSize}, 50px)`;
        for (let y = 0; y < gridSize; y++) {
          for (let x = 0; x < gridSize; x++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.dataset.x = x;
            cell.dataset.y = y;
            robotField.appendChild(cell);
          }
        }
        walls = [...gameConfig.walls];
        updateWalls();
        updateRobotPosition();
        placeCollectibles();
      }

      // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç—ñ–Ω
      function updateWalls() {
        document.querySelectorAll(".cell").forEach((cell) => {
          cell.classList.remove("wall");
        });
        walls.forEach((wall) => {
          const cell = document.querySelector(
            `.cell[data-x="${wall.x}"][data-y="${wall.y}"]`
          );
          if (cell) cell.classList.add("wall");
        });
      }

      // –†–æ–∑–º—ñ—â–µ–Ω–Ω—è —Ñ—Ä—É–∫—Ç—ñ–≤/–æ–≤–æ—á—ñ–≤
      function placeCollectibles() {
        collectibles = [];
        while (collectibles.length < gameConfig.collectiblesCount) {
          const x = Math.floor(Math.random() * gridSize);
          const y = Math.floor(Math.random() * gridSize);
          if (
            (x !== robotPosition.x || y !== robotPosition.y) &&
            !collectibles.some((item) => item.x === x && item.y === y) &&
            !walls.some((wall) => wall.x === x && wall.y === y)
          ) {
            collectibles.push({ x, y, type: gameConfig.collectibleType });
          }
        }
        updateCollectibles();
      }

      // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—ó —Ä–æ–±–æ—Ç–∞
      function updateRobotPosition() {
        document
          .querySelectorAll(".robot-icon")
          .forEach((icon) => icon.remove());
        const cell = document.querySelector(
          `.cell[data-x="${robotPosition.x}"][data-y="${robotPosition.y}"]`
        );
        if (cell) {
          const robotIcon = document.createElement("div");
          robotIcon.className = "robot-icon";
          robotIcon.innerHTML = "ü§ñ";
          cell.appendChild(robotIcon);
        }
        checkCollectibles();
      }

      // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ñ—Ä—É–∫—Ç—ñ–≤/–æ–≤–æ—á—ñ–≤
      function updateCollectibles() {
        document
          .querySelectorAll(".collectible")
          .forEach((item) => item.remove());
        collectibles.forEach((item) => {
          const cell = document.querySelector(
            `.cell[data-x="${item.x}"][data-y="${item.y}"]`
          );
          if (cell) {
            const collectibleIcon = document.createElement("div");
            collectibleIcon.className = "collectible";
            collectibleIcon.innerHTML = item.type;
            cell.appendChild(collectibleIcon);
          }
        });
      }

      // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–±–æ—Ä—É —Ñ—Ä—É–∫—Ç—ñ–≤/–æ–≤–æ—á—ñ–≤
      function checkCollectibles() {
        const itemIndex = collectibles.findIndex(
          (item) => item.x === robotPosition.x && item.y === robotPosition.y
        );
        if (itemIndex !== -1) {
          collectibles.splice(itemIndex, 1);
          updateCollectibles();
          if (collectibles.length === 0) {
            setTimeout(() => {
              isRunning = false;
              if (!completedLevels.includes(currentLevel)) {
                completedLevels.push(currentLevel);
                saveProgress();
              }
              showToast(`–ú–æ–ª–æ–¥–µ—Ü—å! –¢–∏ –∑–∞–≤–µ—Ä—à–∏–≤ —Ä—ñ–≤–µ–Ω—å ${currentLevel}!`);
              createLevelButtons();
              if (currentLevel < levels.length) {
                setTimeout(() => {
                  loadLevel(currentLevel + 1);
                }, 2000);
              }
            }, 500);
          }
        }
      }

      // –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥–∏ –¥–æ –ø—Ä–æ–≥—Ä–∞–º–∏
      function addCommand(command) {
        if (isRunning) return;
        const programStep = document.createElement("div");
        programStep.className = "program-step";
        programStep.dataset.command = command;
        switch (command) {
          case "–≤–≥–æ—Ä—É":
            programStep.innerHTML = "‚¨ÜÔ∏è –í–≥–æ—Ä—É";
            break;
          case "–≤–Ω–∏–∑":
            programStep.innerHTML = "‚¨áÔ∏è –í–Ω–∏–∑";
            break;
          case "–≤–ª—ñ–≤–æ":
            programStep.innerHTML = "‚¨ÖÔ∏è –í–ª—ñ–≤–æ";
            break;
          case "–≤–ø—Ä–∞–≤–æ":
            programStep.innerHTML = "‚û°Ô∏è –í–ø—Ä–∞–≤–æ";
            break;
        }
        // –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É –≤–∏–¥–∞–ª–µ–Ω–Ω—è (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ programStep.remove())
        const deleteBtn = document.createElement("span");
        deleteBtn.className = "delete-step";
        deleteBtn.innerHTML = "‚úñ";
        deleteBtn.onclick = function (e) {
          e.stopPropagation();
          if (!isRunning) {
            programStep.remove();
          }
        };
        programStep.appendChild(deleteBtn);
        programContainer.appendChild(programStep);
      }

      // –û—á–∏—â–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏
      function clearProgram() {
        programContainer.innerHTML = "";
      }

      // –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–∏
      function runProgram() {
        if (isRunning) return;
        isRunning = true;
        const steps = document.querySelectorAll(".program-step");
        if (steps.length === 0) {
          isRunning = false;
          return;
        }
        executeSteps(steps, 0);
      }

      // –í–∏–∫–æ–Ω–∞–Ω–Ω—è –∫—Ä–æ–∫—ñ–≤ –ø—Ä–æ–≥—Ä–∞–º–∏ –ø–æ —á–µ—Ä–∑—ñ
      function executeSteps(steps, index) {
        if (index >= steps.length || !isRunning) {
          isRunning = false;
          return;
        }
        document.querySelectorAll(".program-step").forEach((step) => {
          step.classList.remove("active");
        });
        steps[index].classList.add("active");
        const command = steps[index].dataset.command || "";
        moveRobot(command);
        setTimeout(() => {
          executeSteps(steps, index + 1);
        }, ANIMATION_SPEED);
      }

      // –†—É—Ö —Ä–æ–±–æ—Ç–∞ –∑–∞ –∫–æ–º–∞–Ω–¥–æ—é
      function moveRobot(direction) {
        let newPosition = { ...robotPosition };
        switch (direction) {
          case "–≤–≥–æ—Ä—É":
            newPosition.y = Math.max(0, newPosition.y - 1);
            break;
          case "–≤–Ω–∏–∑":
            newPosition.y = Math.min(gridSize - 1, newPosition.y + 1);
            break;
          case "–≤–ª—ñ–≤–æ":
            newPosition.x = Math.max(0, newPosition.x - 1);
            break;
          case "–≤–ø—Ä–∞–≤–æ":
            newPosition.x = Math.min(gridSize - 1, newPosition.x + 1);
            break;
        }
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ —Å—Ç—ñ–Ω—É
        const hitWall = walls.some(
          (wall) => wall.x === newPosition.x && wall.y === newPosition.y
        );
        if (!hitWall) {
          robotPosition = newPosition;
          updateRobotPosition();
        }
      }

      // –°–∫–∏–¥–∞–Ω–Ω—è —Ä—ñ–≤–Ω—è
      function resetLevel() {
        if (isRunning) {
          isRunning = false;
          setTimeout(() => {
            loadLevel(currentLevel);
          }, 100);
        } else {
          loadLevel(currentLevel);
        }
      }

      // –ü–æ–∫–∞–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (toast)
      function showToast(message) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.style.display = "block";
        setTimeout(() => {
          toast.style.display = "none";
        }, TOAST_DURATION);
      }

      // –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–∏
      window.onbeforeunload = function () {
        if (isRunning) {
          return "–ü—Ä–æ–≥—Ä–∞–º–∞ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è. –î—ñ–π—Å–Ω–æ –±–∞–∂–∞—î—Ç–µ –≤–∏–π—Ç–∏?";
        }
      };

      window.onload = initGame;
    </script>
  </body>
</html>
