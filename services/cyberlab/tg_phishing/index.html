<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Phishing Simulator (Edu) v3.3 Refactored</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; }
        .font-mono { font-family: 'Fira Code', monospace; }
        .terminal-scroll::-webkit-scrollbar { width: 6px; }
        .terminal-scroll::-webkit-scrollbar-track { background: #0f172a; }
        .terminal-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        
        .animate-slide-up { animation: slide-up 0.3s ease-out forwards; }
        @keyframes slide-up { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }

        .animate-notif { animation: notif-pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes notif-pop { 0% { transform: scale(0.8) translateY(-20px); opacity: 0; } 100% { transform: scale(1) translateY(0); opacity: 1; } }

        .bg-stripes { background: repeating-linear-gradient(45deg, #f1f5f9, #f1f5f9 10px, #e2e8f0 10px, #e2e8f0 20px); }
    </style>
</head>
<body class="h-screen w-screen bg-slate-950 flex flex-col text-slate-200">

    <!-- INFO MODAL -->
    <div id="infoModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-slate-900 border border-blue-500/50 rounded-2xl max-w-lg w-full shadow-2xl overflow-hidden transform scale-95 transition-transform duration-300" id="modalContent">
            <div class="bg-slate-800 p-4 flex items-center justify-between border-b border-slate-700">
                <div class="flex items-center gap-3">
                    <i class="fas fa-info-circle text-blue-400 text-xl"></i>
                    <h3 class="text-lg font-bold text-white" id="modalTitle">–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h3>
                </div>
                <button onclick="ui.closeModal()" class="text-slate-400 hover:text-white transition"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <div id="modalText" class="text-slate-300 text-sm leading-relaxed space-y-2">...</div>
                <div class="bg-yellow-900/20 p-3 rounded-lg border border-yellow-800/50 text-sm text-yellow-200 mt-4 hidden" id="modalWarn">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <span id="modalWarnText">...</span>
                </div>
            </div>
            <div class="p-4 bg-slate-950/50 flex justify-end">
                <button onclick="ui.closeModal()" class="bg-blue-600 hover:bg-blue-500 text-white font-medium py-2 px-6 rounded-lg transition">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="bg-slate-900 border-b border-slate-800 shrink-0 h-16 flex items-center justify-between px-4">
        <div class="flex items-center gap-3">
            <div class="bg-red-500/10 p-2 rounded">
                <i class="fas fa-user-shield text-red-400 text-xl"></i>
            </div>
            <div class="hidden sm:block">
                <h1 class="font-bold tracking-wide text-lg text-white">PhishSim <span class="text-xs text-slate-500 bg-slate-800 px-1 rounded ml-1">v3.3</span></h1>
            </div>
        </div>
        
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2 px-3 py-1 bg-slate-800 rounded border border-slate-700">
                <span class="hidden sm:inline text-xs text-slate-400">Config:</span>
                <span id="envStatus" class="text-xs font-bold text-red-500 font-mono">NO 2FA</span>
            </div>
            <button onclick="core.fullReset()" class="text-xs text-slate-400 hover:text-white flex items-center gap-2 border border-slate-700 px-3 py-1.5 rounded hover:bg-slate-800 transition">
                <i class="fas fa-power-off"></i> <span class="hidden sm:inline">Reset</span>
            </button>
        </div>
    </header>

    <div class="bg-yellow-600/20 border-b border-yellow-600/30 p-1 text-center">
        <p class="text-[10px] text-yellow-500 font-mono uppercase tracking-widest">
            <i class="fas fa-exclamation-circle mr-1"></i> –¢—ñ–ª—å–∫–∏ –¥–ª—è –æ—Å–≤—ñ—Ç–Ω—ñ—Ö —Ü—ñ–ª–µ–π.
        </p>
    </div>

    <!-- MOBILE TABS -->
    <div class="md:hidden flex border-b border-slate-800 bg-slate-900">
        <button id="tabPhone" onclick="ui.switchTab('phone')" class="flex-1 py-3 text-sm font-bold border-b-2 border-blue-500 text-blue-400 flex items-center justify-center gap-2 transition-colors">
            <i class="fas fa-mobile-alt"></i> –ñ–µ—Ä—Ç–≤–∞
        </button>
        <button id="tabTerminal" onclick="ui.switchTab('terminal')" class="flex-1 py-3 text-sm font-bold border-b-2 border-transparent text-slate-500 flex items-center justify-center gap-2 transition-colors">
            <i class="fas fa-terminal"></i> –•–∞–∫–µ—Ä (C2)
        </button>
    </div>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col md:grid md:grid-cols-2 overflow-hidden relative">
        
        <!-- LEFT: VICTIM PHONE -->
        <div id="panelPhone" class="flex-1 relative bg-stripes flex items-center justify-center p-4 md:p-8 md:flex">
            
            <div class="absolute top-4 left-4 bg-slate-800 text-white text-xs px-3 py-1 rounded-full shadow-lg z-10 font-mono">
                <i class="fas fa-mobile-alt mr-2"></i>TARGET: iPhone 13
            </div>

            <!-- Phone Frame -->
            <div class="w-[320px] h-[640px] bg-black rounded-[3rem] border-[8px] border-slate-800 shadow-2xl relative overflow-hidden ring-1 ring-slate-900/50 z-20 scale-[0.85] sm:scale-100 transition-transform origin-top md:origin-center">
                <div class="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-6 bg-black rounded-b-xl z-20 flex justify-center items-center gap-4">
                    <div class="w-10 h-1 rounded-full bg-slate-800"></div>
                    <div class="w-1 h-1 rounded-full bg-blue-900"></div>
                </div>

                <!-- Phone Screen -->
                <div id="phoneScreen" class="w-full h-full bg-white text-slate-900 pt-8 pb-4 flex flex-col relative transition-colors duration-500 font-sans">
                    
                    <!-- Top Bar -->
                    <div class="px-5 pb-2 flex justify-between items-center text-xs font-bold text-slate-800 border-b border-slate-100">
                        <span>19:42</span>
                        <div class="flex gap-1">
                            <i class="fas fa-signal"></i>
                            <i class="fas fa-wifi"></i>
                            <i class="fas fa-battery-full"></i>
                        </div>
                    </div>

                    <!-- VIEW: CHAT LIST -->
                    <div id="viewChatList" class="flex-1 overflow-hidden flex flex-col">
                        <div class="bg-[#517da2] px-4 py-3 flex items-center gap-4 text-white shadow-sm shrink-0">
                            <button onclick="ui.toggleMenu()" class="hover:bg-white/10 p-1 rounded"><i class="fas fa-bars"></i></button>
                            <span class="font-bold text-lg">Telegram</span>
                            <div class="ml-auto"><i class="fas fa-search"></i></div>
                        </div>
                        
                        <!-- Side Menu -->
                        <div id="sideMenu" class="absolute inset-y-0 left-0 w-64 bg-white shadow-2xl z-50 transform -translate-x-full transition-transform duration-300 flex flex-col pt-12">
                            <div class="bg-[#517da2] p-4 text-white absolute top-0 w-full h-32 -z-10"></div>
                            <div class="px-4 mb-4 flex gap-3 items-center">
                                <div class="w-12 h-12 rounded-full bg-blue-400 text-white flex items-center justify-center text-xl font-bold">V</div>
                                <div class="text-white">
                                    <div class="font-bold">Victim User</div>
                                    <div class="text-xs opacity-80">+380 50 123 45 67</div>
                                </div>
                            </div>
                            <div class="mt-8 py-2 border-t border-slate-100">
                                <button onclick="ui.openSettings()" class="w-full text-left px-4 py-3 hover:bg-slate-50 flex items-center gap-4 text-slate-700">
                                    <i class="fas fa-cog text-slate-400 w-6"></i> –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
                                </button>
                            </div>
                            <button onclick="ui.toggleMenu()" class="absolute top-2 right-2 text-white/80 p-2"><i class="fas fa-times"></i></button>
                        </div>

                        <!-- Chat List -->
                        <div class="flex-1 overflow-y-auto divide-y divide-slate-100">
                            <!-- Service Chat -->
                            <div class="px-3 py-2 flex gap-3 hover:bg-slate-50 cursor-pointer" onclick="ui.openChat('service')">
                                <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-500 font-bold text-lg"><i class="fas fa-shield-alt"></i></div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex justify-between items-baseline">
                                        <h4 class="font-bold text-sm text-[#517da2] flex items-center gap-1">Telegram <i class="fas fa-check-circle text-blue-400 text-xs"></i></h4>
                                        <span class="text-[10px] text-slate-400">–í—á–æ—Ä–∞</span>
                                    </div>
                                    <p class="text-xs text-slate-500 truncate" id="serviceChatPreview">Login code: 11223. Do not...</p>
                                </div>
                            </div>
                            <!-- Phishing Chat -->
                            <div id="phishChatPreview" class="hidden animate-notif px-3 py-2 bg-blue-50/80 gap-3 cursor-pointer border-l-4 border-blue-500" onclick="ui.openChat('phishing')">
                                <div class="w-12 h-12 rounded-full bg-green-500 flex items-center justify-center text-white font-bold text-lg">A</div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex justify-between items-baseline">
                                        <h4 class="font-bold text-sm truncate">–ê–Ω–Ω–∞ (–û–¥–Ω–æ–∫–ª–∞—Å–Ω–∏—Ü—è)</h4>
                                        <span class="text-[10px] text-blue-500 font-bold">19:43</span>
                                    </div>
                                    <p class="text-xs text-blue-600 font-bold truncate">–ü—Ä–∏–≤—ñ—Ç! –ü—Ä–æ–≥–æ–ª–æ—Å—É–π –ø–ª–∏–∑...</p>
                                    <div class="mt-1 inline-block bg-blue-500 text-white text-[10px] px-1.5 rounded-full">1</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: SETTINGS -->
                    <div id="viewDevices" class="hidden absolute inset-0 bg-[#f0f2f5] z-40 flex flex-col pt-8 animate-slide-up">
                        <div class="bg-white px-4 py-3 flex items-center gap-4 border-b shadow-sm shrink-0">
                            <button onclick="ui.closeSettings()"><i class="fas fa-arrow-left text-slate-500"></i></button>
                            <span class="font-bold text-lg text-slate-800">–ü—Ä–∏—Å—Ç—Ä–æ—ó</span>
                        </div>
                        <div class="p-2">
                            <div class="text-xs font-bold text-slate-500 uppercase ml-2 mb-2 mt-2">–¶–µ–π –ø—Ä–∏—Å—Ç—Ä—ñ–π</div>
                            <div class="bg-white p-3 rounded-xl mb-4 flex gap-3 items-center">
                                <i class="fas fa-mobile-alt text-3xl text-blue-500"></i>
                                <div>
                                    <div class="font-bold text-sm">iPhone 13</div>
                                    <div class="text-xs text-slate-500">Telegram iOS 10.2 ‚Ä¢ Kyiv, Ukraine</div>
                                    <div class="text-xs text-green-500">Online</div>
                                </div>
                            </div>

                            <div class="text-xs font-bold text-slate-500 uppercase ml-2 mb-2">–ê–∫—Ç–∏–≤–Ω—ñ —Å–µ–∞–Ω—Å–∏</div>
                            <div id="hackerSession" class="hidden bg-white p-3 rounded-xl border-l-4 border-red-500 flex gap-3 items-center relative animate-fade-in">
                                <i class="fab fa-linux text-3xl text-slate-600"></i>
                                <div class="flex-1">
                                    <div class="font-bold text-sm">Chrome, Linux</div>
                                    <div class="text-xs text-slate-500">Web Client ‚Ä¢ Kyiv, Ukraine</div>
                                    <div class="text-xs text-slate-400">–©–æ–π–Ω–æ</div>
                                </div>
                                <button onclick="core.killSession()" class="text-red-500 text-xs font-bold border border-red-200 px-2 py-1 rounded bg-red-50 hover:bg-red-100">–ó–∞–≤–µ—Ä—à–∏—Ç–∏</button>
                            </div>
                            <div id="noActiveSessions" class="text-center text-slate-400 text-sm py-4">
                                –ù–µ–º–∞—î —ñ–Ω—à–∏—Ö –∞–∫—Ç–∏–≤–Ω–∏—Ö —Å–µ–∞–Ω—Å—ñ–≤
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: CHAT DETAIL (Dynamic) -->
                    <div id="viewChatDetail" class="hidden absolute inset-0 bg-[#879eb3] z-30 flex flex-col pt-8">
                        <div class="bg-white px-4 py-2 flex items-center gap-3 border-b shadow-sm shrink-0">
                            <i class="fas fa-arrow-left text-slate-500 cursor-pointer" onclick="ui.goBack()"></i>
                            <div id="chatAvatar" class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white text-sm font-bold">A</div>
                            <div>
                                <h4 id="chatName" class="font-bold text-sm text-black">Name</h4>
                                <p class="text-[10px] text-blue-500">online</p>
                            </div>
                        </div>
                        <div class="flex-1 p-3 flex flex-col gap-3 overflow-y-auto" id="chatMessages">
                            <!-- Messages injected here -->
                        </div>
                    </div>

                    <!-- VIEW: FAKE BROWSER -->
                    <div id="viewBrowser" class="hidden absolute inset-0 bg-white z-40 flex flex-col pt-8 animate-slide-up">
                        <div class="bg-slate-100 p-2 border-b flex items-center gap-2 text-xs">
                            <div class="flex-1 bg-white border border-slate-300 rounded px-2 py-1 flex items-center justify-between text-slate-600 shadow-inner">
                                <span class="truncate">teleg-vote.com/login</span>
                                <i class="fas fa-lock text-green-600 text-[10px] cursor-pointer hover:scale-125 transition" onclick="ui.showLockInfo()"></i>
                            </div>
                            <i class="fas fa-ellipsis-v text-slate-400"></i>
                        </div>
                        
                        <div class="flex-1 p-6 flex flex-col items-center justify-center bg-slate-50 relative">
                            <!-- Step A: Enter Phone -->
                            <div id="siteStep1" class="w-full max-w-xs text-center">
                                <div class="w-20 h-20 bg-[#517da2] rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg">
                                    <i class="fas fa-paper-plane text-white text-4xl transform -translate-x-1 translate-y-1"></i>
                                </div>
                                <h2 class="text-xl font-bold mb-1 text-black">–í—Ö—ñ–¥ –≤ Telegram</h2>
                                <p class="text-slate-500 text-xs mb-8">–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Å–≤—ñ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É.</p>
                                <div class="text-left mb-6 relative">
                                    <label class="text-[10px] font-bold text-[#517da2] uppercase absolute -top-2 left-2 bg-slate-50 px-1">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                    <input type="text" id="victimPhone" class="w-full border-2 border-slate-200 rounded-lg p-3 text-lg font-mono focus:outline-none focus:border-[#517da2] text-black bg-white transition" value="+380" placeholder="+380 XX XXX XX XX">
                                </div>
                                <button onclick="core.submitPhone()" class="w-full bg-[#517da2] hover:bg-[#40688a] text-white font-bold py-3.5 rounded-xl shadow-lg transition transform active:scale-95 uppercase tracking-wider text-sm">–î–∞–ª—ñ</button>
                            </div>

                            <!-- Step B: Enter SMS Code -->
                            <div id="siteStep2" class="hidden w-full max-w-xs text-center">
                                <h2 class="text-lg font-bold mb-2 text-black">–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥</h2>
                                <p class="text-slate-500 text-xs mb-6">–ú–∏ –Ω–∞–¥—ñ—Å–ª–∞–ª–∏ –∫–æ–¥ –≤ –¥–æ–¥–∞—Ç–æ–∫ Telegram.</p>
                                <div class="flex justify-center gap-2 mb-6">
                                    <input type="text" id="otpInput" maxlength="5" class="w-36 text-center border-b-2 border-[#517da2] text-3xl font-mono tracking-[0.5em] focus:outline-none bg-transparent text-black" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                </div>
                                <button onclick="core.submitOTP()" class="w-full bg-[#517da2] hover:bg-[#40688a] text-white font-bold py-3.5 rounded-xl shadow-lg mb-2 uppercase text-sm">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
                            </div>

                            <!-- Step C: Enter Cloud Password (2FA) -->
                            <div id="siteStep3" class="hidden w-full max-w-xs text-center">
                                <div class="mb-4 text-[#517da2]"><i class="fas fa-cloud-lock text-5xl"></i></div>
                                <h2 class="text-lg font-bold mb-2 text-black">–•–º–∞—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å</h2>
                                <p class="text-slate-500 text-xs mb-6">–¶–µ–π –∞–∫–∞—É–Ω—Ç –∑–∞—Ö–∏—â–µ–Ω–æ –¥–≤–æ–µ—Ç–∞–ø–Ω–æ—é –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é.</p>
                                <input type="password" class="w-full border-2 border-slate-200 rounded-lg p-3 mb-4 text-center text-black" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å">
                                <button class="w-full bg-[#517da2] opacity-50 cursor-not-allowed text-white font-bold py-3 rounded-xl shadow-lg">–£–≤—ñ–π—Ç–∏</button>
                                <p class="text-[10px] text-red-500 mt-4 font-bold hidden bg-red-50 p-2 rounded" id="2faNotice">
                                    <i class="fas fa-ban mr-1"></i> –•–∞–∫–µ—Ä –Ω–µ –∑–Ω–∞—î –ø–∞—Ä–æ–ª—è. –ê—Ç–∞–∫–∞ –∑—É–ø–∏–Ω–µ–Ω–∞.
                                </p>
                            </div>

                            <!-- Loader -->
                            <div id="siteLoader" class="hidden absolute inset-0 bg-white/95 flex flex-col items-center justify-center z-50">
                                <div class="w-10 h-10 border-4 border-slate-200 border-t-[#517da2] rounded-full animate-spin mb-4"></div>
                                <div class="text-xs text-slate-500 font-mono">–ó'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º...</div>
                            </div>
                        </div>
                    </div>

                    <!-- NOTIFICATION -->
                    <div id="sysNotification" class="absolute top-2 left-2 right-2 bg-white/95 backdrop-blur text-slate-800 p-3 rounded-2xl shadow-2xl z-50 hidden transform -translate-y-full transition-transform duration-500 border border-slate-200 cursor-pointer" onclick="ui.switchTab('phone')">
                        <div class="flex gap-3">
                            <div class="shrink-0 pt-1"><i class="fab fa-telegram text-[#517da2] text-2xl"></i></div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <h4 class="font-bold text-sm">Login code: <span id="realOtpCode" class="font-mono text-lg"></span></h4>
                                    <span class="text-[10px] text-slate-400">now</span>
                                </div>
                                <p class="text-xs text-slate-600 mt-1">Do not give this code to anyone!</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- RIGHT: HACKER TERMINAL -->
        <div id="panelTerminal" class="flex-1 bg-[#0d1117] flex flex-col border-l border-slate-800 relative hidden md:flex font-mono text-sm leading-tight">
            <div class="bg-[#161b22] p-3 border-b border-slate-800 flex justify-between items-center shrink-0">
                <span class="text-slate-400 text-xs">root@c2:~/evilginx2#</span>
                <div class="text-[10px] text-green-500">LISTENING :443</div>
            </div>
            <div id="terminalOutput" class="flex-1 p-4 overflow-y-auto text-slate-300 terminal-scroll font-mono text-xs">
                <div class="text-slate-500 mb-2">./start_server.sh --phishlets telegram.yaml</div>
                <div class="text-blue-400">[INFO] Evilginx v3.2.0 initialized</div>
                <div class="text-green-500">[SUCCESS] Server listening on https://teleg-vote.com</div>
                <div class="text-slate-500">Waiting for victim...</div>
            </div>
            <div class="p-4 bg-[#161b22] border-t border-slate-800">
                <div id="taskBox" class="mb-4 bg-slate-900 border border-slate-700 p-3 rounded flex flex-col gap-2">
                    <div class="flex justify-between items-start">
                        <h3 class="text-blue-400 font-bold text-xs uppercase tracking-wider"><i class="fas fa-terminal mr-1"></i> Current Task</h3>
                        <button onclick="ui.showExplanation()" class="text-xs text-slate-400 hover:text-white underline decoration-dotted">–ê–Ω–∞–ª—ñ–∑</button>
                    </div>
                    <p id="missionText" class="text-slate-200 text-xs">...</p>
                    <div id="cmdHintBlock" class="mt-1">
                        <code id="cmdHint" class="block bg-black p-2 rounded text-green-400 font-mono text-xs border border-slate-800 cursor-pointer hover:bg-slate-950 hover:border-green-800 transition select-none" onclick="core.fillCommand()" title="–í—Å—Ç–∞–≤–∏—Ç–∏ –∫–æ–º–∞–Ω–¥—É">...</code>
                    </div>
                </div>
                <form id="cmdForm" class="flex items-center gap-2 bg-black p-2 rounded border border-slate-800 focus-within:border-green-800 transition" onsubmit="core.handleCommand(event)">
                    <span class="text-green-500 font-bold font-mono text-xs shrink-0">root@c2:~#</span>
                    <input id="cmdInput" type="text" autocomplete="off" class="flex-1 bg-transparent border-none text-white focus:ring-0 focus:outline-none font-mono text-xs" placeholder="..." autofocus>
                </form>
            </div>
        </div>
    </main>

    <script>
        // --- CONSTANTS & CONFIG ---
        const CONFIG = {
            STEPS: [
                {
                    id: 'deploy',
                    cmd: './deploy.py --template telegram_vote',
                    mission: "–ï—Ç–∞–ø 1: –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è. –ó–∞–ø—É—Å–∫ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ –∑ –∫–æ–ø—ñ—î—é –¥–∏–∑–∞–π–Ω—É Telegram.",
                    termLog: `[INFO] Templates loaded: /templates/telegram_vote/\n[INFO] SSL Certificates loaded (LetsEncrypt)\n[SUCCESS] Web Server started on 0.0.0.0:443\n[INFO] Public URL: https://teleg-vote.com`,
                    expl: {
                        title: "–§–µ–π–∫–æ–≤–∏–π —Å–∞–π—Ç",
                        text: "–ú–∏ —Ä–æ–∑–≥–æ—Ä–Ω—É–ª–∏ —Å–∞–π—Ç, —â–æ –≤–∏–≥–ª—è–¥–∞—î —è–∫ Telegram. –ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ HTTPS. –ë–∞–≥–∞—Ç–æ –ª—é–¥–µ–π –¥—É–º–∞—é—Ç—å, —â–æ '–∑–∞–º–æ–∫' –æ–∑–Ω–∞—á–∞—î –±–µ–∑–ø–µ–∫—É, –∞–ª–µ —Ü–µ –ª–∏—à–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–∞–Ω–∞–ª—É.",
                        tip: "–ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π –¥–æ–º–µ–Ω: teleg-vote.com != telegram.org"
                    }
                },
                {
                    id: 'send_lure',
                    cmd: 'python3 send_msg.py --target +380501234567',
                    mission: "–ï—Ç–∞–ø 2: –°–æ—Ü—ñ–∞–ª—å–Ω–∞ —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—è. –î–æ—Å—Ç–∞–≤–∫–∞ —Ñ—ñ—à–∏–Ω–≥–æ–≤–æ–≥–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è.",
                    termLog: `[>] Connecting to MTProto API... OK\n[>] Authenticated as User#7712 (Compromised)\n[>] Sending message to Victim...\n[<] RPC_RESULT: MessageSent (id: 8821)`,
                    expl: {
                        title: "–õ–∞–Ω—Ü—é–≥–æ–≤–∞ —Ä–µ–∞–∫—Ü—ñ—è",
                        text: "–§—ñ—à–∏–Ω–≥ —á–∞—Å—Ç–æ –ø–æ—à–∏—Ä—é—î—Ç—å—Å—è —è–∫ –≤—ñ—Ä—É—Å. –ó–ª–∞–º–∞–≤—à–∏ –æ–¥–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —Å–∫—Ä–∏–ø—Ç —Ä–æ–∑—Å–∏–ª–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –π–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º. –í–∏ –¥–æ–≤—ñ—Ä—è—î—Ç–µ –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫—É, —Ç–æ–º—É –∫–ª—ñ–∫–∞—î—Ç–µ.",
                        tip: "–ö—Ä–∏—Ç–∏—á–Ω–æ —Å—Ç–∞–≤—Ç–µ—Å—è –¥–æ –ø—Ä–æ—Ö–∞–Ω—å '–ø—Ä–æ–≥–æ–ª–æ—Å—É–≤–∞—Ç–∏' –Ω–∞–≤—ñ—Ç—å –≤—ñ–¥ –±–ª–∏–∑—å–∫–∏—Ö."
                    }
                },
                {
                    id: 'wait_click',
                    cmd: 'tail -f access.log',
                    mission: "–ï—Ç–∞–ø 3: –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ—Ö–æ–¥—É –∂–µ—Ä—Ç–≤–∏.",
                    termLog: `[INFO] Tailing access logs...\n...`,
                    manualTrigger: true,
                    expl: {
                        title: "–ü–µ—Ä–µ—Ö—ñ–¥ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º",
                        text: "–ñ–µ—Ä—Ç–≤–∞ –∫–ª—ñ–∫–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è —ñ –ø–æ—Ç—Ä–∞–ø–ª—è—î –Ω–∞ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä.",
                        tip: "–Ø–∫—â–æ Telegram –ø—Ä–æ—Å–∏—Ç—å –≤–≤–µ—Å—Ç–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É –Ω–∞ —Å–∞–π—Ç—ñ ‚Äî —Ü–µ 100% –æ–±–º–∞–Ω."
                    }
                },
                {
                    id: 'intercept_phone',
                    cmd: 'intercepting...',
                    mission: "–ï—Ç–∞–ø 4: –ü–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –Ω–æ–º–µ—Ä–∞ —Ç–∞ –∑–∞–ø–∏—Ç –∫–æ–¥—É.",
                    termLog: `[HTTP] POST /api/login_phone\n[DATA] phone_number: +380...\n[API] Sending AuthRequest to Official Telegram API...\n[API] RESPONSE: 200 OK (type: sentCode)`,
                    manualTrigger: true,
                    expl: {
                        title: "Man-in-the-Middle",
                        text: "–°–µ—Ä–≤–µ—Ä —Ö–∞–∫–µ—Ä–∞ –º–∏—Ç—Ç—î–≤–æ –ø–µ—Ä–µ–¥–∞—î –Ω–æ–º–µ—Ä –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∏ Telegram. Telegram –¥—É–º–∞—î, —â–æ —Ü–µ –≤—Ö—ñ–¥ –∑ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é (Linux), —ñ –Ω–∞–¥—Å–∏–ª–∞—î –∫–æ–¥.",
                        tip: "–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è: —Ç–∞–º –±—É–¥–µ 'Web Client' –∞–±–æ 'Linux', –∞ –Ω–µ –≤–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω."
                    }
                },
                {
                    id: 'intercept_otp',
                    cmd: 'waiting_otp...',
                    mission: "–ï—Ç–∞–ø 5: –ü–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –∫–æ–¥—É.",
                    termLog: `[HTTP] POST /api/login_code\n[DATA] phone_code: XXXXX\n[API] Sending AuthSignIn to Official Telegram API...`,
                    manualTrigger: true,
                    expl: {
                        title: "–í–∏–∫—Ä–∞–¥–µ–Ω–Ω—è —Å–µ—Å—ñ—ó",
                        text: "–í–∏ –≤–≤–æ–¥–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Å–∞–π—Ç—ñ. –•–∞–∫–µ—Ä –æ—Ç—Ä–∏–º—É—î –π–æ–≥–æ —ñ –ø–µ—Ä–µ–¥–∞—î –≤ Telegram. –ë–µ–∑ 2FA —Å–µ—Ä–≤–µ—Ä –≤–∏–¥–∞—î —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø—É.",
                        tip: "–ö–æ–¥ ‚Äî —Ü–µ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Ä—É–±—ñ–∂ –æ–±–æ—Ä–æ–Ω–∏ (—è–∫—â–æ –Ω–µ–º–∞—î 2FA)."
                    }
                },
                {
                    id: 'hijack_attempt',
                    cmd: './export_session.sh',
                    mission: "–ï—Ç–∞–ø 6: –†–µ–∑—É–ª—å—Ç–∞—Ç –∞—Ç–∞–∫–∏.",
                    termLog: `...`,
                    expl: {
                        title: "–§—ñ–Ω–∞–ª",
                        text: "–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –±–µ–∑–ø–µ–∫–∏.",
                        tip: "–ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ '–ü—Ä–∏—Å—Ç—Ä–æ—ó' –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ."
                    }
                }
            ]
        };

        // --- STATE MANAGEMENT ---
        const state = {
            stepIndex: 0,
            isProtected: false,
            generatedOtp: null,
            hackerSessionActive: false
        };

        // --- UI CONTROLLER ---
        const ui = {
            els: {
                term: document.getElementById('terminalOutput'),
                missionText: document.getElementById('missionText'),
                cmdInput: document.getElementById('cmdInput'),
                cmdHint: document.getElementById('cmdHint'),
                cmdHintBlock: document.getElementById('cmdHintBlock'),
                views: {
                    chatList: document.getElementById('viewChatList'),
                    chatDetail: document.getElementById('viewChatDetail'),
                    browser: document.getElementById('viewBrowser'),
                    devices: document.getElementById('viewDevices')
                },
                phoneInputs: {
                    phone: document.getElementById('victimPhone'),
                    otp: document.getElementById('otpInput')
                },
                overlays: {
                    sideMenu: document.getElementById('sideMenu'),
                    notif: document.getElementById('sysNotification'),
                    loader: document.getElementById('siteLoader'),
                    modal: document.getElementById('infoModal')
                },
                dynamic: {
                    otpCode: document.getElementById('realOtpCode'),
                    envStatus: document.getElementById('envStatus'),
                    hackerSession: document.getElementById('hackerSession'),
                    noSessions: document.getElementById('noActiveSessions'),
                    missionBox: document.getElementById('taskBox'),
                    servicePreview: document.getElementById('serviceChatPreview')
                },
                tabs: {
                    phone: document.getElementById('tabPhone'),
                    terminal: document.getElementById('tabTerminal'),
                    panelPhone: document.getElementById('panelPhone'),
                    panelTerminal: document.getElementById('panelTerminal')
                }
            },

            log(text, type = 'neutral') {
                const div = document.createElement('div');
                div.innerText = text;
                div.className = 'mb-1 break-all';
                const colors = { success: 'text-green-500', error: 'text-red-500', warning: 'text-yellow-500', expl: 'text-blue-300 italic border-l-2 border-blue-500 pl-2 my-2' };
                div.classList.add(...(colors[type] || 'text-slate-300').split(' '));
                this.els.term.appendChild(div);
                this.els.term.scrollTop = this.els.term.scrollHeight;
            },

            updateStep() {
                const step = CONFIG.STEPS[state.stepIndex];
                this.els.missionText.innerText = step.mission;
                const isManual = step.manualTrigger;
                
                this.els.cmdInput.disabled = isManual;
                this.els.cmdInput.value = '';
                this.els.cmdInput.placeholder = isManual ? "(–ß–µ–∫–∞—î–º–æ –¥—ñ—ó –∂–µ—Ä—Ç–≤–∏...)" : "root@c2:~#";
                if(isManual) this.els.cmdHintBlock.classList.add('hidden');
                else {
                    this.els.cmdHintBlock.classList.remove('hidden');
                    this.els.cmdHint.innerText = step.cmd;
                }
                if(!isManual) this.els.cmdInput.focus();
            },

            toggleMenu() { this.els.overlays.sideMenu.classList.toggle('-translate-x-full'); },
            
            openSettings() {
                this.toggleMenu();
                this.showView('devices');
                const hasHacker = state.hackerSessionActive;
                this.els.dynamic.hackerSession.classList.toggle('hidden', !hasHacker);
                this.els.dynamic.noSessions.classList.toggle('hidden', hasHacker);
            },
            
            closeSettings() { this.showView('chatList'); },

            showView(viewName) {
                Object.values(this.els.views).forEach(el => el.classList.add('hidden'));
                this.els.views[viewName].classList.remove('hidden');
            },

            openChat(type) {
                if (type === 'phishing') {
                    if (CONFIG.STEPS[state.stepIndex].id !== 'wait_click') return;
                    document.getElementById('chatAvatar').innerText = 'A';
                    document.getElementById('chatAvatar').className = "w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white text-sm font-bold";
                    document.getElementById('chatName').innerText = "–ê–Ω–Ω–∞";
                    document.getElementById('chatMessages').innerHTML = `
                        <div class="self-start bg-white rounded-tr-xl rounded-br-xl rounded-bl-xl p-3 max-w-[85%] shadow-sm text-sm text-black leading-snug">
                            –ü—Ä–∏–≤—ñ—Ç! üëã<br>–°–ª—É—Ö–∞–π, –º–æ—è –º–∞–ª–∞ –±–µ—Ä–µ —É—á–∞—Å—Ç—å —É –∫–æ–Ω–∫—É—Ä—Å—ñ –º–∞–ª—é–Ω–∫—ñ–≤. –ú–æ–∂–µ—à –ø—Ä–æ–≥–æ–ª–æ—Å—É–≤–∞—Ç–∏ –∑–∞ –Ω–µ—ó?<br>
                            –¢—Ä–µ–±–∞ –ø—Ä–æ—Å—Ç–æ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –ª–∞–π–∫.<br><br>–û—Å—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è:<br>
                            <a href="#" onclick="core.openBrowser()" class="text-[#517da2] underline font-bold break-all">http://teleg-vote.com/contest/art2025</a>
                        </div>`;
                    this.showView('chatDetail');
                } else if (type === 'service') {
                    document.getElementById('chatAvatar').innerHTML = '<i class="fas fa-shield-alt"></i>';
                    document.getElementById('chatAvatar').className = "w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-500 text-sm font-bold";
                    document.getElementById('chatName').innerText = "Telegram";
                    let msgs = `<div class="self-start bg-white rounded-tr-xl rounded-br-xl rounded-bl-xl p-3 max-w-[85%] shadow-sm text-sm text-black leading-snug">Login code: 11223.<br>Do not give this code to anyone!</div>`;
                    if (state.generatedOtp) {
                        msgs += `<div class="self-start bg-white rounded-tr-xl rounded-br-xl rounded-bl-xl p-3 max-w-[85%] shadow-sm text-sm text-black leading-snug mt-2">Login code: <strong>${state.generatedOtp}</strong>.<br>Do not give this code to anyone!<br><br><span class="text-xs text-slate-500">Device: Chrome, Linux<br>Location: Kyiv, Ukraine</span></div>`;
                    }
                    document.getElementById('chatMessages').innerHTML = msgs;
                    this.showView('chatDetail');
                }
            },

            goBack() { this.showView('chatList'); },

            showLockInfo() {
                this.showModal("HTTPS (–ó–∞–º–æ–∫)", "–¶–µ–π –∑–Ω–∞—á–æ–∫ –æ–∑–Ω–∞—á–∞—î –ª–∏—à–µ —à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –∫–∞–Ω–∞–ª—É. –¶–µ –ù–ï –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ —Å–∞–π—Ç —Å–ø—Ä–∞–≤–∂–Ω—ñ–π. –•–∞–∫–µ—Ä–∏ —Ç–µ–∂ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å HTTPS.", "–ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –¥–æ–º–µ–Ω (teleg-vote.com).");
            },

            showExplanation() {
                const step = CONFIG.STEPS[state.stepIndex];
                if(step.expl) this.showModal(step.expl.title, step.expl.text, step.expl.tip);
            },

            showModal(title, text, warn) {
                document.getElementById('modalTitle').innerText = title;
                document.getElementById('modalText').innerText = text;
                const w = document.getElementById('modalWarn');
                if(warn) { w.classList.remove('hidden'); document.getElementById('modalWarnText').innerText = warn; }
                else w.classList.add('hidden');
                this.els.overlays.modal.classList.remove('hidden');
                setTimeout(() => { this.els.overlays.modal.classList.remove('opacity-0'); document.getElementById('modalContent').classList.remove('scale-95'); }, 10);
            },

            closeModal() {
                this.els.overlays.modal.classList.add('opacity-0');
                document.getElementById('modalContent').classList.add('scale-95');
                setTimeout(() => this.els.overlays.modal.classList.add('hidden'), 300);
            },

            switchTab(tab) {
                const isPhone = tab === 'phone';
                this.els.tabs.panelPhone.classList.toggle('hidden', !isPhone);
                this.els.tabs.panelPhone.classList.toggle('flex', isPhone);
                this.els.tabs.panelTerminal.classList.toggle('hidden', isPhone);
                this.els.tabs.panelTerminal.classList.toggle('flex', !isPhone);
                
                const activeClass = ['text-blue-400', 'border-blue-500'];
                const inactiveClass = ['text-slate-500', 'border-transparent'];
                
                this.els.tabs.phone.classList[isPhone ? 'add' : 'remove'](...activeClass);
                this.els.tabs.phone.classList[isPhone ? 'remove' : 'add'](...inactiveClass);
                this.els.tabs.terminal.classList[!isPhone ? 'add' : 'remove'](...activeClass);
                this.els.tabs.terminal.classList[!isPhone ? 'remove' : 'add'](...inactiveClass);
            },

            showNotif(code) {
                this.els.dynamic.otpCode.innerText = code;
                this.els.dynamic.servicePreview.innerText = `Login code: ${code}. Do not...`;
                this.els.overlays.notif.classList.remove('hidden', '-translate-y-full');
                setTimeout(() => this.els.overlays.notif.classList.add('-translate-y-full'), 8000);
            },

            finishPhase(saved) {
                this.els.cmdInput.disabled = true;
                this.els.cmdInput.placeholder = "Scenario Ended";
                this.els.cmdHintBlock.classList.add('hidden');

                const btn = document.createElement('button');
                btn.className = "w-full font-bold py-3 rounded mt-2 text-sm transition animate-fade-in";
                
                if (saved) {
                    this.els.missionText.innerHTML = `<span class="text-green-400 font-bold">–ê–¢–ê–ö–£ –í–Ü–î–ë–ò–¢–û!</span><br>2FA –∑—É–ø–∏–Ω–∏–≤ —Ö–∞–∫–µ—Ä–∞.`;
                    btn.classList.add('bg-green-600', 'hover:bg-green-500', 'text-white');
                    btn.innerText = "–ó–∞–≤–µ—Ä—à–∏—Ç–∏";
                    btn.onclick = () => this.showModal("–í–∏—Å–Ω–æ–≤–æ–∫", "Active Sessions: –†–µ–≥—É–ª—è—Ä–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ '–ü—Ä–∏—Å—Ç—Ä–æ—ó'. Cloud Password (2FA): –¶–µ —î–¥–∏–Ω–∏–π –Ω–∞–¥—ñ–π–Ω–∏–π –±–∞—Ä'—î—Ä.", null);
                } else {
                    this.els.missionText.innerHTML = `<span class="text-red-500 font-bold">–ê–ö–ê–£–ù–¢ –ü–Ü–î –ó–ê–ì–†–û–ó–û–Æ!</span><br>–•–∞–∫–µ—Ä —É–≤—ñ–π—à–æ–≤.`;
                    btn.classList.add('bg-red-600', 'hover:bg-red-500', 'text-white', 'animate-pulse');
                    btn.innerText = "üÜò –í–†–Ø–¢–£–í–ê–¢–ò –ê–ö–ê–£–ù–¢";
                    btn.onclick = () => { this.switchTab('phone'); alert("–®–≤–∏–¥–∫–æ! –ú–µ–Ω—é -> –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -> –ü—Ä–∏—Å—Ç—Ä–æ—ó -> –ó–∞–≤–µ—Ä—à–∏—Ç–∏!"); };
                }
                this.els.dynamic.missionBox.appendChild(btn);
            }
        };

        // --- CORE LOGIC ---
        const core = {
            init() {
                state.isProtected = false;
                this.updateEnvStatus();
                ui.updateStep();
                ui.switchTab('phone');
            },

            updateEnvStatus() {
                ui.els.dynamic.envStatus.innerText = state.isProtected ? "SECURE (2FA)" : "NO 2FA";
                ui.els.dynamic.envStatus.className = state.isProtected ? "text-xs font-bold text-green-500 font-mono" : "text-xs font-bold text-red-500 font-mono";
            },

            handleCommand(e) {
                e.preventDefault();
                const val = ui.els.cmdInput.value.trim();
                if (!val) return;
                const step = CONFIG.STEPS[state.stepIndex];
                ui.log(`root@c2:~# ${val}`);

                if (val === step.cmd || val.startsWith(step.cmd.split(' ')[0])) {
                    this.executeStep(step);
                    ui.els.cmdInput.value = '';
                } else {
                    ui.log(`bash: ${val}: command not found`, 'error');
                }
            },

            fillCommand() {
                if (!ui.els.cmdInput.disabled) {
                    ui.els.cmdInput.value = CONFIG.STEPS[state.stepIndex].cmd;
                    ui.els.cmdInput.focus();
                }
            },

            executeStep(step) {
                if (step.termLog) {
                    step.termLog.split('\n').forEach((l, i) => setTimeout(() => ui.log(l, l.includes('SUCCESS') || l.includes('OK') ? 'success' : 'neutral'), i * 300));
                }
                if (step.termExpl) setTimeout(() => ui.log(step.termExpl, 'expl'), 1500);

                if (step.id === 'send_lure') {
                    setTimeout(() => {
                        document.getElementById('phishChatPreview').classList.remove('hidden');
                        this.advanceStep();
                    }, 2000);
                } else if (step.id === 'hijack_attempt') {
                    this.handleHijack();
                } else if (!step.manualTrigger) {
                    setTimeout(() => this.advanceStep(), 1500);
                }
            },

            advanceStep() {
                state.stepIndex++;
                ui.updateStep();
            },

            openBrowser() {
                if (CONFIG.STEPS[state.stepIndex].id !== 'wait_click') return;
                ui.log(`[ACCESS] GET /contest/art2025 IP: 192.168.1.55 UA: iPhone`, 'warning');
                this.executeStep(CONFIG.STEPS[state.stepIndex]); // Log prev step
                ui.showView('browser');
                this.advanceStep();
            },

            submitPhone() {
                const phone = ui.els.phoneInputs.phone.value.replace(/[\s-]/g, '');
                if (!/^\+380\d{9}$/.test(phone)) { alert("–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π –Ω–æ–º–µ—Ä: +380..."); return; }
                
                this.executeStep(CONFIG.STEPS[state.stepIndex]); // Log interception
                
                state.generatedOtp = Math.floor(10000 + Math.random() * 90000);
                
                ui.els.overlays.loader.classList.remove('hidden');
                setTimeout(() => {
                    ui.els.overlays.loader.classList.add('hidden');
                    document.getElementById('siteStep1').classList.add('hidden');
                    document.getElementById('siteStep2').classList.remove('hidden');
                    
                    setTimeout(() => ui.showNotif(state.generatedOtp), 1000);
                    this.advanceStep();
                }, 1500);
            },

            submitOTP() {
                const code = ui.els.phoneInputs.otp.value;
                if (Number(code) !== state.generatedOtp) { alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –∫–æ–¥! (–î–∏–≤. —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è)"); return; }
                
                this.executeStep(CONFIG.STEPS[state.stepIndex]);
                ui.els.overlays.loader.classList.remove('hidden');

                setTimeout(() => {
                    ui.els.overlays.loader.classList.add('hidden');
                    this.advanceStep(); // to hijack
                    document.getElementById('siteStep2').classList.add('hidden');
                    
                    if(state.isProtected) {
                        document.getElementById('siteStep3').classList.remove('hidden');
                        document.getElementById('2faNotice').classList.remove('hidden');
                    } else {
                        ui.els.overlays.loader.classList.remove('hidden');
                        state.hackerSessionActive = true;
                    }
                }, 1000);
            },

            handleHijack() {
                const seq = state.isProtected ? 
                    ["[API] AuthSignIn Success.", "[API] ERROR: SESSION_PASSWORD_NEEDED", "[FAIL] 2FA Enabled.", "[INFO] Session not captured."] : 
                    ["[API] AuthSignIn Success.", "[SUCCESS] Session String Exported.", "[INFO] Access granted.", "[INFO] Downloading contacts..."];

                seq.forEach((l, i) => setTimeout(() => ui.log(l, l.includes('SUCCESS') ? 'success' : (l.includes('FAIL') || l.includes('ERROR') ? 'error' : 'neutral')), i * 500));
                setTimeout(() => ui.finishPhase(state.isProtected), 2500);
            },

            killSession() {
                state.hackerSessionActive = false;
                ui.openSettings(); // Refresh
                alert("–°–µ—Å—ñ—é —Ö–∞–∫–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!");
                if (!state.isProtected && confirm("–£–≤—ñ–º–∫–Ω—É—Ç–∏ 2FA —ñ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏?")) {
                    this.fullReset(true);
                }
            },

            fullReset(protect = false) {
                state.stepIndex = 0;
                state.isProtected = protect;
                state.hackerSessionActive = false;
                state.generatedOtp = null;
                
                // DOM Reset
                ui.els.term.innerHTML = `<div class="text-green-500 font-bold mb-2">--- NEW SCENARIO: ${protect ? 'SECURE' : 'VULNERABLE'} ---</div>`;
                ui.showView('chatList');
                ui.els.overlays.sideMenu.classList.add('-translate-x-full');
                ui.els.phoneInputs.phone.value = "+380";
                ui.els.phoneInputs.otp.value = "";
                document.getElementById('siteStep1').classList.remove('hidden');
                document.getElementById('siteStep2').classList.add('hidden');
                document.getElementById('siteStep3').classList.add('hidden');
                document.getElementById('2faNotice').classList.add('hidden');
                
                const oldBtn = ui.els.dynamic.missionBox.querySelector('button.w-full');
                if(oldBtn) oldBtn.remove();

                this.updateEnvStatus();
                ui.updateStep();
                ui.switchTab(protect ? 'terminal' : 'phone');
            }
        };

        // Init
        core.init();
    </script>
</body>
</html>
