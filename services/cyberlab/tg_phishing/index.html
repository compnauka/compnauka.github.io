<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Phishing Simulator (Edu) v3.1 Mobile Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; }
        .font-mono { font-family: 'Fira Code', monospace; }
        
        /* Terminal Scrollbar */
        .terminal-scroll::-webkit-scrollbar { width: 6px; }
        .terminal-scroll::-webkit-scrollbar-track { background: #0f172a; }
        .terminal-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

        /* Animations */
        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slide-up 0.5s ease-out forwards; }

        @keyframes notif-pop {
            0% { transform: scale(0.8) translateY(-20px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        .animate-notif { animation: notif-pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        .step-active { @apply text-blue-400 border-blue-500 bg-blue-500/10; }
        .step-done { @apply text-green-400 border-green-500; }
        .step-pending { @apply text-slate-600 border-slate-700; }
        
        /* Custom Stripes Background */
        .bg-stripes {
            background: repeating-linear-gradient(
                45deg,
                #f1f5f9,
                #f1f5f9 10px,
                #e2e8f0 10px,
                #e2e8f0 20px
            );
        }
    </style>
</head>
<body class="h-screen w-screen bg-slate-950 flex flex-col text-slate-200">

    <!-- INFO MODAL -->
    <div id="infoModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-slate-900 border border-blue-500/50 rounded-2xl max-w-lg w-full shadow-2xl overflow-hidden transform scale-95 transition-transform duration-300" id="modalContent">
            <div class="bg-gradient-to-r from-blue-900 to-slate-900 p-4 flex items-center justify-between border-b border-blue-800">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-500/20 p-2 rounded-lg">
                        <i class="fas fa-graduation-cap text-blue-400"></i>
                    </div>
                    <h3 class="text-lg font-bold text-white">–ë–∞–∑–∞ –∑–Ω–∞–Ω—å</h3>
                </div>
                <button onclick="closeModal()" class="text-slate-400 hover:text-white transition"><i class="fas fa-times"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <h4 id="modalTitle" class="text-xl font-bold text-blue-400">...</h4>
                <div id="modalText" class="text-slate-300 text-base leading-relaxed space-y-2">...</div>
                <div class="bg-blue-900/20 p-3 rounded-lg border border-blue-800/50 text-sm text-blue-200 mt-4">
                    <i class="fas fa-info-circle mr-2"></i>
                    <span id="modalTip">...</span>
                </div>
            </div>
            <div class="p-4 bg-slate-950/50 flex justify-end">
                <button onclick="closeModal()" class="bg-blue-600 hover:bg-blue-500 text-white font-medium py-2 px-6 rounded-lg transition">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="bg-slate-900 border-b border-slate-800 shrink-0 h-16 flex items-center justify-between px-4 md:px-6">
        <div class="flex items-center gap-3">
            <div class="bg-cyan-500/10 p-2 rounded">
                <i class="fas fa-paper-plane text-cyan-400 text-xl"></i>
            </div>
            <div class="hidden xs:block">
                <h1 class="font-bold tracking-wide text-lg text-white">TG PhishSim <span class="text-xs text-cyan-500 bg-cyan-950 px-1 rounded ml-1">v3.1</span></h1>
            </div>
        </div>
        
        <!-- Environment Status -->
        <div class="flex items-center gap-2 px-3 py-1 bg-slate-800 rounded border border-slate-700 mx-2">
            <span class="hidden sm:inline text-xs text-slate-400">STATUS:</span>
            <span id="envStatus" class="text-xs font-bold text-red-500 font-mono">VULNERABLE</span>
        </div>

        <button onclick="fullReset()" class="text-xs text-slate-400 hover:text-white flex items-center gap-2 border border-slate-700 px-3 py-1.5 rounded hover:bg-slate-800 transition">
            <i class="fas fa-power-off"></i> <span class="hidden sm:inline">–°–∫–∏–¥–∞–Ω–Ω—è</span>
        </button>
    </header>

    <!-- MOBILE TABS (Visible only on small screens) -->
    <div class="md:hidden flex border-b border-slate-800 bg-slate-900">
        <button id="tabPhone" onclick="switchTab('phone')" class="flex-1 py-3 text-sm font-bold border-b-2 border-blue-500 text-blue-400 flex items-center justify-center gap-2 transition-colors">
            <i class="fas fa-mobile-alt"></i> –¢–µ–ª–µ—Ñ–æ–Ω –ñ–µ—Ä—Ç–≤–∏
        </button>
        <button id="tabTerminal" onclick="switchTab('terminal')" class="flex-1 py-3 text-sm font-bold border-b-2 border-transparent text-slate-500 flex items-center justify-center gap-2 transition-colors">
            <i class="fas fa-terminal"></i> –¢–µ—Ä–º—ñ–Ω–∞–ª –•–∞–∫–µ—Ä–∞
        </button>
    </div>

    <!-- MAIN CONTENT -->
    <main class="flex-1 flex flex-col md:grid md:grid-cols-2 overflow-hidden relative">
        
        <!-- LEFT: VICTIM PHONE -->
        <!-- Logic: On mobile, 'flex' if active tab, 'hidden' if inactive. On desktop, always 'flex' or 'block'. -->
        <div id="panelPhone" class="flex-1 relative bg-stripes flex items-center justify-center p-4 md:p-8 md:flex">
            
            <div class="absolute top-4 left-4 bg-slate-800 text-white text-xs px-3 py-1 rounded-full shadow-lg z-10 font-mono">
                <i class="fas fa-mobile-alt mr-2"></i>TARGET DEVICE
            </div>

            <!-- Phone Frame -->
            <div class="w-[320px] h-[640px] bg-black rounded-[3rem] border-[8px] border-slate-800 shadow-2xl relative overflow-hidden ring-1 ring-slate-900/50 z-20 scale-[0.85] sm:scale-100 transition-transform">
                <!-- Notch -->
                <div class="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-6 bg-black rounded-b-xl z-20 flex justify-center items-center gap-4">
                    <div class="w-10 h-1 rounded-full bg-slate-800"></div>
                    <div class="w-1 h-1 rounded-full bg-blue-900"></div>
                </div>

                <!-- Phone Screen -->
                <div id="phoneScreen" class="w-full h-full bg-white text-slate-900 pt-8 pb-4 flex flex-col relative transition-colors duration-500">
                    
                    <!-- TOP BAR -->
                    <div class="px-5 pb-2 flex justify-between items-center text-xs font-bold text-slate-800 border-b border-slate-100">
                        <span>19:42</span>
                        <div class="flex gap-1">
                            <i class="fas fa-signal"></i>
                            <i class="fas fa-wifi"></i>
                            <i class="fas fa-battery-full"></i>
                        </div>
                    </div>

                    <!-- VIEW: CHAT LIST -->
                    <div id="viewChatList" class="flex-1 overflow-hidden">
                        <div class="bg-blue-500 px-4 py-3 flex items-center gap-4 text-white shadow-sm">
                            <i class="fas fa-bars"></i>
                            <span class="font-bold text-lg">Telegram</span>
                            <div class="ml-auto"><i class="fas fa-search"></i></div>
                        </div>
                        <div class="divide-y divide-slate-100">
                            <!-- Victim's chats -->
                            <div class="px-3 py-2 flex gap-3 hover:bg-slate-50 cursor-pointer">
                                <div class="w-12 h-12 rounded-full bg-purple-500 flex items-center justify-center text-white font-bold text-lg">M</div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex justify-between items-baseline">
                                        <h4 class="font-bold text-sm truncate">–ú–∞–º–∞</h4>
                                        <span class="text-[10px] text-slate-400">18:30</span>
                                    </div>
                                    <p class="text-xs text-slate-500 truncate">–ö—É–ø–∏ —Ö–ª—ñ–±–∞ –ø–æ –¥–æ—Ä–æ–∑—ñ</p>
                                </div>
                            </div>
                            <!-- Dynamic Chat Injection -->
                            <div id="phishChatPreview" class="hidden animate-notif px-3 py-2 bg-blue-50/80 gap-3 cursor-pointer border-l-4 border-blue-500" onclick="openChat()">
                                <div class="w-12 h-12 rounded-full bg-green-500 flex items-center justify-center text-white font-bold text-lg">A</div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex justify-between items-baseline">
                                        <h4 class="font-bold text-sm truncate">–ê–Ω–Ω–∞ (–û–¥–Ω–æ–∫–ª–∞—Å–Ω–∏—Ü—è)</h4>
                                        <span class="text-[10px] text-blue-500 font-bold">19:43</span>
                                    </div>
                                    <p class="text-xs text-blue-600 font-bold truncate">–ü—Ä–∏–≤—ñ—Ç! –ü—Ä–æ–≥–æ–ª–æ—Å—É–π –ø–ª–∏–∑...</p>
                                    <div class="mt-1 inline-block bg-blue-500 text-white text-[10px] px-1.5 rounded-full">1</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: CHAT DETAIL -->
                    <div id="viewChatDetail" class="hidden absolute inset-0 bg-slate-100 z-30 flex flex-col pt-8">
                        <div class="bg-white px-4 py-2 flex items-center gap-3 border-b shadow-sm shrink-0">
                            <i class="fas fa-arrow-left text-slate-500 cursor-pointer" onclick="goBack('viewChatList')"></i>
                            <div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white text-sm font-bold">A</div>
                            <div>
                                <h4 class="font-bold text-sm">–ê–Ω–Ω–∞</h4>
                                <p class="text-[10px] text-blue-500">online</p>
                            </div>
                        </div>
                        <div class="flex-1 p-3 flex flex-col gap-3 overflow-y-auto bg-[#879eb3]/10">
                            <div class="self-start bg-white rounded-tr-lg rounded-br-lg rounded-bl-lg p-3 max-w-[85%] shadow-sm text-sm">
                                –ü—Ä–∏–≤—ñ—Ç! üëã<br>
                                –°–ª—É—Ö–∞–π, –º–æ—è –º–∞–ª–∞ –±–µ—Ä–µ —É—á–∞—Å—Ç—å —É –∫–æ–Ω–∫—É—Ä—Å—ñ –º–∞–ª—é–Ω–∫—ñ–≤. –ú–æ–∂–µ—à –ø—Ä–æ–≥–æ–ª–æ—Å—É–≤–∞—Ç–∏ –∑–∞ –Ω–µ—ó?<br>
                                –¢—Ä–µ–±–∞ –ø—Ä–æ—Å—Ç–æ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –ª–∞–π–∫.<br><br>
                                –û—Å—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è:<br>
                                <a href="#" onclick="openBrowser()" class="text-blue-500 underline font-bold break-all">http://teleg-vote.com/contest/art2025</a>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: FAKE BROWSER -->
                    <div id="viewBrowser" class="hidden absolute inset-0 bg-white z-40 flex flex-col pt-8 animate-slide-up">
                        <!-- Fake Address Bar -->
                        <div class="bg-slate-100 p-2 border-b flex items-center gap-2 text-xs">
                            <div class="flex-1 bg-white border border-slate-300 rounded px-2 py-1 flex items-center justify-between text-slate-600">
                                <span class="truncate">teleg-vote.com/login</span>
                                <i class="fas fa-lock text-green-600 text-[10px]"></i>
                            </div>
                            <i class="fas fa-ellipsis-v text-slate-400"></i>
                        </div>
                        
                        <!-- Fake Site Content -->
                        <div class="flex-1 p-6 flex flex-col items-center justify-center bg-slate-50 relative">
                            
                            <!-- Step A: Enter Phone -->
                            <div id="siteStep1" class="w-full max-w-xs text-center">
                                <div class="w-16 h-16 bg-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                                    <i class="fas fa-paper-plane text-white text-3xl"></i>
                                </div>
                                <h2 class="text-xl font-bold mb-1">–í—Ö—ñ–¥ –≤ Telegram</h2>
                                <p class="text-slate-500 text-xs mb-6">–©–æ–± –ø—Ä–æ–≥–æ–ª–æ—Å—É–≤–∞—Ç–∏, —É–≤—ñ–π–¥—ñ—Ç—å —É —Å–≤—ñ–π –∞–∫–∞—É–Ω—Ç.</p>
                                
                                <div class="text-left mb-4">
                                    <label class="text-[10px] font-bold text-slate-400 uppercase">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É</label>
                                    <input type="text" id="victimPhone" class="w-full border-b-2 border-blue-500 bg-transparent py-2 text-lg font-mono focus:outline-none" value="+380" placeholder="+380 XX XXX XX XX">
                                </div>
                                <button onclick="submitPhone()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-lg shadow-lg transition transform active:scale-95">–î–ê–õ–Ü</button>
                            </div>

                            <!-- Step B: Enter SMS Code -->
                            <div id="siteStep2" class="hidden w-full max-w-xs text-center">
                                <h2 class="text-lg font-bold mb-2">–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥</h2>
                                <p class="text-slate-500 text-xs mb-6">–ú–∏ –Ω–∞–¥—ñ—Å–ª–∞–ª–∏ –∫–æ–¥ –≤ –¥–æ–¥–∞—Ç–æ–∫ Telegram –Ω–∞ —ñ–Ω—à–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó.</p>
                                <div class="flex justify-center gap-2 mb-6">
                                    <input type="text" id="otpInput" maxlength="5" class="w-32 text-center border-b-2 border-blue-500 text-2xl font-mono tracking-widest focus:outline-none bg-transparent" placeholder="X X X X X">
                                </div>
                                <button onclick="submitOTP()" class="w-full bg-blue-500 text-white font-bold py-3 rounded-lg shadow-lg mb-2">–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò</button>
                            </div>

                            <!-- Step C: Enter Cloud Password (2FA) -->
                            <div id="siteStep3" class="hidden w-full max-w-xs text-center">
                                <div class="mb-4 text-blue-500"><i class="fas fa-key text-4xl"></i></div>
                                <h2 class="text-lg font-bold mb-2">–•–º–∞—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å</h2>
                                <p class="text-slate-500 text-xs mb-6">–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞—Ö–∏—â–µ–Ω–æ –ø–∞—Ä–æ–ª–µ–º.</p>
                                <input type="password" class="w-full border p-3 rounded mb-4 text-center" placeholder="–ü–∞—Ä–æ–ª—å">
                                <button class="w-full bg-blue-500 text-white font-bold py-3 rounded-lg shadow-lg opacity-50 cursor-not-allowed">–í–•–Ü–î</button>
                                <p class="text-[10px] text-red-500 mt-2 font-bold hidden" id="2faNotice">–•–∞–∫–µ—Ä –Ω–µ –∑–Ω–∞—î —Ü—å–æ–≥–æ –ø–∞—Ä–æ–ª—è!</p>
                            </div>

                            <!-- Loading Spinner -->
                            <div id="siteLoader" class="hidden absolute inset-0 bg-white/90 flex flex-col items-center justify-center z-50">
                                <div class="w-10 h-10 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-2"></div>
                                <div class="text-xs text-slate-500 font-mono">Connecting to Telegram API...</div>
                            </div>
                        </div>
                    </div>

                    <!-- REAL SYSTEM NOTIFICATION (POPUP) -->
                    <div id="sysNotification" class="absolute top-2 left-2 right-2 bg-slate-800/95 text-white p-3 rounded-xl shadow-xl z-50 hidden backdrop-blur transform -translate-y-full transition-transform duration-500 border-l-4 border-blue-400 cursor-pointer" onclick="switchTab('phone')" title="Code">
                        <div class="flex gap-3">
                            <div class="shrink-0 pt-1"><i class="fab fa-telegram text-blue-400 text-lg"></i></div>
                            <div>
                                <h4 class="font-bold text-sm">Telegram Service</h4>
                                <p class="text-xs text-slate-300">Login code: <span id="realOtpCode" class="font-bold text-white tracking-widest text-base"></span>. Do not give this code to anyone!</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- RIGHT: HACKER TERMINAL -->
        <!-- On mobile: Hidden by default, shown when tab is active -->
        <div id="panelTerminal" class="flex-1 bg-[#0c0c0c] flex flex-col border-l border-slate-800 relative hidden md:flex">
            
            <!-- Terminal Header -->
            <div class="bg-[#1a1a1a] p-3 border-b border-slate-800 flex justify-between items-center shrink-0">
                <div class="flex items-center gap-2">
                    <div class="flex gap-1.5">
                        <div class="w-3 h-3 rounded-full bg-red-500"></div>
                        <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                    </div>
                    <span class="text-slate-400 text-xs font-mono ml-2">root@c2-server:~/phish-kit</span>
                </div>
                <div class="text-[10px] font-mono text-green-600">CONNECTED <i class="fas fa-bolt"></i></div>
            </div>

            <!-- Log Output -->
            <div id="terminalOutput" class="flex-1 p-4 font-mono text-sm overflow-y-auto text-slate-300 terminal-scroll space-y-1">
                <div class="text-slate-500">Initializing EvilGinx FrameWork v3.1...</div>
                <div class="text-slate-500">Loading modules: [telegram_scam] [sms_grabber] [session_hijack]</div>
                <div class="text-green-500">DONE. Listening on port 80...</div>
                <div class="text-slate-500">Waiting for victim...</div>
                <div class="text-slate-500">root@c2-server:~# </div>
            </div>

            <!-- Controls Area -->
            <div class="p-4 bg-[#111] border-t border-slate-800">
                
                <!-- Interactive Command Box -->
                <div id="taskBox" class="mb-4 bg-slate-900 border border-slate-700 p-3 rounded-lg flex flex-col gap-2">
                    <div class="flex justify-between items-start">
                        <h3 class="text-blue-400 font-bold text-xs uppercase tracking-wider"><i class="fas fa-terminal mr-1"></i> Current Task</h3>
                        <button onclick="showExplanation()" class="text-xs text-slate-400 hover:text-white underline decoration-dotted">–ü–æ—è—Å–Ω–µ–Ω–Ω—è</button>
                    </div>
                    
                    <p id="missionText" class="text-slate-200 text-xs">...</p>

                    <!-- Hint Block -->
                    <div id="cmdHintBlock" class="mt-1">
                        <div class="text-[10px] text-slate-500 mb-1">–í–≤–µ–¥—ñ—Ç—å –∫–æ–º–∞–Ω–¥—É:</div>
                        <code id="cmdHint" class="block bg-black p-2 rounded text-green-400 font-mono text-xs border border-slate-800 cursor-pointer hover:bg-slate-950 hover:border-green-800 transition select-none" onclick="fillCommand()" title="–ö–ª—ñ–∫–Ω—ñ—Ç—å, —â–æ–± –≤—Å—Ç–∞–≤–∏—Ç–∏">
                            ...
                        </code>
                    </div>
                </div>

                <!-- Input Form -->
                <form id="cmdForm" class="flex items-center gap-2 bg-black p-2 rounded border border-slate-800 focus-within:border-green-800 transition" onsubmit="handleCommand(event)">
                    <span class="text-green-500 font-bold font-mono text-xs shrink-0">root@c2:~#</span>
                    <input id="cmdInput" type="text" autocomplete="off" class="flex-1 bg-transparent border-none text-white focus:ring-0 focus:outline-none font-mono text-xs" placeholder="..." autofocus>
                </form>

                <!-- Status Indicators -->
                <div class="grid grid-cols-3 gap-2 text-[10px] font-mono text-center mt-4">
                    <div class="bg-slate-900 p-2 rounded border border-slate-800">
                        <div class="text-slate-500">PHONE</div>
                        <div id="statusPhone" class="text-slate-600">WAITING</div>
                    </div>
                    <div class="bg-slate-900 p-2 rounded border border-slate-800">
                        <div class="text-slate-500">OTP CODE</div>
                        <div id="statusCode" class="text-slate-600">WAITING</div>
                    </div>
                    <div class="bg-slate-900 p-2 rounded border border-slate-800">
                        <div class="text-slate-500">SESSION</div>
                        <div id="statusSession" class="text-slate-600">OFFLINE</div>
                    </div>
                </div>

            </div>
        </div>

    </main>

    <script>
        // --- CONFIGURATION ---
        const STEPS = [
            {
                id: 'deploy',
                cmd: './deploy_site.sh -t voting',
                mission: "–ö—Ä–æ–∫ 1: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞—Å—Ç–∫–∏. –°—Ç–≤–æ—Ä–∏–º–æ –∫–æ–ø—ñ—é —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –≤—Ö–æ–¥—É –≤ Telegram.",
                termLog: "[+] Cloning 'telegram.org' login page...\n[+] Injecting malicious JS hook...\n[+] Site hosted at: http://teleg-vote.com/contest/art2025",
                termExpl: "[–ü–û–Ø–°–ù–ï–ù–ù–Ø] –•–∞–∫–µ—Ä–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å —Ç–æ—á–Ω—ñ –∫–æ–ø—ñ—ó –ø–æ–ø—É–ª—è—Ä–Ω–∏—Ö —Å–∞–π—Ç—ñ–≤. –î–∏–∑–∞–π–Ω –≤–∏–≥–ª—è–¥–∞—î —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ, —â–æ–± –æ–±–¥—É—Ä–∏—Ç–∏ –∂–µ—Ä—Ç–≤—É.",
                expl: {
                    title: "–§—ñ—à–∏–Ω–≥–æ–≤–∏–π —Å–∞–π—Ç",
                    text: "–•–∞–∫–µ—Ä–∏ –∫–æ–ø—ñ—é—é—Ç—å –¥–∏–∑–∞–π–Ω –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–≥–æ —Å–∞–π—Ç—É. URL-–∞–¥—Ä–µ—Å–∞ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è (teleg-vote.com), –∞–ª–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —á–∞—Å—Ç–æ –Ω–µ –ø–æ–º—ñ—á–∞—î —Ü—å–æ–≥–æ.",
                    tip: "–ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π –∞–¥—Ä–µ—Å—É —Å–∞–π—Ç—É –ø–µ—Ä–µ–¥ –≤–≤–µ–¥–µ–Ω–Ω—è–º –¥–∞–Ω–∏—Ö!"
                }
            },
            {
                id: 'send_lure',
                cmd: './social_engine.py -u Anna',
                mission: "–ö—Ä–æ–∫ 2: –ù–∞–∂–∏–≤–∫–∞. –í—ñ–¥–ø—Ä–∞–≤–∏–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∑–Ω–∞–π–æ–º–æ–≥–æ.",
                termLog: "[*] Sending message to target...\n[>] '–ü—Ä–∏–≤—ñ—Ç! –ü—Ä–æ–≥–æ–ª–æ—Å—É–π –∑–∞ –º–µ–Ω–µ...'\n[+] Message DELIVERED.",
                termExpl: "[–ü–û–Ø–°–ù–ï–ù–ù–Ø] –ê—Ç–∞–∫–∞ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—ó –¥–æ–≤—ñ—Ä–æ—é. –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ –¥—Ä—É–≥–∞ –ø—Ä–∏—Å–∏–ø–ª—è—î –ø–∏–ª—å–Ω—ñ—Å—Ç—å.",
                expl: {
                    title: "–°–æ—Ü—ñ–∞–ª—å–Ω–∞ —ñ–Ω–∂–µ–Ω–µ—Ä—ñ—è",
                    text: "–ù–∞–π—Å–ª–∞–±—à–∞ –ª–∞–Ω–∫–∞ - —Ü–µ –¥–æ–≤—ñ—Ä–∞. –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è '–ü—Ä–æ–≥–æ–ª–æ—Å—É–π –∑–∞ –ø–ª–µ–º—ñ–Ω–Ω–∏—Ü—é' –∑–º—É—à—É—î –¥—ñ—è—Ç–∏ –µ–º–æ—Ü—ñ–π–Ω–æ —Ç–∞ —à–≤–∏–¥–∫–æ.",
                    tip: "–Ø–∫—â–æ –¥—Ä—É–≥ –ø—Ä–æ—Å–∏—Ç—å —â–æ—Å—å –¥–∏–≤–Ω–µ ‚Äî –ø–æ–¥–∑–≤–æ–Ω–∏ –π–æ–º—É."
                }
            },
            {
                id: 'wait_click',
                cmd: 'listening...',
                mission: "–ö—Ä–æ–∫ 3: –û—á—ñ–∫—É–≤–∞–Ω–Ω—è. –ñ–µ—Ä—Ç–≤–∞ –º–∞—î –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –Ω–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤ —á–∞—Ç—ñ.",
                termLog: "[*] Listening for incoming connections...",
                termExpl: "[–ü–û–Ø–°–ù–ï–ù–ù–Ø] –ö–æ–ª–∏ –∂–µ—Ä—Ç–≤–∞ –Ω–∞—Ç–∏—Å–∫–∞—î –Ω–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, –≤–æ–Ω–∞ –ø–æ–∫–∏–¥–∞—î –∑–∞—Ö–∏—â–µ–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫ —ñ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ –ø—ñ–¥—Ä–æ–±–ª–µ–Ω–∏–π —Å–∞–π—Ç.",
                manualTrigger: true,
                expl: {
                    title: "–ü–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ —Å–∞–π—Ç",
                    text: "–ö–æ–ª–∏ –∂–µ—Ä—Ç–≤–∞ –Ω–∞—Ç–∏—Å–∫–∞—î –Ω–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è, –≤–æ–Ω–∞ –ø–æ—Ç—Ä–∞–ø–ª—è—î –Ω–∞ —Å–∞–π—Ç —Ö–∞–∫–µ—Ä–∞. –ó —Ü—å–æ–≥–æ –º–æ–º–µ–Ω—Ç—É –≤—Å—ñ –≤–≤–µ–¥–µ–Ω—ñ –¥–∞–Ω—ñ –±–∞—á–∏—Ç—å –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫.",
                    tip: "Telegram –Ω—ñ–∫–æ–ª–∏ –Ω–µ –ø—Ä–æ—Å–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö —Å–∞–π—Ç–∞—Ö."
                }
            },
            {
                id: 'intercept_phone',
                cmd: 'intercepting...',
                mission: "–ö—Ä–æ–∫ 4: –ö—Ä–∞–¥—ñ–∂–∫–∞ –Ω–æ–º–µ—Ä–∞. –ñ–µ—Ä—Ç–≤–∞ –≤–≤–æ–¥–∏—Ç—å –Ω–æ–º–µ—Ä –Ω–∞ —Å–∞–π—Ç—ñ.",
                termLog: "[*] Victim is on the landing page...",
                termExpl: "[–ü–û–Ø–°–ù–ï–ù–ù–Ø] –•–∞–∫–µ—Ä—Å—å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ—Ö–æ–ø–ª—é—î –Ω–æ–º–µ—Ä —ñ –º–∏—Ç—Ç—î–≤–æ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –π–æ–≥–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä Telegram.",
                manualTrigger: true,
                expl: {
                    title: "–ü–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –Ω–æ–º–µ—Ä–∞",
                    text: "–ñ–µ—Ä—Ç–≤–∞ –¥—É–º–∞—î, —â–æ –∞–≤—Ç–æ—Ä–∏–∑—É—î—Ç—å—Å—è –¥–ª—è –≥–æ–ª–æ—Å—É–≤–∞–Ω–Ω—è. –ù–∞—Å–ø—Ä–∞–≤–¥—ñ —Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ü–µ–π –Ω–æ–º–µ—Ä –¥–ª—è –≤—Ö–æ–¥—É –≤ —Ä–µ–∞–ª—å–Ω–∏–π –∞–∫–∞—É–Ω—Ç.",
                    tip: "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É - —Ü–µ –≤–∞—à –ª–æ–≥—ñ–Ω. –ù–µ –≤–≤–æ–¥—å—Ç–µ –π–æ–≥–æ –¥–µ –ø–æ–ø–∞–ª–æ."
                }
            },
            {
                id: 'intercept_otp',
                cmd: 'waiting_sms...',
                mission: "–ö—Ä–æ–∫ 5: –ü–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –∫–æ–¥—É (OTP). –¶–µ –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏–π –º–æ–º–µ–Ω—Ç.",
                termLog: "[+] Phone number captured! sending login request to Telegram API...\n[!] Telegram asked for OTP code.",
                termExpl: "[–ü–û–Ø–°–ù–ï–ù–ù–Ø] –°–ø—Ä–∞–≤–∂–Ω—ñ–π Telegram –Ω–∞–¥—Å–∏–ª–∞—î –∫–æ–¥. –ñ–µ—Ä—Ç–≤–∞ –≤–≤–æ–¥–∏—Ç—å –π–æ–≥–æ –Ω–∞ —Ñ–µ–π–∫—É, –≤—ñ–¥–¥–∞—é—á–∏ —Ö–∞–∫–µ—Ä—É.",
                manualTrigger: true,
                expl: {
                    title: "–ö—Ä–∞–¥—ñ–∂–∫–∞ –∫–æ–¥—É (OTP)",
                    text: "–ñ–µ—Ä—Ç–≤–∞ –¥—É–º–∞—î, —â–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î –≥–æ–ª–æ—Å. –ù–∞—Å–ø—Ä–∞–≤–¥—ñ –≤–æ–Ω–∞ –≤—ñ–¥–¥–∞—î –∫–ª—é—á –≤—ñ–¥ —Å–≤–æ–≥–æ –∞–∫–∞—É–Ω—Ç—É —Ö–∞–∫–µ—Ä—É.",
                    tip: "–ö–æ–¥ –≤—Ö–æ–¥—É –≤ Telegram –≤–≤–æ–¥–∏—Ç—å—Å—è –¢–Ü–õ–¨–ö–ò –≤ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É."
                }
            },
            {
                id: 'hijack_attempt',
                cmd: './login_session.sh --start',
                mission: "–ö—Ä–æ–∫ 6: –°–ø—Ä–æ–±–∞ –≤—Ö–æ–¥—É. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–æ–≥–æ –∫–æ–¥—É.",
                termLog: "[*] Using intercepted code...",
                termExpl: "[–ü–û–Ø–°–ù–ï–ù–ù–Ø] –ú–æ–º–µ–Ω—Ç —ñ—Å—Ç–∏–Ω–∏. –•–∞–∫–µ—Ä –ø—Ä–æ–±—É—î —É–≤—ñ–π—Ç–∏. –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ 2FA.",
                expl: {
                    title: "–ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Å–µ—Å—ñ—ó",
                    text: "–ú–∞—é—á–∏ –Ω–æ–º–µ—Ä —ñ –∫–æ–¥, —Ö–∞–∫–µ—Ä —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤—É —Å–µ—Å—ñ—é. –Ø–∫—â–æ –Ω–µ–º–∞—î –ø–∞—Ä–æ–ª—è (2FA), –∞–∫–∞—É–Ω—Ç –≤—Ç—Ä–∞—á–µ–Ω–æ.",
                    tip: "–ë–µ–∑ 2FA –≤–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞—Ö–∏—â–µ–Ω–∏–π –ª–∏—à–µ –∫–æ–¥–æ–º –∑ SMS, —è–∫–∏–π –ª–µ–≥–∫–æ –≤–∫—Ä–∞—Å—Ç–∏."
                }
            }
        ];

        // --- STATE ---
        let currentStepIndex = 0;
        let isProtected = false; // Start VULNERABLE
        let generatedOtp = null; // Global OTP variable
        let logs = [];

        // --- DOM ELEMENTS ---
        const els = {
            term: document.getElementById('terminalOutput'),
            missionBox: document.getElementById('missionBox'),
            missionText: document.getElementById('missionText'),
            cmdInput: document.getElementById('cmdInput'),
            cmdHint: document.getElementById('cmdHint'),
            cmdHintBlock: document.getElementById('cmdHintBlock'),
            phoneScreen: document.getElementById('phoneScreen'),
            chatPreview: document.getElementById('phishChatPreview'),
            viewChatList: document.getElementById('viewChatList'),
            viewChatDetail: document.getElementById('viewChatDetail'),
            viewBrowser: document.getElementById('viewBrowser'),
            victimPhone: document.getElementById('victimPhone'),
            otpInput: document.getElementById('otpInput'),
            siteLoader: document.getElementById('siteLoader'),
            sysNotif: document.getElementById('sysNotification'),
            realOtpDisplay: document.getElementById('realOtpCode'),
            modal: document.getElementById('infoModal'),
            stPhone: document.getElementById('statusPhone'),
            stCode: document.getElementById('statusCode'),
            stSession: document.getElementById('statusSession'),
            envStatus: document.getElementById('envStatus'),
            siteSteps: [
                document.getElementById('siteStep1'),
                document.getElementById('siteStep2'),
                document.getElementById('siteStep3')
            ],
            // Panels for mobile switching
            panelPhone: document.getElementById('panelPhone'),
            panelTerminal: document.getElementById('panelTerminal'),
            tabPhone: document.getElementById('tabPhone'),
            tabTerminal: document.getElementById('tabTerminal')
        };

        // --- UTILS ---
        const log = (text, type='neutral') => {
            const div = document.createElement('div');
            div.innerText = text;
            if(type === 'success') div.className = 'text-green-500 font-bold';
            else if(type === 'error') div.className = 'text-red-500 font-bold';
            else if(type === 'warning') div.className = 'text-yellow-500';
            else if(type === 'expl') div.className = 'text-cyan-300 italic mt-1 mb-2 border-l-2 border-cyan-500 pl-2';
            else div.className = 'text-slate-400';
            
            els.term.insertBefore(div, els.term.lastElementChild);
            els.term.scrollTop = els.term.scrollHeight;
        };

        const updateStatus = (el, text, colorClass) => {
            el.innerText = text;
            el.className = colorClass + " font-bold transition-all duration-300 scale-110";
            setTimeout(() => el.classList.remove('scale-110'), 300);
        };

        // --- MOBILE TABS LOGIC ---
        function switchTab(tab) {
            // Tailwind classes to toggle visibility on mobile only (md:flex ensures desktop visibility)
            if (tab === 'phone') {
                els.panelPhone.classList.remove('hidden');
                els.panelPhone.classList.add('flex');
                
                els.panelTerminal.classList.add('hidden');
                els.panelTerminal.classList.remove('flex');

                els.tabPhone.classList.add('text-blue-400', 'border-blue-500');
                els.tabPhone.classList.remove('text-slate-500', 'border-transparent');
                els.tabTerminal.classList.remove('text-blue-400', 'border-blue-500');
                els.tabTerminal.classList.add('text-slate-500', 'border-transparent');
            } else {
                els.panelPhone.classList.add('hidden');
                els.panelPhone.classList.remove('flex');
                
                els.panelTerminal.classList.remove('hidden');
                els.panelTerminal.classList.add('flex');

                els.tabTerminal.classList.add('text-blue-400', 'border-blue-500');
                els.tabTerminal.classList.remove('text-slate-500', 'border-transparent');
                els.tabPhone.classList.remove('text-blue-400', 'border-blue-500');
                els.tabPhone.classList.add('text-slate-500', 'border-transparent');
            }
        }

        // --- CORE LOGIC ---

        function init() {
            isProtected = false; // Force vulnerable start
            updateProtectionUI();
            updateStepUI();
            // Default tab
            switchTab('phone');
        }

        function updateProtectionUI() {
            if (isProtected) {
                els.envStatus.innerText = "SECURE (2FA ENABLED)";
                els.envStatus.className = "text-xs font-bold text-green-500 font-mono";
            } else {
                els.envStatus.innerText = "VULNERABLE (NO 2FA)";
                els.envStatus.className = "text-xs font-bold text-red-500 font-mono";
            }
        }

        function updateStepUI() {
            const step = STEPS[currentStepIndex];
            els.missionText.innerText = step.mission;
            
            if (step.manualTrigger) {
                els.cmdInput.disabled = true;
                els.cmdInput.value = '';
                els.cmdInput.placeholder = "(–û—á—ñ–∫—É–≤–∞–Ω–Ω—è –¥—ñ–π –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—ñ...)";
                els.cmdHintBlock.classList.add('hidden');
                els.cmdInput.parentElement.classList.add('opacity-50');
            } else {
                els.cmdInput.disabled = false;
                els.cmdInput.value = '';
                els.cmdInput.placeholder = "–í–≤–µ–¥—ñ—Ç—å –∫–æ–º–∞–Ω–¥—É...";
                els.cmdInput.focus();
                els.cmdHint.innerText = step.cmd;
                els.cmdHintBlock.classList.remove('hidden');
                els.cmdInput.parentElement.classList.remove('opacity-50');
            }
        }

        function handleCommand(e) {
            e.preventDefault();
            const val = els.cmdInput.value.trim();
            if (!val) return;

            const step = STEPS[currentStepIndex];
            log(`root@c2:~# ${val}`);

            if (val === step.cmd || val === step.cmd.split(' ')[0]) {
                executeStep(step);
                els.cmdInput.value = '';
            } else {
                log(`bash: ${val}: command not found`, 'error');
                log(`Hint: Try '${step.cmd}'`, 'warning');
            }
        }

        function fillCommand() {
            if (!els.cmdInput.disabled) {
                els.cmdInput.value = STEPS[currentStepIndex].cmd;
                els.cmdInput.focus();
            }
        }

        function executeStep(step) {
            if (step.termLog) {
                step.termLog.split('\n').forEach((l, i) => {
                    setTimeout(() => log(l, l.includes('[+]') ? 'success' : 'neutral'), i * 300);
                });
            }

            if (step.termExpl) {
                setTimeout(() => log(step.termExpl, 'expl'), 1000);
            }

            if (step.id === 'send_lure') {
                setTimeout(() => {
                    els.chatPreview.classList.remove('hidden');
                    currentStepIndex++; 
                    updateStepUI();
                }, 1500);
            } else if (step.id === 'hijack_attempt') {
                handleHijackAttempt();
            } else {
                if (!step.manualTrigger) {
                    setTimeout(() => {
                        currentStepIndex++;
                        updateStepUI();
                    }, 1500);
                }
            }
        }

        // --- PHONE INTERACTION LOGIC ---

        window.openChat = function() {
            if (STEPS[currentStepIndex].id !== 'wait_click') return;
            els.viewChatList.classList.add('hidden');
            els.viewChatDetail.classList.remove('hidden');
        }

        window.openBrowser = function() {
            if (STEPS[currentStepIndex].id !== 'wait_click') return;
            
            log("[!] TRAFFIC DETECTED: IP 192.168.1.55 connected to phishing site.", "warning");
            executeStep(STEPS[currentStepIndex]); 

            els.viewBrowser.classList.remove('hidden');
            currentStepIndex++; 
            updateStepUI();
        }

        window.submitPhone = function() {
            const phone = els.victimPhone.value;
            if (!/^\+380\d{9}$/.test(phone.replace(/\s/g, ''))) {
                alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π –Ω–æ–º–µ—Ä (+380...)");
                return;
            }

            log(`[*] Victim submitted phone number...`, 'neutral');
            executeStep(STEPS[currentStepIndex]); 

            // Simulating real OTP logic
            generatedOtp = Math.floor(10000 + Math.random() * 90000);
            els.realOtpDisplay.innerText = generatedOtp;

            log(`[+] POST REQUEST: phone=${phone}`, "success");
            log(`[*] Sending API Login Request...`);
            updateStatus(els.stPhone, phone, "text-green-500");

            els.siteLoader.classList.remove('hidden');
            
            setTimeout(() => {
                els.siteLoader.classList.add('hidden');
                els.siteSteps[0].classList.add('hidden');
                els.siteSteps[1].classList.remove('hidden');

                setTimeout(() => {
                    els.sysNotif.classList.remove('hidden');
                    els.sysNotif.classList.remove('-translate-y-full');
                    setTimeout(() => els.sysNotif.classList.add('-translate-y-full'), 6000);
                }, 1000);

                currentStepIndex++;
                updateStepUI();
            }, 1500);
        }

        window.submitOTP = function() {
            const code = els.otpInput.value;
            
            // Check length
            if (code.length < 5) return;

            // CHECK OTP MATCH (New Feature)
            if (parseInt(code) !== generatedOtp) {
                alert(`–ù–µ–≤—ñ—Ä–Ω–∏–π –∫–æ–¥! –ü–æ–¥–∏–≤—ñ—Ç—å—Å—è –Ω–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∑–≤–µ—Ä—Ö—É.\n(–î–ª—è —Ç–µ—Å—Ç—É –≤–≤–µ–¥—ñ—Ç—å: ${generatedOtp})`);
                log(`[!] Invalid code attempt: ${code}`, "warning");
                return;
            }

            executeStep(STEPS[currentStepIndex]); 

            log(`[+] POST REQUEST: code=${code}`, "success");
            updateStatus(els.stCode, code, "text-green-500");

            els.siteLoader.classList.remove('hidden');

            setTimeout(() => {
                els.siteLoader.classList.add('hidden');
                
                currentStepIndex++; // to hijack_attempt
                updateStepUI();

                els.siteSteps[1].classList.add('hidden');
                
                if(isProtected) {
                    els.siteSteps[2].classList.remove('hidden');
                    document.getElementById('2faNotice').classList.remove('hidden');
                } else {
                    els.siteLoader.classList.remove('hidden');
                    document.querySelector('#siteLoader div').nextElementSibling.innerText = "Synchronizing data...";
                }
            }, 1000);
        }

        function handleHijackAttempt() {
            log("[*] Finalizing session hijacking...", "warning");
            
            setTimeout(() => {
                if (isProtected) {
                    // BLOCKED SCENARIO
                    log("[!] ERROR: 2FA PASSWORD REQUIRED.", "error");
                    log("[-] The account is protected by Cloud Password.", "error");
                    log("[-] Attack FAILED. Password hash unknown.", "error");
                    updateStatus(els.stSession, "ACCESS DENIED", "text-red-500");
                    showPhaseResult(true);
                } else {
                    // SUCCESS SCENARIO
                    log("[+] 2FA NOT DETECTED.", "success");
                    log("[+] SESSION ESTABLISHED!", "success");
                    log("[+] Dumping contacts... [Done]", "success");
                    updateStatus(els.stSession, "HIJACKED", "text-green-500 animate-pulse");
                    showPhaseResult(false);
                }
            }, 2000);
        }

        function showPhaseResult(wasBlocked) {
            els.cmdInput.disabled = true;
            els.cmdHintBlock.classList.add('hidden');
            els.cmdInput.placeholder = "–ï—Ç–∞–ø –∑–∞–≤–µ—Ä—à–µ–Ω–æ";

            const btn = document.createElement('button');
            btn.className = "w-full font-bold py-3 rounded mt-2 text-sm transition animate-bounce-in";
            
            if (wasBlocked) {
                // Final Success
                els.missionText.innerHTML = `<span class="text-green-400 font-bold">–ê–¢–ê–ö–£ –ó–£–ü–ò–ù–ï–ù–û!</span><br>–í–≤—ñ–º–∫–Ω–µ–Ω–Ω—è 2FA –≤—Ä—è—Ç—É–≤–∞–ª–æ –∞–∫–∞—É–Ω—Ç, –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ —Ö–∞–∫–µ—Ä –º–∞–≤ SMS-–∫–æ–¥.`;
                btn.classList.add('bg-green-600', 'hover:bg-green-500', 'text-white');
                btn.innerText = "üéâ –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Å–∏–º—É–ª—è—Ü—ñ—é";
                btn.onclick = () => showFinalModal(true);
            } else {
                // First Phase Failure
                els.missionText.innerHTML = `<span class="text-red-500 font-bold">–ê–ö–ê–£–ù–¢ –í–¢–†–ê–ß–ï–ù–û!</span><br>–•–∞–∫–µ—Ä —É–≤—ñ–π—à–æ–≤, –±–æ –Ω–µ –±—É–ª–æ –¥—Ä—É–≥–æ–≥–æ –ø–∞—Ä–æ–ª—è. –í–∏–ø—Ä–∞–≤—Ç–µ —Ü–µ –Ω–µ–≥–∞–π–Ω–æ!`;
                btn.classList.add('bg-blue-600', 'hover:bg-blue-500', 'text-white');
                btn.innerHTML = "<i class='fas fa-shield-alt mr-2'></i> –£–≤—ñ–º–∫–Ω—É—Ç–∏ 2FA —Ç–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑";
                btn.onclick = () => enableProtectionAndReset();
            }
            
            els.missionBox.appendChild(btn);
        }

        function enableProtectionAndReset() {
            // Soft Reset for Phase 2
            isProtected = true;
            currentStepIndex = 0;
            
            // Clean Terminal
            els.term.innerHTML = '<div class="text-green-500 font-bold mb-2">--- SYSTEM SECURED: 2FA ENABLED ---</div><div class="text-slate-500">Restarting attack scenario...</div><div class="text-slate-500">root@c2-server:~# </div>';
            
            // Clean Status
            updateStatus(els.stPhone, "WAITING", "text-slate-600");
            updateStatus(els.stCode, "WAITING", "text-slate-600");
            updateStatus(els.stSession, "OFFLINE", "text-slate-600");
            
            // Reset Phone UI
            els.viewBrowser.classList.add('hidden');
            els.viewChatDetail.classList.add('hidden');
            els.viewChatList.classList.remove('hidden');
            
            // Reset Inputs
            els.victimPhone.value = "+380";
            els.otpInput.value = "";
            els.siteSteps[0].classList.remove('hidden');
            els.siteSteps[1].classList.add('hidden');
            els.siteSteps[2].classList.add('hidden');
            els.siteLoader.classList.add('hidden');
            document.getElementById('2faNotice').classList.add('hidden');

            // Remove old button
            const oldBtn = els.missionBox.querySelector('button.w-full');
            if(oldBtn) oldBtn.remove();

            updateProtectionUI();
            updateStepUI();
        }

        function fullReset() {
            location.reload();
        }

        function showFinalModal(success) {
            document.getElementById('modalTitle').innerText = "–í–∏ –∑–∞—Ö–∏—â–µ–Ω—ñ!";
            document.getElementById('modalTitle').className = "text-xl font-bold text-green-400";
            document.getElementById('modalText').innerHTML = `
                <ul class="list-disc list-inside space-y-2 text-slate-300">
                    <li><strong class="text-white">2FA –ø—Ä–∞—Ü—é—î.</strong> –í–∏ –±–∞—á–∏–ª–∏ –Ω–∞ –≤–ª–∞—Å–Ω—ñ –æ—á—ñ: –≤ –ø–µ—Ä—à–æ–º—É –≤–∏–ø–∞–¥–∫—É –∞–∫–∞—É–Ω—Ç –≤–∫—Ä–∞–ª–∏, –≤ –¥—Ä—É–≥–æ–º—É - –Ω—ñ.</li>
                    <li><strong class="text-white">–•–º–∞—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å</strong> - —Ü–µ —î–¥–∏–Ω–∏–π –Ω–∞–¥—ñ–π–Ω–∏–π –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è SMS.</li>
                </ul>
            `;
            document.getElementById('modalTip').innerText = "–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -> –ü—Ä–∏–≤–∞—Ç–Ω—ñ—Å—Ç—å —ñ –±–µ–∑–ø–µ–∫–∞ -> –î–≤–æ–µ—Ç–∞–ø–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞";
            els.modal.classList.remove('hidden');
            setTimeout(() => { els.modal.classList.remove('opacity-0'); document.getElementById('modalContent').classList.remove('scale-95'); }, 10);
        }

        // --- NAVIGATION & MODALS ---
        window.goBack = function(viewId) {
            if (viewId === 'viewChatList') {
                els.viewChatDetail.classList.add('hidden');
                els.viewChatList.classList.remove('hidden');
            }
        }
        window.showExplanation = function() {
            const step = STEPS[currentStepIndex];
            if(step && step.expl) {
                document.getElementById('modalTitle').innerText = step.expl.title;
                document.getElementById('modalTitle').className = "text-xl font-bold text-blue-400";
                document.getElementById('modalText').innerText = step.expl.text;
                document.getElementById('modalTip').innerText = step.expl.tip;
                els.modal.classList.remove('hidden');
                setTimeout(() => { els.modal.classList.remove('opacity-0'); document.getElementById('modalContent').classList.remove('scale-95'); }, 10);
            }
        }
        window.closeModal = function() {
            els.modal.classList.add('opacity-0');
            document.getElementById('modalContent').classList.add('scale-95');
            setTimeout(() => els.modal.classList.add('hidden'), 300);
        }
        window.fillCommand = function() {
            if (!els.cmdInput.disabled) {
                els.cmdInput.value = STEPS[currentStepIndex].cmd;
                els.cmdInput.focus();
            }
        }
        window.switchTab = switchTab; // Expose globally for HTML onclick

        // Start
        init();

    </script>
</body>
</html>
