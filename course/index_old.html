<!DOCTYPE html>
<html lang="uk" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CS Mobile Course</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        dark: '#0f172a',
                        darkSec: '#1e293b',
                    },
                    aspectRatio: {
                        '9/16': '9 / 16',
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-down': 'slideDown 0.3s ease-out forwards',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideDown: {
                            '0%': { opacity: '0', transform: 'translateY(-10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        @media (max-width: 768px) {
            .no-scrollbar::-webkit-scrollbar { display: none; }
            .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        }
        body { transition: background-color 0.3s, color 0.3s; }
        .video-placeholder {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-dark dark:text-gray-100 font-sans antialiased pb-20 md:pb-0">

    <div id="app" class="w-full md:max-w-7xl mx-auto min-h-screen bg-white dark:bg-darkSec shadow-2xl relative overflow-hidden flex flex-col transition-all duration-300">

        <!-- HEADER -->
        <header class="sticky top-0 z-50 bg-white/90 dark:bg-darkSec/90 backdrop-blur-md border-b border-gray-200 dark:border-gray-700 px-4 md:px-8 py-4 flex justify-between items-center h-16 transition-colors">
            <div class="flex items-center gap-4">
                <button id="backBtn" class="hidden text-xl text-primary hover:bg-gray-100 dark:hover:bg-slate-800 p-2 rounded-full transition-all">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <h1 id="headerTitle" class="text-xl font-bold tracking-tight">CS Course</h1>
            </div>
            
            <div class="flex items-center gap-4">
                <span id="desktopHint" class="hidden md:block text-xs text-gray-400 font-medium bg-gray-100 dark:bg-slate-800 px-3 py-1 rounded-full">Beta v1.1</span>
                <button id="themeToggle" class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-yellow-400 transition-all hover:bg-gray-200 dark:hover:bg-gray-600 active:scale-95">
                    <i class="fa-solid fa-moon dark:hidden"></i>
                    <i class="fa-solid fa-sun hidden dark:block"></i>
                </button>
            </div>
        </header>

        <!-- CONTENT AREA -->
        <main id="contentArea" class="flex-1 overflow-y-auto no-scrollbar scroll-smooth">
            <!-- Dynamic Content -->
        </main>
    </div>

    <script>
        // --- DATA STRUCTURE (Updated with Quizzes) ---
        const curriculum = [
            {
                id: 0,
                title: "–ú–æ–¥—É–ª—å 0. –°—Ç–∞—Ä—Ç —ñ –ø—Ä–∞–≤–∏–ª–∞",
                lessons: [
                    { 
                        id: "0.1", 
                        title: "–Ø–∫ –ø—Ä–∞—Ü—é—î –∫—É—Ä—Å",
                        quiz: {
                            question: "–Ø–∫–∞ –≥–æ–ª–æ–≤–Ω–∞ –æ—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å —Ü—å–æ–≥–æ –∫—É—Ä—Å—É?",
                            options: ["–î–æ–≤–≥—ñ –ª–µ–∫—Ü—ñ—ó", "Mobile-first —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞", "–¢—ñ–ª—å–∫–∏ —Ç–µ–æ—Ä—ñ—è"],
                            correct: 1
                        }
                    },
                    { 
                        id: "0.2", 
                        title: "–ù–∞–≤—ñ—â–æ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω–∞ –Ω–∞—É–∫–∞",
                        quiz: {
                            question: "CS - —Ü–µ —Ç—ñ–ª—å–∫–∏ –ø—Ä–æ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è?",
                            options: ["–¢–∞–∫", "–ù—ñ, —Ü–µ –ø—Ä–æ –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º", "–¢—ñ–ª—å–∫–∏ –ø—Ä–æ —Ä–µ–º–æ–Ω—Ç –ü–ö"],
                            correct: 1
                        }
                    },
                    { 
                        id: "0.3", 
                        title: "–ú—ñ–Ω—ñ–ø—Ä–æ—î–∫—Ç: —è–∫ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä ‚Äú—Ä–∞—Ö—É—î‚Äù",
                        quiz: {
                            question: "–Ø–∫–∞ —Å–∏—Å—Ç–µ–º–∞ —á–∏—Å–ª–µ–Ω–Ω—è —î –±–∞–∑–æ–≤–æ—é –¥–ª—è –ü–ö?",
                            options: ["–î–µ—Å—è—Ç–∫–æ–≤–∞", "–î–≤—ñ–π–∫–æ–≤–∞", "–®—ñ—Å—Ç–Ω–∞–¥—Ü—è—Ç–∫–æ–≤–∞"],
                            correct: 1
                        }
                    }
                ]
            },
            {
                id: 1,
                title: "–ú–æ–¥—É–ª—å 1. –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è —ñ –¥–∞–Ω—ñ",
                lessons: [
                    { id: "1.1", title: "–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –∫—Ä—ñ–∑—å –≤—ñ–∫–∏", quiz: { question: "–©–æ –±—É–ª–æ –ø–µ—Ä—à–∏–º –Ω–æ—Å—ñ—î–º —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó?", options: ["–ü–∞–ø—ñ—Ä—É—Å", "–ù–∞—Å–∫–µ–ª—å–Ω—ñ –º–∞–ª—é–Ω–∫–∏", "–§–ª–µ—à–∫–∞"], correct: 1 } },
                    { id: "1.2", title: "–î–∞–Ω—ñ vs —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è", quiz: { question: "–©–æ —Ç–∞–∫–µ –¥–∞–Ω—ñ?", options: ["–û–±—Ä–æ–±–ª–µ–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è", "–°–∏—Ä—ñ —Ñ–∞–∫—Ç–∏", "–ó–Ω–∞–Ω–Ω—è"], correct: 1 } },
                    { id: "1.3", title: "–ú–æ–¥–µ–ª—ñ —Ç–∞ –ø—Ä–∞–≤–∏–ª–∞", quiz: { question: "–©–æ —Ç–∞–∫–µ –º–æ–¥–µ–ª—å?", options: ["–°–ø—Ä–æ—â–µ–Ω–µ –ø–æ–¥–∞–Ω–Ω—è –æ–±'—î–∫—Ç–∞", "–Ü–≥—Ä–∞—à–∫–∞", "–¢—ñ–ª—å–∫–∏ 3D –≥—Ä–∞—Ñ—ñ–∫–∞"], correct: 0 } }
                ]
            },
            {
                id: 2,
                title: "–ú–æ–¥—É–ª—å 2. –ö–æ–º–ø‚Äô—é—Ç–µ—Ä —è–∫ —Å–∏—Å—Ç–µ–º–∞",
                lessons: [
                    { id: "2.1", title: "Input‚ÄìProcess‚ÄìOutput", quiz: { question: "–Ø–∫–∞ —Å—Ö–µ–º–∞ –æ–ø–∏—Å—É—î —Ä–æ–±–æ—Ç—É –∫–æ–º–ø'—é—Ç–µ—Ä–∞?", options: ["Input-Output", "Input-Process-Output", "Process-Input"], correct: 1 } },
                    { id: "2.2", title: "–ü—Ä–∏—Å—Ç—Ä–æ—ó –≤–≤–µ–¥–µ–Ω–Ω—è", quiz: { question: "–©–æ —î –ø—Ä–∏—Å—Ç—Ä–æ—î–º –≤–≤–µ–¥–µ–Ω–Ω—è?", options: ["–ú–æ–Ω—ñ—Ç–æ—Ä", "–ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∞", "–ü—Ä–∏–Ω—Ç–µ—Ä"], correct: 1 } },
                    { id: "2.3", title: "–ü—Ä–∏—Å—Ç—Ä–æ—ó –≤–∏–≤–µ–¥–µ–Ω–Ω—è", quiz: { question: "–©–æ —î –ø—Ä–∏—Å—Ç—Ä–æ—î–º –≤–∏–≤–µ–¥–µ–Ω–Ω—è?", options: ["–ú–∏—à–∫–∞", "–ï–∫—Ä–∞–Ω", "–ú—ñ–∫—Ä–æ—Ñ–æ–Ω"], correct: 1 } },
                    { id: "2.4", title: "CPU / RAM / SSD", quiz: { question: "–©–æ —î '–º–æ–∑–∫–æ–º' –∫–æ–º–ø'—é—Ç–µ—Ä–∞?", options: ["SSD", "CPU", "RAM"], correct: 1 } }
                ]
            },
            // ... (Other modules structure assumed standard, quizzes added generically for brevity if needed)
            {
                id: 3,
                title: "–ú–æ–¥—É–ª—å 3. –ö–æ–¥—É–≤–∞–Ω–Ω—è —Å–≤—ñ—Ç—É",
                lessons: [
                    { id: "3.1", title: "–î–≤—ñ–π–∫–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞", quiz: { question: "–°–∫—ñ–ª—å–∫–∏ —Å–∏–º–≤–æ–ª—ñ–≤ —É –¥–≤—ñ–π–∫–æ–≤—ñ–π —Å–∏—Å—Ç–µ–º—ñ?", options: ["10", "2", "8"], correct: 1 } },
                    { id: "3.2", title: "–ë—ñ—Ç–∏, –±–∞–π—Ç–∏, –º–µ–≥–∞–±–∞–π—Ç–∏", quiz: { question: "–°–∫—ñ–ª—å–∫–∏ –±—ñ—Ç —É –±–∞–π—Ç—ñ?", options: ["8", "10", "16"], correct: 0 } },
                    { id: "3.3", title: "–¢–µ–∫—Å—Ç = —á–∏—Å–ª–∞", quiz: { question: "–©–æ —Ç–∞–∫–µ ASCII?", options: ["–ú–æ–≤–∞ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è", "–¢–∞–±–ª–∏—Ü—è –∫–æ–¥—É–≤–∞–Ω–Ω—è", "–ë—Ä–∞—É–∑–µ—Ä"], correct: 1 } },
                    { id: "3.4", title: "–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è = –ø—ñ–∫—Å–µ–ª—ñ", quiz: { question: "–ó —á–æ–≥–æ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è —Ü–∏—Ñ—Ä–æ–≤–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è?", options: ["–í–µ–∫—Ç–æ—Ä—ñ–≤", "–ü—ñ–∫—Å–µ–ª—ñ–≤", "–•–≤–∏–ª—å"], correct: 1 } },
                    { id: "3.5", title: "–ó–≤—É–∫ = —Ö–≤–∏–ª—ñ", quiz: { question: "–©–æ —Ç–∞–∫–µ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü—ñ—è?", options: ["–°—Ç–∏—Å–Ω–µ–Ω–Ω—è –∑–≤—É–∫—É", "–ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ö–≤–∏–ª—ñ –≤ —Ü–∏—Ñ—Ä—É", "–í–∏–¥–∞–ª–µ–Ω–Ω—è —à—É–º—É"], correct: 1 } }
                ]
            }
            // Add remaining modules with default quiz structure in real app
        ];

        // Ensure all lessons have a quiz object fallback
        curriculum.forEach(m => m.lessons.forEach(l => {
            if (!l.quiz) l.quiz = { question: "–ú–∞—Ç–µ—Ä—ñ–∞–ª –∑–∞—Å–≤–æ—î–Ω–æ?", options: ["–ù—ñ", "–¢–∞–∫, –∑—Ä–æ–∑—É–º—ñ–ª–æ", "–ß–∞—Å—Ç–∫–æ–≤–æ"], correct: 1 };
        }));

        // --- STATE ---
        const state = {
            currentView: 'landing',
            activeModuleId: null,
            activeLesson: null,
            completedLessons: JSON.parse(localStorage.getItem('cs_completed')) || [],
            searchQuery: ''
        };

        // --- DOM ---
        const contentArea = document.getElementById('contentArea');
        const headerTitle = document.getElementById('headerTitle');
        const backBtn = document.getElementById('backBtn');
        const themeToggle = document.getElementById('themeToggle');

        // --- THEME ---
        function initTheme() {
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }

        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        });

        // --- RENDERERS ---

        function renderLanding() {
            state.currentView = 'landing';
            backBtn.classList.add('hidden');
            headerTitle.textContent = 'CS Course';
            contentArea.scrollTop = 0;

            const hasProgress = state.completedLessons.length > 0;
            const btnText = hasProgress ? '–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è' : '–ü–æ—á–∞—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è';

            contentArea.innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-[85vh] p-6 text-center space-y-8 relative max-w-4xl mx-auto">
                    <div class="absolute top-1/4 left-1/2 -translate-x-1/2 w-64 h-64 md:w-96 md:h-96 bg-blue-400/20 dark:bg-blue-600/20 rounded-full blur-3xl animate-blob -z-10"></div>
                    <div class="relative transition-transform hover:scale-110 duration-500">
                        <div class="w-24 h-24 md:w-32 md:h-32 bg-white dark:bg-slate-800 rounded-2xl shadow-xl flex items-center justify-center transform rotate-3">
                            <i class="fa-solid fa-microchip text-5xl md:text-6xl text-primary"></i>
                        </div>
                    </div>
                    <div class="space-y-4 max-w-lg mx-auto">
                        <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight text-gray-900 dark:text-white leading-tight">
                            –ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∞ –Ω–∞—É–∫–∞ <span class="text-primary block mt-2">–±–µ–∑ –±–æ–ª—é</span>
                        </h1>
                        <p class="text-lg md:text-xl text-gray-600 dark:text-gray-400 leading-relaxed">
                            –¢–≤—ñ–π –≥—ñ–¥ —É —Ü–∏—Ñ—Ä–æ–≤–æ–º—É —Å–≤—ñ—Ç—ñ. –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ñ –≤—ñ–¥–µ–æ, —Ç–µ–æ—Ä—ñ—è –±–µ–∑ –≤–æ–¥–∏ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞.
                        </p>
                    </div>
                    <button onclick="renderHome()" class="w-full max-w-sm bg-dark dark:bg-white text-white dark:text-dark text-xl font-bold py-4 rounded-2xl shadow-xl transition-all transform hover:scale-[1.02] active:scale-95 group">
                        <span class="relative z-10 flex items-center justify-center gap-2">
                            ${btnText} <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                        </span>
                    </button>
                    <p class="text-xs text-gray-400">–ë–µ–∑ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó ‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è</p>
                </div>
            `;
        }

        function renderHome() {
            state.currentView = 'home';
            backBtn.classList.add('hidden'); 
            headerTitle.textContent = '–ù–∞–≤—á–∞–ª—å–Ω–∏–π –ø–ª–∞–Ω';
            contentArea.scrollTop = 0;

            // Flatten lessons for calculation
            const allLessons = curriculum.flatMap(m => m.lessons);
            const progress = Math.round((state.completedLessons.length / allLessons.length) * 100) || 0;

            let html = `<div class="p-4 md:p-8 space-y-6 pb-12 animate-fade-in max-w-4xl mx-auto">`;
            
            // Progress Widget
            html += `
                <div class="bg-primary text-white p-6 md:p-8 rounded-2xl shadow-lg relative overflow-hidden">
                    <div class="absolute -right-4 -top-4 text-white/10 text-9xl"><i class="fa-solid fa-chart-pie"></i></div>
                    <div class="relative z-10 max-w-2xl">
                        <div class="flex justify-between items-end mb-2">
                            <h2 class="text-2xl md:text-3xl font-bold">–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å</h2>
                            <span class="text-3xl md:text-4xl font-bold">${progress}%</span>
                        </div>
                        <div class="w-full bg-black/20 rounded-full h-3">
                            <div class="bg-white h-3 rounded-full transition-all duration-1000 ease-out shadow-sm" style="width: ${progress}%"></div>
                        </div>
                    </div>
                </div>
            `;

            // Search Bar
            html += `
                <div class="relative">
                    <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="searchInput" placeholder="–ó–Ω–∞–π—Ç–∏ —É—Ä–æ–∫ –∞–±–æ —Ç–µ–º—É..." 
                        class="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all dark:text-white"
                        value="${state.searchQuery}" oninput="handleSearch(this.value)">
                </div>
            `;

            // Modules List
            html += `<div class="flex flex-col gap-4 md:gap-5" id="modulesList">`;
            
            const filteredCurriculum = filterCurriculum(state.searchQuery);

            if (filteredCurriculum.length === 0) {
                html += `<div class="text-center py-10 text-gray-500">–ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ üòî</div>`;
            } else {
                filteredCurriculum.forEach(module => {
                    const isOpen = state.activeModuleId === module.id || state.searchQuery.length > 0;
                    
                    const totalInModule = module.lessons.length;
                    const completedInModule = module.lessons.filter(l => state.completedLessons.includes(l.id)).length;
                    const moduleProgress = totalInModule > 0 ? (completedInModule / totalInModule) * 100 : 0;
                    const isModuleDone = moduleProgress === 100;

                    html += `
                        <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden transition-all duration-300">
                            <button onclick="toggleModule(${module.id})" class="w-full text-left p-5 flex flex-col gap-2 active:bg-gray-50 dark:active:bg-slate-700 outline-none">
                                <div class="flex justify-between items-center w-full">
                                    <div class="flex items-center gap-2">
                                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100">${module.title}</h3>
                                        ${isModuleDone ? '<i class="fa-solid fa-circle-check text-green-500"></i>' : ''}
                                    </div>
                                    <i class="fa-solid fa-chevron-down text-gray-400 transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}"></i>
                                </div>
                                <div class="w-full flex items-center gap-3">
                                    <div class="flex-1 bg-gray-100 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden">
                                        <div class="bg-green-500 h-full rounded-full transition-all" style="width: ${moduleProgress}%"></div>
                                    </div>
                                    <span class="text-xs text-gray-400 font-mono whitespace-nowrap">${completedInModule}/${totalInModule}</span>
                                </div>
                            </button>
                            
                            <div class="${isOpen ? 'block' : 'hidden'} border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-slate-900/50">
                                ${module.lessons.map(lesson => {
                                    const isDone = state.completedLessons.includes(lesson.id);
                                    return `
                                    <button onclick="openLesson('${lesson.id}')" class="w-full p-4 pl-6 text-left flex items-center gap-4 hover:bg-white dark:hover:bg-slate-800 border-b border-gray-100 dark:border-gray-800 last:border-0 transition-colors group">
                                        <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center transition-colors ${isDone ? 'bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400' : 'bg-white dark:bg-slate-800 border border-gray-200 dark:border-gray-700 text-gray-400 group-hover:border-primary group-hover:text-primary'}">
                                            <i class="fa-solid ${isDone ? 'fa-check' : 'fa-play'} text-xs"></i>
                                        </div>
                                        <div class="flex-1">
                                            <span class="block text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-0.5">–£—Ä–æ–∫ ${lesson.id}</span>
                                            <span class="font-medium text-gray-700 dark:text-gray-200 text-sm md:text-base">${lesson.title}</span>
                                        </div>
                                        <i class="fa-solid fa-chevron-right text-gray-300 text-xs opacity-0 group-hover:opacity-100 transition-opacity"></i>
                                    </button>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                });
            }

            html += `</div></div>`;
            contentArea.innerHTML = html;
        }

        function renderLessonView(lessonId) {
            const module = curriculum.find(m => m.lessons.some(l => l.id === lessonId));
            const lesson = module.lessons.find(l => l.id === lessonId);
            const lessonIndex = module.lessons.findIndex(l => l.id === lessonId);
            const quiz = lesson.quiz;
            
            // Navigation Logic
            const flatLessons = curriculum.flatMap(m => m.lessons);
            const globalIndex = flatLessons.findIndex(l => l.id === lessonId);
            const prevLesson = globalIndex > 0 ? flatLessons[globalIndex - 1] : null;
            const nextLesson = globalIndex < flatLessons.length - 1 ? flatLessons[globalIndex + 1] : null;

            state.currentView = 'lesson';
            state.activeLesson = lesson;
            
            backBtn.classList.remove('hidden');
            headerTitle.textContent = lesson.id;
            contentArea.scrollTop = 0;

            const isCompleted = state.completedLessons.includes(lessonId);
            
            contentArea.innerHTML = `
                <div class="animate-fade-in pb-10">
                    <div class="flex flex-col md:grid md:grid-cols-12 md:gap-8 md:p-8 md:items-start max-w-7xl mx-auto">
                        
                        <!-- Video Column -->
                        <div class="w-full md:col-span-4 lg:col-span-3 order-1 md:sticky md:top-6">
                            <div class="w-full aspect-[9/16] bg-black relative flex items-center justify-center video-placeholder overflow-hidden shadow-2xl md:rounded-2xl group">
                                <div class="absolute inset-0 bg-black/40 group-hover:bg-black/30 transition-colors"></div>
                                <div class="absolute inset-0 flex flex-col items-center justify-center text-white p-6 text-center z-10">
                                    <div class="w-16 h-16 md:w-20 md:h-20 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center mb-6 shadow-2xl ring-4 ring-white/10 group-hover:scale-110 transition-transform duration-300 cursor-pointer">
                                        <i class="fa-solid fa-play text-3xl pl-1"></i>
                                    </div>
                                    <h2 class="text-xl md:text-2xl font-bold drop-shadow-md px-4">${lesson.title}</h2>
                                    <p class="mt-2 text-xs md:text-sm opacity-80 font-medium tracking-wide uppercase">–î–∏–≤–∏—Ç–∏—Å—å –≤—ñ–¥–µ–æ</p>
                                </div>
                            </div>
                        </div>

                        <!-- Content Column -->
                        <div class="md:col-span-8 lg:col-span-9 order-2 flex flex-col h-full">
                            <div class="p-6 md:p-8 bg-white dark:bg-darkSec rounded-t-3xl md:rounded-2xl -mt-6 md:mt-0 relative z-20 shadow-[0_-10px_40px_-15px_rgba(0,0,0,0.3)] md:shadow-none md:bg-transparent md:dark:bg-transparent border-0 md:border md:border-gray-100 md:dark:border-gray-700">
                                <div class="w-12 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full mx-auto mb-8 md:hidden"></div>
                                <div class="mb-8">
                                    <div class="flex justify-between items-start">
                                        <span class="inline-block px-3 py-1 rounded-full bg-blue-100 dark:bg-blue-900/30 text-primary text-xs font-bold uppercase tracking-wider mb-3">–¢–µ–æ—Ä—ñ—è</span>
                                        ${isCompleted ? `<span class="hidden md:inline-flex px-4 py-1 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-full font-bold text-xs items-center gap-2"><i class="fa-solid fa-circle-check"></i> –ü—Ä–æ–π–¥–µ–Ω–æ</span>` : ''}
                                    </div>
                                    <h1 class="text-2xl md:text-4xl font-bold mb-6 leading-tight text-gray-900 dark:text-white">${lesson.title}</h1>
                                    <div class="prose dark:prose-invert prose-lg text-gray-600 dark:text-gray-300 leading-relaxed max-w-none">
                                        <p class="mb-4"><strong class="text-gray-900 dark:text-white">–ö–æ–Ω—Å–ø–µ–∫—Ç:</strong> –¶–µ –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è —É—Ä–æ–∫—É ${lesson.id}. –£ —Ä–µ–∞–ª—å–Ω–æ–º—É –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É —Ç—É—Ç –±—É–¥–µ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–∂–Ω–æ—ó —Ç–µ–º–∏.</p>
                                        <div class="bg-yellow-50 dark:bg-yellow-900/20 p-6 rounded-xl border-l-4 border-yellow-400 text-sm md:text-base mt-6">
                                            <strong class="block mb-1 text-yellow-800 dark:text-yellow-200"><i class="fa-regular fa-lightbulb mr-2"></i>–ó–∞–ø–∞–º'—è—Ç–∞–π:</strong> –ö–æ–º–ø‚Äô—é—Ç–µ—Ä–Ω–∞ –Ω–∞—É–∫–∞ ‚Äî —Ü–µ –ø—Ä–æ –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quiz Section -->
                    <div class="max-w-4xl mx-auto px-6 md:px-0 mt-8 md:mt-12 order-3">
                        <div class="bg-gray-50 dark:bg-slate-800 p-6 md:p-10 rounded-2xl border border-gray-200 dark:border-slate-700 shadow-sm">
                            <h3 class="font-bold text-xl md:text-2xl flex items-center gap-3 mb-6">
                                <span class="w-10 h-10 rounded-xl bg-primary text-white flex items-center justify-center shadow-lg"><i class="fa-solid fa-brain"></i></span>
                                –ö–≤—ñ–∑: ${quiz.question}
                            </h3>
                            <div class="space-y-3" id="quizOptions">
                                ${quiz.options.map((opt, idx) => `
                                    <button onclick="checkAnswer(this, ${idx === quiz.correct}, '${lessonId}')" class="w-full p-4 md:p-5 rounded-xl border-2 border-white dark:border-slate-600 bg-white dark:bg-slate-700 text-left hover:border-gray-200 dark:hover:border-gray-500 transition-all font-medium text-base shadow-sm relative group flex items-center gap-4">
                                        <span class="w-8 h-8 rounded-full border-2 border-gray-200 dark:border-gray-500 flex items-center justify-center text-xs font-bold text-gray-400 group-hover:border-gray-400 dark:group-hover:border-gray-300">${String.fromCharCode(65+idx)}</span>
                                        ${opt}
                                    </button>
                                `).join('')}
                            </div>
                            <div id="quizFeedback" class="hidden mt-6 p-4 rounded-xl text-center font-bold text-base animate-bounce-in"></div>
                        </div>

                        <!-- Footer Navigation -->
                        <div class="flex flex-col md:flex-row justify-between items-center pt-8 border-t border-gray-100 dark:border-gray-800 mt-8 gap-4">
                            ${prevLesson ? 
                                `<button onclick="openLesson('${prevLesson.id}')" class="w-full md:w-auto px-6 py-3 text-gray-500 hover:text-gray-900 dark:hover:text-white font-bold transition-colors flex items-center justify-center gap-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800">
                                    <i class="fa-solid fa-arrow-left"></i> ${prevLesson.title}
                                </button>` : '<div></div>'
                            }
                            
                            ${nextLesson ? 
                                `<button onclick="openLesson('${nextLesson.id}')" class="w-full md:w-auto px-6 py-3 bg-dark dark:bg-white text-white dark:text-dark rounded-xl font-bold shadow-lg hover:shadow-xl active:scale-95 transition-all flex items-center justify-center gap-2">
                                    –ù–∞—Å—Ç—É–ø–Ω–∏–π: ${nextLesson.title} <i class="fa-solid fa-arrow-right"></i>
                                </button>` : 
                                `<button onclick="renderHome()" class="w-full md:w-auto px-6 py-3 bg-green-500 text-white rounded-xl font-bold shadow-lg hover:shadow-xl active:scale-95 transition-all">
                                    –ó–∞–≤–µ—Ä—à–∏—Ç–∏ –∫—É—Ä—Å <i class="fa-solid fa-flag-checkered ml-2"></i>
                                </button>`
                            }
                        </div>
                    </div>
                </div>
            `;
        }

        // --- ACTIONS ---

        function handleSearch(query) {
            state.searchQuery = query;
            renderHome();
            // Refocus search input after re-render
            setTimeout(() => {
                const input = document.getElementById('searchInput');
                if(input) {
                    input.focus(); 
                    input.setSelectionRange(input.value.length, input.value.length);
                }
            }, 0);
        }

        function filterCurriculum(query) {
            if (!query) return curriculum;
            const lowerQuery = query.toLowerCase();
            return curriculum.map(mod => {
                const matchingLessons = mod.lessons.filter(l => 
                    l.title.toLowerCase().includes(lowerQuery) || 
                    l.id.includes(lowerQuery)
                );
                // Return module if it matches OR if any lesson matches
                if (mod.title.toLowerCase().includes(lowerQuery) || matchingLessons.length > 0) {
                    return {
                        ...mod,
                        lessons: matchingLessons.length > 0 ? matchingLessons : mod.lessons 
                    };
                }
                return null;
            }).filter(Boolean);
        }

        window.toggleModule = (id) => {
            state.activeModuleId = state.activeModuleId === id ? null : id;
            renderHome();
        };

        window.openLesson = (id) => {
            renderLessonView(id);
        };

        window.goBack = () => {
            renderHome();
        };

        backBtn.addEventListener('click', goBack);

        window.checkAnswer = (btn, isCorrect, lessonId) => {
            const parent = document.getElementById('quizOptions');
            const feedback = document.getElementById('quizFeedback');
            
            Array.from(parent.children).forEach(child => {
                child.classList.remove('ring-2', 'ring-green-500', 'ring-red-500', 'bg-green-50', 'bg-red-50', 'dark:bg-green-900/30', 'dark:bg-red-900/30', 'border-green-500', 'border-red-500');
                child.classList.add('opacity-60', 'cursor-not-allowed');
                child.disabled = true;
            });
            btn.classList.remove('opacity-60', 'cursor-not-allowed', 'border-white', 'dark:border-slate-600');
            btn.classList.add('opacity-100');
            feedback.classList.remove('hidden');

            if (isCorrect) {
                btn.classList.add('ring-2', 'ring-green-500', 'bg-green-50', 'dark:bg-green-900/30', 'border-green-500');
                btn.querySelector('span').classList.add('bg-green-500', 'text-white', 'border-green-500');
                feedback.innerHTML = '<i class="fa-regular fa-face-smile text-2xl mb-2 block"></i> –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –¢–∏ —Å—É–ø–µ—Ä!';
                feedback.classList.add('text-green-700', 'dark:text-green-300', 'bg-green-100', 'dark:bg-green-900/20');
                
                // Trigger Confetti
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });

                if (!state.completedLessons.includes(lessonId)) {
                    state.completedLessons.push(lessonId);
                    localStorage.setItem('cs_completed', JSON.stringify(state.completedLessons));
                }
            } else {
                btn.classList.add('ring-2', 'ring-red-500', 'bg-red-50', 'dark:bg-red-900/30', 'border-red-500');
                btn.querySelector('span').classList.add('bg-red-500', 'text-white', 'border-red-500');
                feedback.innerHTML = '<i class="fa-regular fa-face-frown text-2xl mb-2 block"></i> –°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑.';
                feedback.classList.add('text-red-700', 'dark:text-red-300', 'bg-red-100', 'dark:bg-red-900/20');
            }
        };

        // --- INIT ---
        initTheme();
        renderLanding();
    </script>
</body>
</html>
